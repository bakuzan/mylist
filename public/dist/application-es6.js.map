{"version":3,"sources":["application.js"],"names":["ApplicationConfiguration","applicationModuleName","applicationModuleVendorDependencies","registerModule","moduleName","dependencies","angular","module","requires","push","config","$locationProvider","hashPrefix","run","$rootScope","$state","Authentication","$on","event","toState","name","user","_id","preventDefault","go","element","document","ready","window","location","hash","bootstrap","Menus","addMenuItem","addSubMenuItem","$stateProvider","state","url","templateUrl","controller","AnimeitemsController","$inject","$scope","$stateParams","$location","Animeitems","Mangaitems","fileUpload","$sce","$window","ItemService","ListService","NotificationFactory","AnimeFactory","spinnerService","TagService","$uibModal","ctrl","authentication","filterConfig","ongoingList","showingCount","expandFilters","sortType","sortReverse","ratingLevel","undefined","ratingActions","maxRating","percent","overStar","search","searchTags","tagsForFilter","taglessItem","areTagless","selectListOptions","statTags","commonArrays","getCommonArrays","getItemsAvailable","viewItem","findOne","latestDate","pageConfig","currentPage","pageSize","remove","tickOff","trustAsResourceUrl","update","usedTags","viewItemHistory","whichController","getSelectListOptions","animeitem","confirmation","$remove","i","animeitems","splice","path","warning","item","episodes","latest","Date","updated","modalInstance","open","animation","size","resolve","data","type","result","then","console","log","meta","get","animeitemId","$promise","getAnime","value","loading","query","status","checkForTagless","buildStatTags","onHold","CreateAnimeController","addedEpisodes","addTag","title","updateHistory","create","dropTag","finalNumbers","find","findManga","imgPath","itemUpdate","init","removeTag","sections","showAdditional","showCompletion","showItemTags","setInSeason","submit","tagArray","tagArrayRemove","uploadFile","isCreate","start","newTag","text","tags","finalEpisode","reWatching","end","season","year","substring","image","convertDateToSeason","disc","manga","$save","response","success","errorResponse","error","message","mangaitems","myFile","uploadFileToUrl","WatchAnimeController","$timeout","saved","localStorage","getItem","playVideo","startRewatch","videoFile","processed","file","number","watchedList","JSON","parse","updateWatchedList","setItem","stringify","$watch","nVal","oVal","video","files","findWithAttr","URL","createObjectURL","parseInt","length","WatchListController","WatchAnime","$filter","watchAnime","id","sortOptions","sortOption","v","directive","animeItemModel","restrict","replace","fileModel","$parse","link","scope","attrs","model","modelSetter","assign","bind","$apply","keycuts","postLink","e","altKey","keyCode","isList","view","listBack","css","listFilters","items","page","elem","passTag","tag","indexOf","split","hoveringOver","itemsAvailable","collapseFilters","swOnplay","el","addEventListener","pageControls","pageCount","Math","ceil","last","first","next","prev","ctrlKey","filter","endedMonth","array","month","substr","endedSeason","moment","num","startMonth","startYear","diff","weeks","pad","slice","ratingFilter","rating","seasonForCharacterAnime","anime","startFrom","input","statisticsDetailFilter","division","filterPart","summaryYear","factory","episodeRating","concatenateTagArrays","itemHistory","itemRevisits","reWatchCount","$update","href","AnimeitemsFactory","$resource","method","service","$http","obj","uploadUrl","fd","FormData","append","post","transformRequest","identity","headers","err","popup","buildOverview","buildRatingsDistribution","completeByMonth","completeBySeason","deleteHistory","endingYears","getRatingValues","maxCompleteMonth","maxTagCount","ratingsWeighted","setSeason","date","getFullYear","getMonth","seasons","Number","history","latestHistory","chapters","reReading","now","temp","forEach","past","count","currentPart","finalPart","repeating","index","revisits","today","displayDate","toISOString","fromNow","format","overview","ongoing","completed","modeMap","maxCount","tempRating","maxRatedCount","averageRating","values","averageItemRating","add","checkedRating","itemCount","len","ratedCount","ratings","ratingAdded","ratingAvg","ratingWeighted","weights","unratedCount","total","k","isNaN","possibleValues","ratingsDistribution","colour","percentage","toFixed","years","itemYears","monthDetails","completeByMonthItems","months","max","seasonDetails","completeBySeasonItems","maxCompleteSeason","$q","groupItemsByProperties","manipulateString","numberOfPages","stringReverse","weekEndingForDate","string","reverse","join","pagingDetails","attr","groupProperties","reject","groupedArrays","groupBy","getGroupProperties","groups","group","f","o","Object","keys","map","transform","onlyFirst","toLowerCase","charAt","toUpperCase","convertToSunday","day","getDay","getDate","wkEnd","setDate","endOf","n","searchName","media","mediaType","repeatType","itemTags","alreadyAdded","j","itemTypes","categories","days","summaryFunctions","CharactersController","Characters","CharacterService","seriesFilter","voiceActors","series","findAnime","findOneAnime","findOneManga","maxItemCount","mangaitem","character","voice","characters","buildCharacterTags","buildVoiceActors","buildSeriesList","characterId","mangaitemId","characterBack","clearTagValues","characterTags","deleteSearchTag","disableNgAnimate","$animate","enabled","deletingItem","$parent","enterTag","which","$eval","entry_type","slider","slides","interval","bindToController","controllerAs","self","timer","autoSlide","currentIndex","enter","goToSlide","isFullscreen","leave","repeater","toggleFullscreen","slide","filteredSlides","locked","cancel","visible","sliderController","childElementCount","mediaFilter","seriesDetailFilter","detailSeriesName","tagFilter","found","tagsToSearch","buildGenderDistribution","check","gender","buildRelatedCharacterTags","tagDetailCollection","tagDetailResult","bit","statSeries","CharacterFactory","HeaderController","changeTheme","isActive","isCollapsed","isTimedTheme","menu","getMenu","styles","theme","timedTheme","toggleCollapsibleMenu","viewLocation","timeOfDayTheme","time","getHours","storedValue","getElementById","lastIndexOf","anywhereButHere","$document","body","on","inThing","target","inheritedData","ignore","ngShow","clickPass","stopPropagation","click","formatDate","require","modelCtrl","$formatters","modelValue","loadingSpinner","transclude","active","api","show","hide","toggle","_register","_unregister","myProgress","val","html","calendarFilter","datesSelected","currentWkEnd","iDate","itemDate","currentDate","dateSuffix","suffixes","dtfilter","relevantDigits","suffix","dateArray","dayFilter","daySelected","ds","numberFixedLen","FunctionService","width","padChar","Array","defaultRoles","menus","shouldRender","roles","userRoleIndex","roleIndex","isPublic","validateMenuExistance","menuId","Error","addMenu","removeMenu","menuItemTitle","menuItemURL","menuItemType","menuItemUIRoute","position","menuItemClass","uiRoute","rootMenuItemURL","itemIndex","removeMenuItem","removeSubMenuItem","submenuItemURL","subitemIndex","toastr","options","swal","thenDo","showCancelButton","closeOnConfirm","confirmButtonText","confirmButtonColor","SpinnerService","spinners","queue","loads","hasOwnProperty","optionsOrPromise","spinner","always","promise","extend","$urlRouterProvider","otherwise","HistoryController","AnimeHistory","MangaHistory","HistoryService","buildHistory","historyFilter","happenedWhen","historyGroups","buildHistoryList","animeHistory","mangaHistory","newValue","when","ViewHistoryController","$uibModalInstance","historyStore","close","dismiss","historySeparator","level","timeframe","startOf","filterItemHistory","extractHistory","getEndsOfWeek","getSetDaysAgo","groupItemHistory","weekBeginning","weekEnding","endsOfWeek","mondays","sundays","thisMonday","thisSunday","thisEnd","daysAgo","newDate","subtract","wkBeg","deferred","defer","sort","a","b","dateA","dateB","cutoff","prevItem","groupedHistory","oldest","thisDate","MangaitemsController","MangaFactory","volumes","finalChapter","finalVolume","hardcopy","mangaItemModel","reReadCount","MangaitemsFactory","CompleteOrdersController","order","newPrice","company","price","prototype","editOrder","nextVolume","prices","completeOrder","rrp","paid","controllerId","CreateOrdersController","Orders","isCreateMode","orderId","orderCopy","volume","orderHistory","stepConfig","stepHeaders","currentStep","stepCount","_this","copy","takeStep","step","direction","processOrder","openBoughtDialog","OrderHistoryController","processHistory","cost","purchaseDate","rrpInstance","saving","OrdersController","orders","openOrderHistoryDialog","OrdersFactory","RatingsController","StatisticsService","episodeScore","itemScore","modelOptions","debounce","viewEpisodeRatings","getItems","score","isEqual","buildSummaryFunctions","finished","focusOnShow","myValue","focus","StatisticsController","Toptens","colours","red","green","blue","dataStore","toptens","detail","isVisible","divisionText","summary","isEpisodeRatings","tagDetail","topten","isRanked","isFavourite","generateSeasons","getFilteredItems","getToptenItemStatistics","historyDetail","historyDetails","tableDetail","tableDetails","listCount","getItemStatistics","ratingValues","buildToptenModeList","totalListCount","buildToptenDataStructure","toptenType","filteredItems","getSummaryFunctions","buildYearSummary","yearSummary","episodeSummaryFunctions","buildEpisodeSummaries","summaryType","historyChange","filtered","detailSeasonYear","detailSeason","detectFlood","overflowCheck","scrollWidth","offsetWidth","classList","percentageBarContainer","border","template","percentageBar","display","percentageBarContainerCtrl","tabContainer","tabs","currentTab","listShift","addTab","tab","disable","disabledTab","disabled","select","selectedTab","heading","shiftTabs","elWidth","ulWidth","ul","children","$viewValue","$setViewValue","shift","style","left","tabView","tabContainerCtrl","getModeMap","occuranceCounter","highestRating","lowestRating","modeRating","sum","metric","processYearSummary","results","filteredArray","arrayOfArrays","listType","itemLen","CreateTaskController","Tasks","TaskFactory","newTaskModel","addChecklistItem","backStep","dropChecklistItem","setNewTask","newTask","description","linked","repeat","category","daily","checklist","checklistItems","isAddTask","checklistItem","complete","task","completeTimes","updateCheck","process","valid","linkItems","linkType","ScheduleCalendarTaskController","refresh","timeDiff","abs","getTime","daysFromToday","events","insertChecklistItem","removeTask","tickOffChecklist","updateTask","weekEnds","floor","aDate","bDate","newChecklistItem","TasksController","createTask","dateOptions","dateDisabled","formatYear","maxDate","minDate","startingDay","refreshItems","setTabFilterDay","tabFilter","tabName","getWeekBeginning","tasks","checkStatus","parts","single","all","change","dailyRefresh","UpdateAnimeTaskController","episodeCompleted","episodeNumber","isComplete","ratingLimit","UpdateMangaTaskController","loseInterest","interesting","elm","tagName","alsoInteresting","scheduleCalendar","_removeTime","hour","minute","second","millisecond","_buildMonth","done","monthIndex","_buildWeek","isCurrentMonth","isToday","isSame","_displayEvents","selected","previous","shadowModel","att","shadow","taskItemModel","passClick","passTo","updateAnimeitem","updateMangaitem","errorMessage","userCheck","removeTaskProcess","launchMangaUpdateDialog","checklistIndex","itemOriginal","launchAnimeUpdateDialog","isLinked","animeDialog","dialog","taskId","CreateToptenController","toptenCopy","animeList","mangaList","characterList","conditions","limit","imgSize","height","pushCondition","pushItem","removeCondition","removeItem","steps","listGen","itemsCached","displayList","seriesList","typeDisplay","toptenItem","seriesLimit","tagLimit","limitMin","swapping","one","two","swappingItems","typeSetItemPopulate","getYears","callback","indexTwo","inital","toptenId","StatisticsTopten","list","toptenInfo","ToptensController","openListStats","viewConfig","displayType","linkSuffix","horizontalListItem","horizontalListCtrl","itemWidth","register","horizontalList","clicks","moveItems","setVisibility","child","settings","listSettings","ngMax","$isDirty","isEmpty","isUndefined","maxValidator","Infinity","$setValidity","$parsers","ngMin","minValidator","min","oneStep","stepsController","stepNumber","stepControls","sticky","evt","stickyClass","stickyInnerClass","scrollTop","inner","viewportOffset","getBoundingClientRect","distance_from_top","top","toptenFilter","ToptensFactory","$httpProvider","interceptors","responseError","rejection","AuthenticationController","signin","signup","credentials","username","loginBody","askForPasswordReset","resetUserPassword","token","passwordDetails","Users","hasConnectedAdditionalSocialAccounts","provider","additionalProvidersData","isConnectedSocialAccount","removeUserSocialAccount","delete","params","updateUserProfile","isValid","submitted","changeUserPassword","AuthenticationFactory","_data","UsersFactory"],"mappings":"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","file":"application-es6.js","sourcesContent":["'use strict';\r\n\r\n// Init the application configuration module for AngularJS application\r\nvar ApplicationConfiguration = (function() {\r\n\t// Init module configuration options\r\n\tvar applicationModuleName = 'mylist';\r\n\tvar applicationModuleVendorDependencies = ['ngResource', 'ngCookies',  'ngAnimate',  'ngTouch',  'ngSanitize',  'ui.router', 'ui.bootstrap', 'ui.utils', 'angularFileUpload', 'angularMoment'];\r\n\r\n\t// Add a new vertical module\r\n\tvar registerModule = function(moduleName, dependencies) {\r\n\t\t// Create angular module\r\n\t\tangular.module(moduleName, dependencies || []);\r\n\r\n\t\t// Add the module to the AngularJS configuration file\r\n\t\tangular.module(applicationModuleName).requires.push(moduleName);\r\n\t};\r\n\r\n\treturn {\r\n\t\tapplicationModuleName: applicationModuleName,\r\n\t\tapplicationModuleVendorDependencies: applicationModuleVendorDependencies,\r\n\t\tregisterModule: registerModule\r\n\t};\r\n})();\n'use strict';\r\n\r\n//Start by defining the main module and adding the module dependencies\r\nangular.module(ApplicationConfiguration.applicationModuleName, ApplicationConfiguration.applicationModuleVendorDependencies);\r\n\r\n// Setting HTML5 Location Mode\r\nangular.module(ApplicationConfiguration.applicationModuleName).config(['$locationProvider',\r\n\tfunction($locationProvider) {\r\n\t\t$locationProvider.hashPrefix('!');\r\n\t}\r\n]);\r\n\r\nangular.module(ApplicationConfiguration.applicationModuleName)\r\n     .run(['$rootScope', '$state', 'Authentication', function ($rootScope, $state, Authentication) {\r\n        $rootScope.$on('$stateChangeStart', function (event, toState) {\r\n\t\t\t\t\tif(toState.name === 'signin') {\r\n\t\t\t\t\t\tif(Authentication.user._id) {\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\t$state.go('listTasks');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t        if (!Authentication.user) {\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t$state.go('signin');\r\n\t        }\r\n\t\t\t\t});\r\n}]);\r\n\r\n//Then define the init function for starting up the application\r\nangular.element(document).ready(function() {\r\n\t//Fixing facebook bug with redirect\r\n\tif (window.location.hash === '#_=_') window.location.hash = '#!';\r\n\r\n\t//Then init the app\r\n\tangular.bootstrap(document, [ApplicationConfiguration.applicationModuleName]);\r\n});\r\n\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('animeitems');\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('characters');\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('core');\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('history');\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('mangaitems');\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('orders');\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('ratings');\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('statistics');\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('tasks');\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('toptens');\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('users');\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('animeitems').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Animeitems', 'animeitems', 'dropdown');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'List Animeitems', 'animeitems');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'Watch Animeitems', 'animeitems/watch-list');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'New Animeitem', 'animeitems/create');\r\n\t}\r\n]);\r\n\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('animeitems').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Animeitems state routing\r\n\t\t$stateProvider.\r\n        state('listAnimeitems', {\r\n\t\t\turl: '/animeitems',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/list-animeitems.client.view.html',\r\n\t\t\tcontroller: 'AnimeitemsController as ctrl'\r\n\t\t}).\r\n\t\tstate('watchListAnimeitems', {\r\n\t\t\turl: '/animeitems/watch-list',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/list-animeitems.client.view.html',\r\n\t\t\tcontroller: 'WatchListController as ctrl'\r\n\t\t}).\r\n\t\tstate('createAnimeitem', {\r\n\t\t\turl: '/animeitems/create',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/create-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewAnimeitem', {\r\n\t\t\turl: '/animeitems/:animeitemId',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/view-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('editAnimeitem', {\r\n\t\t\turl: '/animeitems/:animeitemId/edit',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/create-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('watchAnimeitem', {\r\n\t\t\turl: '/animeitems/watch/:animeitemId',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/watch-animeitem.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('AnimeitemsController', AnimeitemsController);\r\n\tAnimeitemsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'AnimeFactory', 'spinnerService', 'TagService', '$uibModal'];\r\n\r\n\tfunction AnimeitemsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, fileUpload, $sce, $window, ItemService, ListService, NotificationFactory, AnimeFactory, spinnerService, TagService, $uibModal) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n    ctrl.filterConfig = {\r\n        ongoingList: true,\r\n        showingCount: 0,\r\n        expandFilters: false,\r\n        sortType: '',\r\n        sortReverse: true,\r\n        ratingLevel: undefined,\r\n        ratingActions: {\r\n            maxRating: 10,\r\n            percent: undefined,\r\n            overStar: null\r\n        },\r\n        search: {},\r\n        searchTags: '',\r\n        tagsForFilter: [],\r\n        taglessItem: false,\r\n        areTagless: false,\r\n        selectListOptions: {},\r\n        statTags: [],\r\n        commonArrays: ListService.getCommonArrays(),\r\n\t\t\t\tgetItemsAvailable: getItemsAvailable,\r\n\t\t\t\tviewItem: ''\r\n    };\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.latestDate = latestDate;\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.viewItemHistory = viewItemHistory;\r\n\t\tctrl.whichController = 'animeitem';\r\n\r\n\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\r\n    //allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n\r\n\t\t// Remove existing Animeitem\r\n\t\tfunction remove(animeitem) {\r\n\t     //are you sure option...\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( animeitem ) {\r\n\t          animeitem.$remove();\r\n\r\n\t          for (var i in ctrl.animeitems) {\r\n\t            if (ctrl.animeitems [i] === animeitem) {\r\n\t            \tctrl.animeitems.splice(i, 1);\r\n\t            }\r\n\t          }\r\n\t        } else {\r\n\t\t\t\t\t\tctrl.animeitem.$remove(function() {\r\n\t          \t$location.path('animeitems');\r\n\t\t\t\t\t\t});\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Anime was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Update existing Animeitem\r\n\t\tfunction update() {\r\n\t\t\tvar animeitem = ctrl.animeitem;\r\n\t\t\tctrl.animeitem = undefined;\r\n      AnimeFactory.update(animeitem, undefined, true, undefined);\r\n\t\t}\r\n\r\n    function tickOff(item) {\r\n        item.episodes += 1;\r\n        item.latest = new Date(); //update latest.\r\n        ctrl.animeitem = item;\r\n        ctrl.update();\r\n    }\r\n\r\n    //latest date display format.\r\n    function latestDate(latest, updated) {\r\n        return ItemService.latestDate(latest, updated);\r\n    }\r\n\r\n\t\tfunction viewItemHistory() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/history/views/item-history.html',\r\n        controller: 'ViewHistoryController as viewHistory',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { viewItem: ctrl.filterConfig.viewItem, type: 'anime' };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed history: ', result, ctrl.filterConfig.viewItem.meta);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tctrl.animeitem = ctrl.filterConfig.viewItem;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n      });\r\n\t\t}\r\n\r\n\t\t// Find existing Animeitem\r\n\t\tfunction findOne() {\r\n\t    Animeitems.get({ animeitemId: $stateParams.animeitemId }).$promise.then(function(result) {\r\n\t        ctrl.animeitem = result;\r\n\t   \t\t\tconsole.log(ctrl.animeitem);\r\n\t    });\r\n\t\t}\r\n\r\n\t\t/** Find a list of Animeitems for values:\r\n         *  (0) returns only ongoing series. (1) returns all series.\r\n         */\r\n\t\tfunction getAnime(value) {\r\n\t    spinnerService.loading('anime', Animeitems.query({ status: value }).$promise.then(function(result) {\r\n\t        ctrl.animeitems = result;\r\n\t\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\t\tctrl.filterConfig.statTags = ItemService.buildStatTags(result, 0);\r\n\t    }));\r\n\t\t}\r\n\r\n    //Set defaults on requery and \"neutralise\" the other search variable.\r\n    function getItemsAvailable() {\r\n        ctrl.animeitems = undefined;\r\n        if (ctrl.filterConfig.ongoingList === true) {\r\n            ctrl.filterConfig.search.onHold = false;\r\n            ctrl.filterConfig.search.status = '';\r\n            getAnime(0);\r\n        } else {\r\n            ctrl.filterConfig.search.onHold = '';\r\n            ctrl.filterConfig.search.status = false;\r\n            getAnime(1);\r\n        }\r\n    }\r\n\t\tctrl.filterConfig.getItemsAvailable();\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('CreateAnimeController', CreateAnimeController);\r\n\tCreateAnimeController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'AnimeFactory', 'spinnerService', 'TagService'];\r\n\r\n\tfunction CreateAnimeController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, fileUpload, $sce, $window, ItemService, ListService, NotificationFactory, AnimeFactory, spinnerService, TagService) {\r\n\t\tvar ctrl = this,\r\n        animeitemId = $stateParams.animeitemId;\r\n\r\n\t\tctrl.addedEpisodes = addedEpisodes;\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.animeitem = {};\r\n\t\tctrl.authentication = Authentication;\r\n    ctrl.config = {\r\n      title: 'Create',\r\n\t\t\tupdateHistory: false,\r\n      ratingActions: {\r\n          maxRating: 10,\r\n          percent: undefined,\r\n          overStar: null\r\n      },\r\n      statTags: [],\r\n      commonArrays: ListService.getCommonArrays()\r\n    };\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.finalNumbers = false; //default show status of final number fields in edit view.\r\n\t\tctrl.find = find;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.findManga = findManga;\r\n    ctrl.imgPath = ''; //image path\r\n\t\tctrl.itemUpdate = new Date(); // today's date as 'yyyy-MM-dd' for the auto-pop of 'latest' in edit page.\r\n    ctrl.init = init;\r\n\t\tctrl.removeTag = removeTag;\r\n\t\tctrl.sections = {\r\n\t\t\tshowAdditional: false,\r\n\t\t\tshowCompletion: false,\r\n\t\t\tshowItemTags: false\r\n\t\t};\r\n\t\tctrl.setInSeason = setInSeason;\r\n\t\tctrl.submit = submit;\r\n    ctrl.tagArray = []; // holding tags pre-submit\r\n    ctrl.tagArrayRemove = [];\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\r\n    function init() {\r\n      ctrl.config.isCreate = animeitemId === undefined;\r\n      if(ctrl.config.isCreate) {\r\n\t\t\t\tctrl.animeitem.episodes = 0;\r\n\t\t\t\tctrl.animeitem.start = ctrl.itemUpdate;\r\n\t\t\t\tctrl.animeitem.latest = ctrl.itemUpdate;\r\n\t\t\t} else if(!ctrl.config.isCreate) {\r\n        ctrl.config.title = 'Edit';\r\n        ctrl.findOne();\r\n      }\r\n      ctrl.find();\r\n      ctrl.findManga();\r\n    }\r\n    ctrl.init();\r\n\r\n    //For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for animeitem tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.animeitem.tags, text);\r\n\t\t}\r\n\r\n\t\tfunction addedEpisodes() {\r\n\t\t\tctrl.animeitem.latest = ctrl.itemUpdate;\r\n\t\t\tctrl.config.updateHistory = true;\r\n\t\t\tif(ctrl.animeitem.episodes === ctrl.animeitem.finalEpisode && ctrl.animeitem.finalEpisode !== 0 && ctrl.animeitem.reWatching === false) {\r\n\t\t\t\tctrl.animeitem.end = ctrl.itemUpdate;\r\n\t\t\t}\r\n\t\t\tif(ctrl.animeitem.episodes > ctrl.animeitem.finalEpisode && ctrl.animeitem.finalEpisode !== 0) {\r\n\t\t\t\tctrl.animeitem.episodes = ctrl.animeitem.finalEpisode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction setInSeason() {\r\n\t\t\tif(ctrl.animeitem.season.season === null) {\r\n\t\t\t\t ctrl.animeitem.season.year = null;\r\n\t\t\t } else {\r\n\t\t\t\t ctrl.animeitem.season.year = ctrl.animeitem.start.substring(0,4);\r\n\t\t\t }\r\n\t\t}\r\n\r\n\t\t// Create new Animeitem\r\n\t\tfunction create() {\r\n\t\t\t// Create new Animeitem object\r\n      var animeitem = new Animeitems();\r\n      animeitem = new Animeitems ({\r\n          title: ctrl.animeitem.title,\r\n          episodes: ctrl.animeitem.episodes,\r\n          start: ctrl.animeitem.start,\r\n          latest: ctrl.animeitem.latest,\r\n          finalEpisode: ctrl.animeitem.finalEpisode,\r\n\t\t\t\t\timage: ctrl.imgPath,\r\n          season: ctrl.season === true ? ItemService.convertDateToSeason(new Date(ctrl.animeitem.start)) : '',\r\n          disc: ctrl.animeitem.disc,\r\n          manga: ctrl.animeitem.manga!==undefined && ctrl.animeitem.manga!==null ? ctrl.animeitem.manga._id : ctrl.animeitem.manga,\r\n          tags: ctrl.tagArray,\r\n          user: ctrl.user\r\n       });\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\tanimeitem.$save(function(response) {\r\n\t\t\t\t$location.path('/animeitems/' + response._id);\r\n\t\t\t\tNotificationFactory.success('Saved!', 'Anime was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n        NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Update existing Animeitem\r\n\t\tfunction update() {\r\n\t\t\tvar animeitem = ctrl.animeitem;\r\n\t\t\tctrl.animeitem = undefined;\r\n      AnimeFactory.update(animeitem, ctrl.tagArray, ctrl.config.updateHistory, ctrl.imgPath);\r\n\t\t}\r\n\r\n\t\tfunction submit() {\r\n\t\t\tif(ctrl.config.isCreate) ctrl.create();\r\n\t\t\tif(!ctrl.config.isCreate) ctrl.update();\r\n\t\t}\r\n\r\n    // Find a list of Animeitems\r\n    function find() {\r\n        Animeitems.query().$promise.then(function(result) {\r\n\t\t\t\t\tctrl.animeitems = result;\r\n\t\t\t\t\t\tctrl.config.statTags = ItemService.buildStatTags(result, 0);\r\n\t\t\t\t});\r\n    }\r\n\r\n\t\t// Find existing Animeitem\r\n\t\tfunction findOne() {\r\n\t    spinnerService.loading('editAnime', Animeitems.get({ animeitemId: animeitemId }).$promise.then(function(result) {\r\n\t        ctrl.animeitem = result;\r\n\t   \t\t\tconsole.log(ctrl.animeitem);\r\n\t    }));\r\n\t\t}\r\n\r\n    // Find list of mangaitems for dropdown.\r\n    function findManga() {\r\n        ctrl.mangaitems = Mangaitems.query();\r\n    }\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/animeitems/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUploadAnime');\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('WatchAnimeController', WatchAnimeController);\r\n\tWatchAnimeController.$inject = ['$scope', 'Authentication', '$stateParams', '$timeout', 'Animeitems', '$sce', 'ListService', 'AnimeFactory'];\r\n\r\n\tfunction WatchAnimeController($scope, Authentication, $stateParams, $timeout, Animeitems, $sce, ListService, AnimeFactory) {\r\n\t\t\t\tvar ctrl = this,\r\n\t\t\t\t\t\tsaved = localStorage.getItem('watched');\r\n\r\n        ctrl.authentication = Authentication;\r\n\t\t\t\tctrl.findOne = findOne;\r\n\t\t\t\tctrl.playVideo = playVideo;\r\n\t\t\t\tctrl.startRewatch = startRewatch;\r\n\t\t\t\tctrl.update = update;\r\n        ctrl.videoFile = {\r\n  \t\t\t\tprocessed: '',\r\n  \t\t\t\tfile: '',\r\n\t\t\t\t\tnumber: '',\r\n  \t\t\t\tmessage: 'Please select an episode.'\r\n        };\r\n\t\t\t\tctrl.watchedList = (localStorage.getItem('watched') !== null) ? JSON.parse(saved) : {};\r\n\r\n\t\t\t\tfunction updateWatchedList() {\r\n\t\t\t\t\tlocalStorage.setItem('watched', JSON.stringify(ctrl.watchedList));\r\n\t\t\t\t\tctrl.watchedList = JSON.parse(localStorage.getItem('watched'));\r\n\t\t\t\t}\r\n\r\n        $scope.$watch('fileGrab', function(nVal, oVal) {\r\n          if(nVal) {\r\n\t\t\t\t\t\tctrl.videoFile.message = ''; //clear any error.\r\n            ctrl.videoFile.file = nVal.name;\r\n\t\t\t\t\t\tctrl.videoFile.number = ctrl.animeitem.video.files[ListService.findWithAttr(ctrl.animeitem.video.files, 'file', nVal.name)].number;\r\n            ctrl.videoFile.processed = $sce.trustAsResourceUrl(window.URL.createObjectURL(nVal));\r\n          }\r\n        });\r\n\r\n\t\t\t\tfunction playVideo() {\r\n\t\t\t\t\tctrl.watchedList[ctrl.videoFile.file] = true;\r\n\t\t\t\t\tupdateWatchedList();\r\n\t\t\t\t\tif(ctrl.animeitem.reWatching && (ListService.findWithAttr(ctrl.animeitem.video.files, 'file', ctrl.videoFile.file) > -1)) {\r\n\t\t\t\t\t\tctrl.animeitem.episodes = parseInt(ctrl.videoFile.number, 10);\r\n\t\t\t\t\t\tctrl.update();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction startRewatch() {\r\n\t\t\t\t\tconsole.log('startRewatch: ');\r\n\t\t\t\t\tvar i = ctrl.animeitem.video.files.length;\r\n\t\t\t\t\twhile(i--) {\r\n\t\t\t\t\t\tctrl.watchedList[ctrl.animeitem.video.files[i].file] = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdateWatchedList();\r\n\t\t\t\t\tctrl.animeitem.episodes = 0;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Update existing Animeitem\r\n\t\t\t\tfunction update() {\r\n\t\t\t\t\tctrl.animeitem.latest = new Date();\r\n\t\t      AnimeFactory.update(ctrl.animeitem, undefined, false, '');\r\n\t\t\t\t}\r\n\r\n        // Find existing Animeitem\r\n    \t\tfunction findOne() {\r\n    \t    Animeitems.get({ animeitemId: $stateParams.animeitemId }).$promise.then(function(result) {\r\n    \t        ctrl.animeitem = result;\r\n    \t   \t\t\tconsole.log(ctrl.animeitem);\r\n    \t    });\r\n    \t\t}\r\n        ctrl.findOne();\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('WatchListController', WatchListController);\r\n\tWatchListController.$inject = ['$scope', 'Authentication', '$state', '$sce', 'spinnerService', 'ItemService', 'ListService', 'WatchAnime', '$filter'];\r\n\r\n\tfunction WatchListController($scope, Authentication, $state, $sce, spinnerService, ItemService, ListService, WatchAnime, $filter) {\r\n\t\t\t\tvar ctrl = this;\r\n\r\n        ctrl.authentication = Authentication;\r\n\t\t\t\tctrl.filterConfig = {\r\n\t\t        ongoingList: true,\r\n\t\t        showingCount: 0,\r\n\t\t        expandFilters: false,\r\n\t\t        sortType: '',\r\n\t\t        sortReverse: true,\r\n\t\t        ratingLevel: undefined,\r\n\t\t        ratingActions: {\r\n\t\t            maxRating: 10,\r\n\t\t            percent: undefined,\r\n\t\t            overStar: null\r\n\t\t        },\r\n\t\t        search: {},\r\n\t\t        searchTags: '',\r\n\t\t        tagsForFilter: [],\r\n\t\t        taglessItem: false,\r\n\t\t        areTagless: false,\r\n\t\t        selectListOptions: {},\r\n\t\t        statTags: [],\r\n\t\t        commonArrays: ListService.getCommonArrays()\r\n\t\t    };\r\n\t\t\t\tctrl.find = find;\r\n\t\t\t\tctrl.latestDate = latestDate;\r\n\t\t\t\tctrl.pageConfig = {\r\n\t\t\t\t\t\tcurrentPage: 0,\r\n\t\t\t\t\t\tpageSize: 10\r\n\t\t\t\t};\r\n\t\t\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\t\t\tctrl.watchAnime = watchAnime;\r\n\t\t\t\tctrl.whichController = 'watch';\r\n\r\n\t\t\t\tfunction watchAnime(id) {\r\n\t\t\t\t\t$state.go('watchAnimeitem', { animeitemId: id });\r\n\t\t\t\t}\r\n\r\n        // Find a list of Animeitems\r\n        function find() {\r\n\t\t\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t\t\t\t\tctrl.filterConfig.sortType = ctrl.filterConfig.selectListOptions.sortOptions[ctrl.filterConfig.selectListOptions.sortOption].v; //Set sort order.\r\n          spinnerService.loading('watch', WatchAnime.query().$promise.then(function(result) {\r\n  \t\t\t\t\tctrl.animeitems = result;\r\n\t\t\t\t\t\tconsole.log('watch list: ', result, 'filterConfig: ', ctrl.filterConfig);\r\n  \t\t\t\t}));\r\n        }\r\n        ctrl.find();\r\n\r\n\t\t\t\t//allow retreival of local resource\r\n\t\t    function trustAsResourceUrl(url) {\r\n\t\t        return $sce.trustAsResourceUrl(url);\r\n\t\t    }\r\n\r\n\t\t\t\t//latest date display format.\r\n\t\t    function latestDate(latest, updated) {\r\n\t\t        return ItemService.latestDate(latest, updated);\r\n\t\t    }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('animeItemModel', animeItemModel);\r\n\r\n  function animeItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/animeitems/templates/anime-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('fileModel', fileModel);\r\n  fileModel.$inject = ['$parse'];\r\n\r\n  function fileModel($parse) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function(scope, element, attrs) {\r\n            var model = $parse(attrs.fileModel);\r\n            var modelSetter = model.assign;\r\n\r\n            element.bind('change', function(){\r\n                scope.$apply(function(){\r\n                    modelSetter(scope, element[0].files[0]);\r\n                });\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('keycuts', keycuts);\r\n\r\n  function keycuts() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function postLink(scope, element, attrs) {\r\n              //keydown catch - alt+v for view\r\n              scope.$on('my:keydown', function(event, e) {\r\n  //                console.log(event, e);\r\n                  if (e.altKey && e.keyCode===86) {\r\n                      if (scope.isList==='list') {\r\n                          scope.isList = 'slider';\r\n                      } else if (scope.isList==='slider') {\r\n                          scope.isList = 'list';\r\n                      } else if (scope.view === 'Anime') {\r\n                          scope.view = 'Manga';\r\n                      } else if (scope.view === 'Manga') {\r\n                          scope.view = 'Character';\r\n                      } else if (scope.view === 'Character') {\r\n                          scope.view = 'Anime';\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('listBack', listBack);\r\n   function listBack() {\r\n      return function(scope, element, attrs){\r\n          var url = attrs.listBack;\r\n          element.css({\r\n              'background-image': 'url(' + url +')',\r\n              'background-size' : '50%',\r\n              'background-repeat': 'no-repeat',\r\n              'background-position': 'right'\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('listFilters', listFilters);\r\n\r\n  function listFilters() {\r\n      return {\r\n          restrict: 'EA',\r\n          replace: true,\r\n          scope: {\r\n              filterConfig: '=',\r\n              items: '=',\r\n              page: '='\r\n          },\r\n          templateUrl: '/modules/animeitems/templates/list-filters.html',\r\n          link: function(scope, elem, attrs) {\r\n              scope.filterConfig.searchTags = '';\r\n              scope.passTag = function(tag) {\r\n                if (scope.filterConfig.searchTags.indexOf(tag) === -1) {\r\n                    scope.filterConfig.searchTags += tag + ',';\r\n                    scope.filterConfig.tagsForFilter = scope.filterConfig.searchTags.substring(0, scope.filterConfig.searchTags.length - 1).split(',');\r\n                }\r\n              };\r\n              //rating 'tooltip' function\r\n              scope.hoveringOver = function(value) {\r\n                scope.filterConfig.ratingActions.overStar = value;\r\n                scope.filterConfig.ratingActions.percent = 100 * (value / scope.filterConfig.ratingActions.maxRating);\r\n              };\r\n\r\n              scope.itemsAvailable = function() {\r\n                scope.filterConfig.getItemsAvailable();\r\n              };\r\n\r\n              scope.collapseFilters = function() {\r\n                scope.filterConfig.expandFilters = false;\r\n              };\r\n\r\n          }\r\n\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('swOnplay', swOnplay);\r\n\r\n  function swOnplay() {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        var el = element[0];\r\n        el.addEventListener('play', function() {\r\n          scope.$apply(attrs.swOnplay);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('pageControls', pageControls);\r\n\r\n  function pageControls() {\r\n    return {\r\n        restrict: 'EA',\r\n        replace: true,\r\n        scope: {\r\n            pageConfig: '=',\r\n            showingCount: '='\r\n        },\r\n        templateUrl: '/modules/animeitems/templates/page-controls.html',\r\n        link: function(scope, elem, attrs) {\r\n            /** Calculate page count.\r\n             *    If showingCount isn't caluclated in time...\r\n             *    If the pageSize is altered...\r\n             */\r\n                scope.$watch('showingCount', function() {\r\n                    scope.pageCount = Math.ceil(scope.showingCount / scope.pageConfig.pageSize);\r\n                    if (scope.pageConfig.currentPage > scope.pageCount - 1) {\r\n                        scope.last(); //in the event changing page size would put you above the last page.\r\n                    } else if (scope.pageConfig.currentPage < 0) {\r\n                        scope.first();\r\n                    }\r\n                });\r\n\r\n            /** Button Functions\r\n             *    go to next/prev pages. skip to first/last page.\r\n             */\r\n            scope.first = function() {\r\n  //              console.log('first');\r\n                scope.pageConfig.currentPage = 0;\r\n            };\r\n            scope.last = function() {\r\n  //              console.log('last');\r\n                scope.pageConfig.currentPage = scope.pageCount - 1;\r\n            };\r\n            scope.next = function() {\r\n  //              console.log('next');\r\n                scope.pageConfig.currentPage += 1;\r\n            };\r\n            scope.prev = function() {\r\n  //              console.log('prev');\r\n                scope.pageConfig.currentPage -= 1;\r\n            };\r\n\r\n            //Catches ctrl+left/right keypresses to change pages.\r\n            scope.$on('my:keydown', function(event, e) {\r\n  //              console.log(event, e);\r\n              if (e.ctrlKey && e.keyCode===39 && scope.pageConfig.currentPage < scope.pageCount - 1) {\r\n                  scope.next();\r\n              } else if (e.ctrlKey && e.keyCode===37 && scope.pageConfig.currentPage > 0) {\r\n                  scope.prev();\r\n              }\r\n            });\r\n\r\n        }\r\n    };\r\n\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('endedMonth', endedMonth);\r\n\r\n  function endedMonth() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n          //ended stat month filter\r\n                  if (item.end!==undefined && item.end!==null) {\r\n                      if (item.end.substring(0,4)===year) {\r\n                          if (item.end.substr(5,2)===month) {\r\n                              return item;\r\n                          }\r\n                      }\r\n                  }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('endedSeason', endedSeason);\r\n  endedSeason.$inject = ['moment'];\r\n\r\n  function endedSeason(moment) {\r\n      //ended stat season filter\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n                  var start = moment(item.start), end = moment(item.end), num, startMonth, startYear, diff, weeks, pad = '00';\r\n                  if (item.end!==undefined && item.end!==null) {\r\n                      /**\r\n                       *  Can currently handle shows of 1 or 2 seasons with 'standard' lengths (10-13) / (22-26) that\r\n                       *  start and finish in the 'normal' season months (J-M,A-J,J-S,O-D) / (J-J,A-S,J-D,O-M).\r\n                       */\r\n                      if (9 < item.finalEpisode && item.finalEpisode < 14) {\r\n                          startMonth = (pad + (month - 2)).slice(-pad.length);\r\n                          if ((item.end.substring(0,4) === year && item.end.substr(5,2) === month) || (item.start.substring(0,4) === year && item.start.substr(5,2) === startMonth)) {\r\n                              diff = end.diff(start, 'days');\r\n                              weeks = Math.ceil(diff / 7) + 1; //add one to correct for the first ep. counting as week 0 in an equation.\r\n                              if (weeks >= item.episodes) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      } else if (13 < item.finalEpisode && item.finalEpisode < 26) {\r\n                          num = (month - 5) > 0 ? (month - 5) : 10;\r\n                          startYear = (month - 5) > 0 ? year : year - 1;\r\n                          startMonth = (pad + num).slice(-pad.length);\r\n                          if ((item.end.substring(0,4) === year && item.end.substr(5,2) === month) || (item.start.substring(0,4) === startYear && item.start.substr(5,2) === startMonth)) {\r\n                              diff = end.diff(start, 'days');\r\n                              weeks = Math.ceil(diff / 7) + 1; //add one to correct for the first ep. counting as week 0 in an equation.\r\n                              if (weeks >= item.episodes) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('ratingFilter', ratingFilter);\r\n\r\n  function ratingFilter() {\r\n      return function(array, rating) {\r\n          if (array !== undefined) {\r\n              //filter for rating stars\r\n              return array.filter(function(item) {\r\n      //            console.log(item);\r\n                  if (item.rating===rating) {\r\n                      return item;\r\n                  } else if (rating===undefined) {\r\n                      return item;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('seasonForCharacterAnime', seasonForCharacterAnime);\r\n\r\n  function seasonForCharacterAnime() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n              if (item.anime && item.anime.season !== undefined && item.anime.season !== null) {\r\n                  if (item.anime.season.year === year && item.anime.season.season === month) {\r\n                      return item;\r\n                  }\r\n              }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('season', season);\r\n\r\n  function season() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n              if (item.season !== undefined && item.season !== null) {\r\n                  if (item.season.year === year && item.season.season === month) {\r\n                      return item;\r\n                  }\r\n              }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('startFrom', startFrom);\r\n\r\n   function startFrom() {\r\n      return function(input, start) {\r\n          if (input !== undefined) {\r\n              start = +start; //parse to int\r\n              return input.slice(start);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('statisticsDetailFilter',statisticsDetailFilter);\r\n   statisticsDetailFilter.$inject = ['$filter'];\r\n\r\n   function statisticsDetailFilter($filter) {\r\n      return function(array, type, year, division) {\r\n          var filter = (division === '')   ? 'summaryYear' :\r\n                       (type === 'months') ? 'endedMonth'  :\r\n                                             'season'      ,\r\n              filterPart = (division === '') ? type : division;\r\n          return $filter(filter)(array, year, filterPart);\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('summaryYear', summaryYear);\r\n\r\n  function summaryYear() {\r\n      return function(array, year, type) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                if (type === 'months' && item.end !== undefined && item.end !== null) {\r\n                    if (item.end.substring(0,4) === year) {\r\n                        return item;\r\n                    }\r\n                } else if (type === 'seasons') {\r\n                    if (item.season.year === year) {\r\n                        return item;\r\n                    }\r\n                }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('AnimeFactory', AnimeFactory);\r\n\tAnimeFactory.$inject = ['Animeitems', 'ListService', 'ItemService', 'NotificationFactory', '$location'];\r\n\r\n\tfunction AnimeFactory(Animeitems, ListService, ItemService, NotificationFactory, $location) {\r\n\t    return {\r\n\t        update: function(item, tagArray, updateHistory, imgPath, episodeRating) {\r\n\t            var animeitem = item;\r\n\t            console.log(animeitem);\r\n\t            //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n\t            if (item.manga!==null && item.manga!==undefined) {\r\n\t                animeitem.manga = item.manga._id;\r\n\t            }\r\n\r\n\t            if (tagArray!==undefined) {\r\n\t                animeitem.tags = ListService.concatenateTagArrays(animeitem.tags, tagArray);\r\n\t            }\r\n\r\n\t            //update the item history.\r\n\t            animeitem = ItemService.itemHistory(animeitem, updateHistory, 'anime', episodeRating);\r\n\r\n\t            if (imgPath!==undefined && imgPath!==null && imgPath!=='') {\r\n\t                animeitem.image = imgPath;\r\n\t            }\r\n\t            //console.log($scope.imgPath);\r\n\t            //console.log(animeitem.image);\r\n\r\n\t            //handle end date\r\n\t            if (animeitem.episodes === animeitem.finalEpisode && animeitem.finalEpisode!==0) {\r\n\t                if (animeitem.end===undefined || animeitem.end === null) {\r\n\t                    animeitem.end = animeitem.latest;\r\n\t//                    console.log(animeitem.end);\r\n\t                }\r\n\t            } else if (animeitem.reWatching === false) {\r\n\t                //in the event the 'complete-ness' of an entry needs to be undone.\r\n\t                //this will undo the end date.\r\n\t                animeitem.end = null;\r\n\t//                console.log(animeitem.end);\r\n\t            }\r\n\r\n\t            //handle status: completed.\r\n\t            if(animeitem.end!==undefined && animeitem.end!==null) {\r\n\t                animeitem.status = true;\r\n\t                animeitem.onHold = false;\r\n\t            } else {\r\n\t                //if no end date, not complete.\r\n\t                animeitem.status = false;\r\n\t            }\r\n\r\n\t            //handle re-reading, re-read count.\r\n\t            if (animeitem.reWatching===true) {\r\n\t\t\t\t\t\t\t\tanimeitem = ItemService.itemRevisits(animeitem, 'anime');\r\n\t\t\t\t\t\t\t\tif(animeitem.episodes===animeitem.finalEpisode) {\r\n\t                animeitem.reWatchCount += 1;\r\n\t                animeitem.reWatching = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t            }\r\n\r\n\t\t\t\tanimeitem.$update(function() {\r\n\t\t\t\t\tif (window.location.href.indexOf('tasks') === -1 && window.location.href.indexOf('watch') === -1 ) $location.path('animeitems');\r\n\r\n\t\t\t\t    NotificationFactory.success('Saved!', 'Anime was saved successfully');\r\n\t\t\t\t}, function(errorResponse) {\r\n\t\t\t\t\tvar error = errorResponse.data.message;\r\n\t                NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t\t});\r\n\t        }\r\n\t    };\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('Animeitems', AnimeitemsFactory);\r\n\tAnimeitemsFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction AnimeitemsFactory($resource) {\r\n\t\t\treturn $resource('animeitems/:animeitemId', { animeitemId: '@_id' }, { update: { method: 'PUT' } });\r\n\t\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('fileUpload', fileUpload);\r\n\tfileUpload.$inject = ['$http', 'NotificationFactory'];\r\n\r\n\tfunction fileUpload($http, NotificationFactory) {\r\n\t\tvar obj = {\r\n\t\t\tuploadFileToUrl: uploadFileToUrl\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n    function uploadFileToUrl(file, uploadUrl){\r\n        var fd = new FormData();\r\n        fd.append('file', file);\r\n        $http.post(uploadUrl, fd, {\r\n            transformRequest: angular.identity,\r\n            headers: {'Content-Type': undefined}\r\n        })\r\n        .success(function(response){\r\n            NotificationFactory.success('Uploaded!', 'Image was saved successfully');\r\n        })\r\n        .error(function(err){\r\n            NotificationFactory.popup('Woops!', 'Something went wrong! \\n' + err, 'error');\r\n        });\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('ItemService', ItemService);\r\n\tItemService.$inject = ['moment', '$filter', 'ListService'];\r\n\r\n\tfunction ItemService(moment, $filter, ListService) {\r\n\t\tvar obj = {\r\n\t\t\tbuildOverview: buildOverview,\r\n\t\t\tbuildRatingsDistribution: buildRatingsDistribution,\r\n\t\t\tbuildStatTags: buildStatTags,\r\n\t\t\tcompleteByMonth: completeByMonth,\r\n\t\t\tcompleteBySeason: completeBySeason,\r\n\t\t\tconvertDateToSeason: convertDateToSeason,\r\n\t\t\tdeleteHistory: deleteHistory,\r\n\t\t\tendingYears: endingYears,\r\n\t\t\tgetRatingValues: getRatingValues,\r\n\t\t\titemHistory: itemHistory,\r\n\t\t\titemRevisits: itemRevisits,\r\n\t\t\tlatestDate: latestDate,\r\n\t\t\tmaxCompleteMonth: maxCompleteMonth,\r\n\t\t\tmaxTagCount: maxTagCount,\r\n\t\t\tratingsWeighted: ratingsWeighted,\r\n\t\t\tsetSeason: setSeason\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n\t        //Using the date, returns the season.\r\n\t        function convertDateToSeason(date) {\r\n\t            var season = '', year = date.getFullYear(), month = date.getMonth() + 1, commonArrays = ListService.getCommonArrays(),\r\n\t                i = commonArrays.seasons.length;\r\n\t//            console.log('convert: ', year, month);\r\n\t            while(i--) {\r\n\t                if (month > Number(commonArrays.seasons[i].number) && season === '') {\r\n\t                    season = { season: commonArrays.seasons[i+1].text, year: year };\r\n\t                }\r\n\t                //catch winter.\r\n\t                if (i === 0 && season === '') {\r\n\t                    season = { season: commonArrays.seasons[i].text, year: year };\r\n\t                }\r\n\t            }\r\n\t//            console.log('to: ', season);\r\n\t            return season;\r\n\t        }\r\n\r\n\t        //add history entry to item.\r\n\t        function itemHistory(item, updateHistory, type, episodeRating) {\r\n\t            console.log('item history: ', item, item.meta, episodeRating);\r\n\t            //populate the history of when each part was 'checked' off.\r\n\t            if (item.meta.history.length !== 0) {\r\n\t                var latestHistory = item.meta.history[item.meta.history.length - 1].value,\r\n\t                    length = type === 'anime' ? item.episodes - latestHistory : item.chapters - latestHistory;\r\n\t                if (length > 0 && (type === 'anime' ? item.reWatching === false : item.reReading === false)) {\r\n\t                    for(var i = 1; i <= length; i++) {\r\n\t                        item.meta.history.push({\r\n\t                            date: Date.now(),\r\n\t                            value: latestHistory + i,\r\n\t                            rating: episodeRating || 0,\r\n\t                            title: item.title,\r\n\t                            id: item._id\r\n\t                        });\r\n\t                    }\r\n\t                }\r\n\t            } else {\r\n\t                if (updateHistory && (type === 'anime' ? item.reWatching === false : item.reReading === false)) {\r\n\t                    item.meta.history.push({\r\n\t                        date: Date.now(),\r\n\t                        value: (type === 'anime' ? item.episodes : item.chapters),\r\n\t                        rating: episodeRating || 0,\r\n\t                        title: item.title,\r\n\t                        id: item._id\r\n\t                    });\r\n\t                }\r\n\t            }\r\n\t            return item;\r\n\t        }\r\n\r\n\t        //remove an entry from an items history.\r\n\t        function deleteHistory(item, history) {\r\n\t            var temp = [];\r\n\t            angular.forEach(item.meta.history, function(past) {\r\n\t                if (past.value !== history.value) {\r\n\t                    temp.push(past);\r\n\t                }\r\n\t            });\r\n\t            item.meta.history = temp;\r\n\t            return item;\r\n\t        }\r\n\r\n\t\t\t\t\tfunction itemRevisits(item, type) {\r\n\t\t\t\t\t\tvar anime = { count: 'reWatchCount', currentPart: 'episodes', finalPart: 'finalEpisode' },\r\n\t\t\t\t\t\t\t\tmanga = { count: 'reReadCount',  currentPart: 'chapters', finalPart: 'finalChapter' },\r\n\t\t\t\t\t\t\t\trepeating = type === 'anime' ? anime : manga,\r\n\t\t\t\t\t\t\t\tindex = ListService.findWithAttr(item.meta.revisits, 'value', item[repeating.count] + 1);\r\n\t\t\t\t\t\tif(index === -1) {\r\n\t\t\t\t\t\t\titem.meta.revisits.push({\r\n\t\t\t\t\t\t\t\tid: item.id,\r\n\t\t\t\t\t\t\t\ttitle: item.title,\r\n\t\t\t\t\t\t\t\tvalue: item[repeating.count] + 1,\r\n\t\t\t\t\t\t\t\trating: 0,\r\n\t\t\t\t\t\t\t\tstart: item.latest,\r\n\t\t\t\t\t\t\t\tend: item[repeating.currentPart] === item[repeating.finalPart] ? item.latest : null\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else if(index > -1 && item[repeating.currentPart] === item[repeating.finalPart]) {\r\n\t\t\t\t\t\t\titem.meta.revisits[index].end = item.latest;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\r\n\t        //function to display relative time - using latest or updated date.\r\n\t        function latestDate(latest, updated) {\r\n\t            //latest date display format.\r\n\t//          console.log(latest, updated);\r\n\t            var today = moment(new Date()), displayDate, diff;\r\n\r\n\t            if (moment(latest).toISOString().substring(0,10)===moment(updated).toISOString().substring(0,10)) {\r\n\t                 displayDate = moment(updated);\r\n\t                 diff = displayDate.fromNow();\r\n\r\n\t                if (diff==='a day ago') {\r\n\t                    return 'Yesterday at ' + displayDate.format('HH:mm');\r\n\t                } else if (diff.indexOf('days') > -1) {\r\n\t                    return diff + ' at ' + displayDate.format('HH:mm');\r\n\t                } else {\r\n\t                    return diff + '.';\r\n\t                }\r\n\t            } else {\r\n\t                 displayDate = moment(latest);\r\n\t                 diff = today.diff(displayDate, 'days');\r\n\r\n\t                //for 0 and 1 day(s) ago use the special term.\r\n\t                if (diff===0) {\r\n\t                    return 'Today';\r\n\t                } else if (diff===1) {\r\n\t                    return 'Yesterday';\r\n\t                } else {\r\n\t                    return diff + ' days ago.';\r\n\t                }\r\n\t            }\r\n\t        }\r\n\r\n\t        //build statistics item overview details.\r\n\t        function buildOverview(items) {\r\n\t            var overview = {\r\n\t                ongoing: $filter('filter')(items, {status: false }).length,\r\n\t                completed: $filter('filter')(items, {status: true }).length\r\n\t            };\r\n\t//            console.log('overview ' , overview);\r\n\t            return overview;\r\n\t        }\r\n\r\n\t        //calculate which month has the most anime completed in it.\r\n\t        function maxCompleteMonth(items) {\r\n\t            var modeMap = {}, maxCount = 0;\r\n\t            for(var i = 0; i < items.length; i++) {\r\n\t                if (items[i].end!==undefined && items[i].end!==null) {\r\n\t                    var end = items[i].end.substring(0,7);\r\n\t                    if(modeMap[end] === null || modeMap[end] === undefined) {\r\n\t                        modeMap[end] = 1;\r\n\t                    } else {\r\n\t                        modeMap[end]++;\r\n\t                    }\r\n\t                    if(modeMap[end] > maxCount) {\r\n\t                        maxCount = modeMap[end];\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            return maxCount;\r\n\t        }\r\n\r\n\t        //calculate the rating values - max rated count and average rating.\r\n\t        function getRatingValues(items) {\r\n\t            var tempRating = 0,\r\n\t                maxRatedCount = 0,\r\n\t                averageRating = 0;\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.rating !== 0) {\r\n\t                    tempRating += item.rating;\r\n\t                    maxRatedCount++;\r\n\t                }\r\n\t            });\r\n\t            averageRating = tempRating / maxRatedCount;\r\n\t            var values = {\r\n\t                maxRatedCount: maxRatedCount,\r\n\t                averageRating: averageRating\r\n\t            };\r\n\t//            console.log('values', values);\r\n\t            return values;\r\n\t        }\r\n\r\n\t        //calculate which month has the most anime completed in it.\r\n\t        function maxTagCount(items) {\r\n\t            var modeMap = {}, maxCount = 0;\r\n\t            angular.forEach(items, function(item) {\r\n\t                angular.forEach(item.tags, function(tag) {\r\n\t                    var text = tag.text;\r\n\t                    if(modeMap[text] === null || modeMap[text] === undefined) {\r\n\t                        modeMap[text] = 1;\r\n\t                    } else {\r\n\t                        modeMap[text]++;\r\n\t                    }\r\n\t                    if(modeMap[text] > maxCount) {\r\n\t                        maxCount = modeMap[text];\r\n\t                    }\r\n\t                });\r\n\t            });\r\n\t            return maxCount;\r\n\t        }\r\n\r\n\t        //build stat tags including counts, averages etc.\r\n\t        function buildStatTags(items, averageItemRating) {\r\n\t            var add = true, statTags = [], checkedRating, maxTagCount = obj.maxTagCount(items), itemCount = items.length;\r\n\t            //is tag in array?\r\n\t            angular.forEach(items, function(item) {\r\n\t                angular.forEach(item.tags, function(tag) {\r\n\t                    for(var i=0, len = statTags.length; i < len; i++) {\r\n\t                        if (statTags[i].tag===tag.text) {\r\n\t                            add = false;\r\n\t                            statTags[i].count += 1;\r\n\t                            statTags[i].ratedCount += item.rating === 0 ? 0 : 1;\r\n\t                            statTags[i].ratings.push(item.rating);\r\n\t                            statTags[i].ratingAdded += item.rating;\r\n\t                            statTags[i].ratingAvg = statTags[i].ratingAdded === 0 ? 0 : statTags[i].ratingAdded / statTags[i].ratedCount;\r\n\t                            statTags[i].ratingWeighted = obj.ratingsWeighted(statTags[i].ratings);\r\n\t                        }\r\n\t                    }\r\n\t                    // add if not in\r\n\t                    if (add===true) {\r\n\t                        checkedRating = item.rating === 0 ? 0 : 1;\r\n\t                        statTags.push({ tag: tag.text, count: 1, ratedCount: checkedRating, ratings: [item.rating], ratingAdded: item.rating, ratingAvg: item.rating, ratingWeighted: 0 });\r\n\t                    }\r\n\t                    add = true; //reset add status.\r\n\t                });\r\n\t//                    console.log(statTags);\r\n\t            });\r\n\t            return statTags;\r\n\t        }\r\n\r\n\t        //function to calculate the weighted mean ratings for the genre tags.\r\n\t        function ratingsWeighted(ratings) {\r\n\t            var values = [], weights = [], unratedCount = 0, total = 0, count = 0;\r\n\t            /**\r\n\t             *  create array (weights) with key(rating).\r\n\t             */\r\n\t            for (var i=0, len = ratings.length; i < len; i++) {\r\n\t                if (ratings[i] in values) {\r\n\t                    weights[ratings[i]]++;\r\n\t                } else {\r\n\t                    values.push(ratings[i]);\r\n\t                    weights[ratings[i]] = 1;\r\n\t                }\r\n\t            }\r\n\t            /**\r\n\t             *  using the key(rating) multiply by the value(weight).\r\n\t             *  calculated weighted total and count.\r\n\t             */\r\n\t            for (var k in weights){\r\n\t                if (typeof weights[k] !== 'function') {\r\n\t                    if (!isNaN(weights[k])) {\r\n\t                        total += k * weights[k];\r\n\t                        count += weights[k];\r\n\t                    }\r\n\t                }\r\n\t                if (k === 0) {\r\n\t                    unratedCount = weights[k];\r\n\t                }\r\n\t            }\r\n\t\t\t\t\t\t\t/* Weighted average.\r\n\t\t\t\t\t\t\t * total = (nth_rating_value * number_of_that_value + ...)\r\n\t\t\t\t\t\t\t * count = number of ratings.\r\n\t\t\t\t\t\t\t */\r\n\t            return total / count;\r\n\t        }\r\n\r\n\t        //builds counts for number of items given for each rating.\r\n\t        function buildRatingsDistribution(items) {\r\n\t            var maxCount = items.length, possibleValues = [10,9,8,7,6,5,4,3,2,1,0], ratingsDistribution = [], i = possibleValues.length;\r\n\t            while(i--) {\r\n\t                var count = $filter('filter')(items, { rating: i }, true).length;\r\n\t                ratingsDistribution.push({ number: i === 0 ? '-' : i,\r\n\t                                           text: i === 0 ? count + ' entries unrated.' : count + ' entries rated ' + i,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t colour: i > 6 \t\t ? '#449d44' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t 7 > i && i > 3 ? '#31b0d5' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t i !== 0 ? '#c9302c' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t\t '#000000',\r\n\t                                           count: count,\r\n\t                                           percentage: ((count / maxCount) * 100).toFixed(2)\r\n\t                                         });\r\n\t            }\r\n\t//            console.log('RD: ', ratingsDistribution);\r\n\t            return ratingsDistribution;\r\n\t        }\r\n\r\n\t        // 'sub-function' of the completeBy... functions.\r\n\t        function endingYears(items) {\r\n\t            var years = [],\r\n\t\t\t\t\t\t\t\t\titemYears = $filter('unique')(items, 'end.substring(0,4)'); //get unqiue years as items.\r\n\t            \t\titemYears = $filter('orderBy')(itemYears, '-end.substring(0,4)'); //order desc.\r\n\t\t\t\t\t\t\tangular.forEach(itemYears, function(item) {\r\n\t\t\t\t\t\t\t\tif(item.end !== undefined && item.end !== null) {\r\n\t\t\t\t\t\t\t\t\tyears.push({ year: item.end.substring(0,4) });\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t            return years;\r\n\t        }\r\n\r\n\t        //complete by month stats\r\n\t        function completeByMonth(items) {\r\n\t            var monthDetails = {}, completeByMonthItems = [], maxCompleteMonth = 0, itemYears = obj.endingYears(items), i = itemYears.length;\r\n\t            //build comlpeteByMonths object.\r\n\t            while(i--) {\r\n\t                //chuck the null end date. push the year part of the other end dates with months array.\r\n\t                if (itemYears[i].year !== undefined && itemYears[i].year !== null) {\r\n\t                    completeByMonthItems.push({ year: itemYears[i].year,\r\n\t                                          months: [\r\n\t                                                    { number: '01', text: 'January', count: $filter('endedMonth')(items, itemYears[i].year, '01').length  },\r\n\t                                                    { number: '02', text: 'February', count: $filter('endedMonth')(items, itemYears[i].year, '02').length },\r\n\t                                                    { number: '03', text: 'March', count: $filter('endedMonth')(items, itemYears[i].year, '03').length },\r\n\t                                                    { number: '04', text: 'April', count: $filter('endedMonth')(items, itemYears[i].year, '04').length },\r\n\t                                                    { number: '05', text: 'May', count: $filter('endedMonth')(items, itemYears[i].year, '05').length },\r\n\t                                                    { number: '06', text: 'June', count: $filter('endedMonth')(items, itemYears[i].year, '06').length },\r\n\t                                                    { number: '07', text: 'July', count: $filter('endedMonth')(items, itemYears[i].year, '07').length },\r\n\t                                                    { number: '08', text: 'August', count: $filter('endedMonth')(items, itemYears[i].year, '08').length },\r\n\t                                                    { number: '09', text: 'September', count: $filter('endedMonth')(items, itemYears[i].year, '09').length },\r\n\t                                                    { number: '10', text: 'October', count: $filter('endedMonth')(items, itemYears[i].year, '10').length },\r\n\t                                                    { number: '11', text: 'November', count: $filter('endedMonth')(items, itemYears[i].year, '11').length },\r\n\t                                                    { number: '12', text: 'December', count: $filter('endedMonth')(items, itemYears[i].year, '12').length }\r\n\t                                          ]\r\n\t                                         });\r\n\t                }\r\n\t            }\r\n\t            maxCompleteMonth = obj.maxCompleteMonth(items);\r\n\t            monthDetails = { months: completeByMonthItems, max: maxCompleteMonth };\r\n\r\n\t//            console.log('completeByMonthItems', completeByMonthItems);\r\n\t            return monthDetails;\r\n\t        }\r\n\r\n\t        //complete by season stats.\r\n\t        function completeBySeason(items) {\r\n\t            var seasonDetails = {}, completeBySeasonItems = [], maxCompleteSeason = 0, itemYears = obj.endingYears(items), i = itemYears.length;\r\n\t            //build completeBySeasonItems object.\r\n\t            while(i--) {\r\n\t                //chuck the null end date. push the year part of the other end dates with seasons array.\r\n\t                if (itemYears[i].year !== undefined && itemYears[i].year !== null) {\r\n\t                    completeBySeasonItems.push({ year: itemYears[i].year,\r\n\t                                            seasons: [\r\n\t                                                        { number: '03', text: 'Winter', count: $filter('season')(items, itemYears[i].year, 'Winter').length },\r\n\t                                                        { number: '06', text: 'Spring', count: $filter('season')(items, itemYears[i].year, 'Spring').length },\r\n\t                                                        { number: '09', text: 'Summer', count: $filter('season')(items, itemYears[i].year, 'Summer').length },\r\n\t                                                        { number: '12', text: 'Fall', count: $filter('season')(items, itemYears[i].year, 'Fall').length }\r\n\t                                            ]\r\n\t                                          });\r\n\t                }\r\n\t            }\r\n\t            //find maximum complete in a season.\r\n\t            angular.forEach(completeBySeasonItems, function(item) {\r\n\t                var i = item.seasons.length;\r\n\t                while(i--) {\r\n\t                    if (item.seasons[i].count > maxCompleteSeason) {\r\n\t                        maxCompleteSeason = item.seasons[i].count;\r\n\t                    }\r\n\t                }\r\n\t            });\r\n\t            seasonDetails = { seasons: completeBySeasonItems, max: maxCompleteSeason };\r\n\t//            console.log('completeBySeasonItems', seasonDetails);\r\n\t            return seasonDetails;\r\n\t        }\r\n\r\n\t        //Temporary function to generate the season data for pre-exisiting items in db.\r\n\t        function setSeason(items, year, season) {\r\n\t            var array = $filter('endedSeason')(items, year, season);\r\n\t            angular.forEach(array, function(item) {\r\n\t                console.log(item.title);\r\n\t                item.season = obj.convertDateToSeason(new Date(item.start));\r\n\t            });\r\n\t            return array;\r\n\t        }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('ListService', ListService);\r\n\tListService.$inject = ['moment', '$q'];\r\n\r\n\tfunction ListService(moment, $q) {\r\n\t\tvar service = {\r\n\t\t\tcheckForTagless: checkForTagless,\r\n\t\t\tconcatenateTagArrays: concatenateTagArrays,\r\n\t\t\tfindWithAttr: findWithAttr,\r\n\t\t\tgetCommonArrays: getCommonArrays,\r\n\t\t\tgetSelectListOptions: getSelectListOptions,\r\n\t\t\tgroupItemsByProperties: groupItemsByProperties,\r\n\t\t\tmanipulateString: manipulateString,\r\n\t\t\tnumberOfPages: numberOfPages,\r\n\t\t\tstringReverse: stringReverse,\r\n\t\t\tweekEndingForDate: weekEndingForDate\r\n\t\t};\r\n\t\treturn service;\r\n\r\n\t        function stringReverse(string) {\r\n\t            return string.split('').reverse().join('');\r\n\t        }\r\n\r\n\t        //get number of pages for list.\r\n\t        function numberOfPages(showingCount, pageSize, currentPage) {\r\n\t            var pageCount = Math.ceil(showingCount/pageSize);\r\n\t            //reset number of pages to be the final page if the number of pages\r\n\t            //becomes less than the one you are on.\r\n\t            if (currentPage + 1 >= pageCount && pageCount !== 0) {\r\n\t                currentPage = pageCount-1;\r\n\t            }\r\n\t            if (pageCount!==0 && currentPage < 0) {\r\n\t                currentPage = 0;\r\n\t            }\r\n\t            var pagingDetails = { currentPage: currentPage, pageCount: pageCount };\r\n\t            return pagingDetails;\r\n\t        }\r\n\r\n\t        //find index of object with given attr.\r\n\t        function findWithAttr(array, attr, value) {\r\n\t            if (array !== undefined) {\r\n\t                for(var i = 0; i < array.length; i += 1) {\r\n\t                    if(array[i][attr] === value) {\r\n\t                        return i;\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            return -1;\r\n\t        }\r\n\r\n\t\t\t\t\t/** Splitting array into multiple arrays by grouping by attributes.\r\n\t\t\t\t\t */\r\n\t\t\t\t\t function groupItemsByProperties(array, groupProperties) {\r\n\t\t\t\t\t\t return $q(function (resolve, reject) {\r\n\t\t\t\t\t\t\t\t var groupedArrays = groupBy(array, function (item) {\r\n\t\t\t\t\t\t\t\t\t\t return getGroupProperties(item, groupProperties);\r\n\t\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t\t resolve(groupedArrays);\r\n\t\t\t\t\t\t });\r\n\t\t\t\t\t }\r\n\t\t\t\t\t //Retrieve the item values for grouping by\r\n\t\t\t\t\t function getGroupProperties(item, groups) {\r\n\t\t\t\t\t\t\t var array = [];\r\n\t\t\t\t\t\t\t angular.forEach(groups, function (group) {\r\n\t\t\t\t\t\t\t\t\t array.push(item[group]);\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t return array;\r\n\t\t\t\t\t }\r\n\t\t\t\t\t //Group the items into arrays using the values.\r\n\t\t\t\t\t function groupBy(array, f) {\r\n\t\t\t\t\t\t\t var groups = {};\r\n\t\t\t\t\t\t\t array.forEach(function (o) {\r\n\t\t\t\t\t\t\t\t\t var group = JSON.stringify(f(o));\r\n\t\t\t\t\t\t\t\t\t groups[group] = groups[group] || [];\r\n\t\t\t\t\t\t\t\t\t groups[group].push(o);\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t return Object.keys(groups).map(function (group) {\r\n\t\t\t\t\t\t\t\t\t return groups[group];\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t }\r\n\r\n\t        function manipulateString(string, transform, onlyFirst) {\r\n\t            switch(transform.toLowerCase()) {\r\n\t                case 'lower':\r\n\t                    if (onlyFirst)  return string.charAt(0).toLowerCase() + string.slice(1);\r\n\t                    if (!onlyFirst) return string.toLowerCase();\r\n\t                    break;\r\n\t                case 'upper':\r\n\t                    if (onlyFirst) return string.charAt(0).toUpperCase() + string.slice(1);\r\n\t                    if (!onlyFirst) return string.toUpperCase();\r\n\t                    break;\r\n\t                default:\r\n\t                    return string.toLowerCase();\r\n\t            }\r\n\t        }\r\n\r\n\t\t\t\t\tfunction weekEndingForDate(convertToSunday) {\r\n\t\t\t        var date = new Date(convertToSunday),\r\n\t\t\t            day = date.getDay(),\r\n\t\t\t            diff = date.getDate() - day + (day === 0 ? 0:7),\r\n\t\t\t            temp = new Date(convertToSunday),\r\n\t\t\t            wkEnd = new Date(temp.setDate(diff));\r\n\t\t\t        return moment(wkEnd.toISOString()).endOf('day');\r\n\t\t\t    }\r\n\r\n\t        //returns the options for the various filters in list pages.\r\n\t        function getSelectListOptions(controller) {\r\n\t            var selectListOptions = {};\r\n\t            if (controller !== 'character' && controller !== 'topten') {\r\n\t                selectListOptions.status = [ { v: '', n: 'All' }, { v: false, n: 'Ongoing' }, { v: true, n: 'Completed' } ];\r\n\t                selectListOptions.searchName = 'title';\r\n\t                if (controller === 'animeitem' || controller === 'watch') {\r\n\t                    selectListOptions.onHold = [ { v: '', n: 'All' }, { v: false, n: 'Ongoing' }, { v: true, n: 'On Hold' } ];\r\n\t                    selectListOptions.sortOptions = [ { v: 'title', n: 'Title' },{ v: 'episodes', n: 'Episodes' },{ v: 'start', n: 'Start date' },\r\n\t                                                      { v: 'end', n: 'End date' },{ v: ['latest', 'meta.updated'], n: 'Latest' },{ v: 'rating', n: 'Rating' }\r\n\t                                                    ];\r\n\t                    selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Latest');\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: false, n: 'Online' }, { v: true, n: 'Disc' } ];\r\n\t                    selectListOptions.mediaType = 'disc';\r\n\t                    selectListOptions.repeating = [ { v: '', n: 'All' }, { v: false, n: 'Not Re-watching' }, { v: true, n: 'Re-watching' } ];\r\n\t                    selectListOptions.repeatType = 'reWatching';\r\n\t                } else if (controller === 'mangaitem') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'title', n: 'Title' },{ v: 'chapters', n: 'Chapters' },{ v: 'volumes', n: 'Volumes' },{ v: 'start', n: 'Start date' },\r\n\t                                                      { v: 'end', n: 'End date' },{ v: ['latest', 'meta.updated'], n: 'Latest' },{ v: 'rating', n: 'Rating' }\r\n\t                                                    ];\r\n\t                    selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Latest');\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: false, n: 'Online' }, { v: true, n: 'Hardcopy' } ];\r\n\t                    selectListOptions.mediaType = 'hardcopy';\r\n\t                    selectListOptions.repeating = [ { v: '', n: 'All' }, { v: false, n: 'Not Re-reading' }, { v: true, n: 'Re-reading' } ];\r\n\t                    selectListOptions.repeatType = 'reReading';\r\n\t                }\r\n\t            } else {\r\n\t                if (controller === 'character') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'name', n: 'Name' }, { v: 'anime.title', n: 'Anime' }, { v: 'manga.title', n: 'Manga' }, { v: 'voice', n: 'Voice' }  ];\r\n\t                    selectListOptions.media = [\r\n\t                        { v: '', n: '-- choose media type --' }, { v: 'none', n: 'None' }, { v: 'anime', n: 'Anime-only' }, { v: 'manga', n: 'Manga-only' }, { v: 'both', n: 'Both' }\r\n\t                    ];\r\n\t                } else if (controller === 'topten') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'name', n: 'Name' } ];\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: 'anime', n: 'Anime' }, { v: 'manga', n: 'Manga' }, { v: 'character', n: 'Character' } ];\r\n\t                    selectListOptions.mediaType = 'type';\r\n\t                }\r\n\t                selectListOptions.searchName = 'name';\r\n\t                selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Name');\r\n\t            }\r\n\t//            console.log(selectListOptions);\r\n\t            return selectListOptions;\r\n\t        }\r\n\r\n\t        function concatenateTagArrays(itemTags, tagArray) {\r\n\t            if (itemTags.length > 0) {\r\n\t                var i = 0, alreadyAdded = false;\r\n\t                while(i < tagArray.length) {\r\n\t                    for(var j = 0; j < itemTags.length; j++) {\r\n\t                        if (itemTags[j].text === tagArray[i].text) {\r\n\t                            alreadyAdded = true;\r\n\t                        }\r\n\t                    }\r\n\t                    //add if isn't already in the array.\r\n\t                    if (alreadyAdded === false) {\r\n\t                        itemTags.push(tagArray[i]);\r\n\t                    }\r\n\t                    i++;\r\n\t                    alreadyAdded = false;\r\n\t                }\r\n\t//                console.log(itemTags);\r\n\t                return itemTags;\r\n\t            } else {\r\n\t                //if there are no tags for item, then just return the new tags.\r\n\t                return tagArray;\r\n\t            }\r\n\t        }\r\n\r\n\t        //check to see if there are items with no tags.\r\n\t        function checkForTagless(items) {\r\n\t            var areTagless = false;\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.tags.length === 0) {\r\n\t                    areTagless = true;\r\n\t                }\r\n\t            });\r\n\t            return areTagless;\r\n\t        }\r\n\r\n\t        function getCommonArrays(controller) {\r\n\t            var commonArrays = {},\r\n\t                itemTypes = [\r\n\t                    { name: 'anime' },\r\n\t                    { name: 'manga' },\r\n\t                    { name: 'character' }\r\n\t                ],\r\n\t                seasons = [\r\n\t                    { number: '03', text: 'Winter' },\r\n\t                    { number: '06', text: 'Spring' },\r\n\t                    { number: '09', text: 'Summer' },\r\n\t                    { number: '12', text: 'Fall' }\r\n\t                ],\r\n\t                months = [\r\n\t                    { number: '01', text: 'January' },\r\n\t                    { number: '02', text: 'February' },\r\n\t                    { number: '03', text: 'March' },\r\n\t                    { number: '04', text: 'April' },\r\n\t                    { number: '05', text: 'May' },\r\n\t                    { number: '06', text: 'June' },\r\n\t                    { number: '07', text: 'July' },\r\n\t                    { number: '08', text: 'August' },\r\n\t                    { number: '09', text: 'September' },\r\n\t                    { number: '10', text: 'October' },\r\n\t                    { number: '11', text: 'November' },\r\n\t                    { number: '12', text: 'December' }\r\n\t                ],\r\n\t                categories = [\r\n\t                    {name: 'Watch'},\r\n\t                    {name: 'Read'},\r\n\t                    {name: 'Play'},\r\n\t                    {name: 'Other'}\r\n\t                ],\r\n\t                days = [\r\n\t                    {name: 'Any'},\r\n\t                    {name: 'Monday'},\r\n\t                    {name: 'Tuesday'},\r\n\t                    {name: 'Wednesday'},\r\n\t                    {name: 'Thursday'},\r\n\t                    {name: 'Friday'},\r\n\t                    {name: 'Saturday'},\r\n\t                    {name: 'Sunday'}\r\n\t                ],\r\n\t                summaryFunctions = [\r\n\t                    { name: 'Average' },\r\n\t                    { name: 'Highest' },\r\n\t                    { name: 'Lowest' },\r\n\t                    { name: 'Mode' }\r\n\t                ];\r\n\t            commonArrays = { months: months, seasons: seasons, categories: categories, days: days, summaryFunctions: summaryFunctions, itemTypes: itemTypes };\r\n\t            return commonArrays;\r\n\t        }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('WatchAnime', WatchAnime);\r\n\tWatchAnime.$inject = ['$resource'];\r\n\r\n\t\tfunction WatchAnime($resource) {\r\n\t\t\treturn $resource('animeitems/watch-list', { }, { update: { method: 'PUT' } });\r\n\t\t}\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('characters').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Characters', 'characters', 'dropdown', '/characters(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'characters', 'List Characters', 'characters');\r\n\t\tMenus.addSubMenuItem('topbar', 'characters', 'New Character', 'characters/create');\r\n\t}\r\n]);\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('characters').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Characters state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listCharacters', {\r\n\t\t\turl: '/characters',\r\n\t\t\ttemplateUrl: 'modules/characters/views/list-characters.client.view.html'\r\n\t\t}).\r\n\t\tstate('createCharacter', {\r\n\t\t\turl: '/characters/create',\r\n\t\t\ttemplateUrl: 'modules/characters/views/create-character.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewCharacter', {\r\n\t\t\turl: '/characters/:characterId',\r\n\t\t\ttemplateUrl: 'modules/characters/views/view-character.client.view.html'\r\n\t\t}).\r\n\t\tstate('editCharacter', {\r\n\t\t\turl: '/characters/:characterId/edit',\r\n\t\t\ttemplateUrl: 'modules/characters/views/edit-character.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.controller('CharactersController', CharactersController);\r\n\tCharactersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Characters', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ListService', 'CharacterService', 'NotificationFactory', 'spinnerService', 'TagService'];\r\n\r\n\tfunction CharactersController($scope, $stateParams, $location, Authentication, Characters, Animeitems, Mangaitems, fileUpload, $sce, $window, ListService, CharacterService, NotificationFactory, spinnerService, TagService) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.filterConfig = {\r\n\t\t\tisList: 'list', //show list? or slider.\r\n      showingCount: 0,\r\n      sortType: '',\r\n      sortReverse: false,\r\n      searchTags: '',\r\n      media: '',\r\n      seriesFilter: '',\r\n      tagsForFilter: [],\r\n      taglessItem: false,\r\n      areTagless: false,\r\n      selectListOptions: {},\r\n      statTags: [],\r\n      voiceActors: [],\r\n      series: []\r\n    };\r\n\t\tctrl.find = find;\r\n\t\tctrl.findAnime = findAnime;\r\n\t\tctrl.findManga = findManga;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.findOneAnime = findOneAnime;\r\n\t\tctrl.findOneManga = findOneManga;\r\n    ctrl.imgPath = ''; //image path\r\n\t\tctrl.maxItemCount = 0; //number of characters.\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.removeTag = removeTag;\r\n    ctrl.tagArray = []; // holding tags pre-submit\r\n    ctrl.tagArrayRemove = [];\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.whichController = 'character';\r\n\r\n\r\n\t\t//allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n    //For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for animeitem tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.mangaitem.tags, text);\r\n\t\t}\r\n\r\n\t\t// Create new Character\r\n\t\tfunction create() {\r\n\t    //console.log(ctrl.tagArray);\r\n\t    var character = new Characters();\r\n\t\t\t// Create new Character object\r\n\t\t\tcharacter = new Characters ({\r\n\t\t\t\tname: ctrl.name,\r\n      \timage: ctrl.imgPath,\r\n        anime: ctrl.anime!==undefined && ctrl.anime!==null ? ctrl.anime._id : ctrl.anime,\r\n        manga: ctrl.manga!==undefined && ctrl.manga!==null ? ctrl.manga._id : ctrl.manga,\r\n        voice: ctrl.voice,\r\n        tags: ctrl.tagArray,\r\n        user: ctrl.user\r\n\t\t\t});\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\tcharacter.$save(function(response) {\r\n\t\t\t\t$location.path('characters/' + response._id);\r\n        NotificationFactory.success('Saved!', 'Character was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n\t\t\t\tNotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Remove existing Character\r\n\t\tfunction remove(character) {\r\n      //are you sure option...\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( character ) {\r\n\t          character.$remove();\r\n\t          for (var i in ctrl.characters) {\r\n\t            if (ctrl.characters [i] === character) {\r\n\t                ctrl.characters.splice(i, 1);\r\n\t            }\r\n\t          }\r\n\t        } else {\r\n\t          ctrl.character.$remove(function() {\r\n\t\t\t\t\t\t\t$location.path('characters');\r\n\t          });\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Character was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Update existing Character\r\n\t\tfunction update() {\r\n\t\t\tvar character = ctrl.character;\r\n      //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n      if (ctrl.character.manga!==null && ctrl.character.manga!==undefined) {\r\n          character.manga = ctrl.character.manga._id;\r\n      }\r\n//            console.log(ctrl.character.anime);\r\n      if (ctrl.character.anime!==null && ctrl.character.anime!==undefined) {\r\n          character.anime = ctrl.character.anime._id;\r\n      }\r\n\r\n      if (ctrl.tagArray!==undefined) {\r\n          character.tags = ListService.concatenateTagArrays(character.tags, ctrl.tagArray);\r\n      }\r\n\r\n      if (ctrl.imgPath!==undefined && ctrl.imgPath!==null && ctrl.imgPath!=='') {\r\n          character.image = ctrl.imgPath;\r\n      }\r\n\r\n\t\t\tcharacter.$update(function() {\r\n\t\t\t\t$location.path('characters');\r\n\t\t\t\tNotificationFactory.success('Saved!', 'Character was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n        NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Find a list of Characters\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t\t\tspinnerService.loading('characters', Characters.query().$promise.then(function(result) {\r\n\t\t\t\tctrl.characters = result;\r\n\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\tctrl.filterConfig.statTags = CharacterService.buildCharacterTags(result);\r\n\t\t\t\tctrl.filterConfig.voiceActors = CharacterService.buildVoiceActors(result);\r\n\t\t\t\tctrl.filterConfig.series = CharacterService.buildSeriesList(result);\r\n\t\t\t\tconsole.log('find characters: ', ctrl.characters, ctrl.filterConfig);\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\t// Find existing Character\r\n\t\tfunction findOne() {\r\n\t\t\tctrl.character = Characters.get({\r\n\t\t\t\tcharacterId: $stateParams.characterId\r\n\t\t\t});\r\n\t\t}\r\n\r\n    // Find a list of Animeitems\r\n\t\tfunction findAnime() {\r\n\t\t\tctrl.animeitems = Animeitems.query();\r\n\t\t}\r\n\r\n    // Find existing Animeitem\r\n\t\tfunction findOneAnime(anime) {\r\n\t\t\tctrl.animeitem = Animeitems.get({\r\n\t\t\t\tanimeitemId: anime\r\n\t\t\t});\r\n\t\t}\r\n\r\n    // Find a list of Mangaitems\r\n\t\tfunction findManga() {\r\n\t\t\tctrl.mangaitems = Mangaitems.query();\r\n\t\t}\r\n\r\n    // Find existing Animeitem\r\n\t\tfunction findOneManga(manga) {\r\n\t\t\tctrl.mangaitem = Mangaitems.get({\r\n\t\t\t\tmangaitemId: manga\r\n\t\t\t});\r\n\t\t}\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/characters/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUploadCharacter');\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('characterBack', characterBack);\r\n\r\n   function characterBack(){\r\n      return function(scope, element, attrs){\r\n          var url = attrs.characterBack;\r\n          element.css({\r\n              'background-image': 'url(' + url +')',\r\n              'background-size' : 'cover',\r\n              'background-repeat': 'no-repeat',\r\n              'background-position': 'center'\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('clearTagValues', clearTagValues);\r\n\r\n  function clearTagValues() {\r\n      return function (scope, element, attrs) {\r\n          element.bind('click', function(event) {\r\n  //            console.log('clear tags');\r\n              scope.$apply(function() {\r\n                  scope.filterConfig.searchTags = '';\r\n                  scope.filterConfig.characterTags = '';\r\n                  scope.filterConfig.tagsForFilter = [];\r\n              });\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('deleteSearchTag', deleteSearchTag);\r\n\r\n  function deleteSearchTag() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function(scope, element, attrs) {\r\n              element.bind('click', function(event) {\r\n                  scope.$apply(function() {\r\n                      var tag = attrs.deleteSearchTag;\r\n                      var index = scope.filterConfig.tagsForFilter.indexOf(tag);\r\n  //                    console.log(tag, index);\r\n                      scope.filterConfig.searchTags = scope.filterConfig.searchTags.replace(tag + ',', '');\r\n                      scope.filterConfig.tagsForFilter.splice(index, 1);\r\n  //                    console.log(scope.searchTags, scope.tagsForFilter);\r\n                  });\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('disableNgAnimate', disableNgAnimate);\r\n  disableNgAnimate.$inject = ['$animate'];\r\n\r\n  function disableNgAnimate($animate) {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element) {\r\n        $animate.enabled(false, element);\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('dropTag', dropTag);\r\n  dropTag.$inject = ['NotificationFactory'];\r\n\r\n   function dropTag(NotificationFactory) {\r\n      return function(scope, element, attrs) {\r\n          element.bind('click', function(event) {\r\n              var text = attrs.dropTag;\r\n               //are you sure option...\r\n              NotificationFactory.confirmation(function() {\r\n                  scope.$apply(function() {\r\n                      var deletingItem = scope.tagArray;\r\n                      scope.$parent.tagArray = [];\r\n  //                    console.log('dropping tag - ', text);\r\n                      //update the complete task.\r\n                      angular.forEach(deletingItem, function(tag) {\r\n                          if (tag.text !== text) {\r\n                              scope.$parent.tagArray.push(tag);\r\n                          }\r\n                      });\r\n                  });\r\n                  NotificationFactory.warning('Dropped!', 'Tag was successfully dropped');\r\n              });\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('enterTag', enterTag);\r\n  function enterTag() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function (scope, element, attrs) {\r\n              element.bind('keydown keypress', function (event) {\r\n                  if(event.which === 13) {\r\n                      scope.$apply(function (){\r\n                          scope.$eval(attrs.enterTag);\r\n                      });\r\n                      event.preventDefault();\r\n                   }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('removeTag', removeTag);\r\n  removeTag.$inject = ['NotificationFactory'];\r\n\r\n   function removeTag(NotificationFactory) {\r\n      return {\r\n          restrict: 'A',\r\n          link: function(scope, element, attrs) {\r\n              element.bind('click', function(event) {\r\n                  var tag = attrs.removeTag,\r\n                      i,\r\n                      entry_type = scope.whichController;\r\n                  //are you sure option...\r\n                NotificationFactory.confirmation(function() {\r\n                      scope.$apply(function () {\r\n                          var index;\r\n                          if (entry_type === 'character') {\r\n                              for(i=0; i < scope.character.tags.length; i++) {\r\n                                  if (scope.character.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.character.tags.splice(index, 1);\r\n                          } else if (entry_type === 'animeitem') {\r\n                              for(i=0; i < scope.animeitem.tags.length; i++) {\r\n                                  if (scope.animeitem.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.animeitem.tags.splice(index, 1);\r\n                          } else if (entry_type === 'mangaitem') {\r\n                              for(i=0; i < scope.mangaitem.tags.length; i++) {\r\n                                  if (scope.mangaitem.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.mangaitem.tags.splice(index, 1);\r\n                          }\r\n  //                        console.log(index, tag);\r\n                      });\r\n                      NotificationFactory.warning('Deleted!', 'Tag was successfully deleted');\r\n                  });\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('slider', slider);\r\n  slider.$inject = ['$timeout', '$sce'];\r\n\r\n  function slider($timeout, $sce) {\r\n    return {\r\n        restrict: 'AE',\r\n        replace: true,\r\n        scope: {\r\n            slides: '=?',\r\n            interval: '=?',\r\n            filterConfig: '=?'\r\n        },\r\n        bindToController: true,\r\n        controllerAs: 'sliderController',\r\n        templateUrl: '/modules/characters/templates/slider.html',\r\n        controller: function($scope) {\r\n          var self = this,\r\n              timer,\r\n              autoSlide;\r\n          self.currentIndex = -1; //pre-first slide to stop 'cannot assign to undefined' error.\r\n          self.enter = enter;\r\n          self.goToSlide = goToSlide;\r\n          self.interval = self.interval === undefined ? 3000 : self.interval; //is there a custom interval?\r\n          self.isFullscreen = false;\r\n          self.leave = leave;\r\n          self.next = next;\r\n          self.prev = prev;\r\n          self.repeater = self.slides === undefined ? false : true; //is there a collection to iterate through?\r\n          self.toggleFullscreen = toggleFullscreen;\r\n          self.trustAsResourceUrl = trustAsResourceUrl;\r\n\r\n          //allow retreival of local resource\r\n          function trustAsResourceUrl(url) {\r\n              return $sce.trustAsResourceUrl(url);\r\n          }\r\n\r\n          //if no collection, make a dummy collection to cycle throught the children.\r\n          if (!self.repeater) {\r\n            self.slides = []; //used to allow cycling.\r\n            for(var i = 0; i < length; i++) {\r\n                self.slides.push({ index: i });\r\n            }\r\n          }\r\n          function goToSlide(slide) {\r\n  //              console.log('go to', slide);\r\n              if (self.currentIndex !== slide) {\r\n                  //reached end of slides?\r\n                  if (slide !== $scope.filteredSlides.length) {\r\n                    self.currentIndex = slide;\r\n                  } else {\r\n                    self.currentIndex = 0;\r\n                  }\r\n              } else {\r\n                  if ($scope.filteredSlides[self.currentIndex].locked) {\r\n                    //unlock, i.e start timer.\r\n                    $scope.filteredSlides[self.currentIndex].locked = false;\r\n                      autoSlide();\r\n                  } else {\r\n                    //lock, i.e. cancel timer.\r\n                    $scope.filteredSlides[self.currentIndex].locked = true;\r\n                    $timeout.cancel(timer);\r\n                  }\r\n              }\r\n          }\r\n\r\n          function next() {\r\n              if (self.currentIndex < $scope.filteredSlides.length - 1) {\r\n                  self.currentIndex += 1;\r\n\r\n              } else {\r\n                  self.currentIndex = 0;\r\n              }\r\n          }\r\n\r\n          function prev() {\r\n              if (self.currentIndex > 0) {\r\n                  self.currentIndex -= 1;\r\n              } else {\r\n                  self.currentIndex = $scope.filteredSlides.length - 1;\r\n              }\r\n          }\r\n\r\n          $scope.$watch('sliderController.currentIndex', function() {\r\n              //  console.log('index', self.currentIndex, 'filtered slides ', $scope.filteredSlides);\r\n              if (self.currentIndex > -1 && $scope.filteredSlides.length > 0) {\r\n                    $scope.filteredSlides.forEach(function(slide) {\r\n                        slide.visible = false; // make every slide invisible\r\n                        slide.locked = false; // make every slide unlocked\r\n                    });\r\n                    $scope.filteredSlides[self.currentIndex].visible = true; // make the current slide visible\r\n              }\r\n          });\r\n\r\n          autoSlide = function() {\r\n              timer = $timeout(function() {\r\n                  self.next();\r\n                  timer = $timeout(autoSlide, self.interval);\r\n              }, self.interval);\r\n          };\r\n          autoSlide();\r\n          $scope.$on('$destroy', function() {\r\n              $timeout.cancel(timer); // when the scope is destroyed, cancel the timer\r\n          });\r\n\r\n          //Stop timer on enter.\r\n          function enter() {\r\n  //              console.log('entered');\r\n              if ($scope.filteredSlides[self.currentIndex].locked !== true) {\r\n                $timeout.cancel(timer);\r\n  //                  console.log('cancelled');\r\n              }\r\n          }\r\n          //Restart timer on leave.\r\n          function leave() {\r\n  //              console.log('left');\r\n              if ($scope.filteredSlides[self.currentIndex].locked !== true) {\r\n                timer = $timeout(autoSlide, self.interval);\r\n  //                  console.log('restarted');\r\n              }\r\n          }\r\n\r\n          //Fullscreen capability\r\n          function toggleFullscreen() {\r\n              self.isFullscreen = !self.isFullscreen;\r\n          }\r\n\r\n        },\r\n        link: function(scope, elem, attrs, sliderController) {\r\n            scope.childElementCount = elem[0].childElementCount - 1;\r\n        }\r\n    };\r\n\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('mediaFilter', mediaFilter);\r\n\r\n  function mediaFilter() {\r\n      return function(array, media) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  if (media==='anime') {\r\n                      if (item.anime!==null && item.manga===null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='manga') {\r\n                      if (item.manga!==null && item.anime===null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='both') {\r\n                      if (item.anime!==null && item.manga!==null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='none') {\r\n                      if (item.anime===null && item.manga===null) {\r\n                          return true;\r\n                      }\r\n                  } else {\r\n                      return true;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('seriesDetailFilter', seriesDetailFilter);\r\n\r\n  function seriesDetailFilter() {\r\n    return function(array, detailSeriesName) {\r\n        if (array !== undefined) {\r\n            return array.filter(function(item) {\r\n                if (detailSeriesName !== '') {\r\n                    //filter stat series detail.\r\n                    if (item.anime!==null && item.anime!==undefined) {\r\n                        if (item.anime.title===detailSeriesName) {\r\n                            return item;\r\n                        }\r\n                    } else if (item.manga!==null && item.manga!==undefined) {\r\n                        if (item.manga.title===detailSeriesName) {\r\n                            return item;\r\n                        }\r\n                    }\r\n                } else {\r\n                    return item;\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('seriesFilter', seriesFilter);\r\n\r\n  function seriesFilter() {\r\n      return function(array, series) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  if (series !== '' && series !== undefined) {\r\n                      //filter stat series detail.\r\n                      if (item.anime!==null && item.anime!==undefined) {\r\n                          return item.anime.title.toLowerCase().indexOf(series.toLowerCase()) > -1;\r\n                      } else if (item.manga!==null && item.manga!==undefined) {\r\n                          return item.manga.title.toLowerCase().indexOf(series.toLowerCase()) > -1;\r\n                      }\r\n                  } else {\r\n                      return item;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('tagFilter', tagFilter);\r\n\r\n  function tagFilter() {\r\n      return function(array, searchTags, taglessItem) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  //special tag filter\r\n                  var found = false;\r\n                  var i = 0;\r\n                  var tagsToSearch = [];\r\n                  var tagsForFilter;\r\n\r\n                  //if tagless is checked return tagless and nothing else.\r\n                  if (taglessItem===true) {\r\n                      if (item.tags.length===0) {\r\n                          return item;\r\n                      }\r\n                  } else {\r\n                      if (searchTags===undefined || searchTags==='') {\r\n                          return true;\r\n                      } else {\r\n                          //get tags that are being looked for\r\n                          tagsForFilter = searchTags.substring(0, searchTags.length - 1).split(',');\r\n                          //console.log(tagsForFilter);\r\n\r\n                          //get tags of items to filter\r\n                          angular.forEach(item.tags, function(tag) {\r\n                              tagsToSearch.push(tag.text);\r\n                          });\r\n\r\n                          //filter: check in 'query' is in tags.\r\n                          for(i = 0; i < tagsForFilter.length; i++) {\r\n                              if (tagsToSearch.indexOf(tagsForFilter[i]) !== -1) {\r\n                                  found = true;\r\n                              } else {\r\n                                  return false;\r\n                              }\r\n                          }\r\n                          return found;\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.service('CharacterService', CharacterService);\r\n\tCharacterService.$inject = ['$q'];\r\n\r\n\tfunction CharacterService($q) {\r\n\r\n\t    //build the character gender distribution.\r\n\t    this.buildGenderDistribution = function(items, maxCount) {\r\n\t        return $q(function(resolve, reject) {\r\n\t            var check, gender = [];\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.tag === 'male') {\r\n\t                    gender.push({\r\n\t                        type: 'male',\r\n\t                        count: item.count,\r\n\t                        percentage: Number(((item.count / maxCount) * 100).toFixed(2)),\r\n\t                        text: '% male.'\r\n\t                    });\r\n\t                } else if (item.tag === 'female') {\r\n\t                    gender.push({\r\n\t                        type: 'female',\r\n\t                        count: item.count,\r\n\t                        percentage: Number(((item.count / maxCount) * 100).toFixed(2)),\r\n\t                        text: '% female.'\r\n\t                    });\r\n\t                }\r\n\t            });\r\n\t            gender.push({\r\n\t                type: 'unassigned',\r\n\t                count: maxCount - gender[0].count - gender[1].count,\r\n\t                percentage: Number(((maxCount - gender[0].count - gender[1].count / maxCount) * 100).toFixed(2)),\r\n\t                text: '% unassigned.'\r\n\t            });\r\n\r\n\t            //Fudge any rounding errors.\r\n\t            check = gender[0].percentage + gender[1].percentage + gender[2].percentage;\r\n\t            if (check > 100) {\r\n\t                gender[2].percentage -= (check - 100).toFixed(2);\r\n\t            } else if (check < 100) {\r\n\t                gender[2].percentage += (100 - check).toFixed(2);\r\n\t            }\r\n\t            resolve(gender);\r\n\t        });\r\n\t    };\r\n\r\n\t    this.buildCharacterTags = function(items) {\r\n\t        var add = true, statTags = [];\r\n\t        //is tag in array?\r\n\t        angular.forEach(items, function(item) {\r\n\t            angular.forEach(item.tags, function(tag) {\r\n\t                for(var i=0; i < statTags.length; i++) {\r\n\t                    if (statTags[i].tag === tag.text) {\r\n\t                        add = false;\r\n\t                        statTags[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t                // add if not in\r\n\t                if (add===true) {\r\n\t                    statTags.push({ tag: tag.text, count: 1 });\r\n\t                }\r\n\t                add = true; //reset add status.\r\n\t            });\r\n\t//          console.log($scope.statTags);\r\n\t        });\r\n\r\n\t        return statTags;\r\n\t    };\r\n\r\n\t    this.buildRelatedCharacterTags = function(items, name) {\r\n\t        var add = true, tagDetailCollection = [], tagDetailResult = [];\r\n\t        //get all character tag arrays that contain the chosen tag into a collection.\r\n\t        angular.forEach(items, function(item){\r\n\t            for(var i=0; i < item.tags.length; i++) {\r\n\t                if (item.tags[i].text === name) {\r\n\t                    tagDetailCollection.push(item.tags);\r\n\t                }\r\n\t            }\r\n\t        });\r\n\t//        console.log(tagDetailCollection);\r\n\t        angular.forEach(tagDetailCollection, function(item) {\r\n\t            angular.forEach(item, function(bit) {\r\n\t//              console.log(bit);\r\n\t                for(var i=0; i < tagDetailResult.length; i++) {\r\n\t                    //if exists and not the search value - increment the count.\r\n\t                    if (tagDetailResult[i].name===bit.text && bit.text!==name) {\r\n\t                        add = false;\r\n\t                        tagDetailResult[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t                //add if true and not the tag we searched on.\r\n\t                if (add===true && bit.text!==name) {\r\n\t                    tagDetailResult.push({ name: bit.text, count: 1 });\r\n\t                }\r\n\t                add = true;\r\n\t            });\r\n\t        });\r\n\t//        console.log(tagDetailResult);\r\n\t        return tagDetailResult;\r\n\t    };\r\n\r\n\t    this.buildVoiceActors = function(items) {\r\n\t        var add = true, voiceActors = [];\r\n\t        //is voice actor in array?\r\n\t        angular.forEach(items, function(item) {\r\n\t            for(var i=0; i < voiceActors.length; i++) {\r\n\t                if (voiceActors[i].name === item.voice) {\r\n\t                    add = false;\r\n\t                    voiceActors[i].count += 1;\r\n\t                }\r\n\t            }\r\n\t            // add if not in\r\n\t            if (add===true) {\r\n\t                voiceActors.push({ name: item.voice, count: 1 });\r\n\t            }\r\n\t            add = true; //reset add status.\r\n\t        });\r\n\r\n\t        return voiceActors;\r\n\t    };\r\n\r\n\t    this.buildSeriesList = function(items) {\r\n\t        var add = true, statSeries = [];\r\n\t        //get series counts.\r\n\t        angular.forEach(items, function(item) {\r\n\t            for(var i=0; i < statSeries.length; i++) {\r\n\t                if (item.anime) {\r\n\t                    if (statSeries[i].name === item.anime.title) {\r\n\t                        add = false;\r\n\t                        statSeries[i].count += 1;\r\n\t                    }\r\n\t                } else if (item.manga) {\r\n\t                    if (statSeries[i].name === item.manga.title) {\r\n\t                        add = false;\r\n\t                        statSeries[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            // add if not in\r\n\t            if (add === true) {\r\n\t                if (typeof(item.anime) === 'object' && item.anime !== null) {\r\n\t                    statSeries.push({ _id: item.anime._id, name: item.anime.title, count: 1 });\r\n\t                } else if (typeof(item.manga) === 'object' && item.manga !== null) {\r\n\t                    statSeries.push({ _id: item.manga._id, name: item.manga.title, count: 1 });\r\n\t                }\r\n\t            }\r\n\t            add = true; //reset add status.\r\n\t        });\r\n\r\n\t        return statSeries;\r\n\t    };\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.factory('Characters', CharacterFactory);\r\n\t CharacterFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction CharacterFactory($resource) {\r\n\t\t\treturn $resource('characters/:characterId', { characterId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.service('TagService', TagService);\r\n\tTagService.$inject = ['$rootScope', 'NotificationFactory'];\r\n\r\n\t function TagService($rootScope, NotificationFactory) {\r\n\t\t\tvar service = {};\r\n\r\n\t\t\t//Add newTag to tagArray\r\n\t\t\tservice.addTag = function(tagArray, newTag) {\r\n\t\t\t    if (newTag!=='' && newTag!==undefined) {\r\n\t\t\t        var i = 0, alreadyAdded = false;\r\n\t\t\t        if (tagArray.length > 0) {\r\n\t\t\t            while(i < tagArray.length) {\r\n\t\t\t                if (tagArray[i].text === newTag) {\r\n\t\t\t                    alreadyAdded = true;\r\n\t\t\t                }\r\n\t\t\t                i++;\r\n\t\t\t            }\r\n\t\t\t            //if not in array add it.\r\n\t\t\t            if (alreadyAdded === false) {\r\n\t\t\t                tagArray.push({ text: newTag });\r\n\t\t\t            }\r\n\t\t\t        } else {\r\n\t\t\t            tagArray.push({ text: newTag });\r\n\t\t\t        }\r\n\t\t\t    }\r\n\t\t\t};\r\n\r\n\t\t\t//Drop tag with text = text, from tagArray\r\n\t\t\tservice.dropTag = function(tagArray, text) {\r\n\t\t\t\t //are you sure option...\r\n\t\t\t\tNotificationFactory.confirmation(function() {\r\n\t\t\t\t\t$rootScope.$apply(function() {\r\n\t\t\t\t\t\tvar i = tagArray.length;\r\n\t\t\t\t\t\twhile(i--) {\r\n\t\t\t\t\t\t\tif(tagArray[i].text === text) {\r\n\t\t\t\t\t\t\t\ttagArray.splice(i, 1);\r\n\t\t\t\t\t\t\t\tNotificationFactory.warning('Dropped!', 'Tag was successfully dropped');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\treturn service;\r\n\t}\r\n\r\n})();\r\n\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('core').controller('HeaderController', HeaderController);\r\n\tHeaderController.$inject = ['$scope', 'Authentication', 'Menus', '$location'];\r\n\r\n\tfunction HeaderController($scope, Authentication, Menus, $location) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.changeTheme = changeTheme;\r\n\t\tctrl.isActive = isActive;\r\n\t\tctrl.isCollapsed = false;\r\n\t\tctrl.isTimedTheme = localStorage.getItem('timedTheme');\r\n\t\tctrl.menu = Menus.getMenu('topbar');\r\n\t\tctrl.saved = localStorage.getItem('theme');\r\n\t\tctrl.styles = [\r\n        { name: 'Day', url: 'dist/main-day.css' },\r\n        { name: 'Night', url: 'dist/main-night.css' }\r\n    ];\r\n\t\tctrl.theme = (localStorage.getItem('theme')!==null) ? JSON.parse(ctrl.saved) : ctrl.styles[1].url;\r\n\t\tctrl.timedTheme = (localStorage.getItem('timedTheme')!==null) ? JSON.parse(ctrl.isTimedTheme) : false;\r\n\t\tctrl.toggleCollapsibleMenu = toggleCollapsibleMenu;\r\n\r\n\t\tlocalStorage.setItem('theme', JSON.stringify(ctrl.theme));\r\n  \tlocalStorage.setItem('timedTheme', JSON.stringify(ctrl.timedTheme));\r\n\r\n\t\tfunction toggleCollapsibleMenu() {\r\n\t\t\tctrl.isCollapsed = !ctrl.isCollapsed;\r\n\t\t}\r\n\r\n\t\t// Collapsing the menu after navigation\r\n\t\t$scope.$on('$stateChangeSuccess', function() {\r\n\t\t\tctrl.isCollapsed = false;\r\n\t\t});\r\n\r\n    function isActive(viewLocation) {\r\n        return viewLocation === $location.path();\r\n    }\r\n\r\n    function changeTheme() {\r\n        localStorage.setItem('timedTheme', JSON.stringify(ctrl.timedTheme));\r\n        var timeOfDayTheme = localStorage.getItem('timedTheme');\r\n        if (timeOfDayTheme === 'false') {\r\n            localStorage.setItem('theme', JSON.stringify(ctrl.theme));\r\n        } else {\r\n            var time = new Date().getHours();\r\n            if (time > 20 || time < 8) {\r\n                localStorage.setItem('theme', JSON.stringify(ctrl.styles[1].url));\r\n            } else if (time > 8) {\r\n                localStorage.setItem('theme', JSON.stringify(ctrl.styles[0].url));\r\n            }\r\n        }\r\n        var storedValue = localStorage.getItem('theme'),\r\n        link = document.getElementById('app-theme');\r\n        link.href = storedValue.substr(1, storedValue.lastIndexOf('\\\"') - 1); //remove quotes for whatever reason.\r\n        ctrl.theme = storedValue.substr(1, storedValue.lastIndexOf('\\\"') - 1); //remove quotes for whatever reason. //set the dropdown to the correct value;\r\n    }\r\n\r\n\t}\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('anywhereButHere', anywhereButHere);\r\n\r\n  function anywhereButHere($document, $window) {\r\n      return {\r\n          restrict: 'A',\r\n          link: function (scope, element, attrs) {\r\n              element.data('thing', true);\r\n\r\n              /** On click, check what you clicked and whether you can ignore it.\r\n               *    Based on checks false the ng-show of the anywhere-but-here element.\r\n               */\r\n              angular.element($document[0].body).on('click', function (e) {\r\n                  var inThing = angular.element(e.target).inheritedData('thing'),\r\n                      ignore = angular.element(e.target).attr('ignore-here');\r\n                  if (!inThing && !ignore) {\r\n                      scope.$apply(function () {\r\n                          scope[attrs.ngShow] = false;\r\n                      });\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('clickPass', clickPass);\r\n  clickPass.$inject = ['$timeout'];\r\n\r\n   function clickPass($timeout) {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        element.bind('click', function(event) {\r\n          $timeout(function() {\r\n            event.stopPropagation();\r\n            document.getElementById(attrs.clickPass).click();\r\n          }, 0);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('formatDate', formatDate);\r\n   function formatDate(){\r\n    return {\r\n     require: 'ngModel',\r\n      link: function(scope, elem, attr, modelCtrl) {\r\n        modelCtrl.$formatters.push(function(modelValue){\r\n          return (modelValue === null) ? null : new Date(modelValue);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('loadingSpinner', loadingSpinner);\r\n  loadingSpinner.$inject = ['$http', 'spinnerService'];\r\n\r\n   function loadingSpinner($http, spinnerService) {\r\n      return {\r\n          restrict: 'A',\r\n          transclude: true,\r\n          replace: true,\r\n          templateUrl: '/modules/core/templates/loading-spinner.html',\r\n          scope: {\r\n              name: '@',\r\n              size: '@?'\r\n          },\r\n          bindToController: 'loadingSpinner',\r\n          controller: function ($scope) {\r\n              $scope.active = false;\r\n  //            $scope.isLoading = function () {\r\n  //                return $http.pendingRequests.length > 0;\r\n  //            };\r\n\r\n  //            $scope.$watch($scope.isLoading, function (v) {\r\n  //                if ($scope.size === 'fullscreen') {\r\n  //                    if(v) {\r\n  //                        $scope.active = true;\r\n  //                    } else {\r\n  //                        $scope.active = false;\r\n  //                    }\r\n  //                }\r\n  //            });\r\n\r\n              var api = {\r\n                  name: $scope.name,\r\n                  show: function () {\r\n                      $scope.active = true;\r\n                  },\r\n                  hide: function () {\r\n                      $scope.active = false;\r\n                  },\r\n                  toggle: function () {\r\n                      $scope.active = !$scope.active;\r\n                  }\r\n              };\r\n\r\n              spinnerService._register(api);\r\n              $scope.$on('$destroy', function () {\r\n                  spinnerService._unregister($scope.name);\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('myProgress', myProgress);\r\n\r\n   function myProgress() {\r\n      return function(scope, element, attrs) {\r\n          scope.$watch(attrs.myProgress, function(val) {\r\n              var type = 'checklist-progress';\r\n              element.html('<div class=\"' + type + '\" style=\"width: ' + val + '%;height: 100%\"></div>');\r\n          });\r\n        };\r\n    }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('calendarFilter', calendarFilter);\r\n\r\n   function calendarFilter() {\r\n      return function(array, datesSelected) {\r\n          if (array) {\r\n              return array.filter(function(item) {\r\n                  //date filter\r\n                  if (item.date === null || item.date === undefined) {\r\n                      if (datesSelected === false) {\r\n                          return item;\r\n                      }\r\n                      return false;\r\n                  }\r\n\r\n                  var day = new Date().getDay(),\r\n                      diff = new Date().getDate() - day + (day === 0 ? 0:7),\r\n                      temp = new Date(),\r\n                      wkEnd = new Date(temp.setDate(diff)),\r\n                      currentWkEnd = wkEnd.toISOString().substring(0,10),\r\n                      iDate = new Date(item.date).toISOString(),\r\n                      itemDate = { year: iDate.substr(0,4), month: iDate.substr(5,2), day: iDate.substr(8,2) },\r\n                      currentDate = { year: currentWkEnd.substr(0,4), month: currentWkEnd.substr(5,2), day: currentWkEnd.substr(8,2) };\r\n\r\n                  if (datesSelected === false) {\r\n                      if (itemDate.year < currentDate.year) {\r\n                          return item;\r\n                      } else if (itemDate.year === currentDate.year) {\r\n                          if (itemDate.month < currentDate.month) {\r\n                              return item;\r\n                          } else if (itemDate.month === currentDate.month) {\r\n                              if (itemDate.day <= currentDate.day) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  } else if (datesSelected === true) {\r\n                      if (itemDate.year > currentDate.year) {\r\n                          return item;\r\n                      } else if (itemDate.year === currentDate.year) {\r\n                          if (itemDate.month > currentDate.month) {\r\n                              return item;\r\n                          } else if (itemDate.month === currentDate.month) {\r\n                              if (itemDate.day > currentDate.day) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('dateSuffix', dateSuffix);\r\n\r\n   function dateSuffix($filter) {\r\n    var suffixes = ['th', 'st', 'nd', 'rd'];\r\n    return function(input) {\r\n      if(input !== undefined){\r\n          var dtfilter = $filter('date')(input, 'MMMM d'),\r\n              day = parseInt(dtfilter.slice(-2)),\r\n              relevantDigits = (day < 30) ? day % 20 : day % 30,\r\n              suffix = (relevantDigits <= 3) ? suffixes[relevantDigits] : suffixes[0],\r\n              dateArray = dtfilter.split(' '),\r\n              month = dateArray[0];\r\n          return dateArray[1] + suffix + ' ' + month + ' ' + $filter('date')(input, 'yyyy');\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('dayFilter', dayFilter);\r\n\r\n   function dayFilter() {\r\n    return function(array, daySelected) {\r\n        return array.filter(function(item) {\r\n            //special day filter\r\n//            console.log(item);\r\n            var ds = daySelected;\r\n            if (ds==='1' && item.day==='Monday') {\r\n                return item;\r\n            } else if (ds==='2' && item.day==='Tuesday') {\r\n                return item;\r\n            } else if (ds==='3' && item.day==='Wednesday') {\r\n                return item;\r\n            } else if (ds==='4' && item.day==='Thursday') {\r\n                return item;\r\n            } else if (ds==='5' && item.day==='Friday') {\r\n                return item;\r\n            } else if (ds==='6' && item.day==='Saturday') {\r\n                return item;\r\n            } else if (ds==='0' && item.day==='Sunday') {\r\n                return item;\r\n            } else if (ds==='' || ds===null || ds===undefined) {\r\n                return item;\r\n            } else if (ds==='Any' && item.day==='Any') {\r\n                return item;\r\n            }\r\n        });\r\n    };\r\n}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('numberFixedLen', numberFixedLen);\r\n\r\n   function numberFixedLen() {\r\n    return function (n, len) {\r\n        var num = parseInt(n, 10);\r\n        len = parseInt(len, 10);\r\n        if (isNaN(num) || isNaN(len)) {\r\n            return n;\r\n        }\r\n        num = ''+num;\r\n        while (num.length < len) {\r\n            num = '0'+num;\r\n        }\r\n        return num;\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('core')\r\n\t.service('FunctionService', FunctionService);\r\n\tFunctionService.$inject = ['moment'];\r\n\r\n\tfunction FunctionService(moment) {\r\n\t\tvar obj = {\r\n\t\t\tpad: pad\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n    function pad(number, width, padChar) {\r\n      padChar = padChar || '0';\r\n      number = number + '';\r\n      return number.length >= width ? number : new Array(width - number.length + 1).join(padChar) + number;\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\n'use strict';\r\n\r\n//Menu service used for managing  menus\r\nangular.module('core').service('Menus', [\r\n\r\n\tfunction() {\r\n\t\t// Define a set of default roles\r\n\t\tthis.defaultRoles = ['*'];\r\n\r\n\t\t// Define the menus object\r\n\t\tthis.menus = {};\r\n\r\n\t\t// A private function for rendering decision \r\n\t\tvar shouldRender = function(user) {\r\n\t\t\tif (user) {\r\n\t\t\t\tif (!!~this.roles.indexOf('*')) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (var userRoleIndex in user.roles) {\r\n\t\t\t\t\t\tfor (var roleIndex in this.roles) {\r\n\t\t\t\t\t\t\tif (this.roles[roleIndex] === user.roles[userRoleIndex]) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn this.isPublic;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Validate menu existance\r\n\t\tthis.validateMenuExistance = function(menuId) {\r\n\t\t\tif (menuId && menuId.length) {\r\n\t\t\t\tif (this.menus[menuId]) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('Menu does not exists');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('MenuId was not provided');\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Get the menu object by menu id\r\n\t\tthis.getMenu = function(menuId) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add new menu object by menu id\r\n\t\tthis.addMenu = function(menuId, isPublic, roles) {\r\n\t\t\t// Create the new menu\r\n\t\t\tthis.menus[menuId] = {\r\n\t\t\t\tisPublic: isPublic || false,\r\n\t\t\t\troles: roles || this.defaultRoles,\r\n\t\t\t\titems: [],\r\n\t\t\t\tshouldRender: shouldRender\r\n\t\t\t};\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeMenu = function(menuId) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\tdelete this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add menu item object\r\n\t\tthis.addMenuItem = function(menuId, menuItemTitle, menuItemURL, menuItemType, menuItemUIRoute, isPublic, roles, position) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Push new menu item\r\n\t\t\tthis.menus[menuId].items.push({\r\n\t\t\t\ttitle: menuItemTitle,\r\n\t\t\t\tlink: menuItemURL,\r\n\t\t\t\tmenuItemType: menuItemType || 'item',\r\n\t\t\t\tmenuItemClass: menuItemType,\r\n\t\t\t\tuiRoute: menuItemUIRoute || ('/' + menuItemURL),\r\n\t\t\t\tisPublic: ((isPublic === null || typeof isPublic === 'undefined') ? this.menus[menuId].isPublic : isPublic),\r\n\t\t\t\troles: ((roles === null || typeof roles === 'undefined') ? this.menus[menuId].roles : roles),\r\n\t\t\t\tposition: position || 0,\r\n\t\t\t\titems: [],\r\n\t\t\t\tshouldRender: shouldRender\r\n\t\t\t});\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add submenu item object\r\n\t\tthis.addSubMenuItem = function(menuId, rootMenuItemURL, menuItemTitle, menuItemURL, menuItemUIRoute, isPublic, roles, position) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tif (this.menus[menuId].items[itemIndex].link === rootMenuItemURL) {\r\n\t\t\t\t\t// Push new submenu item\r\n\t\t\t\t\tthis.menus[menuId].items[itemIndex].items.push({\r\n\t\t\t\t\t\ttitle: menuItemTitle,\r\n\t\t\t\t\t\tlink: menuItemURL,\r\n\t\t\t\t\t\tuiRoute: menuItemUIRoute || ('/' + menuItemURL),\r\n\t\t\t\t\t\tisPublic: ((isPublic === null || typeof isPublic === 'undefined') ? this.menus[menuId].items[itemIndex].isPublic : isPublic),\r\n\t\t\t\t\t\troles: ((roles === null || typeof roles === 'undefined') ? this.menus[menuId].items[itemIndex].roles : roles),\r\n\t\t\t\t\t\tposition: position || 0,\r\n\t\t\t\t\t\tshouldRender: shouldRender\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeMenuItem = function(menuId, menuItemURL) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item to remove\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tif (this.menus[menuId].items[itemIndex].link === menuItemURL) {\r\n\t\t\t\t\tthis.menus[menuId].items.splice(itemIndex, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeSubMenuItem = function(menuId, submenuItemURL) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item to remove\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tfor (var subitemIndex in this.menus[menuId].items[itemIndex].items) {\r\n\t\t\t\t\tif (this.menus[menuId].items[itemIndex].items[subitemIndex].link === submenuItemURL) {\r\n\t\t\t\t\t\tthis.menus[menuId].items[itemIndex].items.splice(subitemIndex, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t//Adding the topbar menu\r\n\t\tthis.addMenu('topbar');\r\n\t}\r\n]);\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .factory('NotificationFactory', NotificationFactory);\r\n\r\n   function NotificationFactory() {\r\n    var self = this;\r\n    /*global swal */\r\n    /*global toastr */\r\n        toastr.options = {\r\n                'closeButton': false,\r\n                'debug': false,\r\n                'newestOnTop': false,\r\n                'progressBar': false,\r\n                'positionClass': 'toast-bottom-right',\r\n                'preventDuplicates': false,\r\n                'onclick': null,\r\n                'showDuration': '300',\r\n                'hideDuration': '1000',\r\n                'timeOut': '5000',\r\n                'extendedTimeOut': '1000',\r\n                'showEasing': 'swing',\r\n                'hideEasing': 'linear',\r\n                'showMethod': 'fadeIn',\r\n                'hideMethod': 'fadeOut'\r\n            };\r\n    return {\r\n        success: function (title, text) {\r\n            toastr.success(text, title, 'Success');\r\n        },\r\n        warning: function (title, text) {\r\n            toastr.warning(text, title, 'Warning');\r\n        },\r\n        error: function (title, text) {\r\n            toastr.error(text, title, 'Error');\r\n        },\r\n        popup: function (title, text, type) {\r\n            swal({\r\n                title: title,\r\n                text: text,\r\n                type: type\r\n            });\r\n        },\r\n        confirmation: function (thenDo) {\r\n              //are you sure option...\r\n            swal({\r\n                title: 'Are you sure?',\r\n                text: 'Are you sure that you want to delete this?',\r\n                type: 'warning',\r\n                showCancelButton: true,\r\n                closeOnConfirm: true,\r\n                confirmButtonText: 'Yes, delete it!',\r\n                confirmButtonColor: '#ec6c62'\r\n            }, thenDo);\r\n        }\r\n    };\r\n}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .factory('spinnerService', SpinnerService);\r\n  SpinnerService.$inject = ['$q'];\r\n   function SpinnerService($q) {\r\n    var spinners = {},\r\n        queue = {},\r\n        loads = {};\r\n\r\n      return {\r\n          spinners: spinners,\r\n        // private method for spinner registration.\r\n        _register: function (data) {\r\n            if (!data.hasOwnProperty('name')) {\r\n                throw new Error('Spinner must specify a name when registering with the spinner service.');\r\n            }\r\n            if (spinners.hasOwnProperty(data.name)) {\r\n                throw new Error('A spinner with the name \\'' + data.name + '\\' has already been registered.');\r\n            }\r\n            spinners[data.name] = data;\r\n            // Increase the spinner count.\r\n            this.count++;\r\n\r\n            // Check if spinnerId was in the queue, if so then fire the\r\n            // queued function.\r\n            if (queue[data.name]) {\r\n    //            console.log(queue, loads);\r\n                if(loads[data.name]) {\r\n    //                console.log(loads[data.name]);\r\n                    this[queue[data.name]](data.name, loads[data.name]);\r\n                    delete loads[data.name];\r\n                    delete queue[data.name];\r\n                } else {\r\n    //                console.log('queued', queue);\r\n                    this[queue[data.name]](data.name);\r\n                    delete queue[data.name];\r\n                }\r\n            }\r\n    //        console.log(spinners);\r\n        },\r\n        _unregister: function (name) {\r\n          if (spinners.hasOwnProperty(name)) {\r\n            delete spinners[name];\r\n          }\r\n        },\r\n        loading: function (name, optionsOrPromise) {\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'loading';\r\n                loads[name] = optionsOrPromise;\r\n    //            console.log('defer', loads[name]);\r\n                return;\r\n            }\r\n            var spinner = spinners[name];\r\n            spinner.show(name);\r\n            optionsOrPromise = optionsOrPromise || {};\r\n\r\n            //Check if it's promise\r\n            if (optionsOrPromise.always || optionsOrPromise['finally']) {\r\n                optionsOrPromise = {\r\n                    promise: optionsOrPromise\r\n                };\r\n            }\r\n\r\n            var options = angular.extend({}, optionsOrPromise);\r\n\r\n            if (options.promise) {\r\n                if (options.promise.always) {\r\n                    options.promise.always(function () {\r\n                        spinner.hide(name);\r\n                    });\r\n                } else if (options.promise['finally']) {\r\n                    options.promise['finally'](function () {\r\n                        spinner.hide(name);\r\n                    });\r\n                }\r\n            }\r\n        },\r\n        show: function (name) {\r\n    //        console.log('show');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'show';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.show();\r\n        },\r\n        hide: function (name) {\r\n    //        console.log('hide');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'hide';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.hide();\r\n        },\r\n        toggle: function (name) {\r\n    //        console.log('toggle');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'toggle';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.toggle();\r\n        },\r\n        count: 0\r\n      };\r\n\r\n  }\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('history').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('history', {\r\n\t\t\turl: '/history',\r\n\t\t\ttemplateUrl: 'modules/history/views/history.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n  'use strict';\r\n  angular.module('history').controller('HistoryController', HistoryController);\r\n  HistoryController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'AnimeHistory', 'MangaHistory', 'HistoryService', 'ListService', 'spinnerService'];\r\n\r\n  function HistoryController($scope, $stateParams, $location, Authentication, AnimeHistory, MangaHistory, HistoryService, ListService, spinnerService) {\r\n\t\tvar ctrl = this,\r\n\t\t    latestDate = new Date().setDate(new Date().getDate() - 29);\r\n\r\n    ctrl.authentication = Authentication;\r\n    ctrl.buildHistory = buildHistory;\r\n    ctrl.filterConfig = {\r\n\t\t\thistoryFilter: 'Today'\r\n    };\r\n    ctrl.happenedWhen = happenedWhen;\r\n    ctrl.historyGroups = [\r\n      { name: 'Today' },\r\n      { name: 'Yesterday' },\r\n      { name: 'This week' },\r\n      { name: 'Last week' },\r\n      { name: 'Two weeks ago' },\r\n      { name: 'Three weeks ago' },\r\n      { name: 'Four weeks ago' },\r\n    ];\r\n    ctrl.view = 'Anime';\r\n\r\n\r\n    function buildHistory() {\r\n\t    spinnerService.loading('history', AnimeHistory.query({ latest: latestDate }).$promise.then(function(result) {\r\n\t\t\t\t\treturn HistoryService.buildHistoryList(result);\r\n\t\t\t}).then(function(result) {\r\n\t      //  console.log('build anime history: ', result);\r\n\t\t\t\tctrl.animeHistory = result;\r\n\t      return MangaHistory.query({ latest: latestDate }).$promise;\r\n\t    }).then(function(result) {\r\n\t\t\t\t//    console.log('manga', result);\r\n\t\t\t\treturn HistoryService.buildHistoryList(result);\r\n\t    }).then(function(result) {\r\n\t\t\t\t//                    console.log('build manga history: ', result);\r\n\t\t\t\tctrl.mangaHistory = result;\r\n\t\t\t})\r\n\t\t  );\r\n    }\r\n\r\n    //Needed to catch 'Character' setting and skip it.\r\n    $scope.$watch('view', function(newValue) {\r\n      if (ctrl.view !== undefined) {\r\n          if (newValue !== 'Anime' && newValue !== 'Manga') {\r\n              ctrl.view = 'Anime';\r\n          }\r\n      }\r\n    });\r\n\r\n    function happenedWhen(when) {\r\n        return HistoryService.happenedWhen(when);\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('tasks').controller('ViewHistoryController', ViewHistoryController);\r\n  ViewHistoryController.$inject =  ['$scope', 'data', '$stateParams', 'Authentication', 'ItemService', 'NotificationFactory', 'spinnerService', '$uibModalInstance'];\r\n\r\nfunction ViewHistoryController($scope, data, $stateParams, Authentication, ItemService, NotificationFactory, spinnerService, $uibModalInstance) {\r\n  var ctrl = this,\r\n      historyStore = [];\r\n\r\n  ctrl.cancel = cancel;\r\n  ctrl.deleteHistory = deleteHistory;\r\n  ctrl.submit = submit;\r\n  ctrl.type = data.type;\r\n  ctrl.updated = false;\r\n  ctrl.viewItem = data.viewItem;\r\n\r\n  function deleteHistory(item, history) {\r\n      //are you sure option...\r\n      NotificationFactory.confirmation(function() {\r\n        if(historyStore.length === 0) {\r\n          historyStore = ctrl.viewItem.meta.history;\r\n        }\r\n        ctrl.viewItem = ItemService.deleteHistory(item, history);\r\n        ctrl.updated = true;\r\n      });\r\n  }\r\n\r\n  function submit() {\r\n    $uibModalInstance.close(ctrl.updated);\r\n  }\r\n\r\n  function cancel() {\r\n    if(ctrl.updated) {\r\n      ctrl.viewItem.meta.history = historyStore;\r\n    }\r\n    $uibModalInstance.dismiss();\r\n  }\r\n\r\n}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .filter('historySeparator', historySeparator);\r\n  historySeparator.$inject = ['HistoryService', 'moment'];\r\n\r\n  function historySeparator(HistoryService, moment) {\r\n    return function(array, level, timeframe) {\r\n        var itemDate,\r\n            attr = (level === 'group') ? 'latest' : 'date';\r\n        if (array !== undefined) {\r\n            return array.filter(function(item) {\r\n                itemDate = moment(item[attr]).startOf('day');\r\n                return HistoryService.filterItemHistory(timeframe.toLowerCase(), itemDate) ? item : false;\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  //History service used to communicate Animeitems REST endpoints\r\n  angular.module('history')\r\n  .factory('AnimeHistory', AnimeHistory);\r\n  AnimeHistory.$inject = ['$resource'];\r\n\r\n    function AnimeHistory($resource) {\r\n      return $resource('history/anime/:latest', { latest: '@_latest' }, { update: { method: 'PUT' } });\r\n    }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .service('HistoryService', HistoryService);\r\n  HistoryService.$inject = ['moment', '$q'];\r\n\r\n   function HistoryService(moment, $q) {\r\n     var service = {\r\n           buildHistoryList: buildHistoryList,\r\n           extractHistory: extractHistory,\r\n           filterItemHistory: filterItemHistory,\r\n           getEndsOfWeek: getEndsOfWeek,\r\n           getSetDaysAgo: getSetDaysAgo,\r\n           groupItemHistory: groupItemHistory,\r\n           happenedWhen: happenedWhen,\r\n           today: moment(new Date()).startOf('day'),\r\n           weekBeginning: weekBeginning,\r\n           weekEnding: weekEnding\r\n         },\r\n         endsOfWeek = getEndsOfWeek(),\r\n         mondays = endsOfWeek.mondays,\r\n         sundays = endsOfWeek.sundays;\r\n         return service;\r\n\r\n    // getting mondays and sundays for this, last, two and three weeks ago.\r\n    function getEndsOfWeek() {\r\n        var endsOfWeek = [], thisMonday = service.weekBeginning(), thisSunday = service.weekEnding();\r\n        endsOfWeek = {\r\n            mondays: [ thisMonday, service.getSetDaysAgo(thisMonday, 7), service.getSetDaysAgo(thisMonday, 14), service.getSetDaysAgo(thisMonday, 21), service.getSetDaysAgo(thisMonday, 28) ],\r\n            sundays: [ thisSunday, service.getSetDaysAgo(thisSunday, 7), service.getSetDaysAgo(thisSunday, 14), service.getSetDaysAgo(thisSunday, 21), service.getSetDaysAgo(thisSunday, 28) ]\r\n        };\r\n        return endsOfWeek;\r\n    }\r\n\r\n    //get 'daysAgo' days ago from 'thisEnd' date.\r\n    function getSetDaysAgo(thisEnd, daysAgo) {\r\n        var newDate = moment(thisEnd).subtract(daysAgo, 'days');\r\n        return newDate;\r\n    }\r\n\r\n    //get 'this' monday.\r\n    function weekBeginning() {\r\n        var date = new Date(),\r\n            day = date.getDay(),\r\n            diff = date.getDate() - day + (day === 0 ? -6:1),\r\n            temp = new Date(),\r\n            wkBeg = new Date(temp.setDate(diff));\r\n        return moment(wkBeg.toISOString()).startOf('day');\r\n    }\r\n\r\n    //get 'this' sunday.\r\n    function weekEnding() {\r\n        var date = new Date(),\r\n            day = date.getDay(),\r\n            diff = date.getDate() - day + (day === 0 ? 0:7),\r\n            temp = new Date(),\r\n            wkEnd = new Date(temp.setDate(diff));\r\n        return moment(wkEnd.toISOString()).endOf('day');\r\n    }\r\n\r\n    function buildHistoryList(items) {\r\n        var deferred = $q.defer(),\r\n            promise = service.extractHistory(items).then(function(result) {\r\n//                console.log('extract history: ', result);\r\n                result.sort(function (a, b) {\r\n                    var dateA = a.date,\r\n                        dateB = b.date;\r\n                    if(dateA > dateB) return -1;\r\n                    if(dateA < dateB) return 1;\r\n                    if(dateA === dateB) return 0;\r\n                });\r\n                return service.groupItemHistory(result);\r\n            }).then(function(result) {\r\n//                console.log('grouped', result);\r\n                deferred.resolve(result);\r\n            });\r\n        return deferred.promise;\r\n    }\r\n\r\n    function extractHistory(items) {\r\n        var deferred = $q.defer(),\r\n            itemHistory = [], today = moment(new Date()).startOf('day');\r\n        angular.forEach(items, function(item) {\r\n            angular.forEach(item.meta.history, function(history) {\r\n                var cutoff = moment(history.date).startOf('day'),\r\n                    diff = today.diff(cutoff, 'days');\r\n//                console.log(diff);\r\n                if (diff < 29) {\r\n                    itemHistory.push({ date: history.date, value: history.value, title: item.title, id: item._id });\r\n                }\r\n            });\r\n        });\r\n        deferred.resolve(itemHistory);\r\n        return deferred.promise;\r\n    }\r\n\r\n    function groupItemHistory(itemHistory) {\r\n        var deferred = $q.defer(),\r\n            index, prevItem, item, group,\r\n            length = itemHistory.length,\r\n            groupedHistory = [];\r\n        for(var i = 0; i < length; i++) {\r\n            item = itemHistory[i];\r\n            if (i === 0) {\r\n                groupedHistory.push({\r\n                    title: item.title,\r\n                    items: [],\r\n                    count: 1,\r\n                    latest: item.date,\r\n                    oldest: item.date\r\n                });\r\n                groupedHistory[0].items.push(item);\r\n            } else if (i !== 0) {\r\n                prevItem = itemHistory[i - 1];\r\n                index = groupedHistory.length - 1;\r\n                if (prevItem.title === item.title) {\r\n                    groupedHistory[index].items.push(item);\r\n                    groupedHistory[index].count++;\r\n                    groupedHistory[index].oldest = item.date;\r\n                } else if (prevItem.title !== item.title) {\r\n                    group = {\r\n                        title: item.title,\r\n                        items: [],\r\n                        count: 1,\r\n                        latest: item.date,\r\n                        oldest: item.date\r\n                    };\r\n                    group.items.push(item);\r\n                    groupedHistory.push(group);\r\n                }\r\n            }\r\n        }\r\n        deferred.resolve(groupedHistory);\r\n        return deferred.promise;\r\n    }\r\n\r\n    function filterItemHistory(timeframe, itemDate) {\r\n        var diff = service.today.diff(itemDate, 'days');\r\n        switch(timeframe) {\r\n            case 'today':\r\n                return diff === 0;\r\n\r\n            case 'yesterday':\r\n                return diff === 1;\r\n\r\n            case 'this week':\r\n                return mondays[0] <= itemDate && itemDate <= sundays[0];\r\n\r\n            case 'last week':\r\n                return mondays[1] <= itemDate && itemDate <= sundays[1];\r\n\r\n            case 'two weeks ago':\r\n                return mondays[2] <= itemDate && itemDate <= sundays[2];\r\n\r\n            case 'three weeks ago':\r\n                return mondays[3] <= itemDate && itemDate <= sundays[3];\r\n\r\n            case 'four weeks ago':\r\n                return mondays[4] <= itemDate && itemDate <= sundays[4];\r\n        }\r\n    }\r\n\r\n    /** function to display relative time.\r\n     *  Using diff because fromNow will create conflicts between\r\n     *  the item date and the 'group date'.\r\n     */\r\n    function happenedWhen(when) {\r\n//          console.log(latest, updated);\r\n        var today = moment(new Date()).startOf('day'), thisDate = moment(when).startOf('day'),\r\n            diff = today.diff(thisDate, 'days');\r\n\r\n        //for 0 and 1 day(s) ago use the special term.\r\n        if (diff === 0) {\r\n            return 'Today at ' + moment(when).format('HH:mm');\r\n        } else if (diff === 1) {\r\n            return 'Yesterday at ' + moment(when).format('HH:mm');\r\n        } else {\r\n            return diff + ' days ago at ' + moment(when).format('HH:mm');\r\n        }\r\n    }\r\n\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .factory('MangaHistory', MangaHistory);\r\n  MangaHistory.$inject = ['$resource'];\r\n\r\n  function MangaHistory($resource) {\r\n    return $resource('history/manga/:latest', { latest: '@_latest' }, { update: { method: 'PUT' } });\r\n  }\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('mangaitems').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Mangaitems', 'mangaitems', 'dropdown', '/mangaitems(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'mangaitems', 'List Mangaitems', 'mangaitems');\r\n\t\tMenus.addSubMenuItem('topbar', 'mangaitems', 'New Mangaitem', 'mangaitems/create');\r\n\t}\r\n]);\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('mangaitems').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Mangaitems state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listMangaitems', {\r\n\t\t\turl: '/mangaitems',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/list-mangaitems.client.view.html'\r\n\t\t}).\r\n\t\tstate('createMangaitem', {\r\n\t\t\turl: '/mangaitems/create',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/create-mangaitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewMangaitem', {\r\n\t\t\turl: '/mangaitems/:mangaitemId',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/view-mangaitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('editMangaitem', {\r\n\t\t\turl: '/mangaitems/:mangaitemId/edit',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/edit-mangaitem.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\tangular.module('mangaitems').controller('MangaitemsController', MangaitemsController);\r\n\tMangaitemsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Mangaitems', 'Animeitems', 'fileUpload', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'MangaFactory', 'spinnerService', 'TagService', '$uibModal'];\r\n\r\n\tfunction MangaitemsController($scope, $stateParams, $location, Authentication, Mangaitems, Animeitems, fileUpload, $sce, $window, ItemService, ListService, NotificationFactory, MangaFactory, spinnerService, TagService, $uibModal) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.chapters = 0;\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.filterConfig = {\r\n        showingCount: 0,\r\n        sortType: '',\r\n        sortReverse: true,\r\n        ratingLevel: undefined,\r\n        ratingActions: {\r\n            maxRating: 10,\r\n            percent: undefined,\r\n            overStar: null\r\n        },\r\n        searchTags: '',\r\n        tagsForFilter: [],\r\n        taglessItem: false,\r\n        areTagless: false,\r\n        selectListOptions: {},\r\n        statTags: [],\r\n\t\t\t\tviewItem: ''\r\n    };\r\n\t\tctrl.finalNumbers = false; //default show status of final number fields in edit view.\r\n\t\tctrl.find = find;\r\n\t\tctrl.findAnime = findAnime;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.imgPath = ''; //image path\r\n\t\tctrl.itemUpdate = new Date(); // today's date as 'yyyy-MM-dd' for the auto-pop of 'latest' in edit page.\r\n\t\tctrl.latest = ctrl.itemUpdate;\r\n\t\tctrl.latestDate = latestDate;\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 10\r\n    };\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.removeTag = removeTag;\r\n\t\tctrl.start = ctrl.itemUpdate;\r\n\t\tctrl.tagArray = []; // holding tags pre-submit\r\n\t\tctrl.tagArrayRemove = [];\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n\t\tctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.viewItemHistory = viewItemHistory;\r\n\t\tctrl.volumes = 0;\r\n\t\tctrl.whichController = 'mangaitem';\r\n\r\n    //allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n\t\t//For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for animeitem tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.mangaitem.tags, text);\r\n\t\t}\r\n\r\n    // Create new Mangaitem\r\n\t\tfunction create() {\r\n\r\n            var mangaitem = new Mangaitems();\r\n            //Handle situation if objects not selected.\r\n                // Create new Mangaitem object\r\n\t\t\t     mangaitem = new Mangaitems ({\r\n\t\t\t\t    title: ctrl.title,\r\n                    chapters: ctrl.chapters,\r\n                    volumes: ctrl.volumes,\r\n                    start: ctrl.start,\r\n                    latest: ctrl.latest,\r\n                    finalChapter: ctrl.finalChapter,\r\n                    finalVolume: ctrl.finalVolume,\r\n                    hardcopy: ctrl.hardcopy,\r\n                    anime: ctrl.anime!==undefined && ctrl.anime!==null ? ctrl.anime._id : ctrl.anime,\r\n                    tags: ctrl.tagArray,\r\n                    user: ctrl.user\r\n\t\t\t     });\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\tmangaitem.$save(function(response) {\r\n\t\t\t\t$location.path('/mangaitems/' + response._id);\r\n\t\t\t\tNotificationFactory.success('Saved!', 'Manga was saved successfully');\r\n\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Remove existing Mangaitem\r\n\t\tfunction remove(mangaitem) {\r\n            //are you sure option...\r\n            NotificationFactory.confirmation(function() {\r\n                if ( mangaitem ) {\r\n                    mangaitem.$remove();\r\n\r\n                    for (var i in ctrl.mangaitems) {\r\n                        if (ctrl.mangaitems [i] === mangaitem) {\r\n                            ctrl.mangaitems.splice(i, 1);\r\n                        }\r\n                    }\r\n                } else {\r\n                    ctrl.mangaitem.$remove(function() {\r\n                        $location.path('/mangaitems');\r\n                    });\r\n                }\r\n                NotificationFactory.warning('Deleted!', 'Manga was successfully deleted.');\r\n            });\r\n\t\t}\r\n\r\n\t\t// Update existing Mangaitem\r\n\t\tfunction update() {\r\n\t\t\tvar mangaitem = ctrl.mangaitem;\r\n            ctrl.mangaitem = undefined;\r\n            MangaFactory.update(mangaitem, ctrl.tagArray, ctrl.updateHistory, ctrl.imgPath);\r\n\t\t}\r\n\r\n\t\tfunction tickOff(item) {\r\n        item.chapters += 1;\r\n        item.latest = new Date(); //update latest.\r\n        ctrl.updateHistory = true; //add to history.\r\n        ctrl.mangaitem = item;\r\n        ctrl.update();\r\n    }\r\n\r\n\t\t// Find a list of Mangaitems\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n      spinnerService.loading('manga', Mangaitems.query().$promise.then(function(result) {\r\n          ctrl.mangaitems = result;\r\n\t\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\t\tctrl.filterConfig.statTags = ItemService.buildStatTags(result, 0);\r\n      }));\r\n\t\t}\r\n\r\n\t\t// Find existing Mangaitem\r\n\t\tfunction findOne() {\r\n\t    Mangaitems.get({ mangaitemId: $stateParams.mangaitemId }).$promise.then(function(result) {\r\n\t        ctrl.mangaitem = result;\r\n\t        //            console.log(ctrl.mangaitem);\r\n\t    });\r\n\t\t}\r\n\r\n    // Find a list of Animeitems for dropdowns.\r\n\t\tfunction findAnime() {\r\n\t\t\tctrl.animeitems = Animeitems.query();\r\n\t\t}\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/mangaitems/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUpload');\r\n    }\r\n\r\n    //latest date display format.\r\n    function latestDate(latest, updated) {\r\n        return ItemService.latestDate(latest, updated);\r\n    }\r\n\r\n\t\tfunction viewItemHistory() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/history/views/item-history.html',\r\n        controller: 'ViewHistoryController as viewHistory',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { viewItem: ctrl.filterConfig.viewItem, type: 'manga' };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed history: ', result, ctrl.filterConfig.viewItem.meta);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tctrl.mangaitem = ctrl.filterConfig.viewItem;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n      });\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('mangaItemModel', mangaItemModel);\r\n\r\n  function mangaItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/mangaitems/templates/manga-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('mangaitems')\r\n\t.factory('MangaFactory', MangaFactory);\r\n\tMangaFactory.$inject = ['Mangaitems', 'ListService', 'ItemService', 'NotificationFactory', '$location'];\r\n\r\n\tfunction MangaFactory(Mangaitems, ListService, ItemService, NotificationFactory, $location) {\r\n    return {\r\n        update: function(item, tagArray, updateHistory, imgPath) {\r\n            var mangaitem = item;\r\n            console.log(mangaitem);\r\n            //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n            if (item.anime!==null && item.anime!==undefined) {\r\n                mangaitem.anime = item.anime._id;\r\n            }\r\n\r\n            if (tagArray!==undefined) {\r\n                mangaitem.tags = ListService.concatenateTagArrays(mangaitem.tags, tagArray);\r\n            }\r\n\r\n            //update the item history.\r\n            mangaitem = ItemService.itemHistory(mangaitem, updateHistory, 'manga');\r\n\r\n            if (imgPath!==undefined && imgPath!==null && imgPath!=='') {\r\n                mangaitem.image = imgPath;\r\n            }\r\n            //console.log($scope.imgPath);\r\n            //console.log(mangaitem.image);\r\n\r\n            //handle end date\r\n            if (mangaitem.chapters===mangaitem.finalChapter && mangaitem.finalChapter!==0) {\r\n                if (mangaitem.end===undefined || mangaitem.end===null) {\r\n                    mangaitem.volumes = mangaitem.finalVolume;\r\n                    mangaitem.end = mangaitem.latest;\r\n                    //console.log(animeitem.end);\r\n                }\r\n            } else if (mangaitem.reReading === false) {\r\n                mangaitem.end = null;\r\n            }\r\n\r\n            //handle status: completed.\r\n            if(mangaitem.end!==undefined && mangaitem.end!==null) {\r\n                mangaitem.status = true;\r\n            } else {\r\n                mangaitem.status = false;\r\n            }\r\n\r\n            //handle re-reading, re-read count.\r\n            if (mangaitem.reReading===true && mangaitem.chapters===mangaitem.finalChapter) {\r\n                mangaitem.volumes = mangaitem.finalVolume;\r\n                mangaitem.reReadCount += 1;\r\n                mangaitem.reReading = false;\r\n            }\r\n\r\n\t\t\tmangaitem.$update(function() {\r\n\t\t\t\tif (window.location.href.indexOf('tasks') === -1) $location.path('/mangaitems');\r\n\r\n                NotificationFactory.success('Saved!', 'Manga was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tvar error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\r\n\r\n        }\r\n    };\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\t//Mangaitems service used to communicate Mangaitems REST endpoints\r\n\tangular.module('mangaitems')\r\n\t.factory('Mangaitems',  MangaitemsFactory);\r\n\tMangaitemsFactory.$inject = ['$resource'];\r\n\r\n\tfunction MangaitemsFactory($resource) {\r\n\t\treturn $resource('mangaitems/:mangaitemId', { mangaitemId: '@_id'\r\n\t\t}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('orders').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Orders', 'orders', 'dropdown', '/orders(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'orders', 'List Orders', 'orders');\r\n\t\tMenus.addSubMenuItem('topbar', 'orders', 'New Order', 'orders/create');\r\n\t}\r\n]);\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('orders').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Orders state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listOrders', {\r\n\t\t\turl: '/orders',\r\n\t\t\ttemplateUrl: 'modules/orders/views/list-orders.client.view.html'\r\n\t\t}).\r\n\t\tstate('createOrder', {\r\n\t\t\turl: '/orders/create',\r\n\t\t\ttemplateUrl: 'modules/orders/views/create-order.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewOrder', {\r\n\t\t\turl: '/orders/:orderId',\r\n\t\t\ttemplateUrl: 'modules/orders/views/view-order.client.view.html'\r\n\t\t}).\r\n\t\tstate('editOrder', {\r\n\t\t\turl: '/orders/:orderId/edit',\r\n\t\t\ttemplateUrl: 'modules/orders/views/create-order.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n\n'use strict';\r\nvar CompleteOrdersController = (function () {\r\n    function CompleteOrdersController($scope, $uibModalInstance, order) {\r\n        this.$scope = $scope;\r\n        this.$uibModalInstance = $uibModalInstance;\r\n        this.order = order;\r\n        this.newPrice = {\r\n            company: '',\r\n            price: null\r\n        };\r\n    }\r\n    CompleteOrdersController.prototype.editOrder = function (index) {\r\n        var item = this.order.nextVolume.prices[index];\r\n        this.newPrice.company = item.company;\r\n        this.newPrice.price = item.price;\r\n        this.order.nextVolume.prices.splice(index, 1);\r\n    };\r\n    CompleteOrdersController.prototype.completeOrder = function () {\r\n        this.order.nextVolume.prices.push({ company: this.newPrice.company, date: this.newPrice.date, price: this.newPrice.price, rrp: this.order.rrp, paid: true });\r\n        this.$uibModalInstance.close(this.order);\r\n    };\r\n    CompleteOrdersController.prototype.cancel = function () {\r\n        this.$uibModalInstance.dismiss('cancel');\r\n    };\r\n    CompleteOrdersController.controllerId = 'CompleteOrdersController';\r\n    CompleteOrdersController.$inject = ['$scope', '$uibModalInstance', 'order'];\r\n    return CompleteOrdersController;\r\n}());\r\nangular.module('orders').controller(CompleteOrdersController.controllerId, CompleteOrdersController);\r\n\n'use strict';\r\nvar CreateOrdersController = (function () {\r\n    function CreateOrdersController($scope, $stateParams, $location, Authentication, $q, Orders, Mangaitems, $uibModal, NotificationFactory) {\r\n        this.$scope = $scope;\r\n        this.$stateParams = $stateParams;\r\n        this.$location = $location;\r\n        this.Authentication = Authentication;\r\n        this.$q = $q;\r\n        this.Orders = Orders;\r\n        this.Mangaitems = Mangaitems;\r\n        this.$uibModal = $uibModal;\r\n        this.NotificationFactory = NotificationFactory;\r\n        this.isCreateMode = this.$stateParams.orderId === undefined;\r\n        this.order = {};\r\n        this.orderCopy = {\r\n            series: '',\r\n            nextVolume: {\r\n                volume: 1,\r\n                date: Date.now(),\r\n                rrp: 0.00,\r\n                prices: []\r\n            },\r\n            rrp: 0.00,\r\n            orderHistory: []\r\n        };\r\n        this.authentication = this.Authentication;\r\n        this.stepConfig = {\r\n            stepHeaders: [\r\n                { text: 'Set next order' },\r\n                { text: 'Set prices' }\r\n            ],\r\n            currentStep: 1,\r\n            stepCount: 2,\r\n            items: []\r\n        };\r\n        this.init();\r\n    }\r\n    CreateOrdersController.prototype.init = function () {\r\n        var _this = this;\r\n        angular.copy(this.orderCopy, this.order);\r\n        if (this.isCreateMode) {\r\n            console.log('create mode');\r\n            this.Mangaitems.query().$promise.then(function (result) {\r\n                _this.stepConfig.items = result;\r\n                console.log('items: ', result);\r\n            });\r\n        }\r\n        else {\r\n            console.log('edit mode');\r\n            this.findOne();\r\n        }\r\n        console.log('init done: ');\r\n    };\r\n    CreateOrdersController.prototype.takeStep = function (step, direction) {\r\n        console.log('stepping: ', step, direction);\r\n        this.stepConfig.currentStep = (direction) ? step + 1 : step - 1;\r\n    };\r\n    CreateOrdersController.prototype.processOrder = function () {\r\n        if (this.order.nextVolume.volume > 0) {\r\n            var temp = angular.copy(this.order.nextVolume);\r\n            this.order.orderHistory.push(this.order.nextVolume);\r\n            this.order.nextVolume = {\r\n                volume: temp.volume + 1,\r\n                date: null,\r\n                rrp: this.order.rrp,\r\n                prices: []\r\n            };\r\n            this.update();\r\n        }\r\n    };\r\n    CreateOrdersController.prototype.cancel = function () {\r\n        this.$location.path('orders');\r\n    };\r\n    CreateOrdersController.prototype.create = function () {\r\n        var _this = this;\r\n        var order = new this.Orders({\r\n            series: this.order.series._id,\r\n            nextVolume: {\r\n                date: this.order.nextVolume.date,\r\n                volume: this.order.nextVolume.volume,\r\n                rrp: this.order.nextVolume.rrp,\r\n                prices: this.order.nextVolume.prices\r\n            },\r\n            rrp: this.order.rrp,\r\n            orderHistory: this.order.orderHistory\r\n        });\r\n        order.$save(function (response) {\r\n            _this.$location.path('orders/' + response._id);\r\n            _this.NotificationFactory.success('Saved!', 'New Order was successfully saved!');\r\n            angular.copy(_this.orderCopy, _this.order);\r\n        }, function (errorResponse) {\r\n            this.error = errorResponse.data.message;\r\n            this.NotificationFactory.error('Error!', 'Order failed to save!');\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.update = function () {\r\n        var _this = this;\r\n        var order = this.order;\r\n        order.$update(function () {\r\n            _this.$location.path('orders/' + order._id);\r\n            _this.NotificationFactory.success('Saved!', 'Order was successfully saved!');\r\n        }, function (errorResponse) {\r\n            this.error = errorResponse.data.message;\r\n            this.NotificationFactory.error('Error!', 'Order failed to save!');\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.openBoughtDialog = function () {\r\n        var _this = this;\r\n        var modalInstance = this.$uibModal.open({\r\n            animation: true,\r\n            templateUrl: '/modules/orders/views/complete-order.client.view.html',\r\n            controller: 'CompleteOrdersController as modal',\r\n            size: 'md',\r\n            resolve: {\r\n                order: function () {\r\n                    return _this.order;\r\n                }\r\n            }\r\n        });\r\n        modalInstance.result.then(function (result) {\r\n            console.log(result);\r\n            _this.order = result;\r\n            _this.processOrder();\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.findOne = function () {\r\n        this.order = this.Orders.get({ orderId: this.$stateParams.orderId });\r\n        console.log('found one: ', this.order);\r\n    };\r\n    CreateOrdersController.controllerId = 'CreateOrdersController';\r\n    CreateOrdersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', '$q', 'Orders', 'Mangaitems', '$uibModal', 'NotificationFactory'];\r\n    return CreateOrdersController;\r\n}());\r\nangular.module('orders').controller(CreateOrdersController.controllerId, CreateOrdersController);\r\n\n'use strict';\r\nvar OrderHistoryController = (function () {\r\n    function OrderHistoryController($scope, $uibModalInstance, order, $filter) {\r\n        this.$scope = $scope;\r\n        this.$uibModalInstance = $uibModalInstance;\r\n        this.order = order;\r\n        this.$filter = $filter;\r\n        this.processHistory();\r\n    }\r\n    OrderHistoryController.prototype.processHistory = function () {\r\n        var _this = this;\r\n        angular.forEach(this.order.orderHistory, function (item) {\r\n            console.log('order history: ', item);\r\n            var len = item.prices.length;\r\n            for (var i = 0; i < len; i++) {\r\n                if (item.prices[i].paid) {\r\n                    var cost = _this.$filter('number')(item.prices[i].price, 2), rrp = _this.$filter('number')(item.prices[i].rrp, 2);\r\n                    item.purchaseDate = item.prices[i].date;\r\n                    item.paid = cost;\r\n                    item.rrpInstance = rrp;\r\n                    item.saving = ((cost / rrp) * 100).toFixed(2);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    OrderHistoryController.prototype.cancel = function () {\r\n        this.$uibModalInstance.dismiss('cancel');\r\n    };\r\n    OrderHistoryController.controllerId = 'OrderHistoryController';\r\n    OrderHistoryController.$inject = ['$scope', '$uibModalInstance', 'order', '$filter'];\r\n    return OrderHistoryController;\r\n}());\r\nangular.module('orders').controller(OrderHistoryController.controllerId, OrderHistoryController);\r\n\n'use strict';\r\nvar OrdersController = (function () {\r\n    function OrdersController($scope, $stateParams, $location, Authentication, Orders, spinnerService, $uibModal) {\r\n        this.$scope = $scope;\r\n        this.$stateParams = $stateParams;\r\n        this.$location = $location;\r\n        this.Authentication = Authentication;\r\n        this.Orders = Orders;\r\n        this.spinnerService = spinnerService;\r\n        this.$uibModal = $uibModal;\r\n        this.authentication = this.Authentication;\r\n        this.order = undefined;\r\n        this.orders = [];\r\n        this.pageConfig = {\r\n            currentPage: 0,\r\n            pageSize: 10\r\n        };\r\n        this.init();\r\n    }\r\n    OrdersController.prototype.init = function () {\r\n        console.log('init: ', this.$stateParams);\r\n        if (this.$stateParams.orderId) {\r\n            console.log('find one');\r\n            this.findOne();\r\n        }\r\n        else {\r\n            console.log('find all');\r\n            this.find();\r\n        }\r\n    };\r\n    OrdersController.prototype.remove = function (order) {\r\n        if (order) {\r\n            order.$remove();\r\n            for (var i = 0, length = this.order.length; i < length; i++) {\r\n                if (this.orders[i] === order) {\r\n                    this.orders.splice(i, 1);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.order.$remove(function () {\r\n                this.$location.path('orders');\r\n            });\r\n        }\r\n    };\r\n    OrdersController.prototype.find = function () {\r\n        var _this = this;\r\n        this.spinnerService.loading('orders', this.Orders.query().$promise.then(function (result) {\r\n            _this.orders = result;\r\n        }));\r\n    };\r\n    OrdersController.prototype.findOne = function () {\r\n        var _this = this;\r\n        this.spinnerService.loading('orders', this.Orders.get({ orderId: this.$stateParams.orderId }).$promise.then(function (result) {\r\n            _this.order = result;\r\n        }));\r\n    };\r\n    OrdersController.prototype.openOrderHistoryDialog = function () {\r\n        var _this = this;\r\n        var modalInstance = this.$uibModal.open({\r\n            animation: true,\r\n            templateUrl: '/modules/orders/views/order-history.client.view.html',\r\n            controller: 'OrderHistoryController as modal',\r\n            size: 'md',\r\n            resolve: {\r\n                order: function () {\r\n                    return _this.order;\r\n                }\r\n            }\r\n        });\r\n    };\r\n    OrdersController.controllerId = 'OrdersController';\r\n    OrdersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Orders', 'spinnerService', '$uibModal'];\r\n    return OrdersController;\r\n}());\r\nangular.module('orders').controller(OrdersController.controllerId, OrdersController);\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('orders').factory('Orders', OrdersFactory);\r\n\tOrdersFactory.$inject = ['$resource'];\r\n\r\n\tfunction OrdersFactory($resource) {\r\n\t\treturn $resource('orders/:orderId', { orderId: '@_id'\r\n\t\t}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('ratings').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('ratings', {\r\n\t\t\turl: '/ratings',\r\n\t\t\ttemplateUrl: 'modules/ratings/views/ratings.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\tangular.module('ratings')\r\n\t.controller('RatingsController', RatingsController);\r\n\tRatingsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'ListService', 'NotificationFactory', 'StatisticsService', 'spinnerService'];\r\n\tfunction RatingsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, ListService, NotificationFactory, StatisticsService, spinnerService) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.episodeScore = episodeScore;\r\n\t\tctrl.find = find;\r\n\t\tctrl.go = go;\r\n\t\tctrl.hoveringOver = hoveringOver;\r\n\t\tctrl.itemScore = itemScore;\r\n\t\tctrl.maxRating = 10;\r\n\t\tctrl.modelOptions = { debounce: 700 };\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 20\r\n    };\r\n    ctrl.ratingLevel = undefined; //default rating filter\r\n    ctrl.sortReverse = true;\r\n    ctrl.sortType = 'rating';\r\n\t\tctrl.view = 'Anime';\r\n\t\tctrl.viewEpisodeRatings = viewEpisodeRatings;\r\n    ctrl.viewItem = undefined;\r\n\r\n\t\t//rating 'tooltip' function\r\n    function hoveringOver(value) {\r\n        ctrl.overStar = value;\r\n        ctrl.percent = 100 * (value / ctrl.maxRating);\r\n    }\r\n\r\n    function go(id) {\r\n        $location.path('/mangaitems/' + id);\r\n    }\r\n\r\n    function getItems(view) {\r\n        if (view === 'Anime') {\r\n            spinnerService.loading('rating', Animeitems.query().$promise.then(function(result) {\r\n                ctrl.items = result;\r\n            }));\r\n        } else if (view === 'Manga') {\r\n            spinnerService.loading('rating', Mangaitems.query().$promise.then(function(result) {\r\n                ctrl.items = result;\r\n            }));\r\n        }\r\n        ctrl.viewItem = undefined;\r\n    }\r\n\r\n    function find(view) {\r\n\t\t\tif(view === 'Anime' || view === 'Manga') {\r\n\t\t\t\t getItems(view);\r\n\t\t\t } else {\r\n\t\t\t\tctrl.view = 'Anime';\r\n\t\t\t\tgetItems(ctrl.view);\r\n\t\t\t }\r\n    }\r\n\r\n    //apply new score.\r\n    function itemScore(item, score) {\r\n        if (item.rating !== score) {\r\n            item.rating = score;\r\n\r\n            item.$update(function() {\r\n                $location.path('ratings');\r\n                NotificationFactory.success('Saved!', 'New rating was saved successfully');\r\n            }, function(errorResponse) {\r\n                ctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Your change failed!');\r\n            });\r\n//                console.log('update');\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /** Episode rating functions below here.\r\n     */\r\n    function viewEpisodeRatings(item) {\r\n        ctrl.viewItem = (ctrl.viewItem !== item) ? item : undefined;\r\n        ctrl.isEqual = (ctrl.viewItem === item) ? true : false;\r\n        ctrl.search = (ctrl.viewItem === item) ? item.title : '';\r\n        if (ctrl.viewItem !== undefined) {\r\n            spinnerService.loading('summary', StatisticsService.buildSummaryFunctions(ctrl.viewItem.meta.history).then(function(result) {\r\n                ctrl.summaryFunctions = result;\r\n            }));\r\n        }\r\n    }\r\n\r\n    function episodeScore(finished) {\r\n//            console.log('finished: ', finished, ctrl.viewItem.meta.history);\r\n        if (finished) {\r\n            var item = ctrl.viewItem;\r\n            item.$update(function() {\r\n                $location.path('ratings');\r\n                NotificationFactory.success('Saved!', 'New episode rating was saved successfully');\r\n                spinnerService.loading('summary', StatisticsService.buildSummaryFunctions(ctrl.viewItem.meta.history).then(function(result) {\r\n                    ctrl.summaryFunctions = result;\r\n                }));\r\n            }, function(errorResponse) {\r\n                ctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Your change failed!');\r\n            });\r\n        }\r\n    }\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('ratings')\r\n  .directive('focusOnShow', focusOnShow);\r\n\r\n  function focusOnShow($timeout) {\r\n    return function(scope, element, attrs) {\r\n       scope.$watch(attrs.focusOnShow, function (newValue) {\r\n//            console.log('preview changed!')\r\n            $timeout(function() {\r\n                var myValue = newValue && element[0].focus();\r\n                return myValue;\r\n            });\r\n         },true);\r\n      };\r\n    }\r\n})();\r\n\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('statistics').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('statistics', {\r\n\t\t\turl: '/statistics',\r\n\t\t\ttemplateUrl: 'modules/statistics/views/statistics.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('statistics').controller('StatisticsController', StatisticsController);\r\n\tStatisticsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'Characters', 'Toptens', 'ListService', 'ItemService', 'CharacterService', 'StatisticsService', '$filter', 'spinnerService'];\r\n\r\n\t\tfunction StatisticsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, Characters, Toptens, ListService, ItemService, CharacterService, StatisticsService, $filter, spinnerService) {\r\n\t\t\tvar ctrl = this,\r\n\t\t\t\t\tfilter = $filter('filter');\r\n\t\t\tctrl.authentication = Authentication;\r\n\t\t\tctrl.colours = { red: '#c9302c', green: '#449d44', blue: '#31b0d5' }; //'red'; '#d9534f'; ////'green';'#5cb85c'; ////'blue';'#5bc0de'; //\r\n\t\t\tctrl.commonArrays = ListService.getCommonArrays('statistics');\r\n\t\t\tctrl.dataStore = { anime: [], manga: [], character: [], toptens: { anime: {}, manga: {}, character: {} } };\r\n\t\t\tctrl.detail = {\r\n\t\t\t\t\tisVisible: false,\r\n\t\t\t\t\tyear: '',\r\n\t\t\t\t\tdivision: '',\r\n\t\t\t\t\tdivisionText: '',\r\n\t\t\t\t\thistory: 'months',\r\n\t\t\t\t\tsummary: {\r\n\t\t\t\t\t\t\ttype: '',\r\n\t\t\t\t\t\t\tisVisible: false\r\n\t\t\t\t\t},\r\n\t\t\t\t\tisEpisodeRatings: false\r\n\t\t\t};\r\n\t\t\tctrl.filterConfig = {\r\n          show: {\r\n              tag: false,\r\n              series: false,\r\n              voice: false\r\n          },\r\n          sort: {\r\n\t\t\t\t\t\t\tepisodeRating: {\r\n\t\t\t\t\t\t\t\ttype: 'title',\r\n\t\t\t\t\t\t\t\treverse: false\r\n\t\t\t\t\t\t\t},\r\n              tag: {\r\n                  type: 'ratingWeighted',\r\n                  reverse: true\r\n              },\r\n              tagDetail: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n              series: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n              voice: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n\t\t\t\t\t\t\ttopten: {\r\n\t\t\t\t\t\t\t\ttype: 'count',\r\n\t\t\t\t\t\t\t\treverse: true\r\n\t\t\t\t\t\t\t}\r\n          },\r\n          search: {\r\n              tag: '',\r\n              tagDetail: '',\r\n              series: '',\r\n              voice: '',\r\n\t\t\t\t\t\t\ttopten: ''\r\n          },\r\n\t\t\t\t\ttopten: {\r\n\t\t\t\t\t\tisRanked: false,\r\n\t\t\t\t\t\tisFavourite: false\r\n\t\t\t\t\t}\r\n      };\r\n\t\t\tctrl.find = find;\r\n\t\t\tctrl.gender = {}; //holds gender summary details.\r\n\t\t\tctrl.generateSeasons = generateSeasons;\r\n\t\t\tctrl.getFilteredItems = getFilteredItems;\r\n\t\t\tctrl.getToptenItemStatistics = getToptenItemStatistics;\r\n\t\t\tctrl.historyDetail = historyDetail;\r\n      ctrl.historyDetails = {};\r\n      ctrl.overview = {}; //holds summary/overview details.\r\n      ctrl.ratingsDistribution = []; //counts for each rating.\r\n      ctrl.statSeries = []; //for series statistics;\r\n      ctrl.statTags = []; //for tag statistics;\r\n\t\t\tctrl.tableDetail = tableDetail;\r\n\t\t\tctrl.tableDetails = {};\r\n      ctrl.taglessItem = false; //filter variable for showing tagless items.\r\n      ctrl.toptens = {\r\n\t\t\t\ttype: 'anime',\r\n\t\t\t\tanime: { listCount: 0, items: [] }, manga:  { listCount: 0, items: [] }, character:  { listCount: 0, items: [] }, detail: { items: [] }\r\n\t\t\t };\r\n      ctrl.view = 'Anime';\r\n      ctrl.voiceActors = []; //for voice actor list;\r\n\r\n\t\t\tfunction getItemStatistics(view, items) {\r\n\t\t\t\tif(view === 'Anime' || view === 'Manga') {\r\n\t\t\t\t\tctrl.overview = ItemService.buildOverview(items);\r\n\t\t\t\t\tctrl.historyDetails.months = ItemService.completeByMonth(items);\r\n\t\t\t\t\tif (view === 'Anime') ctrl.historyDetails.seasons = ItemService.completeBySeason(items);\r\n\t\t\t\t\tctrl.ratingValues = ItemService.getRatingValues(items);\r\n\t\t\t\t\tctrl.ratingsDistribution = ItemService.buildRatingsDistribution(items);\r\n\t\t\t\t\tctrl.statTags = ItemService.buildStatTags(items, ctrl.ratingValues.averageRating);\r\n\t\t\t\t} else if (view === 'Character') {\r\n\t\t\t\t\tctrl.statTags = CharacterService.buildCharacterTags(items);\r\n\t\t\t\t\tctrl.statSeries = CharacterService.buildSeriesList(items);\r\n\t\t\t\t\tctrl.voiceActors = CharacterService.buildVoiceActors(items);\r\n\t\t\t\t\tCharacterService.buildGenderDistribution(ctrl.statTags, items.length).then(function(result) {\r\n\t\t\t\t\t\t\tctrl.gender = result;\r\n\t\t\t\t\t\t\tctrl.gender[0].colour = ctrl.colours.red;\r\n\t\t\t\t\t\t\tctrl.gender[1].colour = ctrl.colours.green;\r\n\t\t\t\t\t\t\tctrl.gender[2].colour = ctrl.colours.blue;\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (view ==='Topten') {\r\n\t\t\t\t\tStatisticsService.buildToptenModeList(items, ctrl.toptens.type).then(function(result) {\r\n\t\t\t\t\t\tctrl.toptens.detail.items = result.sort(function(a, b) {\r\n\t\t\t\t\t\t\tif(a.count < b.count) return 1;\r\n\t\t\t\t\t\t\tif(a.count > b.count) return -1;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.log('topten stat process: ', items, ctrl.toptens);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//handle getting view items and setting view specific defaults.\r\n      function getItems(view) {\r\n          //reset defaults that are shared between views.\r\n          ctrl.detail.history = 'months';\r\n          ctrl.filterConfig.search.tag = '';\r\n          ctrl.detail.isVisible = false;\r\n          ctrl.detail.isEpisodeRatings = false;\r\n          ctrl.statTags = []; //clear to stop multiple views tags appearing.\r\n          ctrl.ratingsDistribution = [];\r\n          if (view === 'Anime') {\r\n              ctrl.filterConfig.sort.tag.type = 'ratingWeighted'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.anime.length === 0) {\r\n                spinnerService.loading('items', Animeitems.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.anime = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t                getItemStatistics(view, result);\r\n\t\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.anime;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.anime);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - anime');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Manga') {\r\n              ctrl.filterConfig.sort.tag.type = 'ratingWeighted'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.manga.length === 0) {\r\n              \tspinnerService.loading('items',\tMangaitems.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.manga = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t\t\t\t\t\t\t\t\tgetItemStatistics(view, result);\r\n              \t}));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.manga;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.manga);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - anime');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Character') {\r\n              ctrl.filterConfig.sort.tag.type = 'count'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.character.length === 0) {\r\n\t\t\t\t\t\t\t\tspinnerService.loading('character', Characters.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.character = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t\t\t\t\t\t\t\t\tgetItemStatistics(view, result);\r\n                }));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.character;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.character);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - character');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Topten') {\r\n\t\t\t\t\t\tif (ctrl.dataStore.toptens.anime.totalListCount === undefined) {\r\n              spinnerService.loading('topten', Toptens.query().$promise.then(function(result) {\r\n                return ListService.groupItemsByProperties(result, ['type']);\r\n              }).then(function(result) {\r\n\t\t\t\t\t\t\t\tfor(var i = 0, type = ''; i < 3; i++) {\r\n\t\t\t\t\t\t\t\t\ttype = result[i][0].type;\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.toptens[type].items = result[i];\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.toptens[type].totalListCount = result[i].length;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn StatisticsService.buildToptenDataStructure(ctrl.toptens, result);\r\n              }).then(function(result) {\r\n\t\t\t\t\t\t\t\tctrl.toptens = result;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, result[ctrl.toptens.type].items);\r\n\t\t\t\t\t\t\t\tconsole.log('topten arrays: ', ctrl.toptens);\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.toptens[ctrl.toptens.type].items);\r\n\t\t\t\t\t\t\tconsole.log('from cache - topten');\r\n\t\t\t\t\t\t}\r\n          }\r\n\t\t\t\t\tconsole.log('dataStore check: ', ctrl.dataStore);\r\n      }\r\n      function find(view) {\r\n          getItems(view);\r\n      }\r\n\r\n\t\t\tfunction getToptenItemStatistics(view, toptenType) {\r\n\t\t\t\tconsole.log('get topten stats: ', toptenType);\r\n\t\t\t\tvar filteredItems = ctrl.dataStore.toptens[toptenType].items;\r\n\t\t\t\tif(ctrl.filterConfig.topten.isRanked) filteredItems = filter(filteredItems, { isRanked: true });\r\n\t\t\t\tif(ctrl.filterConfig.topten.isFavourite) filteredItems = filter(filteredItems, { isFavourite: true });\r\n\t\t\t\tconsole.log('post filtering: ', filteredItems);\r\n\t\t\t\tif(filteredItems.length > 0) {\r\n\t\t\t\t\tctrl.toptens[toptenType].items = []; //clear items so you won't get repeats.\r\n\t\t\t\t\tStatisticsService.buildToptenDataStructure(ctrl.toptens, [filteredItems]).then(function(result) {\r\n\t\t\t\t\t\tctrl.toptens = result;\r\n\t\t\t\t\t\tconsole.log('topten data structure - result: ', result, ctrl.toptens);\r\n\t\t\t\t\t\tgetItemStatistics(view, result[toptenType].items);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctrl.toptens[toptenType].listCount = 0;\r\n\t\t\t\t\tctrl.toptens.detail.items = filteredItems;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n      //Builds ratings aggregates.\r\n      function getSummaryFunctions(array) {\r\n      \tspinnerService.loading('detail', StatisticsService.buildSummaryFunctions(array).then(function(result) {\r\n        \tctrl.historyDetails.summaryFunctions = result;\r\n\t\t\t\t\tconsole.log('got summary functions: ', ctrl.detail, ctrl.historyDetails);\r\n        }));\r\n        if (ctrl.detail.summary.isVisible === true) {\r\n\t        spinnerService.loading('detail',\r\n\t            StatisticsService.buildYearSummary(array, ctrl.detail.year, ctrl.detail.summary.type).then(function(result) {\r\n\t                ctrl.historyDetails.yearSummary = result;\r\n\t\t\t\t\t\t\t\t\tconsole.log('got year summary: ', ctrl.detail, ctrl.historyDetails);\r\n\t            })\r\n\t        );\r\n        }\r\n\t\t\t\tif(ctrl.detail.isEpisodeRatings && array[0].meta.episodeSummaryFunctions === undefined) { //If the first item has it already, they all do and this is pointless.\r\n          spinnerService.loading('detail', StatisticsService.buildEpisodeSummaries(array).then(function(result) {\r\n                  console.log(array);\r\n          }));\r\n\t\t\t\t}\r\n//            console.log(array, $scope.historyDetails);\r\n      }\r\n\r\n      function historyDetail(year, division, divisionText, summaryType) {\r\n\t      ctrl.detail.isVisible = true;\r\n\t      ctrl.detail.year = year;\r\n\t      ctrl.detail.division = division;\r\n\t      ctrl.detail.divisionText = divisionText;\r\n\t\t\t\tctrl.detail.summary.type = summaryType;\r\n\t      ctrl.detail.summary.isVisible = (summaryType === undefined) ? false : true;\r\n\t\t\t\tctrl.getFilteredItems();\r\n      }\r\n\r\n      function tableDetail(type, name) {\r\n          if (ctrl.tableDetails[type] === name) {\r\n              ctrl.filterConfig.search[type] = '';\r\n              ctrl.filterConfig.show[type] = false;\r\n              ctrl.tableDetails[type] = '';\r\n              if (type === 'tag') ctrl.tableDetails.isEqual = false;\r\n          } else {\r\n              ctrl.filterConfig.search[type] = name;\r\n              ctrl.tableDetails[type] = name;\r\n              ctrl.filterConfig.show[type] = true;\r\n              if (type === 'tag') {\r\n                  ctrl.tagDetailResult = CharacterService.buildRelatedCharacterTags(ctrl.items, name);\r\n                  ctrl.tableDetails.isEqual = true;\r\n              }\r\n          }\r\n      }\r\n\r\n\t\t\tfunction getFilteredItems(historyChange) {\r\n\t\t\t\tif(historyChange) {\r\n\t\t\t\t\tctrl.detail.isVisible = false;\r\n\t\t\t\t\tctrl.detail.summary.isVisible = false;\r\n\t\t\t\t\tif(ctrl.detail.history === 'months') ctrl.detail.isEpisodeRatings = false;\r\n\t\t\t\t}\r\n\t\t\t\tvar filtered = $filter('statisticsDetailFilter')(ctrl.items, ctrl.detail.history, ctrl.detail.year, ctrl.detail.division);\r\n\t\t\t\tgetSummaryFunctions(filtered);\r\n\t\t\t}\r\n\r\n      /** Using the start date of confirmed 'in-season' shows\r\n       *  to populate the new season attrs. that will work with the new\r\n       *  filters in the hopes accuracy and speed will increase.\r\n       */\r\n      function generateSeasons() {\r\n          if (ctrl.view === 'Anime') {\r\n              var array = ItemService.setSeason(ctrl.items, ctrl.detailSeasonYear, ctrl.detailSeason);\r\n              angular.forEach(array, function(item) {\r\n                  item.$update(function() {\r\n                      console.log(item);\r\n                  }, function(errorResponse) {\r\n                      ctrl.error = errorResponse.data.message;\r\n                  });\r\n              });\r\n          }\r\n      }\r\n\t\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('detectFlood', detectFlood);\r\n  detectFlood.$inject = ['$timeout'];\r\n\r\n  function detectFlood($timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function(scope, element, attrs) {\r\n            var el = element[0];\r\n\r\n            function overflowCheck() {\r\n                if (el.scrollWidth > el.offsetWidth) {\r\n                    el.classList.add('flooded');\r\n                } else {\r\n                    el.classList.remove('flooded');\r\n                }\r\n            }\r\n            overflowCheck();\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: el.offsetWidth,\r\n                    };\r\n                }, function () {\r\n//                    console.log('detect flood?');\r\n                        overflowCheck();\r\n                }, true\r\n            );\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('percentageBarContainer', percentageBarContainer);\r\n\r\n  function percentageBarContainer() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        scope: {\r\n          border: '@?'\r\n        },\r\n        transclude: true,\r\n        bindToController: true,\r\n        template: '<div class=\"relative {{percentageBarContainer.border}}\" style=\"height: 20px;\" ng-transclude></div>',\r\n        controllerAs: 'percentageBarContainer',\r\n        controller: function($scope) {\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('percentageBar', percentageBar);\r\n\r\n  function percentageBar() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        scope: {\r\n            type: '@?',\r\n            percentage: '@',\r\n            colour: '@?',\r\n            display: '@?'\r\n        },\r\n        require: '^percentageBarContainer',\r\n        templateUrl: '/modules/statistics/templates/percentage-bar.html',\r\n        link: function(scope, element, attrs, percentageBarContainerCtrl) {\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('tabContainer', tabContainer);\r\n\r\n  function tabContainer() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        scope: {\r\n            model: '=ngModel'\r\n        },\r\n        templateUrl: '/modules/statistics/templates/tab-container.html',\r\n        require: '?ngModel',\r\n        bindToController: true,\r\n        controllerAs: 'tabContainer',\r\n        controller: function($scope) {\r\n            var self = this;\r\n            self.tabs = [];\r\n            self.currentTab = undefined;\r\n            self.listShift = 0;\r\n\r\n            self.addTab = function addTab(tab) {\r\n                self.tabs.push(tab);\r\n\r\n                if(self.tabs.length === 1) {\r\n                    tab.active = true;\r\n                }\r\n            };\r\n\r\n            self.disable = function(disabledTab) {\r\n                if(disabledTab.active) {\r\n                    angular.forEach(self.tabs, function(tab) {\r\n                        if(!tab.disabled) {\r\n                            self.select(tab);\r\n                            return;\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n\r\n            self.select = function(selectedTab) {\r\n                if(!selectedTab.disabled) {\r\n                    angular.forEach(self.tabs, function(tab) {\r\n                        if(tab.active && tab !== selectedTab) {\r\n                          tab.active = false;\r\n                        }\r\n                    });\r\n                    selectedTab.active = true;\r\n                    self.currentTab = ($scope.tabContainer.model === undefined) ? undefined : selectedTab.heading;\r\n                }\r\n            };\r\n\r\n            self.shiftTabs = function(direction) {\r\n                switch(direction) {\r\n                    case 'origin':\r\n//                        console.log(self.listShift, (self.listShift - 100));\r\n                        if ((self.listShift + 100) > 0) {\r\n                            self.listShift = 0;\r\n                        } else {\r\n                            self.listShift += 100;\r\n                        }\r\n                        break;\r\n\r\n                    case 'offset':\r\n                        if ((self.listShift - 100) < ($scope.elWidth - $scope.ulWidth)) {\r\n                            self.listShift = $scope.elWidth - $scope.ulWidth;\r\n                        } else {\r\n                            self.listShift -= 100;\r\n                        }\r\n                        break;\r\n                }\r\n            };\r\n\r\n        },\r\n        link: function(scope, element, attrs, model) {\r\n            var el = element[0],\r\n                ul = el.children[0].children[0];\r\n            scope.elWidth = el.offsetWidth;\r\n            scope.ulWidth = ul.offsetWidth;\r\n\r\n            scope.$watch('tabContainer.currentTab', function(newValue) {\r\n                if (newValue !== undefined && model.$viewValue !== undefined) {\r\n                    model.$setViewValue(newValue);\r\n                }\r\n            });\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: el.offsetWidth,\r\n                    };\r\n                }, function () {\r\n                    scope.elWidth = el.offsetWidth;\r\n                }, true\r\n            );\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: ul.offsetWidth,\r\n                    };\r\n                }, function () {\r\n                    scope.ulWidth = ul.offsetWidth;\r\n                }, true\r\n            );\r\n\r\n            scope.$watch('tabContainer.listShift', function(newValue) {\r\n                if(newValue !== undefined) {\r\n                    var shift = (newValue === 0) ? '' : 'px';\r\n                    ul.style.left = newValue + shift;\r\n                }\r\n            });\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('tabView', tabView);\r\n\r\n  function tabView() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        template: '<div class=\"tab-view\" role=\"tabpanel\" ng-show=\"active\" ng-transclude></div>',\r\n        require: '^tabContainer',\r\n        scope: {\r\n            heading: '@',\r\n            disabled: '='\r\n        },\r\n        link: function (scope, element, attrs, tabContainerCtrl) {\r\n            scope.active = false;\r\n            tabContainerCtrl.addTab(scope);\r\n\r\n            scope.$watch('disabled', function(newValue) {\r\n                if(newValue !== undefined) {\r\n                    if(newValue) {\r\n                        console.log(scope.heading, newValue);\r\n                        tabContainerCtrl.disable(scope);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  //Statistics service\r\n  angular.module('statistics')\r\n  .service('StatisticsService', StatisticsService);\r\n  StatisticsService.$inject = ['$filter', 'ListService', '$q'];\r\n\r\n   function StatisticsService($filter, ListService, $q) {\r\n      var service = {\r\n        buildEpisodeSummaries: buildEpisodeSummaries,\r\n        buildSummaryFunctions: buildSummaryFunctions,\r\n        buildToptenDataStructure: buildToptenDataStructure,\r\n        buildToptenModeList: buildToptenModeList,\r\n        buildYearSummary: buildYearSummary,\r\n        getModeMap: getModeMap,\r\n        occuranceCounter: occuranceCounter\r\n      };\r\n      return service;\r\n\r\n      function buildSummaryFunctions(array) {\r\n          return $q(function(resolve, reject) {\r\n              if (array !== undefined) {\r\n                  var i = array.length, highestRating = 0, lowestRating = 10, averageRating = 0, modeRating = {}, ratings = { count: 0, sum: 0 };\r\n                  while(i--) {\r\n      //                console.log(array[i]);\r\n                      highestRating = array[i].rating > highestRating ? array[i].rating : highestRating;\r\n                      lowestRating = 0 < array[i].rating && array[i].rating < lowestRating ? array[i].rating : lowestRating;\r\n                      ratings.count += array[i].rating > 0 ? 1 : 0;\r\n                      ratings.sum += array[i].rating;\r\n                      averageRating = (ratings.sum / ratings.count).toFixed(2);\r\n                      modeRating = service.getModeMap(array, 'rating', 0);\r\n                  }\r\n                  resolve([\r\n                      { metric: 'Average rating', value: averageRating },\r\n                      { metric: 'Highest rating', value: highestRating },\r\n                      { metric: 'Lowest rating',  value: (lowestRating === 10) ? 0 : lowestRating },\r\n                      { metric: 'Mode rating',    value: (modeRating.value === undefined) ? 0 : modeRating.value }\r\n                  ]);\r\n              }\r\n          });\r\n      }\r\n\r\n      function processYearSummary(summary, array) {\r\n          var i = array.length;\r\n          if (summary.length < 1) {\r\n              while(i--) {\r\n                  summary.push({\r\n                      metric: array[i].metric,\r\n                      values: []\r\n                  });\r\n              }\r\n              summary.reverse();\r\n          }\r\n          i = array.length;\r\n          for(var j = 0; j < i; j++) {\r\n              summary[j].values.push({ value: array[j].value });\r\n          }\r\n          return summary;\r\n      }\r\n\r\n      function buildYearSummary(array, year, type) {\r\n          return $q(function(resolve, reject) {\r\n              var filter = (type === 'months') ? 'endedMonth' : 'season',\r\n                  attr   = (type === 'months') ? 'number'     : 'text'  ,\r\n                  commonArrays = ListService.getCommonArrays(),\r\n                  i = commonArrays[type].length,\r\n                  yearSummary = [], results = [];\r\n\r\n              for(var j = 0; j < i; j++) {\r\n                  var filteredArray = $filter(filter)(array, year, commonArrays[type][j][attr]),\r\n                      promise = service.buildSummaryFunctions(filteredArray);\r\n                  results.push(promise);\r\n              }\r\n              angular.forEach(results, function(promise) {\r\n                  promise.then(function(result) {\r\n                      yearSummary = processYearSummary(yearSummary, result);\r\n                  });\r\n              });\r\n              resolve(yearSummary);\r\n          });\r\n      }\r\n\r\n      function buildEpisodeSummaries(array) {\r\n          return $q(function(resolve, reject) {\r\n              angular.forEach(array, function(item) {\r\n                  service.buildSummaryFunctions(item.meta.history).then(function(result) {\r\n                      item.meta.episodeSummaryFunctions = result;\r\n                  });\r\n              });\r\n              resolve(array);\r\n          });\r\n      }\r\n\r\n      function getModeMap(array, attr, ignore) {\r\n          var modeMap = {},\r\n              max = {\r\n                  count: 0,\r\n                  value: ''\r\n              };\r\n          for(var i = 0; i < array.length; i++) {\r\n              var value = array[i][attr];\r\n              if(modeMap[value] === null || modeMap[value] === undefined) {\r\n                  modeMap[value] = 1;\r\n              } else {\r\n                  modeMap[value]++;\r\n              }\r\n              if(modeMap[value] > max.count) {\r\n                  //Ignore is a value you might not care about e.g. 0;\r\n                  if (ignore !== value) {\r\n                      max.count = modeMap[value];\r\n                      max.value = value;\r\n                  }\r\n              }\r\n          }\r\n  //        console.log(max);\r\n          return max;\r\n      }\r\n\r\n      function occuranceCounter(array, attr) {\r\n        return $q(function(resolve, reject) {\r\n          var occuranceCounter = [];\r\n          ListService.groupItemsByProperties(array, [attr]).then(function(result) {\r\n            for(var i = 0, len = result.length; i < len; i++) {\r\n              occuranceCounter.push({\r\n                value: result[i][0][attr],\r\n                count: result[i].length\r\n              });\r\n            }\r\n          });\r\n          resolve(occuranceCounter);\r\n        });\r\n      }\r\n\r\n      function buildToptenDataStructure(obj, arrayOfArrays) {\r\n        return $q(function(resolve, reject) {\r\n          angular.forEach(arrayOfArrays, function(array) {\r\n            var type = array[0].type, listType = type + 'List', len = array.length;\r\n            obj[type].listCount = len;\r\n            for(var i = 0; i < len; i++) {\r\n              var itemLen = array[i][listType].length;\r\n              for(var j = 0; j < itemLen; j++) {\r\n                obj[type].items.push(array[i][listType][j]);\r\n              }\r\n            }\r\n          });\r\n          resolve(obj);\r\n        });\r\n      }\r\n\r\n      function buildToptenModeList(array, type) {\r\n        var attr = type === 'character' ? 'name' : 'title';\r\n        return service.occuranceCounter(array, attr);\r\n      }\r\n\r\n    }\r\n\r\n  })();\r\n\n'use strict';\r\n\r\n//// Configuring the Articles module\r\n//angular.module('tasks').run(['Menus',\r\n//\tfunction(Menus) {\r\n//\t\t// Set top bar menu items\r\n//\t\tMenus.addMenuItem('topbar', 'Tasks', 'tasks', 'dropdown', '/tasks(/create)?');\r\n//\t\tMenus.addSubMenuItem('topbar', 'tasks', 'List Tasks', 'tasks');\r\n//\t\tMenus.addSubMenuItem('topbar', 'tasks', 'New Task', 'tasks/create');\r\n//\t}\r\n//]);\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('tasks').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Tasks state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listTasks', {\r\n\t\t\turl: '/tasks',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/list-tasks.client.view.html'\r\n\t\t}).\r\n\t\tstate('createTask', {\r\n\t\t\turl: '/tasks/create',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/create-task.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewTask', {\r\n\t\t\turl: '/tasks/:taskId',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/view-task.client.view.html'\r\n\t\t}).\r\n\t\tstate('editTask', {\r\n\t\t\turl: '/tasks/:taskId/edit',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/edit-task.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('tasks').controller('CreateTaskController', CreateTaskController);\r\n  CreateTaskController.$inject =  ['$scope', 'data', '$stateParams', '$location', 'Authentication', 'Tasks', 'ListService', 'NotificationFactory', 'TaskFactory', 'spinnerService', '$uibModalInstance', 'Animeitems', 'Mangaitems'];\r\n\r\nfunction CreateTaskController($scope, data, $stateParams, $location, Authentication, Tasks, ListService, NotificationFactory, TaskFactory, spinnerService, $uibModalInstance, Animeitems, Mangaitems) {\r\n  var ctrl = this,\r\n      newTaskModel = {};\r\n  ctrl.addChecklistItem = addChecklistItem;\r\n  ctrl.backStep = backStep;\r\n  ctrl.cancel = cancel;\r\n  ctrl.commonArrays = data.commonArrays;\r\n  ctrl.create = create;\r\n  ctrl.dropChecklistItem = dropChecklistItem;\r\n  ctrl.stepConfig = {\r\n      currentStep: 1,\r\n      stepCount: 2\r\n  };\r\n  ctrl.submit = submit;\r\n  ctrl.takeStep = takeStep;\r\n\r\n  function setNewTask() {\r\n      ctrl.newTask = {\r\n          description: '',\r\n          link: {\r\n              linked: false,\r\n              type: '',\r\n              anime: undefined,\r\n              manga: undefined\r\n          },\r\n          day: '',\r\n          date: new Date(),\r\n          repeat: 0,\r\n          category: '',\r\n          daily: false,\r\n          checklist: false,\r\n          checklistItems: [],\r\n          isAddTask: false\r\n      };\r\n  }\r\n  setNewTask();\r\n  angular.copy(ctrl.newTask, newTaskModel);\r\n\r\n\r\n  //for adding/removing options.\r\n  function addChecklistItem() {\r\n          if (ctrl.newTask.checklistItem!=='' && ctrl.newTask.checklistItem!==undefined) {\r\n              var i = 0;\r\n              var alreadyAdded = false;\r\n              if (ctrl.newTask.checklistItems.length > 0) {\r\n                  while(i < ctrl.newTask.checklistItems.length) {\r\n                      if (ctrl.newTask.checklistItems[i].text === ctrl.newTask.checklistItem) {\r\n                          alreadyAdded = true;\r\n                      }\r\n                      i++;\r\n                  }\r\n                  //if not in array add it.\r\n                  if (alreadyAdded === false) {\r\n                      ctrl.newTask.checklistItems.push({ text: ctrl.newTask.checklistItem, complete: false });\r\n                  }\r\n              } else {\r\n                  ctrl.newTask.checklistItems.push({ text: ctrl.newTask.checklistItem, complete: false });\r\n              }\r\n          }\r\n          ctrl.newTask.checklistItem = '';\r\n  }\r\n  function dropChecklistItem(text) {\r\n      var deletingItem = ctrl.newTask.checklistItems;\r\n      ctrl.newTask.checklistItems = [];\r\n      //update the task.\r\n      angular.forEach(deletingItem, function(item) {\r\n          if (item.text !== text) {\r\n              ctrl.newTask.checklistItems.push(item);\r\n          }\r\n      });\r\n  }\r\n\r\n  // Create new Task\r\n  function create() {\r\n//            console.log(this.newTask);\r\n    // Create new Task object\r\n    var task = new Tasks ({\r\n        description: ctrl.newTask.description,\r\n        link: {\r\n            linked: ctrl.newTask.link.linked,\r\n            type: (ctrl.newTask.link.linked === false) ? ''      :\r\n                  (ctrl.newTask.category === 'Watch')  ? 'anime' :\r\n                                                         'manga' ,\r\n            anime: (ctrl.newTask.link.anime === undefined) ? undefined : ctrl.newTask.link.anime._id ,\r\n            manga: (ctrl.newTask.link.manga === undefined) ? undefined : ctrl.newTask.link.manga._id\r\n        },\r\n        day: ctrl.newTask.daily === true ? 'Any' : ctrl.newTask.day,\r\n        date: ctrl.newTask.date === '' ? new Date() : ctrl.newTask.date,\r\n        repeat: (ctrl.newTask.link.linked === false) ? ctrl.newTask.repeat                     :\r\n                (ctrl.newTask.category === 'Watch')  ? ctrl.newTask.link.anime.finalEpisode    :\r\n                                                       1    ,\r\n        completeTimes: (ctrl.newTask.link.linked === false) ? 0                                     :\r\n                       (ctrl.newTask.category === 'Watch')  ? ctrl.newTask.link.anime.episodes      :\r\n                                                              0      ,\r\n        updateCheck: new Date().getDay() === 1 ? true : false,\r\n        complete: false,\r\n        category: ctrl.newTask.category === '' ? 'Other' : ctrl.newTask.category,\r\n        daily: ctrl.newTask.daily,\r\n        checklist: ctrl.newTask.checklist,\r\n        checklistItems: ctrl.newTask.checklistItems\r\n    });\r\n//\t\t\t// Redirect after save\r\n    task.$save(function(response) {\r\n      $location.path('tasks');\r\n      NotificationFactory.success('Saved!', 'New Task was successfully saved!');\r\n    }, function(errorResponse) {\r\n      ctrl.error = errorResponse.data.message;\r\n      console.log(errorResponse);\r\n      NotificationFactory.error('Error!', 'New Task failed to save!');\r\n    });\r\n  }\r\n\r\n  function backStep(step) {\r\n      ctrl.stepConfig.currentStep -= 1;\r\n  }\r\n  function takeStep(step) {\r\n      var check = process(step);\r\n      if (check.valid) {\r\n          ctrl.stepConfig.currentStep += 1;\r\n      } else {\r\n          NotificationFactory.popup('Attention!', check.message, 'warning');\r\n      }\r\n  }\r\n  function submit() {\r\n    ctrl.create();\r\n    $uibModalInstance.close();\r\n  }\r\n  function cancel() {\r\n    $uibModalInstance.dismiss();\r\n  }\r\n\r\n  function process(step) {\r\n      switch(step) {\r\n          case 1:\r\n              if (ctrl.newTask.link.linked === true) {\r\n                  var category = ctrl.newTask.category;\r\n                  if (category === 'Watch') {\r\n                      ctrl.linkItems = Animeitems.query({\r\n                          status: 0\r\n                      });\r\n                      ctrl.linkType = 'anime';\r\n                      ctrl.newTask.checklistItems = [];\r\n                      ctrl.newTask.checklist = false;\r\n                  } else if (category === 'Read') {\r\n                      ctrl.linkItems = Mangaitems.query({\r\n                          status: 0\r\n                      });\r\n                      ctrl.linkType = 'manga';\r\n                  } else {\r\n                      return { valid: false, message: 'Category must be either Watch or Read for linked items!' };\r\n                  }\r\n              } else {\r\n                  //Ensure that stuff is cleared when not linked.\r\n                  ctrl.linkType = '';\r\n                  ctrl.newTask.link.anime = undefined;\r\n                  ctrl.newTask.link.manga = undefined;\r\n              }\r\n              return { valid: true };\r\n      }\r\n  }\r\n}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('tasks').controller('ScheduleCalendarTaskController', ScheduleCalendarTaskController);\r\n\tScheduleCalendarTaskController.$inject = ['$scope', '$uibModalInstance', 'moment', 'data', 'ListService', 'TaskFactory'];\r\n\r\n\tfunction ScheduleCalendarTaskController($scope, $uibModalInstance, moment, data, ListService, TaskFactory) {\r\n    var ctrl = this,\r\n\t\t\t\trefresh = false,\r\n\t\t\t\ttimeDiff = Math.abs(new Date(data.date).getTime() - new Date().getTime());\r\n\r\n\t\tctrl.cancel = cancel;\r\n    ctrl.date = new Date(data.date);\r\n\t\tctrl.day = ctrl.date.getDay() > 0 ? ctrl.date.getDay() - 1 : 6;\r\n\t\tctrl.days = data.days;\r\n\t\tctrl.daysFromToday = Math.ceil(timeDiff / (1000 * 3600 * 24));\r\n    ctrl.events = [];\r\n\t\tctrl.init = init;\r\n\t\tctrl.insertChecklistItem = insertChecklistItem;\r\n\t\tctrl.removeTask = removeTask;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.tickOffChecklist = tickOffChecklist;\r\n\t\tctrl.today = new Date();\r\n\t\tctrl.updateTask = updateTask;\r\n\t\tconsole.log('data: ', data, 'days: ', ctrl.days, ctrl.day, ctrl.date);\r\n\r\n\t\tfunction init() {\r\n\t\t\tvar weekEnds = new Date(ListService.weekEndingForDate(ctrl.date));\r\n\t\t\tangular.forEach(data.events, function(event) {\r\n\t\t\t\tif(new Date(event.date) < weekEnds && ((event.day.substring(0, 3) === ctrl.days[ctrl.day].text) || (event.day === 'Any'))) {\r\n\t\t\t\t\t// console.log('daysFromToday: ', ctrl.daysFromToday);\r\n\t\t\t\t\tif(!event.daily) {\r\n\t\t\t\t\t\t//in weeks\r\n\t\t\t\t\t\t// console.log('weeks: ', event.completeTimes, Math.floor(ctrl.daysFromToday / 7), event.repeat);\r\n\t\t\t\t\t\tif((event.completeTimes + Math.floor(ctrl.daysFromToday / 7) <= event.repeat) || event.repeat === 0) {\r\n\t\t\t\t\t\t\tctrl.events.push(event);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if(event.daily) {\r\n\t\t\t\t\t\t//in days\r\n\t\t\t\t\t\t// console.log('days: ', event.completeTimes, ctrl.daysFromToday, event.repeat);\r\n\t\t\t\t\t\tif(((event.completeTimes + ctrl.daysFromToday) <= event.repeat) || event.repeat === 0) {\r\n\t\t\t\t\t\t\tctrl.events.push(event);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tctrl.events.sort(function(a, b) {\r\n\t\t\t\tvar aDate = a.date, bDate = b.date;\r\n\t\t\t\treturn aDate < bDate ? 1 :\r\n\t\t\t\t\t\t\t aDate > bDate ? -1 : 0;\r\n\t\t\t});\r\n\t\t}\r\n\t\tctrl.init();\r\n\r\n\t\tfunction removeTask(task) {\r\n\t\t\tTaskFactory.removeTask(task, ctrl.events, true);\r\n\t\t}\r\n\t\t//Update task.\r\n\t\tfunction updateTask(task) {\r\n\t\t\t\tTaskFactory.updateTask(task);\r\n\t\t}\r\n    //Add new checklist item.\r\n    function insertChecklistItem(task, newChecklistItem) {\r\n        TaskFactory.insertChecklistItem(task, newChecklistItem);\r\n    }\r\n\t\t//Tick off a task.\r\n\t\tfunction tickOff(task) {\r\n\t\t    TaskFactory.tickOff(task).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOff: ', result);\r\n\t\t\t\t\trefresh = result.refresh;\r\n\t\t\t\t});\r\n\t\t}\r\n    //Tick of a checklist item.\r\n    function tickOffChecklist(task, index) {\r\n        TaskFactory.tickOffChecklist(task, index).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOffChecklist: ', result);\r\n\t\t\t\t\trefresh = result.refresh;\r\n\t\t\t\t});\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.close(refresh);\r\n    }\r\n\t}\r\n})();\r\n\n(function() {\r\n'use strict';\r\n\r\n\t// Tasks controller\r\n\tangular.module('tasks').controller('TasksController', TasksController);\r\n\tTasksController.$inject =  ['$scope', '$timeout', '$stateParams', '$location', 'Authentication', 'Tasks', 'ListService', 'NotificationFactory', 'TaskFactory', 'spinnerService', '$uibModal', 'moment'];\r\n\r\n\tfunction TasksController($scope, $timeout, $stateParams, $location, Authentication, Tasks, ListService, NotificationFactory, TaskFactory, spinnerService, $uibModal, moment) {\r\n\t\tvar ctrl = this,\r\n\t\t\t\ttoday = new Date(),\r\n\t\t\t\tday = today.getDay();\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.commonArrays = ListService.getCommonArrays();\r\n\t\tctrl.createTask = createTask;\r\n\t\tctrl.dateOptions = {\r\n\t\t\tdateDisabled: false,\r\n\t\t\tformatYear: 'yy',\r\n\t\t\tmaxDate: new Date(2020, 5, 22),\r\n\t\t\tminDate: new Date(),\r\n\t\t\tstartingDay: 1\r\n\t\t};\r\n\t\tctrl.filterConfig = {\r\n\t\t\tview: 'list',\r\n      showingCount: 0,\r\n      sortType: '',\r\n      sortReverse: true,\r\n      search: {\r\n          description: '',\r\n          day: ''\r\n      },\r\n      datesSelected: false\r\n    };\r\n\t\tctrl.insertChecklistItem = insertChecklistItem;\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 10\r\n    };\r\n\t\tctrl.refreshItems = refreshItems;\r\n\t\tctrl.removeTask = removeTask;\r\n\t\tctrl.setTabFilterDay = setTabFilterDay;\r\n\t\tctrl.tabFilter = tabFilter;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.tickOffChecklist = tickOffChecklist;\r\n\t\tctrl.updateTask = updateTask;\r\n\t\tctrl.weekBeginning = weekBeginning;\r\n\t\tctrl.whichController = 'task';\r\n\r\n    function tabFilter(tabName) {\r\n        ctrl.filterConfig.search.day = tabName;\r\n    }\r\n\r\n    function weekBeginning() {\r\n        return TaskFactory.getWeekBeginning();\r\n    }\r\n\r\n\t\tfunction createTask() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/tasks/views/create-task.client.view.html',\r\n        controller: 'CreateTaskController as taskCreate',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { commonArrays: ctrl.commonArrays };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed create task: ', result);\r\n\t\t\t\tfind();\r\n      });\r\n\t\t}\r\n\r\n\t\t// Remove existing Task\r\n\t\tfunction removeTask(task) {\r\n\t\t\tTaskFactory.removeTask(task, ctrl.tasks, true);\r\n\t\t}\r\n\t\t//Update task.\r\n\t\tfunction updateTask(task) {\r\n\t\t\t\tTaskFactory.updateTask(task);\r\n\t\t}\r\n    //Add new checklist item.\r\n    function insertChecklistItem(task, newChecklistItem) {\r\n        TaskFactory.insertChecklistItem(task, newChecklistItem);\r\n    }\r\n\t\t//Tick off a task.\r\n\t\tfunction tickOff(task) {\r\n\t\t    TaskFactory.tickOff(task).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOff: ', result);\r\n\t\t\t\t\tif(result.refresh) find();\r\n\t\t\t\t});\r\n\t\t}\r\n    //Tick of a checklist item.\r\n\t\tfunction tickOffChecklist(task, index) {\r\n        TaskFactory.tickOffChecklist(task, index).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOffChecklist: ', result);\r\n\t\t\t\t\tif(result.refresh) find();\r\n\t\t\t\t});\r\n    }\r\n\r\n    //Defaults the tab filter to the current day of the week.\r\n    function setTabFilterDay(day) {\r\n        var index = day === 0 ? 7 : day; //Adjust for Sunday.\r\n        ctrl.filterConfig.search.day = ctrl.commonArrays.days[index].name;\r\n        console.log(day, ctrl.filterConfig.search.day);\r\n    }\r\n    ctrl.setTabFilterDay(day);\r\n\r\n    //check things\r\n    function checkStatus() {\r\n        if (day === 1) {\r\n            console.log('monday', day);\r\n            angular.forEach(ctrl.tasks, function (task) {\r\n                //has it been updated today?\r\n                if(task.updateCheck === false) {\r\n                    console.log('updating - ', task.description);\r\n                    var type = task.link.type;\r\n                    if ((task.link.linked === false) || (type === 'manga')) {\r\n                        //has it reached the necessary number of repeats?\r\n                        if(task.completeTimes !== task.repeat) {\r\n                            console.log('not complete', task.description);\r\n                            task.complete = false;\r\n                            task.updateCheck = true;\r\n                            TaskFactory.updateTask(task);\r\n                        } else if (task.completeTimes === task.repeat) {\r\n                            console.log('complete - delete', task.description);\r\n                            TaskFactory.removeTask(task, ctrl.tasks);\r\n                        }\r\n                    } else if (task.link.type === 'anime') {\r\n                        console.log('linked');\r\n                            var parts = { single: 'episodes', all: 'finalEpisode' };\r\n                        if (task.link[type][parts.single] !== task.link[type][parts.all]) {\r\n                            console.log('linked not complete', task.description);\r\n                            task.complete = false;\r\n                            task.updateCheck = true;\r\n                            TaskFactory.updateTask(task);\r\n                        } else if (task.link[type][parts.single] === task.link[type][parts.all]) {\r\n                            console.log('linked complete - delete', task.description);\r\n                            TaskFactory.removeTask(task, ctrl.tasks);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n            console.log('not monday', day);\r\n            angular.forEach(ctrl.tasks, function (task) {\r\n                var change = task.updateCheck === false ? false : true;\r\n                task.updateCheck = false;\r\n                //is it a daily task?\r\n                if (task.daily === true) {\r\n                    console.log('daily', task.description);\r\n                    //has it reached the necessary number of repeats?\r\n                    if(task.completeTimes !== task.repeat) {\r\n                        console.log('not complete', task.description);\r\n                        var refresh = today.toISOString().slice(0,10);\r\n                        //has it been refreshed today?\r\n                        if (task.dailyRefresh.slice(0,10) !== refresh) {\r\n                            console.log('not complete - update', task.description);\r\n                            task.complete = false;\r\n                            task.dailyRefresh = refresh;\r\n                            TaskFactory.updateTask(task);\r\n                        }\r\n                    } else if (task.completeTimes === task.repeat) {\r\n                        console.log('complete - delete', task.description);\r\n                        TaskFactory.removeTask(task, ctrl.tasks);\r\n                    }\r\n                } else if ((task.daily === false) && change) {\r\n                    console.log('weekly update: ', task.description);\r\n                    TaskFactory.updateTask(task);\r\n                }\r\n            });\r\n        }\r\n        find();\r\n    }\r\n\r\n\t\t// Find a list of Tasks\r\n\t\tfunction find(check) {\r\n\t\t\t$timeout(function () {\r\n\t\t    spinnerService.loading('tasks', Tasks.query().$promise.then(function(result) {\r\n\t\t\t\t\tconsole.log('found! : ', result);\r\n\t\t        ctrl.tasks = result;\r\n\t\t        if (check === true) checkStatus();\r\n\t\t    }));\r\n\t\t\t}, 250);\r\n\t\t}\r\n\t\tfind(true);\r\n\r\n\t\tfunction refreshItems() {\r\n\t\t\tfind();\r\n      NotificationFactory.warning('Refreshed!', 'Task list refreshed!');\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('tasks').controller('UpdateAnimeTaskController', UpdateAnimeTaskController);\r\n\tUpdateAnimeTaskController.$inject = ['$scope', '$uibModalInstance', 'data', 'FunctionService'];\r\n\r\n\tfunction UpdateAnimeTaskController($scope, $uibModalInstance, data, FunctionService) {\r\n    var ctrl = this;\r\n\t\tctrl.cancel = cancel;\r\n\t\tctrl.episodeCompleted = data.item.link.anime.episodes + 1;\r\n    ctrl.episodeNumber = FunctionService.pad(ctrl.episodeCompleted, 3);\r\n    ctrl.episodeRating = 0;\r\n    ctrl.item = data.item;\r\n    ctrl.isComplete = ctrl.episodeCompleted === ctrl.item.link.anime.finalEpisode && ctrl.item.link.anime.finalEpisode !== 0;\r\n    ctrl.ratingLimit = 10;\r\n    ctrl.stepConfig = {\r\n        currentStep: 1,\r\n        stepCount: 1\r\n    };\r\n\t\tctrl.submit = submit;\r\n\r\n    function submit() {\r\n      $uibModalInstance.close({ task: ctrl.item, episodeRating: ctrl.episodeRating });\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('tasks').controller('UpdateMangaTaskController', UpdateMangaTaskController);\r\n\tUpdateMangaTaskController.$inject = ['$scope', '$uibModalInstance', 'data'];\r\n\r\n\tfunction UpdateMangaTaskController($scope, $uibModalInstance, data) {\r\n    var ctrl = this;\r\n\t\tctrl.cancel = cancel;\r\n    ctrl.item = data.item;\r\n    ctrl.stepConfig = {\r\n        currentStep: 1,\r\n        stepCount: 1\r\n    };\r\n\t\tctrl.submit = submit;\r\n    console.log('update linked manga item: ', ctrl.item);\r\n\r\n    function submit() {\r\n      $uibModalInstance.close(ctrl.item);\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('loseInterest', loseInterest);\r\n\r\n   function loseInterest($document, $window) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attrs) {\r\n            element.data('interesting', true);\r\n            /** On click, check what you clicked and whether you can ignore it.\r\n             *    Based on checks false the ng-show of the anywhere-but-here element.\r\n             */\r\n            angular.element($document[0].body).on('click', function (e) {\r\n                var interesting = angular.element(e.target).inheritedData('interesting'),\r\n                    elm = angular.element(e.target)[0].tagName,\r\n                    alsoInteresting = (elm === 'A') || (elm === 'I');\r\n                    //console.log(elm);\r\n                if (!interesting && !alsoInteresting) {\r\n                    scope.$apply(function () {\r\n                        scope.collapseFilters();\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('scheduleCalendar', scheduleCalendar);\r\n  scheduleCalendar.$inject = ['$uibModal', 'moment', 'ListService'];\r\n\r\n   function scheduleCalendar($uibModal, moment, ListService) {\r\n\r\n    function _removeTime(date) {\r\n      return date.day(1).hour(12).minute(0).second(0).millisecond(0);\r\n    }\r\n\r\n    function _buildMonth(scope, start, month) {\r\n         scope.weeks = [];\r\n         var done = false, date = moment(start), monthIndex = date.month(), count = 0;\r\n         while (!done) {\r\n           var days = _buildWeek(moment(date), month);\r\n           if(ListService.findWithAttr(days, 'isCurrentMonth', true) > -1) {\r\n             scope.weeks.push({ days: days });\r\n           }\r\n             date.add(1, 'w');\r\n             done = count++ > 2 && monthIndex !== date.month();\r\n             monthIndex = date.month();\r\n         }\r\n     }\r\n\r\n     function _buildWeek(date, month) {\r\n         var days = [];\r\n         for (var i = 0; i < 7; i++) {\r\n             days.push({\r\n                 name: date.format('dd').substring(0, 1),\r\n                 number: date.date(),\r\n                 isCurrentMonth: date.month() === month.month(),\r\n                 isToday: date.isSame(new Date(), 'day'),\r\n                 date: date\r\n             });\r\n             date = moment(date);\r\n             date.add(1, 'd');\r\n         }\r\n         return days;\r\n     }\r\n\r\n     function _displayEvents(events, date, days) {\r\n       var modalInstance = $uibModal.open({\r\n         animation: true,\r\n         templateUrl: '/modules/tasks/views/schedule-calendar-task.client.view.html',\r\n         controller: 'ScheduleCalendarTaskController as ctrl',\r\n         size: 'lg',\r\n         resolve: {\r\n           data: function () {\r\n             return { events: events, date: date, days: days };\r\n           }\r\n         }\r\n       }).result.then(function(result) {\r\n         console.log('closed - require refresh: ', result);\r\n       });\r\n     }\r\n\r\n    return {\r\n         restrict: 'A',\r\n         templateUrl: 'modules/tasks/templates/schedule-calendar.html',\r\n         scope: {\r\n           events: '='\r\n         },\r\n         link: function(scope) {\r\n             scope.days = [{ text: 'Mon' }, { text: 'Tue' }, { text: 'Wed' }, { text: 'Thu' }, { text: 'Fri' }, { text: 'Sat' }, { text: 'Sun' }];\r\n             scope.selected = moment(new Date());\r\n             scope.month = moment(scope.selected);\r\n\r\n             var start = moment(_removeTime(angular.copy(scope.selected)));\r\n             start.date(-6);\r\n             _removeTime(start.day(0));\r\n\r\n             _buildMonth(scope, start, scope.month);\r\n\r\n             scope.select = function(day) {\r\n               if(scope.selected === day.date){\r\n                 _displayEvents(scope.events, day.date, scope.days);\r\n               }\r\n               scope.selected = day.date;\r\n             };\r\n\r\n             scope.next = function() {\r\n                 var next = moment(scope.month);\r\n                 _removeTime(next.month(next.month()+1).date(0));\r\n                 scope.month.month(scope.month.month()+1);\r\n                 _buildMonth(scope, next, scope.month);\r\n             };\r\n\r\n             scope.previous = function() {\r\n                 var previous = moment(scope.month);\r\n                 _removeTime(previous.month(previous.month()-1).date(0));\r\n                 scope.month.month(scope.month.month()-1);\r\n                 _buildMonth(scope, previous, scope.month);\r\n             };\r\n         }\r\n     };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('shadowModel', shadowModel);\r\n\r\n   function shadowModel() {\r\n    return {\r\n      scope: true,\r\n      link: function(scope, el, att) {\r\n        console.log('shadow: ', scope);\r\n        scope[att.shadow] = angular.copy(scope[att.shadow]);\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('taskItemModel', taskItemModel);\r\n\r\n  function taskItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/tasks/templates/task-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('passClick', passClick);\r\n\r\n  function passClick() {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        element.bind('click', function(event) {\r\n          var passTo = document.getElementById(attrs.passClick);\r\n          passTo.focus();\r\n          passTo.click();\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks').factory('TaskFactory', TaskFactory);\r\n  TaskFactory.$inject = ['$q', 'Animeitems', 'Mangaitems', 'AnimeFactory', 'MangaFactory', 'NotificationFactory', 'ListService', '$uibModal'];\r\n\r\n    function TaskFactory($q, Animeitems, Mangaitems, AnimeFactory, MangaFactory, NotificationFactory, ListService, $uibModal) {\r\n      var obj = {\r\n        getWeekBeginning: getWeekBeginning,\r\n        insertChecklistItem: insertChecklistItem,\r\n        removeTask: removeTask,\r\n        updateAnimeitem: updateAnimeitem,\r\n        updateMangaitem: updateMangaitem,\r\n        updateTask: updateTask,\r\n        tickOff: tickOff,\r\n        tickOffChecklist: tickOffChecklist,\r\n      };\r\n      return obj;\r\n\r\n          function getWeekBeginning() {\r\n              var newDate = new Date(),\r\n                  day = newDate.getDay(),\r\n                  diff = newDate.getDate() - day + (day === 0 ? -6:1); // adjust when day is sunday\r\n              var wkBeg = new Date();\r\n              return new Date(wkBeg.setDate(diff));\r\n          }\r\n\r\n          function updateAnimeitem(task, episodeRating) {\r\n            return $q(function(resolve, reject) {\r\n              var query = Animeitems.get({\r\n  \t\t\t\t\t\t\tanimeitemId: task.link.anime._id\r\n  \t\t\t\t\t\t});\r\n              query.$promise.then(function(data) {\r\n                  console.log('update animeitem for ', task, data);\r\n                  data.episodes += 1;\r\n                  data.rating = task.link.anime.rating || data.rating;\r\n                  data.latest = new Date();\r\n                  AnimeFactory.update(data, undefined, true, undefined, episodeRating);\r\n                  resolve(data);\r\n              });\r\n            });\r\n          }\r\n\r\n          function updateMangaitem(task, chapters, volumes) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n              var query = Mangaitems.get({\r\n  \t\t\t\t\t\t\tmangaitemId: task.link.manga._id\r\n  \t\t\t\t\t\t});\r\n              query.$promise.then(function(data) {\r\n                  //console.log(data);\r\n                  data.chapters = chapters;\r\n                  data.volumes = volumes;\r\n                  data.latest = new Date();\r\n                  MangaFactory.update(data, undefined, true, undefined);\r\n  \t\t\t\t\t\t\t\tresolve(data);\r\n              });\r\n  \t\t\t\t\t});\r\n          }\r\n\r\n  \t\t\t\t/** Task Update,Edit,Delete and other functions below here.\r\n  \t\t\t\t */\r\n\r\n  \t\t\t // Update existing Task\r\n  \t\t\t function updateTask(task, refresh) {\r\n  \t\t\t\t return $q(function(resolve, reject) {\r\n  \t\t\t\t\t //console.log('update');\r\n  \t\t\t\t\t if (task.link.anime) {\r\n  \t\t\t\t\t\t task.link.anime = task.link.anime._id;\r\n  \t\t\t\t\t } else if (task.link.manga) {\r\n  \t\t\t\t\t\t task.link.manga = task.link.manga._id;\r\n  \t\t\t\t\t }\r\n\r\n  \t\t\t\t\t\ttask.$update(function() {\r\n  \t\t\t\t\t\t\tNotificationFactory.success('Saved!', 'Task was successfully updated!');\r\n  \t\t\t\t\t\t  //Refresh items if the callee wasn't checkStatus.\r\n  \t\t\t\t\t\t  console.log('update, refresh items ? ', refresh);\r\n  \t\t\t\t\t\t  resolve({ refresh: refresh });\r\n  \t\t\t\t\t\t}, function(errorResponse) {\r\n  \t\t\t\t\t\t\tvar errorMessage = errorResponse.data.message;\r\n  \t\t\t\t\t\t\treject(errorMessage);\r\n  \t\t\t\t\t\t  //console.log(errorResponse);\r\n  \t\t\t\t\t\t  NotificationFactory.error('Error!', 'Task failed to save!');\r\n  \t\t\t\t\t\t});\r\n  \t\t\t\t\t});\r\n  \t\t\t }\r\n\r\n  \t\t\t //Remove a task.\r\n  \t\t\t\tfunction removeTask(task, tasks, userCheck) {\r\n  \t\t\t\t\tif(userCheck) {\r\n  \t\t\t\t\t\t//console.log('launch');\r\n  \t\t\t\t\t\tNotificationFactory.confirmation(function remove() {\r\n  \t\t          removeTaskProcess(task, tasks);\r\n  \t\t\t\t\t\t});\r\n  \t\t\t\t\t} else {\r\n  \t\t\t\t\t\tremoveTaskProcess(task, tasks);\r\n  \t\t\t\t\t}\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\tfunction removeTaskProcess(task, tasks) {\r\n  \t\t\t\t\tif ( task ) {\r\n  \t\t\t\t\t\t\ttask.$remove();\r\n  \t\t\t\t\t\t\tfor (var i in tasks) {\r\n  \t\t\t\t\t\t\t\t\tif (tasks[i] === task) {\r\n  \t\t\t\t\t\t\t\t\t\t\ttasks.splice(i, 1);\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\tNotificationFactory.warning('Deleted!', 'Task was successfully deleted.');\r\n  \t\t\t\t\t}\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Linked manga need special options dialog.\r\n  \t\t\t\tfunction launchMangaUpdateDialog(task, checklistIndex) {\r\n  \t\t\t\t\tvar modalInstance = $uibModal.open({\r\n  \t\t\t\t\t\tanimation: true,\r\n  \t\t      \ttemplateUrl: '/modules/tasks/views/update-manga-task.client.view.html',\r\n  \t\t      \tcontroller: 'UpdateMangaTaskController as ctrl',\r\n  \t\t      \tsize: 'md',\r\n  \t\t      \tresolve: {\r\n  \t\t        \tdata: function () {\r\n  \t\t          \treturn { item: angular.copy(task), itemOriginal: task };\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t\treturn modalInstance;\r\n  \t\t\t\t}\r\n\r\n          //Linked anime need special options dialog.\r\n  \t\t\t\tfunction launchAnimeUpdateDialog(task, checklistIndex) {\r\n  \t\t\t\t\tvar modalInstance = $uibModal.open({\r\n  \t\t\t\t\t\tanimation: true,\r\n  \t\t      \ttemplateUrl: '/modules/tasks/views/update-anime-task.client.view.html',\r\n  \t\t      \tcontroller: 'UpdateAnimeTaskController as ctrl',\r\n  \t\t      \tsize: 'md',\r\n  \t\t      \tresolve: {\r\n  \t\t        \tdata: function () {\r\n  \t\t          \treturn { item: angular.copy(task), itemOriginal: task };\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t\treturn modalInstance;\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Completes a task.\r\n  \t\t\t\tfunction tickOff(task) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n  \t\t\t\t\t\tvar isLinked = task.link.linked;\r\n  \t\t\t\t    //Is it linked?\r\n  \t\t\t\t    if (!isLinked) {\r\n  \t\t\t\t        task.completeTimes += 1;\r\n  \t\t\t\t    } else if (isLinked) {\r\n  \t\t\t\t        /** Anime or manga?\r\n  \t\t\t\t         *   Update the item value AND the complete/repeat values.\r\n  \t\t\t\t         */\r\n  \t\t\t\t        if (task.link.type === 'anime') {\r\n                    task.complete = false;\r\n                      var animeDialog = launchAnimeUpdateDialog(task);\r\n                      animeDialog.result.then(function(result) {\r\n                        console.log('update anime task result: ', result);\r\n                        task = result.task;\r\n                        task.completeTimes = task.link.anime.episodes + 1;\r\n                        task.complete = true;\r\n                        task.repeat = task.link.anime.finalEpisode;\r\n                        obj.updateAnimeitem(task, result.episodeRating).then(function(result) {\r\n                          return obj.updateTask(task, true);\r\n                        }).then(function(result) {\r\n                          console.log('update anime into update task: ', result);\r\n                          resolve(result);\r\n                        });\r\n                      });\r\n  \t\t\t\t        } else if (task.link.type === 'manga') {\r\n  \t\t\t\t\t\t\t\t\t  task.complete = false;\r\n  \t\t\t\t            var dialog = launchMangaUpdateDialog(task);\r\n  \t\t\t\t\t\t\t\t\t\tdialog.result.then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\ttask = result;\r\n  \t\t\t\t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t\t\t\t\t\t\t\t\ttask.complete = true;\r\n  \t\t\t\t\t\t\t\t\t\t\tobj.updateMangaitem(task, task.link.manga.chapters, task.link.manga.volumes).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\t\tconsole.log('updated manga: ', result);\r\n  \t\t\t\t\t\t\t\t\t\t\t\treturn obj.updateTask(task, true);\r\n  \t\t\t\t\t\t\t\t\t\t\t}).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\t\tconsole.log('update manga into update task: ', result);\r\n  \t\t\t\t\t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t        }\r\n  \t\t\t\t    }\r\n  \t\t\t\t\t\tif(!isLinked) {\r\n  \t\t\t\t\t    obj.updateTask(task, isLinked).then(function(result) {\r\n  \t\t\t\t\t\t\t\tconsole.log('update task resolve: ', result);\r\n  \t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Completes a checklist item.\r\n  \t\t\t\tfunction tickOffChecklist(task, index) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n  \t\t\t\t\t\t//update the option for the task.\r\n  \t\t\t\t\t\tvar isLinked = task.link.linked;\r\n  \t\t\t\t\t\tif (isLinked && task.link.type === 'manga') {\r\n  \t\t\t\t\t\t\t\ttask.checklistItems[index].complete = false;\r\n  \t\t\t\t\t\t\t\tvar dialog = launchMangaUpdateDialog(task, index);\r\n  \t\t\t\t\t\t\t\tdialog.result.then(function(result) {\r\n  \t\t\t\t\t\t\t\t\ttask = result;\r\n  \t\t\t\t\t\t\t\t\ttask.checklistItems[index].complete = true;\r\n  \t\t\t\t\t\t\t\t\tif(ListService.findWithAttr(task.checklistItems, 'complete', false) === -1) {\r\n  \t\t\t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t              task.complete = true;\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t\t\tobj.updateMangaitem(task, task.link.manga.chapters, task.link.manga.volumes).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\tconsole.log('updated manga: ', result);\r\n  \t\t\t\t\t\t\t\t\t\treturn obj.updateTask(task, true);\r\n  \t\t\t\t\t\t\t\t\t}).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\tconsole.log('update manga into update task: ', result);\r\n  \t\t\t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t} else if(!isLinked) {\r\n  \t\t\t\t\t\t\tif(ListService.findWithAttr(task.checklistItems, 'complete', false) === -1) {\r\n  \t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t\t\t\t\t\ttask.complete = true;\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t//console.log('tickoff checklist: ', task);\r\n  \t\t\t\t\t    obj.updateTask(task, isLinked).then(function(result) {\r\n  \t\t\t\t\t\t\t\tconsole.log('update task resolve: ', result);\r\n  \t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Add additional items to a checklist.\r\n  \t\t\t\tfunction insertChecklistItem(task, newChecklistItem) {\r\n  \t\t\t\t\tif (newChecklistItem!=='' && newChecklistItem!==undefined) {\r\n  \t\t\t\t\t\t\tvar alreadyAdded = false;\r\n  \t\t\t\t\t\t\t//find the item and insert the option.\r\n  \t\t\t\t\t\t\tangular.forEach(task.checklistItems, function (item) {\r\n  \t\t\t\t\t\t\t\t\tif (item === newChecklistItem) {\r\n  \t\t\t\t\t\t\t\t\t\t\talreadyAdded = true;\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t});\r\n\r\n  \t\t\t\t\t\t\t//if not in array add it.\r\n  \t\t\t\t\t\t\tif (alreadyAdded === false) {\r\n  \t\t\t\t\t\t\t\t\ttask.checklistItems.push({ text: newChecklistItem, complete: false });\r\n  \t\t\t\t\t\t\t} else if (alreadyAdded === true) {\r\n  \t\t\t\t\t\t\t\t\tNotificationFactory.popup('Option already exists.', 'Please re-name and try again.', 'error');\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t}\r\n  \t\t\t\t\tobj.updateTask(task);\r\n  \t\t\t\t}\r\n\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\t//Tasks service used to communicate Tasks REST endpoints\r\n\tangular.module('tasks').factory('Tasks', Tasks);\r\n\tTasks.$inject = ['$resource'];\r\n\r\n\t\tfunction Tasks($resource) {\r\n\t\t\treturn $resource('tasks/:taskId', { taskId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('toptens').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Toptens', 'toptens', 'dropdown', '/toptens(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'toptens', 'List Toptens', 'toptens');\r\n\t\tMenus.addSubMenuItem('topbar', 'toptens', 'New Topten', 'toptens/create');\r\n\t}\r\n]);\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('toptens').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Toptens state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listToptens', {\r\n\t\t\turl: '/toptens',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/list-toptens.client.view.html'\r\n\t\t}).\r\n\t\tstate('createTopten', {\r\n\t\t\turl: '/toptens/create',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/create-topten.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewTopten', {\r\n\t\t\turl: '/toptens/:toptenId',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/view-topten.client.view.html'\r\n\t\t}).\r\n\t\tstate('editTopten', {\r\n\t\t\turl: '/toptens/:toptenId/edit',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/create-topten.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\tangular.module('toptens').controller('CreateToptenController', CreateToptenController);\r\n\tCreateToptenController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Toptens', 'ListService', 'Animeitems', 'Mangaitems', 'Characters', 'NotificationFactory', 'CharacterService', 'ItemService', '$filter'];\r\n\r\n\tfunction CreateToptenController($scope, $stateParams, $location, Authentication, Toptens, ListService, Animeitems, Mangaitems, Characters, NotificationFactory, CharacterService, ItemService, $filter) {\r\n\t\tvar ctrl = this,\r\n\t\t\t\ttoptenCopy = {\r\n\t        name: '',\r\n\t        description: '',\r\n\t        type: '',\r\n\t        isFavourite: false,\r\n\t        isRanked: false,\r\n\t        animeList: [],\r\n\t        mangaList: [],\r\n\t        characterList: [],\r\n\t        conditions: {\r\n\t            limit: null,\r\n\t            series: [],\r\n\t            tags: [],\r\n\t\t\t\t\t\t\tseason: null,\r\n\t\t\t\t\t\t\tyear: null\r\n\t        }\r\n\t\t\t\t};\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.cancel = cancel;\r\n\t\tctrl.create = create;\r\n\t\tctrl.commonArrays = ListService.getCommonArrays();\r\n\t\tctrl.imgSize = {\r\n\t\t\t\theight: '50px',\r\n\t\t\t\twidth: '100px'\r\n\t\t};\r\n\t\tctrl.isCreate = true;\r\n\t\tctrl.pushCondition = pushCondition;\r\n\t\tctrl.pushItem = pushItem;\r\n\t\tctrl.removeCondition = removeCondition;\r\n\t\tctrl.removeItem = removeItem;\r\n    ctrl.stepConfig = {\r\n        steps: [1,2,3,4,5,6,7,8,9,10],\r\n        stepHeaders: [\r\n            { text: 'Select attributes' },\r\n            { text: 'Set conditions' },\r\n            { text: 'Populate list' }\r\n        ],\r\n        currentStep: 1,\r\n        stepCount: 3,\r\n        listGen: {\r\n            itemsCached: [],\r\n            items: [],\r\n            displayList: [],\r\n            seriesList: [],\r\n            typeDisplay: '',\r\n            toptenItem: '',\r\n            seriesLimit: '',\r\n            tagLimit: '',\r\n            series: [],\r\n            tags: []\r\n        },\r\n        limitMin: 0,\r\n\t\t\t\tswapping: {\r\n\t\t\t\t\tone: '',\r\n\t\t\t\t\ttwo: ''\r\n\t\t\t\t}\r\n    };\r\n\t\tctrl.swappingItems = swappingItems;\r\n\t\tctrl.takeStep = takeStep;\r\n    ctrl.topten = {};\r\n    angular.copy(toptenCopy, ctrl.topten);\r\n\t\tctrl.update = update;\r\n\t\tctrl.years = [];\r\n\t\t// Create new Topten\r\n\t\tfunction create() {\r\n            // console.log(ctrl.topten, ctrl.topten);\r\n\t\t\t// Create new Topten object\r\n\t\t\tvar topten = new Toptens();\r\n\t\t\ttopten = new Toptens ({\r\n\t\t\t\tname: ctrl.topten.name,\r\n                description: ctrl.topten.description,\r\n                type: ctrl.topten.type,\r\n                isFavourite: ctrl.topten.isFavourite,\r\n                isRanked: ctrl.topten.isRanked,\r\n                animeList: ctrl.topten.animeList.length > 0 ? ctrl.topten.animeList : null,\r\n                characterList: ctrl.topten.characterList.length > 0 ? ctrl.topten.characterList : null,\r\n                mangaList: ctrl.topten.mangaList.length > 0 ? ctrl.topten.mangaList : null,\r\n                conditions: {\r\n                    limit: ctrl.topten.conditions.limit,\r\n                    series: ctrl.topten.conditions.series,\r\n                    tags: ctrl.topten.conditions.tags,\r\n\t\t\t\t\t\t\t\t\t\tseason: ctrl.topten.conditions.season,\r\n\t\t\t\t\t\t\t\t\t\tyear: ctrl.topten.conditions.year,\r\n                }\r\n\t\t\t});\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\ttopten.$save(function(response) {\r\n\t\t\t\t$location.path('toptens/' + response._id);\r\n\t\t\t\tNotificationFactory.success('Saved!', 'New List was successfully saved!');\r\n\t\t\t\t// Clear form fields\r\n\t\t\t\tangular.copy(toptenCopy, ctrl.topten);\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n\t\t\t\tNotificationFactory.error('Error!', 'Something went wrong!');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Update existing Topten\r\n\t\tfunction update() {\r\n\t\t\tvar topten = ctrl.topten;\r\n\r\n\t\t\ttopten.$update(function() {\r\n\t\t\t\t$location.path('toptens/' + topten._id);\r\n                NotificationFactory.success('Updated!', 'List update was successful!');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Something went wrong!');\r\n\t\t\t});\r\n\t\t}\r\n\r\n    function typeSetItemPopulate() {\r\n        var type = ListService.manipulateString(ctrl.topten.type, 'upper', true);\r\n        switch(type) {\r\n            case 'Anime':\r\n                Animeitems.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'title';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n\t\t\t\t\t\t\t\t\t\tctrl.years = ItemService.endingYears(result);\r\n                });\r\n                break;\r\n            case 'Manga':\r\n                Mangaitems.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'title';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n                });\r\n                break;\r\n            case 'Character':\r\n                Characters.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'name';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n                    ctrl.stepConfig.listGen.series = CharacterService.buildSeriesList(result);\r\n\t\t\t\t\t\t\t\t\t\tvar getYears = [];\r\n\t\t\t\t\t\t\t\t\t\tangular.forEach(result, function (item) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(item.anime) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tgetYears.push(item.anime);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tctrl.years = ItemService.endingYears(getYears);\r\n                });\r\n                break;\r\n        }\r\n        // console.log('type set: ', ctrl.stepConfig.listGen);\r\n\t\t\t}\r\n\r\n    //Processing on step submits.\r\n    function process(number, direction, callback) {\r\n        // console.log(number, direction);\r\n        switch(number) {\r\n            case 1:\r\n                if (ctrl.topten.type !== '' && ctrl.isCreate) {\r\n                    typeSetItemPopulate();\r\n                    callback();\r\n                } else if (ctrl.topten.type !== '' && !ctrl.isCreate) {\r\n                    if (ctrl.stepConfig.listGen.displayList.length < 1) {\r\n                        angular.forEach(ctrl.topten[ctrl.topten.type + 'List'], function(item) {\r\n                            var index = ListService.findWithAttr(ctrl.stepConfig.listGen.items, '_id', item._id);\r\n                            ctrl.stepConfig.listGen.displayList.push(ctrl.stepConfig.listGen.items[index]);\r\n                        });\r\n                        ctrl.stepConfig.limitMin = ctrl.stepConfig.listGen.displayList.length;\r\n                    }\r\n                    callback();\r\n                } else if (ctrl.topten.type === '') {\r\n                    NotificationFactory.popup('Invalid form', 'You MUST select a type to continue.', 'error');\r\n                }\r\n                break;\r\n\r\n            case 2:\r\n\t\t\t\t\t\t\t\tif(direction) {\r\n\t\t\t\t\t\t\t\t\tvar i = 0, j = 0, length;\r\n                  angular.copy(ctrl.stepConfig.listGen.items, ctrl.stepConfig.listGen.itemsCached);\r\n                  // console.log('pre conditions: ', ctrl.stepConfig.listGen.items.length, ctrl.stepConfig.listGen.itemsCached.length);\r\n\r\n\t\t\t\t\t\t\t\t\tif(ctrl.topten.type === 'anime') {\r\n\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.season) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('season')(ctrl.stepConfig.listGen.items, ctrl.topten.conditions.year, ctrl.topten.conditions.season);\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tNotificationFactory.popup('Invalid form', 'A year MUST be selected when selecting a season.', 'error');\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('filter')(ctrl.stepConfig.listGen.items, { season: { year: ctrl.topten.conditions.year } });\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else if(ctrl.topten.type === 'character') {\r\n\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.season) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('seasonForCharacterAnime')(ctrl.stepConfig.listGen.items, ctrl.topten.conditions.year, ctrl.topten.conditions.season);\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tNotificationFactory.popup('Invalid form', 'A year MUST be selected when selecting a season.', 'error');\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('filter')(ctrl.stepConfig.listGen.items, { anime: { season: { year: ctrl.topten.conditions.year } } });\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n                  if(ctrl.topten.conditions.series.length > 0) {\r\n                      i = ctrl.stepConfig.listGen.items.length;\r\n                      while(i--) {\r\n                          var remove = true,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tattr = (ctrl.stepConfig.listGen.items[i].anime !== null) ? 'anime' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t (ctrl.stepConfig.listGen.items[i].anime !== null) ? 'manga' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t null;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlength = ctrl.topten.conditions.series.length;\r\n\t\t\t\t\t\t\t\t\t\t\t\t//  console.log('tag while: ', i, length, attr);\r\n                          if(attr !== null) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag item: ', ctrl.stepConfig.listGen.items[i]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor(j = 0; j < length; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar series = ctrl.topten.conditions.series[j];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log(ctrl.stepConfig.listGen.items[i][attr].title, series.name, ctrl.stepConfig.listGen.items[i][attr].title.indexOf(series.name));\r\n                              if(ctrl.stepConfig.listGen.items[i][attr].title.indexOf(series.name) > -1) {\r\n                                  remove = false;\r\n                              }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                            if(remove) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('remove as remove: ' + remove);\r\n                                ctrl.stepConfig.listGen.items.splice(i, 1);\r\n                            }\r\n                          } else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('straight remove');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n                          }\r\n                      }\r\n                  }\r\n\r\n                  if(ctrl.topten.conditions.tags.length > 0) {\r\n                      i = ctrl.stepConfig.listGen.items.length;\r\n                      while(i--) {\r\n                          var count = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlength = ctrl.topten.conditions.tags.length;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag while: ', i, length);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(ctrl.stepConfig.listGen.items[i].tags.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag item: ', ctrl.stepConfig.listGen.items[i].tags);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor(j = 0; j < length; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar tag = ctrl.topten.conditions.tags[j];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag round: ' + i + '-' + j, ctrl.stepConfig.listGen.items[i].tags, tag.tag, ListService.findWithAttr(ctrl.stepConfig.listGen.items[i].tags, 'text', tag.tag));\r\n\t                                if(ListService.findWithAttr(ctrl.stepConfig.listGen.items[i].tags, 'text', tag.tag) > -1) {\r\n\t                                    count++;\r\n\t                                }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                            if(count !== length) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('remove as count: ' + count + ' > length: ' + length);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n                            }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('straight remove');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                      }\r\n                  }\r\n\t\t\t\t\t\t\t\t\t// console.log('post conditions: ', ctrl.stepConfig.listGen.items.length, ctrl.stepConfig.listGen.itemsCached.length);\r\n\t\t\t\t\t\t\t\t}\r\n                callback();\r\n                break;\r\n\r\n            case 3:\r\n                if(!direction) {\r\n                    ctrl.stepConfig.listGen.items = angular.copy(ctrl.stepConfig.listGen.itemsCached);\r\n                }\r\n                callback();\r\n                break;\r\n        }\r\n    }\r\n\r\n    function pushItem(item) {\r\n        if(ctrl.topten.conditions.limit === null || ctrl.topten.conditions.limit === 0 || ctrl.topten.conditions.limit > ctrl.stepConfig.listGen.displayList.length) {\r\n            var index = ctrl.topten[ctrl.topten.type+'List'].indexOf(item._id);\r\n            if (!ctrl.isCreate && index === -1) {\r\n                index = ListService.findWithAttr(ctrl.topten[ctrl.topten.type+'List'], '_id', item._id);\r\n            }\r\n            if (index === -1) {\r\n                ctrl.topten[ctrl.topten.type + 'List'].push(item._id);\r\n                ctrl.stepConfig.listGen.displayList.push(item);\r\n            } else {\r\n                NotificationFactory.warning('Duplicate!', 'Item has already been added to list.');\r\n            }\r\n        } else {\r\n            NotificationFactory.error('Full!', 'Item list has reached the defined capacity.');\r\n        }\r\n        ctrl.stepConfig.listGen.toptenItem = '';\r\n    }\r\n\r\n    function removeItem(item) {\r\n        //For display array.\r\n        var index = ctrl.stepConfig.listGen.displayList.indexOf(item);\r\n        ctrl.stepConfig.listGen.displayList.splice(index, 1);\r\n\r\n        //For topten list.\r\n        index = ctrl.topten[ctrl.topten.type + 'List'].indexOf(item._id);\r\n        if (!ctrl.isCreate && index === -1) {\r\n            index = ListService.findWithAttr(ctrl.topten[ctrl.topten.type+'List'], '_id', item._id);\r\n        }\r\n        ctrl.topten[ctrl.topten.type + 'List'].splice(index, 1);\r\n        NotificationFactory.warning('Removed!', 'Item has been removed from list.');\r\n    }\r\n\r\n    function pushCondition(type, item) {\r\n        var index, indexTwo;\r\n        switch(type) {\r\n            case 'series':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.series, 'name', item.name);\r\n                if(index === -1) {\r\n                    ctrl.topten.conditions.series.push(item);\r\n                } else {\r\n                    NotificationFactory.warning('Duplicate!', 'Series has already been added to list.');\r\n                }\r\n                ctrl.stepConfig.listGen.seriesLimit = '';\r\n                break;\r\n\r\n            case 'tag':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.tags, 'tag', item.tag);\r\n                if(index === -1) {\r\n                    ctrl.topten.conditions.tags.push(item);\r\n                } else {\r\n                    NotificationFactory.warning('Duplicate!', 'Tag has already been added to list.');\r\n                }\r\n                ctrl.stepConfig.listGen.tagLimit = '';\r\n                break;\r\n        }\r\n    }\r\n\r\n    function removeCondition(type, item) {\r\n        var index, indexTwo;\r\n        switch(type) {\r\n            case 'series':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.series, 'name', item.name);\r\n\t\t\t\t\t\t\t\tctrl.topten.conditions.series.splice(index, 1);\r\n                NotificationFactory.warning('Removed!', 'Series has been removed from list.');\r\n                break;\r\n\r\n            case 'tag':\r\n                index = ctrl.topten.conditions.tags.indexOf(item);\r\n                ctrl.topten.conditions.tags.splice(index, 1);\r\n                NotificationFactory.warning('Removed!', 'Tag has been removed from list.');\r\n                break;\r\n        }\r\n    }\r\n\r\n    //Step related functions:\r\n    function takeStep(number, direction) {\r\n        process(number, direction, function() {\r\n            ctrl.stepConfig.currentStep = (direction) ? number + 1 : number - 1;\r\n        });\r\n        // console.log('step: ', ctrl.stepConfig, ctrl.topten);\r\n    }\r\n    function cancel() {\r\n        $location.path('toptens');\r\n    }\r\n\r\n    function inital() {\r\n        // console.log('state params: ', $stateParams);\r\n        if ($stateParams.toptenId !== undefined) {\r\n            ctrl.isCreate = false;\r\n            Toptens.get({ toptenId: $stateParams.toptenId }).$promise.then(function(result) {\r\n                ctrl.topten = result;\r\n\t\t\t\t\t\t\t\t// console.log('topten: ', result);\r\n                typeSetItemPopulate();\r\n            });\r\n        }\r\n    }\r\n    inital();\r\n\r\n\t\tfunction swappingItems(index) {\r\n\t\t\t// console.log('item selected: ', index);\r\n\t\t\tif(ctrl.stepConfig.swapping.one === '') {\r\n\t\t\t\tctrl.stepConfig.swapping.one = index;\r\n\t\t\t} else if(ctrl.stepConfig.swapping.one === index) {\r\n\t\t\t\tctrl.stepConfig.swapping.one = '';\r\n\t\t\t} else {\r\n\t\t\t\tctrl.stepConfig.swapping.two = index;\r\n\t\t\t\t//Re-order display list.\r\n\t\t\t\tvar temp = ctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.one];\r\n\t\t\t\tctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.one] = ctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.two];\r\n\t\t\t\tctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.two] = temp;\r\n\t\t\t\t//Re-order topten item list.\r\n\t\t\t\ttemp = ctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.one];\r\n\t\t\t\tctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.one] = ctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.two];\r\n\t\t\t\tctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.two] = temp;\r\n\t\t\t\t//Clear.\r\n\t\t\t\tctrl.stepConfig.swapping.one = '';\r\n\t\t\t\tctrl.stepConfig.swapping.two = '';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens').controller('StatisticsTopten', StatisticsTopten);\r\n  StatisticsTopten.$inject = ['$scope','$uibModalInstance','list', 'CharacterService'];\r\n\r\n   function StatisticsTopten($scope, $uibModalInstance, list, CharacterService) {\r\n     var ctrl = this;\r\n\r\n     ctrl.cancel = cancel;\r\n     ctrl.list = list;\r\n     ctrl.toptenInfo = {\r\n       tags: [],\r\n       series: []\r\n     };\r\n\r\n     function process() {\r\n       var listType = ctrl.list.type + 'List';\r\n       ctrl.toptenInfo.tags = CharacterService.buildCharacterTags(ctrl.list[listType]);\r\n       if(ctrl.list.type === 'character') {\r\n         ctrl.toptenInfo.series = CharacterService.buildSeriesList(ctrl.list[listType]);\r\n       }\r\n     }\r\n     process();\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('toptens').controller('ToptensController', ToptensController);\r\n\tToptensController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', '$uibModal', 'Toptens', 'NotificationFactory', 'ListService', 'spinnerService'];\r\n\r\n\tfunction ToptensController($scope, $stateParams, $location, Authentication, $uibModal, Toptens, NotificationFactory, ListService, spinnerService) {\r\n\t\tvar ctrl = this;\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.filterConfig = {\r\n\t\t\t\tshowingCount: 0,\r\n\t\t\t\texpandFilters: false,\r\n\t\t\t\tsortType: '',\r\n\t\t\t\tsortReverse: false,\r\n\t\t\t\tratingLevel: undefined,\r\n\t\t\t\tsearch: {},\r\n\t\t\t\tsearchTags: '',\r\n\t\t\t\ttagsForFilter: [],\r\n\t\t\t\ttaglessItem: false,\r\n\t\t\t\tareTagless: false,\r\n\t\t\t\tselectListOptions: {},\r\n\t\t\t\tcommonArrays: ListService.getCommonArrays()\r\n\t\t};\r\n\t\tctrl.find = find;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.openListStats = openListStats;\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.viewConfig = {\r\n        displayType: '',\r\n        linkSuffix: '',\r\n\t\t\t\ttags: [],\r\n\t\t\t\tseries: []\r\n    };\r\n    ctrl.whichController = 'topten';\r\n\r\n\t\t// Remove existing Topten\r\n\t\tfunction remove(topten) {\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( topten ) {\r\n\t            topten.$remove();\r\n\t            for (var i in ctrl.toptens) {\r\n\t                if (ctrl.toptens [i] === topten) {\r\n\t                    ctrl.toptens.splice(i, 1);\r\n\t                }\r\n\t            }\r\n\t        } else {\r\n\t            ctrl.topten.$remove(function() {\r\n\t                $location.path('toptens');\r\n\t            });\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Anime was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Find a list of Toptens\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t    spinnerService.loading('topten', Toptens.query().$promise.then(function(result) {\r\n\t        ctrl.toptens = result;\r\n\t    }));\r\n\t\t\tconsole.log(ctrl.toptens);\r\n\t\t}\r\n\r\n\t\t// Find existing Topten\r\n\t\tfunction findOne() {\r\n\t    Toptens.get({ toptenId: $stateParams.toptenId }).$promise.then(function(result) {\r\n\t        ctrl.topten = result;\r\n\t        ctrl.viewConfig.displayType = (ctrl.topten.type === 'character') ? 'name' : 'title';\r\n\t        ctrl.viewConfig.linkSuffix = (ctrl.topten.type === 'character') ? 's' : 'items';\r\n\t    });\r\n\t\t}\r\n\r\n\t\tfunction openListStats() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n\t\t\t\tanimation: true,\r\n      \ttemplateUrl: '/modules/toptens/views/statistics-topten.client.view.html',\r\n      \tcontroller: 'StatisticsTopten as ctrl',\r\n      \tsize: 'lg',\r\n      \tresolve: {\r\n        \tlist: function () {\r\n          \treturn ctrl.topten;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('horizontalListItem', horizontalListItem);\r\n\r\n   function horizontalListItem() {\r\n      return {\r\n          restrict: 'A',\r\n          replace: true,\r\n          transclude: true,\r\n          scope: {},\r\n          templateUrl: '/modules/toptens/templates/horizontal-list-item.html',\r\n          require: '^horizontalList',\r\n          link: function(scope, element, attr, horizontalListCtrl) {\r\n              scope.isVisible = false;\r\n              scope.itemWidth = horizontalListCtrl.itemWidth;\r\n              scope.position = element.index();\r\n              horizontalListCtrl.register(scope);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('horizontalList', horizontalList);\r\n\r\n   function horizontalList() {\r\n      return {\r\n          restrict: 'A',\r\n          transclude: true,\r\n          require: 'horizontalList',\r\n          scope: {},\r\n          templateUrl: '/modules/toptens/templates/horizontal-list.html',\r\n          bindToController: true,\r\n          controllerAs: 'horizontalList',\r\n          controller: function($scope) {\r\n              var self = this;\r\n              self.clicks = 0;\r\n              self.items = [];\r\n              self.moveItems = moveItems;\r\n              self.register = register;\r\n              self.shift = 0;\r\n\r\n              function register(item) {\r\n                  self.items.push(item);\r\n                  if([0, 1, 2].indexOf(item.position) > -1) {\r\n                      item.isVisible = true;\r\n                  }\r\n              }\r\n\r\n              function setVisibility() {\r\n                  var values = [],\r\n                      check = self.clicks * 3;\r\n                  for(var i = 0; i < 3; i++) {\r\n                      values.push(check + i);\r\n                  }\r\n                  angular.forEach(self.items, function(item) {\r\n                      item.isVisible = (values.indexOf(item.position) > -1);\r\n                  });\r\n              }\r\n\r\n              function moveItems(direction) {\r\n                  if(direction === 'left') {\r\n                      if((self.clicks - 1) < 0) {\r\n                          self.clicks = 0;\r\n                      } else {\r\n                          self.clicks -= 1;\r\n                      }\r\n                      setVisibility();\r\n                  } else if (direction === 'right') {\r\n                      if ((self.clicks + 1) < Math.ceil(self.items.length / 3)) {\r\n                          self.clicks += 1;\r\n                      }\r\n                      setVisibility();\r\n                  }\r\n              }\r\n\r\n          },\r\n          link: function(scope, element, attr, ctrl) {\r\n              var el = element[0],\r\n                  child = el.children[0];\r\n              scope.settings = {\r\n                  child: child,\r\n                  style: child.style,\r\n                  value: 0\r\n              };\r\n\r\n              function listSettings() {\r\n                  ctrl.shift = -el.offsetWidth;\r\n                  ctrl.itemWidth = el.offsetWidth / 3;\r\n                  angular.forEach(ctrl.items, function(item) {\r\n                      item.itemWidth = ctrl.itemWidth;\r\n                  });\r\n              }\r\n              listSettings();\r\n\r\n              window.addEventListener('resize', function(e) {\r\n                  if(el.offsetWidth !== Math.abs(ctrl.shift)) {\r\n                      listSettings();\r\n                      scope.$apply();\r\n                  }\r\n              });\r\n\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('ngMax', ngMax);\r\n\r\n  function ngMax() {\r\n      return {\r\n          restrict: 'A',\r\n          require: 'ngModel',\r\n          link: function(scope, elem, attr, ctrl) {\r\n\r\n              scope.$watch(attr.ngMax, function(){\r\n                  if (ctrl.$isDirty) ctrl.$setViewValue(ctrl.$viewValue);\r\n              });\r\n\r\n              var isEmpty = function(value) {\r\n                 return angular.isUndefined(value) || value === '' || value === null;\r\n              };\r\n\r\n              var maxValidator = function(value) {\r\n                var max = scope.$eval(attr.ngMax) || Infinity;\r\n                if (!isEmpty(value) && value > max) {\r\n                  ctrl.$setValidity('ngMax', false);\r\n                  return undefined;\r\n                } else {\r\n                  ctrl.$setValidity('ngMax', true);\r\n                  return value;\r\n                }\r\n              };\r\n\r\n              ctrl.$parsers.push(maxValidator);\r\n              ctrl.$formatters.push(maxValidator);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('ngMin', ngMin);\r\n\r\n  function ngMin() {\r\n      return {\r\n          restrict: 'A',\r\n          require: 'ngModel',\r\n          link: function(scope, elem, attr, ctrl) {\r\n              scope.$watch(attr.ngMin, function(){\r\n                  if (ctrl.$isDirty) ctrl.$setViewValue(ctrl.$viewValue);\r\n              });\r\n\r\n              var isEmpty = function(value) {\r\n                 return angular.isUndefined(value) || value === '' || value === null;\r\n              };\r\n\r\n              var minValidator = function(value) {\r\n                var min = scope.$eval(attr.ngMin) || 0;\r\n                if (!isEmpty(value) && value < min) {\r\n                  ctrl.$setValidity('ngMin', false);\r\n                  return undefined;\r\n                } else {\r\n                  ctrl.$setValidity('ngMin', true);\r\n                  return value;\r\n                }\r\n              };\r\n\r\n              ctrl.$parsers.push(minValidator);\r\n              ctrl.$formatters.push(minValidator);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('oneStep', oneStep);\r\n\r\n  function oneStep() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        transclude: true,\r\n        scope: {},\r\n        require: '^steps',\r\n        templateUrl: '/modules/toptens/templates/step.html',\r\n        link: function(scope, elm, attrs, stepsController) {\r\n            scope.active = false;\r\n            scope.stepNumber = elm.index() + 1;\r\n            stepsController.register(scope);\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('stepControls', stepControls);\r\n    function stepControls() {\r\n       return {\r\n           restrict: 'A',\r\n           replace: true,\r\n           transclude: true,\r\n           template: '<div class=\"step-controls step-button-group padding-5\" ng-transclude>' +\r\n                      '</div>'\r\n       };\r\n    }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('steps', steps);\r\n  function steps() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        scope: {\r\n            stepConfig: '='\r\n        },\r\n        template: '<div class=\"steps\" ng-transclude>' +\r\n                  '</div>',\r\n        bindToController: true,\r\n        controllerAs: 'steps',\r\n        controller: function($scope) {\r\n            var self = this;\r\n\r\n            self.register = register;\r\n            self.steps = [];\r\n\r\n            function register(step) {\r\n                self.steps.push(step);\r\n                if(step.stepNumber === 1) {\r\n                    step.active = true;\r\n                }\r\n            }\r\n        },\r\n        link: function(scope, element, attrs, stepsController) {\r\n          scope.$watch('steps.stepConfig.currentStep', function(newValue) {\r\n              if (newValue !== undefined) {\r\n                console.log('steps: ', newValue);\r\n                  angular.forEach(stepsController.steps, function(step) {\r\n                      if(step.stepNumber !== newValue) {\r\n                          step.active = false;\r\n                      } else {\r\n                          step.active = true;\r\n                      }\r\n                  });\r\n              }\r\n          });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('sticky', sticky);\r\n\r\n  function sticky() {\r\n      return {\r\n          restrict: 'A',\r\n          scope: {},\r\n          link: function(scope, element, attrs) {\r\n\r\n              window.addEventListener('scroll', function (evt) {\r\n                  var stickyClass = 'sticky-scroll-top',\r\n                      stickyInnerClass = 'sticky-inner-container',\r\n                      scrollTop = document.body.scrollTop,\r\n                      elm = element[0],\r\n                      inner = elm.children[0],\r\n                      viewportOffset = elm.getBoundingClientRect(),\r\n                      distance_from_top = viewportOffset.top; // This value is your scroll distance from the top\r\n\r\n                  // The element has scrolled to the top of the page. Set appropriate style.\r\n                  if (distance_from_top < 56) {\r\n  //                    console.log('top hit : ', distance_from_top);\r\n                      elm.classList.add(stickyClass);\r\n                      inner.classList.add(stickyInnerClass);\r\n                  }\r\n\r\n                  // The element has not reached the top.\r\n                  if(distance_from_top > 55 || scrollTop < 10) {\r\n  //                    console.log('we are at: ', distance_from_top);\r\n                      elm.classList.remove(stickyClass);\r\n                      inner.classList.remove(stickyInnerClass);\r\n                  }\r\n            });\r\n\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .filter('toptenFilter', toptenFilter);\r\n\r\n  function toptenFilter() {\r\n    return function(array, displayType, value) {\r\n        if(array !== undefined) {\r\n            return array.filter(function(item) {\r\n                if(item[displayType].toLowerCase().indexOf(value.toLowerCase()) > -1) {\r\n                    return item;\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\t//Toptens service used to communicate Toptens REST endpoints\r\n\tangular.module('toptens').factory('Toptens', ToptensFactory);\r\n\tToptensFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction ToptensFactory($resource) {\r\n\t\t\treturn $resource('toptens/:toptenId', { toptenId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n})();\r\n\n'use strict';\r\n\r\n// Config HTTP Error Handling\r\nangular.module('users').config(['$httpProvider',\r\n\tfunction($httpProvider) {\r\n\t\t// Set the httpProvider \"not authorized\" interceptor\r\n\t\t$httpProvider.interceptors.push(['$q', '$location', 'Authentication',\r\n\t\t\tfunction($q, $location, Authentication) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tresponseError: function(rejection) {\r\n\t\t\t\t\t\tswitch (rejection.status) {\r\n\t\t\t\t\t\t\tcase 401:\r\n\t\t\t\t\t\t\t\t// Deauthenticate the global user\r\n\t\t\t\t\t\t\t\tAuthentication.user = null;\r\n\r\n\t\t\t\t\t\t\t\t// Redirect to signin page\r\n\t\t\t\t\t\t\t\t$location.path('signin');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 403:\r\n\t\t\t\t\t\t\t\t// Add unauthorized behaviour \r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn $q.reject(rejection);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t]);\r\n\t}\r\n]);\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('users').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Users state routing\r\n\t\t$stateProvider.\r\n\t\tstate('profile', {\r\n\t\t\turl: '/settings/profile',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/edit-profile.client.view.html'\r\n\t\t}).\r\n\t\tstate('password', {\r\n\t\t\turl: '/settings/password',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/change-password.client.view.html'\r\n\t\t}).\r\n\t\tstate('accounts', {\r\n\t\t\turl: '/settings/accounts',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/social-accounts.client.view.html'\r\n\t\t}).\r\n//\t\tstate('signup', {\r\n//\t\t\turl: '/signup',\r\n//\t\t\ttemplateUrl: 'modules/users/views/authentication/signup.client.view.html'\r\n//\t\t}).\r\n\t\tstate('signin', {\r\n\t\t\turl: '/signin',\r\n\t\t\ttemplateUrl: 'modules/users/views/authentication/signin.client.view.html'\r\n\t\t}).\r\n\t\tstate('forgot', {\r\n\t\t\turl: '/password/forgot',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/forgot-password.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset-invalid', {\r\n\t\t\turl: '/password/reset/invalid',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password-invalid.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset-success', {\r\n\t\t\turl: '/password/reset/success',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password-success.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset', {\r\n\t\t\turl: '/password/reset/:token',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\tangular.module('users').controller('AuthenticationController', AuthenticationController);\r\n\tAuthenticationController.$inject = ['$scope', '$http', '$location', 'Authentication'];\r\n\r\n\tfunction AuthenticationController($scope, $http, $location, Authentication) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.signin = signin;\r\n\t\tctrl.signup = signup;\r\n\r\n\t\tfunction signup() {\r\n\t\t\t$http.post('/auth/signup', ctrl.credentials).success(function(response) {\r\n\t\t\t\t// If successful we assign the response to the global user model\r\n\t\t\t\tctrl.authentication.user = response;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/signin');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\tctrl.error = response.message;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction signin() {\r\n\t\t\tctrl.credentials.username = 'username';\r\n\t\t\t$http.post('/auth/signin', ctrl.credentials).success(function(response) {\r\n\t\t\t\t// If successful we assign the response to the global user model\r\n\t\t\t\tctrl.authentication.user = response;\r\n\t\t\t\tctrl.loginBody = true;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/tasks');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\tctrl.error = response.message;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\n'use strict';\r\n\r\nangular.module('users').controller('PasswordController', ['$scope', '$stateParams', '$http', '$location', 'Authentication',\r\n\tfunction($scope, $stateParams, $http, $location, Authentication) {\r\n\t\t$scope.authentication = Authentication;\r\n\r\n\t\t//If user is signed in then redirect back home\r\n\t\tif ($scope.authentication.user) $location.path('/');\r\n\r\n\t\t// Submit forgotten password account id\r\n\t\t$scope.askForPasswordReset = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/auth/forgot', $scope.credentials).success(function(response) {\r\n\t\t\t\t// Show user success message and clear form\r\n\t\t\t\t$scope.credentials = null;\r\n\t\t\t\t$scope.success = response.message;\r\n\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t// Show user error message and clear form\r\n\t\t\t\t$scope.credentials = null;\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Change user password\r\n\t\t$scope.resetUserPassword = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/auth/reset/' + $stateParams.token, $scope.passwordDetails).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.passwordDetails = null;\r\n\r\n\t\t\t\t// Attach user profile\r\n\t\t\t\tAuthentication.user = response;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/password/reset/success');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n]);\n'use strict';\r\n\r\nangular.module('users').controller('SettingsController', ['$scope', '$http', '$location', 'Users', 'Authentication',\r\n\tfunction($scope, $http, $location, Users, Authentication) {\r\n\t\t$scope.user = Authentication.user;\r\n\r\n\t\t// If user is not signed in then redirect back home\r\n\t\tif (!$scope.user) $location.path('/');\r\n\r\n\t\t// Check if there are additional accounts \r\n\t\t$scope.hasConnectedAdditionalSocialAccounts = function(provider) {\r\n\t\t\tfor (var i in $scope.user.additionalProvidersData) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Check if provider is already in use with current user\r\n\t\t$scope.isConnectedSocialAccount = function(provider) {\r\n\t\t\treturn $scope.user.provider === provider || ($scope.user.additionalProvidersData && $scope.user.additionalProvidersData[provider]);\r\n\t\t};\r\n\r\n\t\t// Remove a user social account\r\n\t\t$scope.removeUserSocialAccount = function(provider) {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.delete('/users/accounts', {\r\n\t\t\t\tparams: {\r\n\t\t\t\t\tprovider: provider\r\n\t\t\t\t}\r\n\t\t\t}).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.success = true;\r\n\t\t\t\t$scope.user = Authentication.user = response;\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Update a user profile\r\n\t\t$scope.updateUserProfile = function(isValid) {\r\n\t\t\tif (isValid) {\r\n\t\t\t\t$scope.success = $scope.error = null;\r\n\t\t\t\tvar user = new Users($scope.user);\r\n\r\n\t\t\t\tuser.$update(function(response) {\r\n\t\t\t\t\t$scope.success = true;\r\n\t\t\t\t\tAuthentication.user = response;\r\n\t\t\t\t}, function(response) {\r\n\t\t\t\t\t$scope.error = response.data.message;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t$scope.submitted = true;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Change user password\r\n\t\t$scope.changeUserPassword = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/users/password', $scope.passwordDetails).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.success = true;\r\n\t\t\t\t$scope.passwordDetails = null;\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\t// Authentication service for user variables\r\n\tangular.module('users').factory('Authentication', AuthenticationFactory);\r\n\r\n\tfunction AuthenticationFactory() {\r\n\t\tvar _this = this;\r\n\r\n\t\t_this._data = {\r\n\t\t\tuser: window.user\r\n\t\t};\r\n\r\n\t\treturn _this._data;\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\t// Users service used for communicating with the users REST endpoint\r\n\tangular.module('users').factory('Users', UsersFactory);\r\n\tUsersFactory.$inject = ['$resource'];\r\n\r\n\tfunction UsersFactory($resource) {\r\n\t\treturn $resource('users', {}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n"]}