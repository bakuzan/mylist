{"version":3,"sources":["application.js"],"names":["ApplicationConfiguration","applicationModuleName","applicationModuleVendorDependencies","registerModule","moduleName","dependencies","angular","module","requires","push","config","$locationProvider","hashPrefix","run","$rootScope","$state","Authentication","$on","event","toState","name","user","_id","preventDefault","go","element","document","ready","location","hash","window","bootstrap","Menus","addMenuItem","addSubMenuItem","$stateProvider","state","url","templateUrl","controller","AnimeitemsController","$scope","$stateParams","$location","Animeitems","Mangaitems","$sce","$window","ItemService","ListService","NotificationFactory","AnimeFactory","spinnerService","$uibModal","getAnime","value","loading","query","status","$promise","then","result","ctrl","animeitems","filterConfig","areTagless","checkForTagless","statTags","buildStatTags","authentication","ongoingList","showingCount","expandFilters","sortType","sortReverse","ratingLevel","ratingActions","maxRating","percent","overStar","search","searchTags","tagsForFilter","taglessItem","selectListOptions","commonArrays","getCommonArrays","getItemsAvailable","onHold","viewItem","findOne","get","animeitemId","animeitem","console","log","latestDate","latest","updated","pageConfig","currentPage","pageSize","remove","confirmation","i","$remove","splice","path","warning","tickOff","item","episodes","Date","update","trustAsResourceUrl","usedTags","viewItemHistory","open","animation","size","resolve","data","type","meta","whichController","getSelectListOptions","$inject","CreateAnimeController","fileUpload","TagService","Enums","addedEpisodes","itemUpdate","updateHistory","finalEpisode","reWatching","end","addTag","tagArray","newTag","title","malSearchType","create","start","image","imgPath","season","convertDateToSeason","disc","manga","tags","mal","$save","success","errorResponse","error","message","dropTag","text","finalNumbers","find","malSearchOptions","disabled","id","findManga","mangaitems","init","isCreate","placeholder","required","autocomplete","removeTag","sections","showAdditional","showCompletion","showItemTags","selectMalEntry","malEntry","malStatus","anime","ongoing","setInSeason","year","substring","submit","tagArrayRemove","uploadFile","myFile","uploadFileToUrl","WatchAnimeController","$timeout","updateWatchedList","localStorage","setItem","JSON","stringify","watchedList","parse","getItem","saved","playVideo","videoFile","file","findWithAttr","video","files","parseInt","number","startRewatch","length","processed","$watch","nVal","URL","createObjectURL","WatchListController","WatchAnime","sortOptions","sortOption","v","watchAnime","directive","restrict","replace","fileModel","$parse","link","scope","attrs","model","modelSetter","assign","bind","$apply","e","altKey","keyCode","isList","view","listBack","css","items","page","passTag","tag","indexOf","split","hoveringOver","itemsAvailable","collapseFilters","el","addEventListener","swOnplay","pageCount","Math","ceil","last","first","next","prev","ctrlKey","filter","array","month","substr","endedSeason","moment","num","startMonth","startYear","diff","weeks","pad","slice","rating","input","statisticsDetailFilter","$filter","division","filterPart","episodeRating","concatenateTagArrays","itemHistory","itemRevisits","reWatchCount","$update","href","factory","AnimeitemsFactory","$resource","method","$http","uploadUrl","fd","FormData","append","post","transformRequest","identity","headers","err","popup","service","obj","buildOverview","overview","completed","buildRatingsDistribution","maxCount","ratingsDistribution","count","colour","percentage","toFixed","checkedRating","add","maxTagCount","itemCount","forEach","len","ratedCount","ratings","ratingAdded","ratingAvg","ratingWeighted","ratingsWeighted","completeByMonth","monthDetails","completeByMonthItems","maxCompleteMonth","itemYears","endingYears","months","max","completeBySeason","seasonDetails","completeBySeasonItems","maxCompleteSeason","seasons","date","getFullYear","getMonth","deleteHistory","history","temp","past","years","getRatingValues","tempRating","maxRatedCount","averageRating","values","latestHistory","chapters","reReading","now","repeating","currentPart","finalPart","index","revisits","displayDate","today","toISOString","fromNow","format","modeMap","weights","total","k","isNaN","setSeason","$q","getGroupProperties","groups","group","groupBy","f","o","Object","keys","map","itemTags","alreadyAdded","j","attr","categories","days","summaryFunctions","itemTypes","n","searchName","media","mediaType","repeatType","groupItemsByProperties","groupProperties","groupedArrays","manipulateString","string","transform","onlyFirst","toLowerCase","charAt","toUpperCase","numberOfPages","pagingDetails","stringReverse","reverse","join","weekEndingForDate","convertToSunday","day","getDay","getDate","wkEnd","setDate","endOf","CharactersController","Characters","CharacterService","character","voice","response","seriesFilter","voiceActors","series","characters","buildCharacterTags","buildVoiceActors","buildSeriesList","findAnime","characterId","findOneAnime","findOneManga","mangaitem","mangaitemId","maxItemCount","characterBack","characterTags","deleteSearchTag","disableNgAnimate","$animate","enabled","deletingItem","$parent","which","$eval","enterTag","entry_type","slider","slides","interval","bindToController","controllerAs","timer","autoSlide","self","currentIndex","enter","filteredSlides","locked","cancel","goToSlide","slide","isFullscreen","leave","repeater","toggleFullscreen","visible","elem","childElementCount","detailSeriesName","found","tagsToSearch","buildGenderDistribution","check","gender","buildRelatedCharacterTags","tagDetailCollection","tagDetailResult","bit","statSeries","CharacterFactory","HeaderController","changeTheme","timedTheme","timeOfDayTheme","theme","time","getHours","styles","storedValue","getElementById","lastIndexOf","isActive","viewLocation","isCollapsed","isTimedTheme","menu","getMenu","toggleCollapsibleMenu","anywhereButHere","$compile","showBackdrop","body","backdrop","appendChild","triggerAnywhereButHere","clickPass","stopPropagation","click","require","modelCtrl","$formatters","modelValue","loadingSpinner","transclude","active","api","show","hide","toggle","_register","_unregister","malSearch","MalService","selectItem","searchString","options","searchMal","searchResults","hasSearchResults","timeoutPromise","displayActions","displaySelectedItemActions","hasFocus","processItem","selectedItem","selectedItemActions","displayText","action","displayRawJson","toggleSearchDropdownOnFocus","newValue","myProgress","val","html","datesSelected","currentWkEnd","iDate","itemDate","currentDate","dateSuffix","suffixes","dtfilter","relevantDigits","suffix","dateArray","daySelected","ds","complete","FunctionService","width","padChar","Array","malService","params","isArray","queryType","defaultRoles","menus","shouldRender","roles","userRoleIndex","roleIndex","isPublic","validateMenuExistance","menuId","Error","addMenu","removeMenu","menuItemTitle","menuItemURL","menuItemType","menuItemUIRoute","position","menuItemClass","uiRoute","rootMenuItemURL","itemIndex","removeMenuItem","removeSubMenuItem","submenuItemURL","subitemIndex","toastr","swal","thenDo","showCancelButton","closeOnConfirm","confirmButtonText","confirmButtonColor","SpinnerService","spinners","queue","loads","hasOwnProperty","optionsOrPromise","spinner","always","promise","extend","$urlRouterProvider","otherwise","HistoryController","AnimeHistory","MangaHistory","HistoryService","buildHistory","buildHistoryList","animeHistory","mangaHistory","historyFilter","happenedWhen","when","historyGroups","ViewHistoryController","$uibModalInstance","historyStore","dismiss","close","historySeparator","level","timeframe","startOf","filterItemHistory","getEndsOfWeek","endsOfWeek","thisMonday","weekBeginning","thisSunday","weekEnding","mondays","getSetDaysAgo","sundays","deferred","defer","extractHistory","sort","a","b","dateA","dateB","groupItemHistory","cutoff","thisEnd","daysAgo","newDate","subtract","prevItem","groupedHistory","oldest","thisDate","wkBeg","CreateMangaController","MangaFactory","addedChapters","finalChapter","addedVolumes","volumes","finalVolume","hardcopy","MangaitemsController","reReadCount","MangaitemsFactory","CompleteOrdersController","order","newPrice","company","price","prototype","editOrder","nextVolume","prices","completeOrder","rrp","paid","controllerId","CreateOrdersController","Orders","isCreateMode","orderId","orderCopy","volume","orderHistory","stepConfig","stepHeaders","currentStep","stepCount","_this","copy","takeStep","step","direction","processOrder","openBoughtDialog","modalInstance","OrderHistoryController","processHistory","cost","purchaseDate","rrpInstance","saving","OrdersController","orders","openOrderHistoryDialog","OrdersFactory","RatingsController","StatisticsService","getItems","episodeScore","finished","buildSummaryFunctions","itemScore","score","modelOptions","debounce","viewEpisodeRatings","isEqual","focusOnShow","myValue","focus","StatisticsController","Toptens","getItemStatistics","historyDetails","ratingValues","colours","red","green","blue","buildToptenModeList","toptens","detail","isVisible","isEpisodeRatings","dataStore","totalListCount","buildToptenDataStructure","getSummaryFunctions","summary","buildYearSummary","yearSummary","episodeSummaryFunctions","buildEpisodeSummaries","divisionText","tagDetail","topten","isRanked","isFavourite","generateSeasons","detailSeasonYear","detailSeason","getFilteredItems","historyChange","filtered","getToptenItemStatistics","toptenType","filteredItems","listCount","historyDetail","summaryType","tableDetail","tableDetails","detectFlood","overflowCheck","scrollWidth","offsetWidth","classList","border","template","display","tabs","currentTab","listShift","addTab","tab","disable","disabledTab","select","selectedTab","tabContainer","heading","shiftTabs","elWidth","ulWidth","ul","children","$viewValue","$setViewValue","shift","style","left","tabContainerCtrl","processYearSummary","metric","highestRating","lowestRating","modeRating","sum","getModeMap","arrayOfArrays","listType","itemLen","occuranceCounter","results","filteredArray","ignore","CreateTaskController","Tasks","TaskFactory","process","newTask","linked","category","linkItems","linkType","checklistItems","checklist","valid","addChecklistItem","checklistItem","backStep","task","description","daily","repeat","completeTimes","updateCheck","dropChecklistItem","isAddTask","ScheduleCalendarTaskController","refresh","timeDiff","abs","getTime","daysFromToday","events","weekEnds","floor","aDate","bDate","insertChecklistItem","newChecklistItem","removeTask","tickOffChecklist","updateTask","TasksController","checkStatus","tasks","parts","single","all","change","dailyRefresh","createTask","dateOptions","dateDisabled","formatYear","maxDate","minDate","startingDay","refreshItems","setTabFilterDay","tabFilter","tabName","getWeekBeginning","UpdateAnimeTaskController","episodeCompleted","episodeNumber","isComplete","ratingLimit","UpdateMangaTaskController","loseInterest","$document","on","interesting","target","inheritedData","elm","tagName","scheduleCalendar","_removeTime","hour","minute","second","millisecond","_buildMonth","done","monthIndex","_buildWeek","isCurrentMonth","isToday","isSame","_displayEvents","selected","previous","att","shadow","passTo","passClick","removeTaskProcess","launchMangaUpdateDialog","itemOriginal","launchAnimeUpdateDialog","userCheck","updateAnimeitem","updateMangaitem","reject","errorMessage","isLinked","animeDialog","dialog","taskId","CreateToptenController","typeSetItemPopulate","listGen","typeDisplay","getYears","callback","displayList","limitMin","itemsCached","conditions","toptenCopy","animeList","mangaList","characterList","limit","imgSize","height","pushCondition","seriesLimit","tagLimit","pushItem","toptenItem","removeCondition","removeItem","steps","seriesList","swapping","one","two","swappingItems","toptenId","StatisticsTopten","list","toptenInfo","ToptensController","viewConfig","displayType","linkSuffix","openListStats","horizontalListCtrl","itemWidth","register","setVisibility","clicks","moveItems","listSettings","child","settings","ngMax","$isDirty","isEmpty","isUndefined","maxValidator","$setValidity","$parsers","ngMin","minValidator","min","stepsController","stepNumber","stickyClass","stickyInnerClass","scrollTop","inner","viewportOffset","getBoundingClientRect","distance_from_top","top","ToptensFactory","$httpProvider","interceptors","responseError","rejection","AuthenticationController","signin","credentials","username","loginBody","signup","askForPasswordReset","resetUserPassword","token","passwordDetails","Users","hasConnectedAdditionalSocialAccounts","additionalProvidersData","isConnectedSocialAccount","provider","removeUserSocialAccount","delete","updateUserProfile","isValid","submitted","changeUserPassword","_data","UsersFactory"],"mappings":"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","file":"application.min.js","sourcesContent":["'use strict';\r\n\r\n// Init the application configuration module for AngularJS application\r\nvar ApplicationConfiguration = (function() {\r\n\t// Init module configuration options\r\n\tvar applicationModuleName = 'mylist';\r\n\tvar applicationModuleVendorDependencies = ['ngResource', 'ngCookies',  'ngAnimate',  'ngTouch',  'ngSanitize',  'ui.router', 'ui.bootstrap', 'ui.utils', 'angularFileUpload', 'angularMoment'];\r\n\r\n\t// Add a new vertical module\r\n\tvar registerModule = function(moduleName, dependencies) {\r\n\t\t// Create angular module\r\n\t\tangular.module(moduleName, dependencies || []);\r\n\r\n\t\t// Add the module to the AngularJS configuration file\r\n\t\tangular.module(applicationModuleName).requires.push(moduleName);\r\n\t};\r\n\r\n\treturn {\r\n\t\tapplicationModuleName: applicationModuleName,\r\n\t\tapplicationModuleVendorDependencies: applicationModuleVendorDependencies,\r\n\t\tregisterModule: registerModule\r\n\t};\r\n})();\r\n'use strict';\r\n\r\n//Start by defining the main module and adding the module dependencies\r\nangular.module(ApplicationConfiguration.applicationModuleName, ApplicationConfiguration.applicationModuleVendorDependencies);\r\n\r\n// Setting HTML5 Location Mode\r\nangular.module(ApplicationConfiguration.applicationModuleName).config(['$locationProvider',\r\n\tfunction($locationProvider) {\r\n\t\t$locationProvider.hashPrefix('!');\r\n\t}\r\n]);\r\n\r\nangular.module(ApplicationConfiguration.applicationModuleName)\r\n     .run(['$rootScope', '$state', 'Authentication', function ($rootScope, $state, Authentication) {\r\n        $rootScope.$on('$stateChangeStart', function (event, toState) {\r\n\t\t\t\t\tif(toState.name === 'signin') {\r\n\t\t\t\t\t\tif(Authentication.user._id) {\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\t$state.go('listTasks');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t        if (!Authentication.user) {\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t$state.go('signin');\r\n\t        }\r\n\t\t\t\t});\r\n}]);\r\n\r\n//Then define the init function for starting up the application\r\nangular.element(document).ready(function() {\r\n\t//Fixing facebook bug with redirect\r\n\tif (window.location.hash === '#_=_') window.location.hash = '#!';\r\n\r\n\t//Then init the app\r\n\tangular.bootstrap(document, [ApplicationConfiguration.applicationModuleName]);\r\n});\r\n\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('animeitems');\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('characters');\r\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('core');\r\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('history');\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('mangaitems');\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('orders');\r\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('ratings');\r\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('statistics');\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('tasks');\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('toptens');\r\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('users');\r\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('animeitems').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Animeitems', 'animeitems', 'dropdown');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'List Animeitems', 'animeitems');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'Watch Animeitems', 'animeitems/watch-list');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'New Animeitem', 'animeitems/create');\r\n\t}\r\n]);\r\n\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('animeitems').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Animeitems state routing\r\n\t\t$stateProvider.\r\n        state('listAnimeitems', {\r\n\t\t\turl: '/animeitems',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/list-animeitems.client.view.html',\r\n\t\t\tcontroller: 'AnimeitemsController as ctrl'\r\n\t\t}).\r\n\t\tstate('watchListAnimeitems', {\r\n\t\t\turl: '/animeitems/watch-list',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/list-animeitems.client.view.html',\r\n\t\t\tcontroller: 'WatchListController as ctrl'\r\n\t\t}).\r\n\t\tstate('createAnimeitem', {\r\n\t\t\turl: '/animeitems/create',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/create-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewAnimeitem', {\r\n\t\t\turl: '/animeitems/:animeitemId',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/view-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('editAnimeitem', {\r\n\t\t\turl: '/animeitems/:animeitemId/edit',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/create-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('watchAnimeitem', {\r\n\t\t\turl: '/animeitems/watch/:animeitemId',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/watch-animeitem.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('AnimeitemsController', AnimeitemsController);\r\n\tAnimeitemsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'AnimeFactory', 'spinnerService', '$uibModal'];\r\n\r\n\tfunction AnimeitemsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, $sce, $window, ItemService, ListService, NotificationFactory, AnimeFactory, spinnerService, $uibModal) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n    ctrl.filterConfig = {\r\n        ongoingList: true,\r\n        showingCount: 0,\r\n        expandFilters: false,\r\n        sortType: '',\r\n        sortReverse: true,\r\n        ratingLevel: undefined,\r\n        ratingActions: {\r\n            maxRating: 10,\r\n            percent: undefined,\r\n            overStar: null\r\n        },\r\n        search: {},\r\n        searchTags: '',\r\n        tagsForFilter: [],\r\n        taglessItem: false,\r\n        areTagless: false,\r\n        selectListOptions: {},\r\n        statTags: [],\r\n        commonArrays: ListService.getCommonArrays(),\r\n\t\t\t\tgetItemsAvailable: getItemsAvailable,\r\n\t\t\t\tviewItem: ''\r\n    };\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.latestDate = latestDate;\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.viewItemHistory = viewItemHistory;\r\n\t\tctrl.whichController = 'animeitem';\r\n\r\n\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\r\n    //allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n\r\n\t\t// Remove existing Animeitem\r\n\t\tfunction remove(animeitem) {\r\n\t     //are you sure option...\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( animeitem ) {\r\n\t          animeitem.$remove();\r\n\r\n\t          for (var i in ctrl.animeitems) {\r\n\t            if (ctrl.animeitems [i] === animeitem) {\r\n\t            \tctrl.animeitems.splice(i, 1);\r\n\t            }\r\n\t          }\r\n\t        } else {\r\n\t\t\t\t\t\tctrl.animeitem.$remove(function() {\r\n\t          \t$location.path('animeitems');\r\n\t\t\t\t\t\t});\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Anime was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Update existing Animeitem\r\n\t\tfunction update() {\r\n\t\t\tvar animeitem = ctrl.animeitem;\r\n\t\t\tctrl.animeitem = undefined;\r\n      AnimeFactory.update(animeitem, undefined, true, undefined);\r\n\t\t}\r\n\r\n    function tickOff(item) {\r\n        item.episodes += 1;\r\n        item.latest = new Date(); //update latest.\r\n        ctrl.animeitem = item;\r\n        ctrl.update();\r\n    }\r\n\r\n    //latest date display format.\r\n    function latestDate(latest, updated) {\r\n        return ItemService.latestDate(latest, updated);\r\n    }\r\n\r\n\t\tfunction viewItemHistory() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/history/views/item-history.html',\r\n        controller: 'ViewHistoryController as viewHistory',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { viewItem: ctrl.filterConfig.viewItem, type: 'anime' };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed history: ', result, ctrl.filterConfig.viewItem.meta);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tctrl.animeitem = ctrl.filterConfig.viewItem;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n      });\r\n\t\t}\r\n\r\n\t\t// Find existing Animeitem\r\n\t\tfunction findOne() {\r\n\t    Animeitems.get({ animeitemId: $stateParams.animeitemId }).$promise.then(function(result) {\r\n\t        ctrl.animeitem = result;\r\n\t   \t\t\tconsole.log(ctrl.animeitem);\r\n\t    });\r\n\t\t}\r\n\r\n\t\t/** Find a list of Animeitems for values:\r\n         *  (0) returns only ongoing series. (1) returns all series.\r\n         */\r\n\t\tfunction getAnime(value) {\r\n\t    spinnerService.loading('anime', Animeitems.query({ status: value }).$promise.then(function(result) {\r\n\t        ctrl.animeitems = result;\r\n\t\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\t\tctrl.filterConfig.statTags = ItemService.buildStatTags(result, 0);\r\n\t    }));\r\n\t\t}\r\n\r\n    //Set defaults on requery and \"neutralise\" the other search variable.\r\n    function getItemsAvailable() {\r\n        ctrl.animeitems = undefined;\r\n        if (ctrl.filterConfig.ongoingList === true) {\r\n            ctrl.filterConfig.search.onHold = false;\r\n            ctrl.filterConfig.search.status = '';\r\n            getAnime(0);\r\n        } else {\r\n            ctrl.filterConfig.search.onHold = '';\r\n            ctrl.filterConfig.search.status = false;\r\n            getAnime(1);\r\n        }\r\n    }\r\n\t\tctrl.filterConfig.getItemsAvailable();\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('CreateAnimeController', CreateAnimeController);\r\n\tCreateAnimeController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'AnimeFactory', 'spinnerService', 'TagService', 'Enums'];\r\n\r\n\tfunction CreateAnimeController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, fileUpload, $sce, $window, ItemService, ListService, NotificationFactory, AnimeFactory, spinnerService, TagService, Enums) {\r\n\t\tvar ctrl = this,\r\n        animeitemId = $stateParams.animeitemId;\r\n\r\n\t\tctrl.addedEpisodes = addedEpisodes;\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.animeitem = {};\r\n\t\tctrl.authentication = Authentication;\r\n    ctrl.config = {\r\n      title: 'Create',\r\n\t\t\tupdateHistory: false,\r\n      ratingActions: {\r\n          maxRating: 10,\r\n          percent: undefined,\r\n          overStar: null\r\n      },\r\n      statTags: [],\r\n      commonArrays: ListService.getCommonArrays(),\r\n\t\t\tmalSearchType: 'anime'\r\n    };\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.finalNumbers = false; //default show status of final number fields in edit view.\r\n\t\tctrl.find = find;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.findManga = findManga;\r\n    ctrl.imgPath = ''; //image path\r\n\t\tctrl.itemUpdate = new Date(); // today's date as 'yyyy-MM-dd' for the auto-pop of 'latest' in edit page.\r\n    ctrl.init = init;\r\n\t\tctrl.malSearchOptions = {\r\n\t\t\tplaceholder: 'Title',\r\n\t\t\tname: 'title',\r\n\t\t\trequired: true,\r\n\t\t\tautocomplete: 'off',\r\n\t\t\tdisabled: true\r\n\t\t};\r\n\t\tctrl.removeTag = removeTag;\r\n\t\tctrl.sections = {\r\n\t\t\tshowAdditional: false,\r\n\t\t\tshowCompletion: false,\r\n\t\t\tshowItemTags: false\r\n\t\t};\r\n\t\tctrl.selectMalEntry = selectMalEntry;\r\n\t\tctrl.setInSeason = setInSeason;\r\n\t\tctrl.submit = submit;\r\n    ctrl.tagArray = []; // holding tags pre-submit\r\n    ctrl.tagArrayRemove = [];\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\r\n    function init() {\r\n      ctrl.config.isCreate = animeitemId === undefined;\r\n      if(ctrl.config.isCreate) {\r\n\t\t\t\tctrl.animeitem.episodes = 0;\r\n\t\t\t\tctrl.animeitem.start = ctrl.itemUpdate;\r\n\t\t\t\tctrl.animeitem.latest = ctrl.itemUpdate;\r\n\t\t\t\tctrl.malSearchOptions.disabled = false;\r\n\t\t\t} else if(!ctrl.config.isCreate) {\r\n        ctrl.config.title = 'Edit';\r\n        ctrl.findOne();\r\n      }\r\n      ctrl.find();\r\n      ctrl.findManga();\r\n    }\r\n    ctrl.init();\r\n\r\n\t\tfunction selectMalEntry(malEntry) {\r\n\t\t\tif(malEntry) {\r\n\t\t\t\tctrl.animeitem.title = malEntry.title;\r\n\t\t\t\tctrl.animeitem.finalEpisode = malEntry.episodes;\r\n\t\t\t\tctrl.imgPath = malEntry.image;\r\n\t\t\t\tctrl.season = malEntry.status === Enums.malStatus.anime.ongoing;\r\n\t\t\t\tctrl.animeitem.mal = {\r\n\t\t\t\t\tid: malEntry.id\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tctrl.animeitem.finalEpisode = 0;\r\n\t\t\t\tctrl.animeitem.mal = undefined;\r\n\t\t\t\tctrl.season = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n    //For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for animeitem tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.animeitem.tags, text);\r\n\t\t}\r\n\r\n\t\tfunction addedEpisodes() {\r\n\t\t\tctrl.animeitem.latest = ctrl.itemUpdate;\r\n\t\t\tctrl.config.updateHistory = true;\r\n\t\t\tif(ctrl.animeitem.episodes === ctrl.animeitem.finalEpisode && ctrl.animeitem.finalEpisode !== 0 && ctrl.animeitem.reWatching === false) {\r\n\t\t\t\tctrl.animeitem.end = ctrl.itemUpdate;\r\n\t\t\t}\r\n\t\t\tif(ctrl.animeitem.episodes > ctrl.animeitem.finalEpisode && ctrl.animeitem.finalEpisode !== 0) {\r\n\t\t\t\tctrl.animeitem.episodes = ctrl.animeitem.finalEpisode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction setInSeason() {\r\n\t\t\tif(ctrl.animeitem.season.season === null) {\r\n\t\t\t\t ctrl.animeitem.season.year = null;\r\n\t\t\t } else {\r\n\t\t\t\t ctrl.animeitem.season.year = ctrl.animeitem.start.substring(0,4);\r\n\t\t\t }\r\n\t\t}\r\n\r\n\t\t// Create new Animeitem\r\n\t\tfunction create() {\r\n\t\t\t// Create new Animeitem object\r\n      var animeitem = new Animeitems();\r\n      animeitem = new Animeitems ({\r\n          title: ctrl.animeitem.title,\r\n          episodes: ctrl.animeitem.episodes,\r\n          start: ctrl.animeitem.start,\r\n          latest: ctrl.animeitem.latest,\r\n          finalEpisode: ctrl.animeitem.finalEpisode,\r\n\t\t\t\t\timage: ctrl.imgPath,\r\n          season: ctrl.season === true ? ItemService.convertDateToSeason(new Date(ctrl.animeitem.start)) : '',\r\n          disc: ctrl.animeitem.disc,\r\n          manga: ctrl.animeitem.manga!==undefined && ctrl.animeitem.manga!==null ? ctrl.animeitem.manga._id : ctrl.animeitem.manga,\r\n          tags: ctrl.tagArray,\r\n\t\t\t\t\tmal: ctrl.animeitem.mal,\r\n          user: ctrl.user\r\n       });\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\tanimeitem.$save(function(response) {\r\n\t\t\t\t$location.path('/animeitems');\r\n\t\t\t\tNotificationFactory.success('Saved!', 'Anime was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n        NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Update existing Animeitem\r\n\t\tfunction update() {\r\n\t\t\tvar animeitem = ctrl.animeitem;\r\n\t\t\tctrl.animeitem = undefined;\r\n      AnimeFactory.update(animeitem, ctrl.tagArray, ctrl.config.updateHistory, ctrl.imgPath);\r\n\t\t}\r\n\r\n\t\tfunction submit() {\r\n\t\t\tif(ctrl.config.isCreate) ctrl.create();\r\n\t\t\tif(!ctrl.config.isCreate) ctrl.update();\r\n\t\t}\r\n\r\n    // Find a list of Animeitems\r\n    function find() {\r\n        Animeitems.query().$promise.then(function(result) {\r\n\t\t\t\t\tctrl.animeitems = result;\r\n\t\t\t\t\t\tctrl.config.statTags = ItemService.buildStatTags(result, 0);\r\n\t\t\t\t});\r\n    }\r\n\r\n\t\t// Find existing Animeitem\r\n\t\tfunction findOne() {\r\n\t    spinnerService.loading('editAnime', Animeitems.get({ animeitemId: animeitemId }).$promise.then(function(result) {\r\n\t        ctrl.animeitem = result;\r\n\t\t\t\t\tctrl.malSearchOptions.disabled = (ctrl.animeitem.mal && ctrl.animeitem.mal.id > 0) || false;\r\n\t    }));\r\n\t\t}\r\n\r\n    // Find list of mangaitems for dropdown.\r\n    function findManga() {\r\n        ctrl.mangaitems = Mangaitems.query();\r\n    }\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/animeitems/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUploadAnime');\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('WatchAnimeController', WatchAnimeController);\r\n\tWatchAnimeController.$inject = ['$scope', 'Authentication', '$stateParams', '$timeout', 'Animeitems', '$sce', 'ListService', 'AnimeFactory'];\r\n\r\n\tfunction WatchAnimeController($scope, Authentication, $stateParams, $timeout, Animeitems, $sce, ListService, AnimeFactory) {\r\n\t\t\t\tvar ctrl = this,\r\n\t\t\t\t\t\tsaved = localStorage.getItem('watched');\r\n\r\n        ctrl.authentication = Authentication;\r\n\t\t\t\tctrl.findOne = findOne;\r\n\t\t\t\tctrl.playVideo = playVideo;\r\n\t\t\t\tctrl.startRewatch = startRewatch;\r\n\t\t\t\tctrl.update = update;\r\n        ctrl.videoFile = {\r\n  \t\t\t\tprocessed: '',\r\n  \t\t\t\tfile: '',\r\n\t\t\t\t\tnumber: '',\r\n  \t\t\t\tmessage: 'Please select an episode.'\r\n        };\r\n\t\t\t\tctrl.watchedList = (localStorage.getItem('watched') !== null) ? JSON.parse(saved) : {};\r\n\r\n\t\t\t\tfunction updateWatchedList() {\r\n\t\t\t\t\tlocalStorage.setItem('watched', JSON.stringify(ctrl.watchedList));\r\n\t\t\t\t\tctrl.watchedList = JSON.parse(localStorage.getItem('watched'));\r\n\t\t\t\t}\r\n\r\n        $scope.$watch('fileGrab', function(nVal, oVal) {\r\n          if(nVal) {\r\n\t\t\t\t\t\tctrl.videoFile.message = ''; //clear any error.\r\n            ctrl.videoFile.file = nVal.name;\r\n\t\t\t\t\t\tctrl.videoFile.number = ctrl.animeitem.video.files[ListService.findWithAttr(ctrl.animeitem.video.files, 'file', nVal.name)].number;\r\n            ctrl.videoFile.processed = $sce.trustAsResourceUrl(window.URL.createObjectURL(nVal));\r\n          }\r\n        });\r\n\r\n\t\t\t\tfunction playVideo() {\r\n\t\t\t\t\tctrl.watchedList[ctrl.videoFile.file] = true;\r\n\t\t\t\t\tupdateWatchedList();\r\n\t\t\t\t\tif(ctrl.animeitem.reWatching && (ListService.findWithAttr(ctrl.animeitem.video.files, 'file', ctrl.videoFile.file) > -1)) {\r\n\t\t\t\t\t\tctrl.animeitem.episodes = parseInt(ctrl.videoFile.number, 10);\r\n\t\t\t\t\t\tctrl.update();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction startRewatch() {\r\n\t\t\t\t\tconsole.log('startRewatch: ');\r\n\t\t\t\t\tvar i = ctrl.animeitem.video.files.length;\r\n\t\t\t\t\twhile(i--) {\r\n\t\t\t\t\t\tctrl.watchedList[ctrl.animeitem.video.files[i].file] = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdateWatchedList();\r\n\t\t\t\t\tctrl.animeitem.episodes = 0;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Update existing Animeitem\r\n\t\t\t\tfunction update() {\r\n\t\t\t\t\tctrl.animeitem.latest = new Date();\r\n\t\t      AnimeFactory.update(ctrl.animeitem, undefined, false, '');\r\n\t\t\t\t}\r\n\r\n        // Find existing Animeitem\r\n    \t\tfunction findOne() {\r\n    \t    Animeitems.get({ animeitemId: $stateParams.animeitemId }).$promise.then(function(result) {\r\n    \t        ctrl.animeitem = result;\r\n    \t   \t\t\tconsole.log(ctrl.animeitem);\r\n    \t    });\r\n    \t\t}\r\n        ctrl.findOne();\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('WatchListController', WatchListController);\r\n\tWatchListController.$inject = ['$scope', 'Authentication', '$state', '$sce', 'spinnerService', 'ItemService', 'ListService', 'WatchAnime', '$filter'];\r\n\r\n\tfunction WatchListController($scope, Authentication, $state, $sce, spinnerService, ItemService, ListService, WatchAnime, $filter) {\r\n\t\t\t\tvar ctrl = this;\r\n\r\n        ctrl.authentication = Authentication;\r\n\t\t\t\tctrl.filterConfig = {\r\n\t\t        ongoingList: true,\r\n\t\t        showingCount: 0,\r\n\t\t        expandFilters: false,\r\n\t\t        sortType: '',\r\n\t\t        sortReverse: true,\r\n\t\t        ratingLevel: undefined,\r\n\t\t        ratingActions: {\r\n\t\t            maxRating: 10,\r\n\t\t            percent: undefined,\r\n\t\t            overStar: null\r\n\t\t        },\r\n\t\t        search: {},\r\n\t\t        searchTags: '',\r\n\t\t        tagsForFilter: [],\r\n\t\t        taglessItem: false,\r\n\t\t        areTagless: false,\r\n\t\t        selectListOptions: {},\r\n\t\t        statTags: [],\r\n\t\t        commonArrays: ListService.getCommonArrays()\r\n\t\t    };\r\n\t\t\t\tctrl.find = find;\r\n\t\t\t\tctrl.latestDate = latestDate;\r\n\t\t\t\tctrl.pageConfig = {\r\n\t\t\t\t\t\tcurrentPage: 0,\r\n\t\t\t\t\t\tpageSize: 10\r\n\t\t\t\t};\r\n\t\t\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\t\t\tctrl.watchAnime = watchAnime;\r\n\t\t\t\tctrl.whichController = 'watch';\r\n\r\n\t\t\t\tfunction watchAnime(id) {\r\n\t\t\t\t\t$state.go('watchAnimeitem', { animeitemId: id });\r\n\t\t\t\t}\r\n\r\n        // Find a list of Animeitems\r\n        function find() {\r\n\t\t\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t\t\t\t\tctrl.filterConfig.sortType = ctrl.filterConfig.selectListOptions.sortOptions[ctrl.filterConfig.selectListOptions.sortOption].v; //Set sort order.\r\n          spinnerService.loading('watch', WatchAnime.query().$promise.then(function(result) {\r\n  \t\t\t\t\tctrl.animeitems = result;\r\n\t\t\t\t\t\tconsole.log('watch list: ', result, 'filterConfig: ', ctrl.filterConfig);\r\n  \t\t\t\t}));\r\n        }\r\n        ctrl.find();\r\n\r\n\t\t\t\t//allow retreival of local resource\r\n\t\t    function trustAsResourceUrl(url) {\r\n\t\t        return $sce.trustAsResourceUrl(url);\r\n\t\t    }\r\n\r\n\t\t\t\t//latest date display format.\r\n\t\t    function latestDate(latest, updated) {\r\n\t\t        return ItemService.latestDate(latest, updated);\r\n\t\t    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('animeItemModel', animeItemModel);\r\n\r\n  function animeItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/animeitems/templates/anime-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('fileModel', fileModel);\r\n  fileModel.$inject = ['$parse'];\r\n\r\n  function fileModel($parse) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function(scope, element, attrs) {\r\n            var model = $parse(attrs.fileModel);\r\n            var modelSetter = model.assign;\r\n\r\n            element.bind('change', function(){\r\n                scope.$apply(function(){\r\n                    modelSetter(scope, element[0].files[0]);\r\n                });\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('keycuts', keycuts);\r\n\r\n  function keycuts() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function postLink(scope, element, attrs) {\r\n              //keydown catch - alt+v for view\r\n              scope.$on('my:keydown', function(event, e) {\r\n  //                console.log(event, e);\r\n                  if (e.altKey && e.keyCode===86) {\r\n                      if (scope.isList==='list') {\r\n                          scope.isList = 'slider';\r\n                      } else if (scope.isList==='slider') {\r\n                          scope.isList = 'list';\r\n                      } else if (scope.view === 'Anime') {\r\n                          scope.view = 'Manga';\r\n                      } else if (scope.view === 'Manga') {\r\n                          scope.view = 'Character';\r\n                      } else if (scope.view === 'Character') {\r\n                          scope.view = 'Anime';\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('listBack', listBack);\r\n   function listBack() {\r\n      return function(scope, element, attrs){\r\n          var url = attrs.listBack;\r\n          element.css({\r\n              'background-image': 'url(' + url +')',\r\n              'background-size' : '50%',\r\n              'background-repeat': 'no-repeat',\r\n              'background-position': 'right'\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('listFilters', listFilters);\r\n\r\n  function listFilters() {\r\n      return {\r\n          restrict: 'EA',\r\n          replace: true,\r\n          scope: {\r\n              filterConfig: '=',\r\n              items: '=',\r\n              page: '='\r\n          },\r\n          templateUrl: '/modules/animeitems/templates/list-filters.html',\r\n          link: function(scope, elem, attrs) {\r\n              scope.filterConfig.searchTags = '';\r\n              scope.passTag = function(tag) {\r\n                if (scope.filterConfig.searchTags.indexOf(tag) === -1) {\r\n                    scope.filterConfig.searchTags += tag + ',';\r\n                    scope.filterConfig.tagsForFilter = scope.filterConfig.searchTags.substring(0, scope.filterConfig.searchTags.length - 1).split(',');\r\n                }\r\n              };\r\n              //rating 'tooltip' function\r\n              scope.hoveringOver = function(value) {\r\n                scope.filterConfig.ratingActions.overStar = value;\r\n                scope.filterConfig.ratingActions.percent = 100 * (value / scope.filterConfig.ratingActions.maxRating);\r\n              };\r\n\r\n              scope.itemsAvailable = function() {\r\n                scope.filterConfig.getItemsAvailable();\r\n              };\r\n\r\n              scope.collapseFilters = function() {\r\n                scope.filterConfig.expandFilters = false;\r\n              };\r\n\r\n          }\r\n\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('swOnplay', swOnplay);\r\n\r\n  function swOnplay() {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        var el = element[0];\r\n        el.addEventListener('play', function() {\r\n          scope.$apply(attrs.swOnplay);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('pageControls', pageControls);\r\n\r\n  function pageControls() {\r\n    return {\r\n        restrict: 'EA',\r\n        replace: true,\r\n        scope: {\r\n            pageConfig: '=',\r\n            showingCount: '='\r\n        },\r\n        templateUrl: '/modules/animeitems/templates/page-controls.html',\r\n        link: function(scope, elem, attrs) {\r\n            /** Calculate page count.\r\n             *    If showingCount isn't caluclated in time...\r\n             *    If the pageSize is altered...\r\n             */\r\n                scope.$watch('showingCount', function() {\r\n                    scope.pageCount = Math.ceil(scope.showingCount / scope.pageConfig.pageSize);\r\n                    if (scope.pageConfig.currentPage > scope.pageCount - 1) {\r\n                        scope.last(); //in the event changing page size would put you above the last page.\r\n                    } else if (scope.pageConfig.currentPage < 0) {\r\n                        scope.first();\r\n                    }\r\n                });\r\n\r\n            /** Button Functions\r\n             *    go to next/prev pages. skip to first/last page.\r\n             */\r\n            scope.first = function() {\r\n  //              console.log('first');\r\n                scope.pageConfig.currentPage = 0;\r\n            };\r\n            scope.last = function() {\r\n  //              console.log('last');\r\n                scope.pageConfig.currentPage = scope.pageCount - 1;\r\n            };\r\n            scope.next = function() {\r\n  //              console.log('next');\r\n                scope.pageConfig.currentPage += 1;\r\n            };\r\n            scope.prev = function() {\r\n  //              console.log('prev');\r\n                scope.pageConfig.currentPage -= 1;\r\n            };\r\n\r\n            //Catches ctrl+left/right keypresses to change pages.\r\n            scope.$on('my:keydown', function(event, e) {\r\n  //              console.log(event, e);\r\n              if (e.ctrlKey && e.keyCode===39 && scope.pageConfig.currentPage < scope.pageCount - 1) {\r\n                  scope.next();\r\n              } else if (e.ctrlKey && e.keyCode===37 && scope.pageConfig.currentPage > 0) {\r\n                  scope.prev();\r\n              }\r\n            });\r\n\r\n        }\r\n    };\r\n\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('endedMonth', endedMonth);\r\n\r\n  function endedMonth() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n          //ended stat month filter\r\n                  if (item.end!==undefined && item.end!==null) {\r\n                      if (item.end.substring(0,4)===year) {\r\n                          if (item.end.substr(5,2)===month) {\r\n                              return item;\r\n                          }\r\n                      }\r\n                  }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('endedSeason', endedSeason);\r\n  endedSeason.$inject = ['moment'];\r\n\r\n  function endedSeason(moment) {\r\n      //ended stat season filter\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n                  var start = moment(item.start), end = moment(item.end), num, startMonth, startYear, diff, weeks, pad = '00';\r\n                  if (item.end!==undefined && item.end!==null) {\r\n                      /**\r\n                       *  Can currently handle shows of 1 or 2 seasons with 'standard' lengths (10-13) / (22-26) that\r\n                       *  start and finish in the 'normal' season months (J-M,A-J,J-S,O-D) / (J-J,A-S,J-D,O-M).\r\n                       */\r\n                      if (9 < item.finalEpisode && item.finalEpisode < 14) {\r\n                          startMonth = (pad + (month - 2)).slice(-pad.length);\r\n                          if ((item.end.substring(0,4) === year && item.end.substr(5,2) === month) || (item.start.substring(0,4) === year && item.start.substr(5,2) === startMonth)) {\r\n                              diff = end.diff(start, 'days');\r\n                              weeks = Math.ceil(diff / 7) + 1; //add one to correct for the first ep. counting as week 0 in an equation.\r\n                              if (weeks >= item.episodes) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      } else if (13 < item.finalEpisode && item.finalEpisode < 26) {\r\n                          num = (month - 5) > 0 ? (month - 5) : 10;\r\n                          startYear = (month - 5) > 0 ? year : year - 1;\r\n                          startMonth = (pad + num).slice(-pad.length);\r\n                          if ((item.end.substring(0,4) === year && item.end.substr(5,2) === month) || (item.start.substring(0,4) === startYear && item.start.substr(5,2) === startMonth)) {\r\n                              diff = end.diff(start, 'days');\r\n                              weeks = Math.ceil(diff / 7) + 1; //add one to correct for the first ep. counting as week 0 in an equation.\r\n                              if (weeks >= item.episodes) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('ratingFilter', ratingFilter);\r\n\r\n  function ratingFilter() {\r\n      return function(array, rating) {\r\n          if (array !== undefined) {\r\n              //filter for rating stars\r\n              return array.filter(function(item) {\r\n      //            console.log(item);\r\n                  if (item.rating===rating) {\r\n                      return item;\r\n                  } else if (rating===undefined) {\r\n                      return item;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('seasonForCharacterAnime', seasonForCharacterAnime);\r\n\r\n  function seasonForCharacterAnime() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n              if (item.anime && item.anime.season !== undefined && item.anime.season !== null) {\r\n                  if (item.anime.season.year === year && item.anime.season.season === month) {\r\n                      return item;\r\n                  }\r\n              }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('season', season);\r\n\r\n  function season() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n              if (item.season !== undefined && item.season !== null) {\r\n                  if (item.season.year === year && item.season.season === month) {\r\n                      return item;\r\n                  }\r\n              }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('startFrom', startFrom);\r\n\r\n   function startFrom() {\r\n      return function(input, start) {\r\n          if (input !== undefined) {\r\n              start = +start; //parse to int\r\n              return input.slice(start);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('statisticsDetailFilter',statisticsDetailFilter);\r\n   statisticsDetailFilter.$inject = ['$filter'];\r\n\r\n   function statisticsDetailFilter($filter) {\r\n      return function(array, type, year, division) {\r\n          var filter = (division === '')   ? 'summaryYear' :\r\n                       (type === 'months') ? 'endedMonth'  :\r\n                                             'season'      ,\r\n              filterPart = (division === '') ? type : division;\r\n          return $filter(filter)(array, year, filterPart);\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('summaryYear', summaryYear);\r\n\r\n  function summaryYear() {\r\n      return function(array, year, type) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                if (type === 'months' && item.end !== undefined && item.end !== null) {\r\n                    if (item.end.substring(0,4) === year) {\r\n                        return item;\r\n                    }\r\n                } else if (type === 'seasons') {\r\n                    if (item.season.year === year) {\r\n                        return item;\r\n                    }\r\n                }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('AnimeFactory', AnimeFactory);\r\n\tAnimeFactory.$inject = ['Animeitems', 'ListService', 'ItemService', 'NotificationFactory', '$location'];\r\n\r\n\tfunction AnimeFactory(Animeitems, ListService, ItemService, NotificationFactory, $location) {\r\n\t    return {\r\n\t        update: function(item, tagArray, updateHistory, imgPath, episodeRating) {\r\n\t            var animeitem = item;\r\n\t            console.log(animeitem);\r\n\t            //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n\t            if (item.manga!==null && item.manga!==undefined) {\r\n\t                animeitem.manga = item.manga._id;\r\n\t            }\r\n\r\n\t            if (tagArray!==undefined) {\r\n\t                animeitem.tags = ListService.concatenateTagArrays(animeitem.tags, tagArray);\r\n\t            }\r\n\r\n\t            //update the item history.\r\n\t            animeitem = ItemService.itemHistory(animeitem, updateHistory, 'anime', episodeRating);\r\n\r\n\t            if (imgPath!==undefined && imgPath!==null && imgPath!=='') {\r\n\t                animeitem.image = imgPath;\r\n\t            }\r\n\t            //console.log($scope.imgPath);\r\n\t            //console.log(animeitem.image);\r\n\r\n\t            //handle end date\r\n\t            if (animeitem.episodes === animeitem.finalEpisode && animeitem.finalEpisode!==0) {\r\n\t                if (animeitem.end===undefined || animeitem.end === null) {\r\n\t                    animeitem.end = animeitem.latest;\r\n\t//                    console.log(animeitem.end);\r\n\t                }\r\n\t            } else if (animeitem.reWatching === false) {\r\n\t                //in the event the 'complete-ness' of an entry needs to be undone.\r\n\t                //this will undo the end date.\r\n\t                animeitem.end = null;\r\n\t//                console.log(animeitem.end);\r\n\t            }\r\n\r\n\t            //handle status: completed.\r\n\t            if(animeitem.end!==undefined && animeitem.end!==null) {\r\n\t                animeitem.status = true;\r\n\t                animeitem.onHold = false;\r\n\t            } else {\r\n\t                //if no end date, not complete.\r\n\t                animeitem.status = false;\r\n\t            }\r\n\r\n\t            //handle re-reading, re-read count.\r\n\t            if (animeitem.reWatching===true) {\r\n\t\t\t\t\t\t\t\tanimeitem = ItemService.itemRevisits(animeitem, 'anime');\r\n\t\t\t\t\t\t\t\tif(animeitem.episodes===animeitem.finalEpisode) {\r\n\t                animeitem.reWatchCount += 1;\r\n\t                animeitem.reWatching = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t            }\r\n\r\n\t\t\t\tanimeitem.$update(function() {\r\n\t\t\t\t\tif (window.location.href.indexOf('tasks') === -1 && window.location.href.indexOf('watch') === -1 ) $location.path('animeitems');\r\n\r\n\t\t\t\t    NotificationFactory.success('Saved!', 'Anime was saved successfully');\r\n\t\t\t\t}, function(errorResponse) {\r\n\t\t\t\t\tvar error = errorResponse.data.message;\r\n\t                NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t\t});\r\n\t        }\r\n\t    };\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('Animeitems', AnimeitemsFactory);\r\n\tAnimeitemsFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction AnimeitemsFactory($resource) {\r\n\t\t\treturn $resource('animeitems/:animeitemId', { animeitemId: '@_id' }, { update: { method: 'PUT' } });\r\n\t\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('fileUpload', fileUpload);\r\n\tfileUpload.$inject = ['$http', 'NotificationFactory'];\r\n\r\n\tfunction fileUpload($http, NotificationFactory) {\r\n\t\tvar obj = {\r\n\t\t\tuploadFileToUrl: uploadFileToUrl\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n    function uploadFileToUrl(file, uploadUrl){\r\n        var fd = new FormData();\r\n        fd.append('file', file);\r\n        $http.post(uploadUrl, fd, {\r\n            transformRequest: angular.identity,\r\n            headers: {'Content-Type': undefined}\r\n        })\r\n        .success(function(response){\r\n            NotificationFactory.success('Uploaded!', 'Image was saved successfully');\r\n        })\r\n        .error(function(err){\r\n            NotificationFactory.popup('Woops!', 'Something went wrong! \\n' + err, 'error');\r\n        });\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('ItemService', ItemService);\r\n\tItemService.$inject = ['moment', '$filter', 'ListService'];\r\n\r\n\tfunction ItemService(moment, $filter, ListService) {\r\n\t\tvar obj = {\r\n\t\t\tbuildOverview: buildOverview,\r\n\t\t\tbuildRatingsDistribution: buildRatingsDistribution,\r\n\t\t\tbuildStatTags: buildStatTags,\r\n\t\t\tcompleteByMonth: completeByMonth,\r\n\t\t\tcompleteBySeason: completeBySeason,\r\n\t\t\tconvertDateToSeason: convertDateToSeason,\r\n\t\t\tdeleteHistory: deleteHistory,\r\n\t\t\tendingYears: endingYears,\r\n\t\t\tgetRatingValues: getRatingValues,\r\n\t\t\titemHistory: itemHistory,\r\n\t\t\titemRevisits: itemRevisits,\r\n\t\t\tlatestDate: latestDate,\r\n\t\t\tmaxCompleteMonth: maxCompleteMonth,\r\n\t\t\tmaxTagCount: maxTagCount,\r\n\t\t\tratingsWeighted: ratingsWeighted,\r\n\t\t\tsetSeason: setSeason\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n\t        //Using the date, returns the season.\r\n\t        function convertDateToSeason(date) {\r\n\t            var season = '', year = date.getFullYear(), month = date.getMonth() + 1, commonArrays = ListService.getCommonArrays(),\r\n\t                i = commonArrays.seasons.length;\r\n\t//            console.log('convert: ', year, month);\r\n\t            while(i--) {\r\n\t                if (month > Number(commonArrays.seasons[i].number) && season === '') {\r\n\t                    season = { season: commonArrays.seasons[i+1].text, year: year };\r\n\t                }\r\n\t                //catch winter.\r\n\t                if (i === 0 && season === '') {\r\n\t                    season = { season: commonArrays.seasons[i].text, year: year };\r\n\t                }\r\n\t            }\r\n\t//            console.log('to: ', season);\r\n\t            return season;\r\n\t        }\r\n\r\n\t        //add history entry to item.\r\n\t        function itemHistory(item, updateHistory, type, episodeRating) {\r\n\t            console.log('item history: ', item, item.meta, episodeRating);\r\n\t            //populate the history of when each part was 'checked' off.\r\n\t            if (item.meta.history.length !== 0) {\r\n\t                var latestHistory = item.meta.history[item.meta.history.length - 1].value,\r\n\t                    length = type === 'anime' ? item.episodes - latestHistory : item.chapters - latestHistory;\r\n\t                if (length > 0 && (type === 'anime' ? item.reWatching === false : item.reReading === false)) {\r\n\t                    for(var i = 1; i <= length; i++) {\r\n\t                        item.meta.history.push({\r\n\t                            date: Date.now(),\r\n\t                            value: latestHistory + i,\r\n\t                            rating: episodeRating || 0,\r\n\t                            title: item.title,\r\n\t                            id: item._id\r\n\t                        });\r\n\t                    }\r\n\t                }\r\n\t            } else {\r\n\t                if (updateHistory && (type === 'anime' ? item.reWatching === false : item.reReading === false)) {\r\n\t                    item.meta.history.push({\r\n\t                        date: Date.now(),\r\n\t                        value: (type === 'anime' ? item.episodes : item.chapters),\r\n\t                        rating: episodeRating || 0,\r\n\t                        title: item.title,\r\n\t                        id: item._id\r\n\t                    });\r\n\t                }\r\n\t            }\r\n\t            return item;\r\n\t        }\r\n\r\n\t        //remove an entry from an items history.\r\n\t        function deleteHistory(item, history) {\r\n\t            var temp = [];\r\n\t            angular.forEach(item.meta.history, function(past) {\r\n\t                if (past.value !== history.value) {\r\n\t                    temp.push(past);\r\n\t                }\r\n\t            });\r\n\t            item.meta.history = temp;\r\n\t            return item;\r\n\t        }\r\n\r\n\t\t\t\t\tfunction itemRevisits(item, type) {\r\n\t\t\t\t\t\tvar anime = { count: 'reWatchCount', currentPart: 'episodes', finalPart: 'finalEpisode' },\r\n\t\t\t\t\t\t\t\tmanga = { count: 'reReadCount',  currentPart: 'chapters', finalPart: 'finalChapter' },\r\n\t\t\t\t\t\t\t\trepeating = type === 'anime' ? anime : manga,\r\n\t\t\t\t\t\t\t\tindex = ListService.findWithAttr(item.meta.revisits, 'value', item[repeating.count] + 1);\r\n\t\t\t\t\t\tif(index === -1) {\r\n\t\t\t\t\t\t\titem.meta.revisits.push({\r\n\t\t\t\t\t\t\t\tid: item.id,\r\n\t\t\t\t\t\t\t\ttitle: item.title,\r\n\t\t\t\t\t\t\t\tvalue: item[repeating.count] + 1,\r\n\t\t\t\t\t\t\t\trating: 0,\r\n\t\t\t\t\t\t\t\tstart: item.latest,\r\n\t\t\t\t\t\t\t\tend: item[repeating.currentPart] === item[repeating.finalPart] ? item.latest : null\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else if(index > -1 && item[repeating.currentPart] === item[repeating.finalPart]) {\r\n\t\t\t\t\t\t\titem.meta.revisits[index].end = item.latest;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\r\n\t        //function to display relative time - using latest or updated date.\r\n\t        function latestDate(latest, updated) {\r\n\t            //latest date display format.\r\n\t//          console.log(latest, updated);\r\n\t            var today = moment(new Date()), displayDate, diff;\r\n\r\n\t            if (moment(latest).toISOString().substring(0,10)===moment(updated).toISOString().substring(0,10)) {\r\n\t                 displayDate = moment(updated);\r\n\t                 diff = displayDate.fromNow();\r\n\r\n\t                if (diff==='a day ago') {\r\n\t                    return 'Yesterday at ' + displayDate.format('HH:mm');\r\n\t                } else if (diff.indexOf('days') > -1) {\r\n\t                    return diff + ' at ' + displayDate.format('HH:mm');\r\n\t                } else {\r\n\t                    return diff + '.';\r\n\t                }\r\n\t            } else {\r\n\t                 displayDate = moment(latest);\r\n\t                 diff = today.diff(displayDate, 'days');\r\n\r\n\t                //for 0 and 1 day(s) ago use the special term.\r\n\t                if (diff===0) {\r\n\t                    return 'Today';\r\n\t                } else if (diff===1) {\r\n\t                    return 'Yesterday';\r\n\t                } else {\r\n\t                    return diff + ' days ago.';\r\n\t                }\r\n\t            }\r\n\t        }\r\n\r\n\t        //build statistics item overview details.\r\n\t        function buildOverview(items) {\r\n\t            var overview = {\r\n\t                ongoing: $filter('filter')(items, {status: false }).length,\r\n\t                completed: $filter('filter')(items, {status: true }).length\r\n\t            };\r\n\t//            console.log('overview ' , overview);\r\n\t            return overview;\r\n\t        }\r\n\r\n\t        //calculate which month has the most anime completed in it.\r\n\t        function maxCompleteMonth(items) {\r\n\t            var modeMap = {}, maxCount = 0;\r\n\t            for(var i = 0; i < items.length; i++) {\r\n\t                if (items[i].end!==undefined && items[i].end!==null) {\r\n\t                    var end = items[i].end.substring(0,7);\r\n\t                    if(modeMap[end] === null || modeMap[end] === undefined) {\r\n\t                        modeMap[end] = 1;\r\n\t                    } else {\r\n\t                        modeMap[end]++;\r\n\t                    }\r\n\t                    if(modeMap[end] > maxCount) {\r\n\t                        maxCount = modeMap[end];\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            return maxCount;\r\n\t        }\r\n\r\n\t        //calculate the rating values - max rated count and average rating.\r\n\t        function getRatingValues(items) {\r\n\t            var tempRating = 0,\r\n\t                maxRatedCount = 0,\r\n\t                averageRating = 0;\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.rating !== 0) {\r\n\t                    tempRating += item.rating;\r\n\t                    maxRatedCount++;\r\n\t                }\r\n\t            });\r\n\t            averageRating = tempRating / maxRatedCount;\r\n\t            var values = {\r\n\t                maxRatedCount: maxRatedCount,\r\n\t                averageRating: averageRating\r\n\t            };\r\n\t//            console.log('values', values);\r\n\t            return values;\r\n\t        }\r\n\r\n\t        //calculate which month has the most anime completed in it.\r\n\t        function maxTagCount(items) {\r\n\t            var modeMap = {}, maxCount = 0;\r\n\t            angular.forEach(items, function(item) {\r\n\t                angular.forEach(item.tags, function(tag) {\r\n\t                    var text = tag.text;\r\n\t                    if(modeMap[text] === null || modeMap[text] === undefined) {\r\n\t                        modeMap[text] = 1;\r\n\t                    } else {\r\n\t                        modeMap[text]++;\r\n\t                    }\r\n\t                    if(modeMap[text] > maxCount) {\r\n\t                        maxCount = modeMap[text];\r\n\t                    }\r\n\t                });\r\n\t            });\r\n\t            return maxCount;\r\n\t        }\r\n\r\n\t        //build stat tags including counts, averages etc.\r\n\t        function buildStatTags(items, averageItemRating) {\r\n\t            var add = true, statTags = [], checkedRating, maxTagCount = obj.maxTagCount(items), itemCount = items.length;\r\n\t            //is tag in array?\r\n\t            angular.forEach(items, function(item) {\r\n\t                angular.forEach(item.tags, function(tag) {\r\n\t                    for(var i=0, len = statTags.length; i < len; i++) {\r\n\t                        if (statTags[i].tag===tag.text) {\r\n\t                            add = false;\r\n\t                            statTags[i].count += 1;\r\n\t                            statTags[i].ratedCount += item.rating === 0 ? 0 : 1;\r\n\t                            statTags[i].ratings.push(item.rating);\r\n\t                            statTags[i].ratingAdded += item.rating;\r\n\t                            statTags[i].ratingAvg = statTags[i].ratingAdded === 0 ? 0 : statTags[i].ratingAdded / statTags[i].ratedCount;\r\n\t                            statTags[i].ratingWeighted = obj.ratingsWeighted(statTags[i].ratings);\r\n\t                        }\r\n\t                    }\r\n\t                    // add if not in\r\n\t                    if (add===true) {\r\n\t                        checkedRating = item.rating === 0 ? 0 : 1;\r\n\t                        statTags.push({ tag: tag.text, count: 1, ratedCount: checkedRating, ratings: [item.rating], ratingAdded: item.rating, ratingAvg: item.rating, ratingWeighted: 0 });\r\n\t                    }\r\n\t                    add = true; //reset add status.\r\n\t                });\r\n\t//                    console.log(statTags);\r\n\t            });\r\n\t            return statTags;\r\n\t        }\r\n\r\n\t        //function to calculate the weighted mean ratings for the genre tags.\r\n\t        function ratingsWeighted(ratings) {\r\n\t            var values = [], weights = [], unratedCount = 0, total = 0, count = 0;\r\n\t            /**\r\n\t             *  create array (weights) with key(rating).\r\n\t             */\r\n\t            for (var i=0, len = ratings.length; i < len; i++) {\r\n\t                if (ratings[i] in values) {\r\n\t                    weights[ratings[i]]++;\r\n\t                } else {\r\n\t                    values.push(ratings[i]);\r\n\t                    weights[ratings[i]] = 1;\r\n\t                }\r\n\t            }\r\n\t            /**\r\n\t             *  using the key(rating) multiply by the value(weight).\r\n\t             *  calculated weighted total and count.\r\n\t             */\r\n\t            for (var k in weights){\r\n\t                if (typeof weights[k] !== 'function') {\r\n\t                    if (!isNaN(weights[k])) {\r\n\t                        total += k * weights[k];\r\n\t                        count += weights[k];\r\n\t                    }\r\n\t                }\r\n\t                if (k === 0) {\r\n\t                    unratedCount = weights[k];\r\n\t                }\r\n\t            }\r\n\t\t\t\t\t\t\t/* Weighted average.\r\n\t\t\t\t\t\t\t * total = (nth_rating_value * number_of_that_value + ...)\r\n\t\t\t\t\t\t\t * count = number of ratings.\r\n\t\t\t\t\t\t\t */\r\n\t            return total / count;\r\n\t        }\r\n\r\n\t        //builds counts for number of items given for each rating.\r\n\t        function buildRatingsDistribution(items) {\r\n\t            var maxCount = items.length, possibleValues = [10,9,8,7,6,5,4,3,2,1,0], ratingsDistribution = [], i = possibleValues.length;\r\n\t            while(i--) {\r\n\t                var count = $filter('filter')(items, { rating: i }, true).length;\r\n\t                ratingsDistribution.push({ number: i === 0 ? '-' : i,\r\n\t                                           text: i === 0 ? count + ' entries unrated.' : count + ' entries rated ' + i,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t colour: i > 6 \t\t ? '#449d44' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t 7 > i && i > 3 ? '#31b0d5' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t i !== 0 ? '#c9302c' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t\t '#000000',\r\n\t                                           count: count,\r\n\t                                           percentage: ((count / maxCount) * 100).toFixed(2)\r\n\t                                         });\r\n\t            }\r\n\t//            console.log('RD: ', ratingsDistribution);\r\n\t            return ratingsDistribution;\r\n\t        }\r\n\r\n\t        // 'sub-function' of the completeBy... functions.\r\n\t        function endingYears(items) {\r\n\t            var years = [],\r\n\t\t\t\t\t\t\t\t\titemYears = $filter('unique')(items, 'end.substring(0,4)'); //get unqiue years as items.\r\n\t            \t\titemYears = $filter('orderBy')(itemYears, '-end.substring(0,4)'); //order desc.\r\n\t\t\t\t\t\t\tangular.forEach(itemYears, function(item) {\r\n\t\t\t\t\t\t\t\tif(item.end !== undefined && item.end !== null) {\r\n\t\t\t\t\t\t\t\t\tyears.push({ year: item.end.substring(0,4) });\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t            return years;\r\n\t        }\r\n\r\n\t        //complete by month stats\r\n\t        function completeByMonth(items) {\r\n\t            var monthDetails = {}, completeByMonthItems = [], maxCompleteMonth = 0, itemYears = obj.endingYears(items), i = itemYears.length;\r\n\t            //build comlpeteByMonths object.\r\n\t            while(i--) {\r\n\t                //chuck the null end date. push the year part of the other end dates with months array.\r\n\t                if (itemYears[i].year !== undefined && itemYears[i].year !== null) {\r\n\t                    completeByMonthItems.push({ year: itemYears[i].year,\r\n\t                                          months: [\r\n\t                                                    { number: '01', text: 'January', count: $filter('endedMonth')(items, itemYears[i].year, '01').length  },\r\n\t                                                    { number: '02', text: 'February', count: $filter('endedMonth')(items, itemYears[i].year, '02').length },\r\n\t                                                    { number: '03', text: 'March', count: $filter('endedMonth')(items, itemYears[i].year, '03').length },\r\n\t                                                    { number: '04', text: 'April', count: $filter('endedMonth')(items, itemYears[i].year, '04').length },\r\n\t                                                    { number: '05', text: 'May', count: $filter('endedMonth')(items, itemYears[i].year, '05').length },\r\n\t                                                    { number: '06', text: 'June', count: $filter('endedMonth')(items, itemYears[i].year, '06').length },\r\n\t                                                    { number: '07', text: 'July', count: $filter('endedMonth')(items, itemYears[i].year, '07').length },\r\n\t                                                    { number: '08', text: 'August', count: $filter('endedMonth')(items, itemYears[i].year, '08').length },\r\n\t                                                    { number: '09', text: 'September', count: $filter('endedMonth')(items, itemYears[i].year, '09').length },\r\n\t                                                    { number: '10', text: 'October', count: $filter('endedMonth')(items, itemYears[i].year, '10').length },\r\n\t                                                    { number: '11', text: 'November', count: $filter('endedMonth')(items, itemYears[i].year, '11').length },\r\n\t                                                    { number: '12', text: 'December', count: $filter('endedMonth')(items, itemYears[i].year, '12').length }\r\n\t                                          ]\r\n\t                                         });\r\n\t                }\r\n\t            }\r\n\t            maxCompleteMonth = obj.maxCompleteMonth(items);\r\n\t            monthDetails = { months: completeByMonthItems, max: maxCompleteMonth };\r\n\r\n\t//            console.log('completeByMonthItems', completeByMonthItems);\r\n\t            return monthDetails;\r\n\t        }\r\n\r\n\t        //complete by season stats.\r\n\t        function completeBySeason(items) {\r\n\t            var seasonDetails = {}, completeBySeasonItems = [], maxCompleteSeason = 0, itemYears = obj.endingYears(items), i = itemYears.length;\r\n\t            //build completeBySeasonItems object.\r\n\t            while(i--) {\r\n\t                //chuck the null end date. push the year part of the other end dates with seasons array.\r\n\t                if (itemYears[i].year !== undefined && itemYears[i].year !== null) {\r\n\t                    completeBySeasonItems.push({ year: itemYears[i].year,\r\n\t                                            seasons: [\r\n\t                                                        { number: '03', text: 'Winter', count: $filter('season')(items, itemYears[i].year, 'Winter').length },\r\n\t                                                        { number: '06', text: 'Spring', count: $filter('season')(items, itemYears[i].year, 'Spring').length },\r\n\t                                                        { number: '09', text: 'Summer', count: $filter('season')(items, itemYears[i].year, 'Summer').length },\r\n\t                                                        { number: '12', text: 'Fall', count: $filter('season')(items, itemYears[i].year, 'Fall').length }\r\n\t                                            ]\r\n\t                                          });\r\n\t                }\r\n\t            }\r\n\t            //find maximum complete in a season.\r\n\t            angular.forEach(completeBySeasonItems, function(item) {\r\n\t                var i = item.seasons.length;\r\n\t                while(i--) {\r\n\t                    if (item.seasons[i].count > maxCompleteSeason) {\r\n\t                        maxCompleteSeason = item.seasons[i].count;\r\n\t                    }\r\n\t                }\r\n\t            });\r\n\t            seasonDetails = { seasons: completeBySeasonItems, max: maxCompleteSeason };\r\n\t//            console.log('completeBySeasonItems', seasonDetails);\r\n\t            return seasonDetails;\r\n\t        }\r\n\r\n\t        //Temporary function to generate the season data for pre-exisiting items in db.\r\n\t        function setSeason(items, year, season) {\r\n\t            var array = $filter('endedSeason')(items, year, season);\r\n\t            angular.forEach(array, function(item) {\r\n\t                console.log(item.title);\r\n\t                item.season = obj.convertDateToSeason(new Date(item.start));\r\n\t            });\r\n\t            return array;\r\n\t        }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('ListService', ListService);\r\n\tListService.$inject = ['moment', '$q'];\r\n\r\n\tfunction ListService(moment, $q) {\r\n\t\tvar service = {\r\n\t\t\tcheckForTagless: checkForTagless,\r\n\t\t\tconcatenateTagArrays: concatenateTagArrays,\r\n\t\t\tfindWithAttr: findWithAttr,\r\n\t\t\tgetCommonArrays: getCommonArrays,\r\n\t\t\tgetSelectListOptions: getSelectListOptions,\r\n\t\t\tgroupItemsByProperties: groupItemsByProperties,\r\n\t\t\tmanipulateString: manipulateString,\r\n\t\t\tnumberOfPages: numberOfPages,\r\n\t\t\tstringReverse: stringReverse,\r\n\t\t\tweekEndingForDate: weekEndingForDate\r\n\t\t};\r\n\t\treturn service;\r\n\r\n\t        function stringReverse(string) {\r\n\t            return string.split('').reverse().join('');\r\n\t        }\r\n\r\n\t        //get number of pages for list.\r\n\t        function numberOfPages(showingCount, pageSize, currentPage) {\r\n\t            var pageCount = Math.ceil(showingCount/pageSize);\r\n\t            //reset number of pages to be the final page if the number of pages\r\n\t            //becomes less than the one you are on.\r\n\t            if (currentPage + 1 >= pageCount && pageCount !== 0) {\r\n\t                currentPage = pageCount-1;\r\n\t            }\r\n\t            if (pageCount!==0 && currentPage < 0) {\r\n\t                currentPage = 0;\r\n\t            }\r\n\t            var pagingDetails = { currentPage: currentPage, pageCount: pageCount };\r\n\t            return pagingDetails;\r\n\t        }\r\n\r\n\t        //find index of object with given attr.\r\n\t        function findWithAttr(array, attr, value) {\r\n\t            if (array !== undefined) {\r\n\t                for(var i = 0; i < array.length; i += 1) {\r\n\t                    if(array[i][attr] === value) {\r\n\t                        return i;\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            return -1;\r\n\t        }\r\n\r\n\t\t\t\t\t/** Splitting array into multiple arrays by grouping by attributes.\r\n\t\t\t\t\t */\r\n\t\t\t\t\t function groupItemsByProperties(array, groupProperties) {\r\n\t\t\t\t\t\t return $q(function (resolve, reject) {\r\n\t\t\t\t\t\t\t\t var groupedArrays = groupBy(array, function (item) {\r\n\t\t\t\t\t\t\t\t\t\t return getGroupProperties(item, groupProperties);\r\n\t\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t\t resolve(groupedArrays);\r\n\t\t\t\t\t\t });\r\n\t\t\t\t\t }\r\n\t\t\t\t\t //Retrieve the item values for grouping by\r\n\t\t\t\t\t function getGroupProperties(item, groups) {\r\n\t\t\t\t\t\t\t var array = [];\r\n\t\t\t\t\t\t\t angular.forEach(groups, function (group) {\r\n\t\t\t\t\t\t\t\t\t array.push(item[group]);\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t return array;\r\n\t\t\t\t\t }\r\n\t\t\t\t\t //Group the items into arrays using the values.\r\n\t\t\t\t\t function groupBy(array, f) {\r\n\t\t\t\t\t\t\t var groups = {};\r\n\t\t\t\t\t\t\t array.forEach(function (o) {\r\n\t\t\t\t\t\t\t\t\t var group = JSON.stringify(f(o));\r\n\t\t\t\t\t\t\t\t\t groups[group] = groups[group] || [];\r\n\t\t\t\t\t\t\t\t\t groups[group].push(o);\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t return Object.keys(groups).map(function (group) {\r\n\t\t\t\t\t\t\t\t\t return groups[group];\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t }\r\n\r\n\t        function manipulateString(string, transform, onlyFirst) {\r\n\t            switch(transform.toLowerCase()) {\r\n\t                case 'lower':\r\n\t                    if (onlyFirst)  return string.charAt(0).toLowerCase() + string.slice(1);\r\n\t                    if (!onlyFirst) return string.toLowerCase();\r\n\t                    break;\r\n\t                case 'upper':\r\n\t                    if (onlyFirst) return string.charAt(0).toUpperCase() + string.slice(1);\r\n\t                    if (!onlyFirst) return string.toUpperCase();\r\n\t                    break;\r\n\t                default:\r\n\t                    return string.toLowerCase();\r\n\t            }\r\n\t        }\r\n\r\n\t\t\t\t\tfunction weekEndingForDate(convertToSunday) {\r\n\t\t\t        var date = new Date(convertToSunday),\r\n\t\t\t            day = date.getDay(),\r\n\t\t\t            diff = date.getDate() - day + (day === 0 ? 0:7),\r\n\t\t\t            temp = new Date(convertToSunday),\r\n\t\t\t            wkEnd = new Date(temp.setDate(diff));\r\n\t\t\t        return moment(wkEnd.toISOString()).endOf('day');\r\n\t\t\t    }\r\n\r\n\t        //returns the options for the various filters in list pages.\r\n\t        function getSelectListOptions(controller) {\r\n\t            var selectListOptions = {};\r\n\t            if (controller !== 'character' && controller !== 'topten') {\r\n\t                selectListOptions.status = [ { v: '', n: 'All' }, { v: false, n: 'Ongoing' }, { v: true, n: 'Completed' } ];\r\n\t                selectListOptions.searchName = 'title';\r\n\t                if (controller === 'animeitem' || controller === 'watch') {\r\n\t                    selectListOptions.onHold = [ { v: '', n: 'All' }, { v: false, n: 'Ongoing' }, { v: true, n: 'On Hold' } ];\r\n\t                    selectListOptions.sortOptions = [ { v: 'title', n: 'Title' },{ v: 'episodes', n: 'Episodes' },{ v: 'start', n: 'Start date' },\r\n\t                                                      { v: 'end', n: 'End date' },{ v: ['latest', 'meta.updated'], n: 'Latest' },{ v: 'rating', n: 'Rating' }\r\n\t                                                    ];\r\n\t                    selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Latest');\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: false, n: 'Online' }, { v: true, n: 'Disc' } ];\r\n\t                    selectListOptions.mediaType = 'disc';\r\n\t                    selectListOptions.repeating = [ { v: '', n: 'All' }, { v: false, n: 'Not Re-watching' }, { v: true, n: 'Re-watching' } ];\r\n\t                    selectListOptions.repeatType = 'reWatching';\r\n\t                } else if (controller === 'mangaitem') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'title', n: 'Title' },{ v: 'chapters', n: 'Chapters' },{ v: 'volumes', n: 'Volumes' },{ v: 'start', n: 'Start date' },\r\n\t                                                      { v: 'end', n: 'End date' },{ v: ['latest', 'meta.updated'], n: 'Latest' },{ v: 'rating', n: 'Rating' }\r\n\t                                                    ];\r\n\t                    selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Latest');\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: false, n: 'Online' }, { v: true, n: 'Hardcopy' } ];\r\n\t                    selectListOptions.mediaType = 'hardcopy';\r\n\t                    selectListOptions.repeating = [ { v: '', n: 'All' }, { v: false, n: 'Not Re-reading' }, { v: true, n: 'Re-reading' } ];\r\n\t                    selectListOptions.repeatType = 'reReading';\r\n\t                }\r\n\t            } else {\r\n\t                if (controller === 'character') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'name', n: 'Name' }, { v: 'anime.title', n: 'Anime' }, { v: 'manga.title', n: 'Manga' }, { v: 'voice', n: 'Voice' }  ];\r\n\t                    selectListOptions.media = [\r\n\t                        { v: '', n: '-- choose media type --' }, { v: 'none', n: 'None' }, { v: 'anime', n: 'Anime-only' }, { v: 'manga', n: 'Manga-only' }, { v: 'both', n: 'Both' }\r\n\t                    ];\r\n\t                } else if (controller === 'topten') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'name', n: 'Name' } ];\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: 'anime', n: 'Anime' }, { v: 'manga', n: 'Manga' }, { v: 'character', n: 'Character' } ];\r\n\t                    selectListOptions.mediaType = 'type';\r\n\t                }\r\n\t                selectListOptions.searchName = 'name';\r\n\t                selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Name');\r\n\t            }\r\n\t//            console.log(selectListOptions);\r\n\t            return selectListOptions;\r\n\t        }\r\n\r\n\t        function concatenateTagArrays(itemTags, tagArray) {\r\n\t            if (itemTags.length > 0) {\r\n\t                var i = 0, alreadyAdded = false;\r\n\t                while(i < tagArray.length) {\r\n\t                    for(var j = 0; j < itemTags.length; j++) {\r\n\t                        if (itemTags[j].text === tagArray[i].text) {\r\n\t                            alreadyAdded = true;\r\n\t                        }\r\n\t                    }\r\n\t                    //add if isn't already in the array.\r\n\t                    if (alreadyAdded === false) {\r\n\t                        itemTags.push(tagArray[i]);\r\n\t                    }\r\n\t                    i++;\r\n\t                    alreadyAdded = false;\r\n\t                }\r\n\t//                console.log(itemTags);\r\n\t                return itemTags;\r\n\t            } else {\r\n\t                //if there are no tags for item, then just return the new tags.\r\n\t                return tagArray;\r\n\t            }\r\n\t        }\r\n\r\n\t        //check to see if there are items with no tags.\r\n\t        function checkForTagless(items) {\r\n\t            var areTagless = false;\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.tags.length === 0) {\r\n\t                    areTagless = true;\r\n\t                }\r\n\t            });\r\n\t            return areTagless;\r\n\t        }\r\n\r\n\t        function getCommonArrays(controller) {\r\n\t            var commonArrays = {},\r\n\t                itemTypes = [\r\n\t                    { name: 'anime' },\r\n\t                    { name: 'manga' },\r\n\t                    { name: 'character' }\r\n\t                ],\r\n\t                seasons = [\r\n\t                    { number: '03', text: 'Winter' },\r\n\t                    { number: '06', text: 'Spring' },\r\n\t                    { number: '09', text: 'Summer' },\r\n\t                    { number: '12', text: 'Fall' }\r\n\t                ],\r\n\t                months = [\r\n\t                    { number: '01', text: 'January' },\r\n\t                    { number: '02', text: 'February' },\r\n\t                    { number: '03', text: 'March' },\r\n\t                    { number: '04', text: 'April' },\r\n\t                    { number: '05', text: 'May' },\r\n\t                    { number: '06', text: 'June' },\r\n\t                    { number: '07', text: 'July' },\r\n\t                    { number: '08', text: 'August' },\r\n\t                    { number: '09', text: 'September' },\r\n\t                    { number: '10', text: 'October' },\r\n\t                    { number: '11', text: 'November' },\r\n\t                    { number: '12', text: 'December' }\r\n\t                ],\r\n\t                categories = [\r\n\t                    {name: 'Watch'},\r\n\t                    {name: 'Read'},\r\n\t                    {name: 'Play'},\r\n\t                    {name: 'Other'}\r\n\t                ],\r\n\t                days = [\r\n\t                    {name: 'Any'},\r\n\t                    {name: 'Monday'},\r\n\t                    {name: 'Tuesday'},\r\n\t                    {name: 'Wednesday'},\r\n\t                    {name: 'Thursday'},\r\n\t                    {name: 'Friday'},\r\n\t                    {name: 'Saturday'},\r\n\t                    {name: 'Sunday'}\r\n\t                ],\r\n\t                summaryFunctions = [\r\n\t                    { name: 'Average' },\r\n\t                    { name: 'Highest' },\r\n\t                    { name: 'Lowest' },\r\n\t                    { name: 'Mode' }\r\n\t                ];\r\n\t            commonArrays = { months: months, seasons: seasons, categories: categories, days: days, summaryFunctions: summaryFunctions, itemTypes: itemTypes };\r\n\t            return commonArrays;\r\n\t        }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('WatchAnime', WatchAnime);\r\n\tWatchAnime.$inject = ['$resource'];\r\n\r\n\t\tfunction WatchAnime($resource) {\r\n\t\t\treturn $resource('animeitems/watch-list', { }, { update: { method: 'PUT' } });\r\n\t\t}\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('characters').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Characters', 'characters', 'dropdown', '/characters(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'characters', 'List Characters', 'characters');\r\n\t\tMenus.addSubMenuItem('topbar', 'characters', 'New Character', 'characters/create');\r\n\t}\r\n]);\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('characters').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Characters state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listCharacters', {\r\n\t\t\turl: '/characters',\r\n\t\t\ttemplateUrl: 'modules/characters/views/list-characters.client.view.html'\r\n\t\t}).\r\n\t\tstate('createCharacter', {\r\n\t\t\turl: '/characters/create',\r\n\t\t\ttemplateUrl: 'modules/characters/views/create-character.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewCharacter', {\r\n\t\t\turl: '/characters/:characterId',\r\n\t\t\ttemplateUrl: 'modules/characters/views/view-character.client.view.html'\r\n\t\t}).\r\n\t\tstate('editCharacter', {\r\n\t\t\turl: '/characters/:characterId/edit',\r\n\t\t\ttemplateUrl: 'modules/characters/views/edit-character.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.controller('CharactersController', CharactersController);\r\n\tCharactersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Characters', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ListService', 'CharacterService', 'NotificationFactory', 'spinnerService', 'TagService'];\r\n\r\n\tfunction CharactersController($scope, $stateParams, $location, Authentication, Characters, Animeitems, Mangaitems, fileUpload, $sce, $window, ListService, CharacterService, NotificationFactory, spinnerService, TagService) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.filterConfig = {\r\n\t\t\tisList: 'list', //show list? or slider.\r\n      showingCount: 0,\r\n      sortType: '',\r\n      sortReverse: false,\r\n      searchTags: '',\r\n      media: '',\r\n      seriesFilter: '',\r\n      tagsForFilter: [],\r\n      taglessItem: false,\r\n      areTagless: false,\r\n      selectListOptions: {},\r\n      statTags: [],\r\n      voiceActors: [],\r\n      series: []\r\n    };\r\n\t\tctrl.find = find;\r\n\t\tctrl.findAnime = findAnime;\r\n\t\tctrl.findManga = findManga;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.findOneAnime = findOneAnime;\r\n\t\tctrl.findOneManga = findOneManga;\r\n    ctrl.imgPath = ''; //image path\r\n\t\tctrl.maxItemCount = 0; //number of characters.\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.removeTag = removeTag;\r\n    ctrl.tagArray = []; // holding tags pre-submit\r\n    ctrl.tagArrayRemove = [];\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.whichController = 'character';\r\n\r\n\r\n\t\t//allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n    //For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for animeitem tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.mangaitem.tags, text);\r\n\t\t}\r\n\r\n\t\t// Create new Character\r\n\t\tfunction create() {\r\n\t    //console.log(ctrl.tagArray);\r\n\t    var character = new Characters();\r\n\t\t\t// Create new Character object\r\n\t\t\tcharacter = new Characters ({\r\n\t\t\t\tname: ctrl.name,\r\n      \timage: ctrl.imgPath,\r\n        anime: ctrl.anime!==undefined && ctrl.anime!==null ? ctrl.anime._id : ctrl.anime,\r\n        manga: ctrl.manga!==undefined && ctrl.manga!==null ? ctrl.manga._id : ctrl.manga,\r\n        voice: ctrl.voice,\r\n        tags: ctrl.tagArray,\r\n        user: ctrl.user\r\n\t\t\t});\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\tcharacter.$save(function(response) {\r\n\t\t\t\t$location.path('characters/' + response._id);\r\n        NotificationFactory.success('Saved!', 'Character was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n\t\t\t\tNotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Remove existing Character\r\n\t\tfunction remove(character) {\r\n      //are you sure option...\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( character ) {\r\n\t          character.$remove();\r\n\t          for (var i in ctrl.characters) {\r\n\t            if (ctrl.characters [i] === character) {\r\n\t                ctrl.characters.splice(i, 1);\r\n\t            }\r\n\t          }\r\n\t        } else {\r\n\t          ctrl.character.$remove(function() {\r\n\t\t\t\t\t\t\t$location.path('characters');\r\n\t          });\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Character was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Update existing Character\r\n\t\tfunction update() {\r\n\t\t\tvar character = ctrl.character;\r\n      //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n      if (ctrl.character.manga!==null && ctrl.character.manga!==undefined) {\r\n          character.manga = ctrl.character.manga._id;\r\n      }\r\n//            console.log(ctrl.character.anime);\r\n      if (ctrl.character.anime!==null && ctrl.character.anime!==undefined) {\r\n          character.anime = ctrl.character.anime._id;\r\n      }\r\n\r\n      if (ctrl.tagArray!==undefined) {\r\n          character.tags = ListService.concatenateTagArrays(character.tags, ctrl.tagArray);\r\n      }\r\n\r\n      if (ctrl.imgPath!==undefined && ctrl.imgPath!==null && ctrl.imgPath!=='') {\r\n          character.image = ctrl.imgPath;\r\n      }\r\n\r\n\t\t\tcharacter.$update(function() {\r\n\t\t\t\t$location.path('characters');\r\n\t\t\t\tNotificationFactory.success('Saved!', 'Character was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n        NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Find a list of Characters\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t\t\tspinnerService.loading('characters', Characters.query().$promise.then(function(result) {\r\n\t\t\t\tctrl.characters = result;\r\n\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\tctrl.filterConfig.statTags = CharacterService.buildCharacterTags(result);\r\n\t\t\t\tctrl.filterConfig.voiceActors = CharacterService.buildVoiceActors(result);\r\n\t\t\t\tctrl.filterConfig.series = CharacterService.buildSeriesList(result);\r\n\t\t\t\tconsole.log('find characters: ', ctrl.characters, ctrl.filterConfig);\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\t// Find existing Character\r\n\t\tfunction findOne() {\r\n\t\t\tctrl.character = Characters.get({\r\n\t\t\t\tcharacterId: $stateParams.characterId\r\n\t\t\t});\r\n\t\t}\r\n\r\n    // Find a list of Animeitems\r\n\t\tfunction findAnime() {\r\n\t\t\tctrl.animeitems = Animeitems.query();\r\n\t\t}\r\n\r\n    // Find existing Animeitem\r\n\t\tfunction findOneAnime(anime) {\r\n\t\t\tctrl.animeitem = Animeitems.get({\r\n\t\t\t\tanimeitemId: anime\r\n\t\t\t});\r\n\t\t}\r\n\r\n    // Find a list of Mangaitems\r\n\t\tfunction findManga() {\r\n\t\t\tctrl.mangaitems = Mangaitems.query();\r\n\t\t}\r\n\r\n    // Find existing Animeitem\r\n\t\tfunction findOneManga(manga) {\r\n\t\t\tctrl.mangaitem = Mangaitems.get({\r\n\t\t\t\tmangaitemId: manga\r\n\t\t\t});\r\n\t\t}\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/characters/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUploadCharacter');\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('characterBack', characterBack);\r\n\r\n   function characterBack(){\r\n      return function(scope, element, attrs){\r\n          var url = attrs.characterBack;\r\n          element.css({\r\n              'background-image': 'url(' + url +')',\r\n              'background-size' : 'cover',\r\n              'background-repeat': 'no-repeat',\r\n              'background-position': 'center'\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('clearTagValues', clearTagValues);\r\n\r\n  function clearTagValues() {\r\n      return function (scope, element, attrs) {\r\n          element.bind('click', function(event) {\r\n  //            console.log('clear tags');\r\n              scope.$apply(function() {\r\n                  scope.filterConfig.searchTags = '';\r\n                  scope.filterConfig.characterTags = '';\r\n                  scope.filterConfig.tagsForFilter = [];\r\n              });\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('deleteSearchTag', deleteSearchTag);\r\n\r\n  function deleteSearchTag() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function(scope, element, attrs) {\r\n              element.bind('click', function(event) {\r\n                  scope.$apply(function() {\r\n                      var tag = attrs.deleteSearchTag;\r\n                      var index = scope.filterConfig.tagsForFilter.indexOf(tag);\r\n  //                    console.log(tag, index);\r\n                      scope.filterConfig.searchTags = scope.filterConfig.searchTags.replace(tag + ',', '');\r\n                      scope.filterConfig.tagsForFilter.splice(index, 1);\r\n  //                    console.log(scope.searchTags, scope.tagsForFilter);\r\n                  });\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('disableNgAnimate', disableNgAnimate);\r\n  disableNgAnimate.$inject = ['$animate'];\r\n\r\n  function disableNgAnimate($animate) {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element) {\r\n        $animate.enabled(false, element);\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('dropTag', dropTag);\r\n  dropTag.$inject = ['NotificationFactory'];\r\n\r\n   function dropTag(NotificationFactory) {\r\n      return function(scope, element, attrs) {\r\n          element.bind('click', function(event) {\r\n              var text = attrs.dropTag;\r\n               //are you sure option...\r\n              NotificationFactory.confirmation(function() {\r\n                  scope.$apply(function() {\r\n                      var deletingItem = scope.tagArray;\r\n                      scope.$parent.tagArray = [];\r\n  //                    console.log('dropping tag - ', text);\r\n                      //update the complete task.\r\n                      angular.forEach(deletingItem, function(tag) {\r\n                          if (tag.text !== text) {\r\n                              scope.$parent.tagArray.push(tag);\r\n                          }\r\n                      });\r\n                  });\r\n                  NotificationFactory.warning('Dropped!', 'Tag was successfully dropped');\r\n              });\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('enterTag', enterTag);\r\n  function enterTag() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function (scope, element, attrs) {\r\n              element.bind('keydown keypress', function (event) {\r\n                  if(event.which === 13) {\r\n                      scope.$apply(function (){\r\n                          scope.$eval(attrs.enterTag);\r\n                      });\r\n                      event.preventDefault();\r\n                   }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('removeTag', removeTag);\r\n  removeTag.$inject = ['NotificationFactory'];\r\n\r\n   function removeTag(NotificationFactory) {\r\n      return {\r\n          restrict: 'A',\r\n          link: function(scope, element, attrs) {\r\n              element.bind('click', function(event) {\r\n                  var tag = attrs.removeTag,\r\n                      i,\r\n                      entry_type = scope.whichController;\r\n                  //are you sure option...\r\n                NotificationFactory.confirmation(function() {\r\n                      scope.$apply(function () {\r\n                          var index;\r\n                          if (entry_type === 'character') {\r\n                              for(i=0; i < scope.character.tags.length; i++) {\r\n                                  if (scope.character.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.character.tags.splice(index, 1);\r\n                          } else if (entry_type === 'animeitem') {\r\n                              for(i=0; i < scope.animeitem.tags.length; i++) {\r\n                                  if (scope.animeitem.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.animeitem.tags.splice(index, 1);\r\n                          } else if (entry_type === 'mangaitem') {\r\n                              for(i=0; i < scope.mangaitem.tags.length; i++) {\r\n                                  if (scope.mangaitem.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.mangaitem.tags.splice(index, 1);\r\n                          }\r\n  //                        console.log(index, tag);\r\n                      });\r\n                      NotificationFactory.warning('Deleted!', 'Tag was successfully deleted');\r\n                  });\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('slider', slider);\r\n  slider.$inject = ['$timeout', '$sce'];\r\n\r\n  function slider($timeout, $sce) {\r\n    return {\r\n        restrict: 'AE',\r\n        replace: true,\r\n        scope: {\r\n            slides: '=?',\r\n            interval: '=?',\r\n            filterConfig: '=?'\r\n        },\r\n        bindToController: true,\r\n        controllerAs: 'sliderController',\r\n        templateUrl: '/modules/characters/templates/slider.html',\r\n        controller: [\"$scope\", function($scope) {\r\n          var self = this,\r\n              timer,\r\n              autoSlide;\r\n          self.currentIndex = -1; //pre-first slide to stop 'cannot assign to undefined' error.\r\n          self.enter = enter;\r\n          self.goToSlide = goToSlide;\r\n          self.interval = self.interval === undefined ? 3000 : self.interval; //is there a custom interval?\r\n          self.isFullscreen = false;\r\n          self.leave = leave;\r\n          self.next = next;\r\n          self.prev = prev;\r\n          self.repeater = self.slides === undefined ? false : true; //is there a collection to iterate through?\r\n          self.toggleFullscreen = toggleFullscreen;\r\n          self.trustAsResourceUrl = trustAsResourceUrl;\r\n\r\n          //allow retreival of local resource\r\n          function trustAsResourceUrl(url) {\r\n              return $sce.trustAsResourceUrl(url);\r\n          }\r\n\r\n          //if no collection, make a dummy collection to cycle throught the children.\r\n          if (!self.repeater) {\r\n            self.slides = []; //used to allow cycling.\r\n            for(var i = 0; i < length; i++) {\r\n                self.slides.push({ index: i });\r\n            }\r\n          }\r\n          function goToSlide(slide) {\r\n  //              console.log('go to', slide);\r\n              if (self.currentIndex !== slide) {\r\n                  //reached end of slides?\r\n                  if (slide !== $scope.filteredSlides.length) {\r\n                    self.currentIndex = slide;\r\n                  } else {\r\n                    self.currentIndex = 0;\r\n                  }\r\n              } else {\r\n                  if ($scope.filteredSlides[self.currentIndex].locked) {\r\n                    //unlock, i.e start timer.\r\n                    $scope.filteredSlides[self.currentIndex].locked = false;\r\n                      autoSlide();\r\n                  } else {\r\n                    //lock, i.e. cancel timer.\r\n                    $scope.filteredSlides[self.currentIndex].locked = true;\r\n                    $timeout.cancel(timer);\r\n                  }\r\n              }\r\n          }\r\n\r\n          function next() {\r\n              if (self.currentIndex < $scope.filteredSlides.length - 1) {\r\n                  self.currentIndex += 1;\r\n\r\n              } else {\r\n                  self.currentIndex = 0;\r\n              }\r\n          }\r\n\r\n          function prev() {\r\n              if (self.currentIndex > 0) {\r\n                  self.currentIndex -= 1;\r\n              } else {\r\n                  self.currentIndex = $scope.filteredSlides.length - 1;\r\n              }\r\n          }\r\n\r\n          $scope.$watch('sliderController.currentIndex', function() {\r\n              //  console.log('index', self.currentIndex, 'filtered slides ', $scope.filteredSlides);\r\n              if (self.currentIndex > -1 && $scope.filteredSlides.length > 0) {\r\n                    $scope.filteredSlides.forEach(function(slide) {\r\n                        slide.visible = false; // make every slide invisible\r\n                        slide.locked = false; // make every slide unlocked\r\n                    });\r\n                    $scope.filteredSlides[self.currentIndex].visible = true; // make the current slide visible\r\n              }\r\n          });\r\n\r\n          autoSlide = function() {\r\n              timer = $timeout(function() {\r\n                  self.next();\r\n                  timer = $timeout(autoSlide, self.interval);\r\n              }, self.interval);\r\n          };\r\n          autoSlide();\r\n          $scope.$on('$destroy', function() {\r\n              $timeout.cancel(timer); // when the scope is destroyed, cancel the timer\r\n          });\r\n\r\n          //Stop timer on enter.\r\n          function enter() {\r\n  //              console.log('entered');\r\n              if ($scope.filteredSlides[self.currentIndex].locked !== true) {\r\n                $timeout.cancel(timer);\r\n  //                  console.log('cancelled');\r\n              }\r\n          }\r\n          //Restart timer on leave.\r\n          function leave() {\r\n  //              console.log('left');\r\n              if ($scope.filteredSlides[self.currentIndex].locked !== true) {\r\n                timer = $timeout(autoSlide, self.interval);\r\n  //                  console.log('restarted');\r\n              }\r\n          }\r\n\r\n          //Fullscreen capability\r\n          function toggleFullscreen() {\r\n              self.isFullscreen = !self.isFullscreen;\r\n          }\r\n\r\n        }],\r\n        link: function(scope, elem, attrs, sliderController) {\r\n            scope.childElementCount = elem[0].childElementCount - 1;\r\n        }\r\n    };\r\n\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('mediaFilter', mediaFilter);\r\n\r\n  function mediaFilter() {\r\n      return function(array, media) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  if (media==='anime') {\r\n                      if (item.anime!==null && item.manga===null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='manga') {\r\n                      if (item.manga!==null && item.anime===null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='both') {\r\n                      if (item.anime!==null && item.manga!==null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='none') {\r\n                      if (item.anime===null && item.manga===null) {\r\n                          return true;\r\n                      }\r\n                  } else {\r\n                      return true;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('seriesDetailFilter', seriesDetailFilter);\r\n\r\n  function seriesDetailFilter() {\r\n    return function(array, detailSeriesName) {\r\n        if (array !== undefined) {\r\n            return array.filter(function(item) {\r\n                if (detailSeriesName !== '') {\r\n                    //filter stat series detail.\r\n                    if (item.anime!==null && item.anime!==undefined) {\r\n                        if (item.anime.title===detailSeriesName) {\r\n                            return item;\r\n                        }\r\n                    } else if (item.manga!==null && item.manga!==undefined) {\r\n                        if (item.manga.title===detailSeriesName) {\r\n                            return item;\r\n                        }\r\n                    }\r\n                } else {\r\n                    return item;\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('seriesFilter', seriesFilter);\r\n\r\n  function seriesFilter() {\r\n      return function(array, series) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  if (series !== '' && series !== undefined) {\r\n                      //filter stat series detail.\r\n                      if (item.anime!==null && item.anime!==undefined) {\r\n                          return item.anime.title.toLowerCase().indexOf(series.toLowerCase()) > -1;\r\n                      } else if (item.manga!==null && item.manga!==undefined) {\r\n                          return item.manga.title.toLowerCase().indexOf(series.toLowerCase()) > -1;\r\n                      }\r\n                  } else {\r\n                      return item;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('tagFilter', tagFilter);\r\n\r\n  function tagFilter() {\r\n      return function(array, searchTags, taglessItem) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  //special tag filter\r\n                  var found = false;\r\n                  var i = 0;\r\n                  var tagsToSearch = [];\r\n                  var tagsForFilter;\r\n\r\n                  //if tagless is checked return tagless and nothing else.\r\n                  if (taglessItem===true) {\r\n                      if (item.tags.length===0) {\r\n                          return item;\r\n                      }\r\n                  } else {\r\n                      if (searchTags===undefined || searchTags==='') {\r\n                          return true;\r\n                      } else {\r\n                          //get tags that are being looked for\r\n                          tagsForFilter = searchTags.substring(0, searchTags.length - 1).split(',');\r\n                          //console.log(tagsForFilter);\r\n\r\n                          //get tags of items to filter\r\n                          angular.forEach(item.tags, function(tag) {\r\n                              tagsToSearch.push(tag.text);\r\n                          });\r\n\r\n                          //filter: check in 'query' is in tags.\r\n                          for(i = 0; i < tagsForFilter.length; i++) {\r\n                              if (tagsToSearch.indexOf(tagsForFilter[i]) !== -1) {\r\n                                  found = true;\r\n                              } else {\r\n                                  return false;\r\n                              }\r\n                          }\r\n                          return found;\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.service('CharacterService', CharacterService);\r\n\tCharacterService.$inject = ['$q'];\r\n\r\n\tfunction CharacterService($q) {\r\n\r\n\t    //build the character gender distribution.\r\n\t    this.buildGenderDistribution = function(items, maxCount) {\r\n\t        return $q(function(resolve, reject) {\r\n\t            var check, gender = [];\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.tag === 'male') {\r\n\t                    gender.push({\r\n\t                        type: 'male',\r\n\t                        count: item.count,\r\n\t                        percentage: Number(((item.count / maxCount) * 100).toFixed(2)),\r\n\t                        text: '% male.'\r\n\t                    });\r\n\t                } else if (item.tag === 'female') {\r\n\t                    gender.push({\r\n\t                        type: 'female',\r\n\t                        count: item.count,\r\n\t                        percentage: Number(((item.count / maxCount) * 100).toFixed(2)),\r\n\t                        text: '% female.'\r\n\t                    });\r\n\t                }\r\n\t            });\r\n\t            gender.push({\r\n\t                type: 'unassigned',\r\n\t                count: maxCount - gender[0].count - gender[1].count,\r\n\t                percentage: Number(((maxCount - gender[0].count - gender[1].count / maxCount) * 100).toFixed(2)),\r\n\t                text: '% unassigned.'\r\n\t            });\r\n\r\n\t            //Fudge any rounding errors.\r\n\t            check = gender[0].percentage + gender[1].percentage + gender[2].percentage;\r\n\t            if (check > 100) {\r\n\t                gender[2].percentage -= (check - 100).toFixed(2);\r\n\t            } else if (check < 100) {\r\n\t                gender[2].percentage += (100 - check).toFixed(2);\r\n\t            }\r\n\t            resolve(gender);\r\n\t        });\r\n\t    };\r\n\r\n\t    this.buildCharacterTags = function(items) {\r\n\t        var add = true, statTags = [];\r\n\t        //is tag in array?\r\n\t        angular.forEach(items, function(item) {\r\n\t            angular.forEach(item.tags, function(tag) {\r\n\t                for(var i=0; i < statTags.length; i++) {\r\n\t                    if (statTags[i].tag === tag.text) {\r\n\t                        add = false;\r\n\t                        statTags[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t                // add if not in\r\n\t                if (add===true) {\r\n\t                    statTags.push({ tag: tag.text, count: 1 });\r\n\t                }\r\n\t                add = true; //reset add status.\r\n\t            });\r\n\t//          console.log($scope.statTags);\r\n\t        });\r\n\r\n\t        return statTags;\r\n\t    };\r\n\r\n\t    this.buildRelatedCharacterTags = function(items, name) {\r\n\t        var add = true, tagDetailCollection = [], tagDetailResult = [];\r\n\t        //get all character tag arrays that contain the chosen tag into a collection.\r\n\t        angular.forEach(items, function(item){\r\n\t            for(var i=0; i < item.tags.length; i++) {\r\n\t                if (item.tags[i].text === name) {\r\n\t                    tagDetailCollection.push(item.tags);\r\n\t                }\r\n\t            }\r\n\t        });\r\n\t//        console.log(tagDetailCollection);\r\n\t        angular.forEach(tagDetailCollection, function(item) {\r\n\t            angular.forEach(item, function(bit) {\r\n\t//              console.log(bit);\r\n\t                for(var i=0; i < tagDetailResult.length; i++) {\r\n\t                    //if exists and not the search value - increment the count.\r\n\t                    if (tagDetailResult[i].name===bit.text && bit.text!==name) {\r\n\t                        add = false;\r\n\t                        tagDetailResult[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t                //add if true and not the tag we searched on.\r\n\t                if (add===true && bit.text!==name) {\r\n\t                    tagDetailResult.push({ name: bit.text, count: 1 });\r\n\t                }\r\n\t                add = true;\r\n\t            });\r\n\t        });\r\n\t//        console.log(tagDetailResult);\r\n\t        return tagDetailResult;\r\n\t    };\r\n\r\n\t    this.buildVoiceActors = function(items) {\r\n\t        var add = true, voiceActors = [];\r\n\t        //is voice actor in array?\r\n\t        angular.forEach(items, function(item) {\r\n\t            for(var i=0; i < voiceActors.length; i++) {\r\n\t                if (voiceActors[i].name === item.voice) {\r\n\t                    add = false;\r\n\t                    voiceActors[i].count += 1;\r\n\t                }\r\n\t            }\r\n\t            // add if not in\r\n\t            if (add===true) {\r\n\t                voiceActors.push({ name: item.voice, count: 1 });\r\n\t            }\r\n\t            add = true; //reset add status.\r\n\t        });\r\n\r\n\t        return voiceActors;\r\n\t    };\r\n\r\n\t    this.buildSeriesList = function(items) {\r\n\t        var add = true, statSeries = [];\r\n\t        //get series counts.\r\n\t        angular.forEach(items, function(item) {\r\n\t            for(var i=0; i < statSeries.length; i++) {\r\n\t                if (item.anime) {\r\n\t                    if (statSeries[i].name === item.anime.title) {\r\n\t                        add = false;\r\n\t                        statSeries[i].count += 1;\r\n\t                    }\r\n\t                } else if (item.manga) {\r\n\t                    if (statSeries[i].name === item.manga.title) {\r\n\t                        add = false;\r\n\t                        statSeries[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            // add if not in\r\n\t            if (add === true) {\r\n\t                if (typeof(item.anime) === 'object' && item.anime !== null) {\r\n\t                    statSeries.push({ _id: item.anime._id, name: item.anime.title, count: 1 });\r\n\t                } else if (typeof(item.manga) === 'object' && item.manga !== null) {\r\n\t                    statSeries.push({ _id: item.manga._id, name: item.manga.title, count: 1 });\r\n\t                }\r\n\t            }\r\n\t            add = true; //reset add status.\r\n\t        });\r\n\r\n\t        return statSeries;\r\n\t    };\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.factory('Characters', CharacterFactory);\r\n\t CharacterFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction CharacterFactory($resource) {\r\n\t\t\treturn $resource('characters/:characterId', { characterId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.service('TagService', TagService);\r\n\tTagService.$inject = ['$rootScope', 'NotificationFactory'];\r\n\r\n\t function TagService($rootScope, NotificationFactory) {\r\n\t\t\tvar service = {};\r\n\r\n\t\t\t//Add newTag to tagArray\r\n\t\t\tservice.addTag = function(tagArray, newTag) {\r\n\t\t\t    if (newTag!=='' && newTag!==undefined) {\r\n\t\t\t        var i = 0, alreadyAdded = false;\r\n\t\t\t        if (tagArray.length > 0) {\r\n\t\t\t            while(i < tagArray.length) {\r\n\t\t\t                if (tagArray[i].text === newTag) {\r\n\t\t\t                    alreadyAdded = true;\r\n\t\t\t                }\r\n\t\t\t                i++;\r\n\t\t\t            }\r\n\t\t\t            //if not in array add it.\r\n\t\t\t            if (alreadyAdded === false) {\r\n\t\t\t                tagArray.push({ text: newTag });\r\n\t\t\t            }\r\n\t\t\t        } else {\r\n\t\t\t            tagArray.push({ text: newTag });\r\n\t\t\t        }\r\n\t\t\t    }\r\n\t\t\t};\r\n\r\n\t\t\t//Drop tag with text = text, from tagArray\r\n\t\t\tservice.dropTag = function(tagArray, text) {\r\n\t\t\t\t //are you sure option...\r\n\t\t\t\tNotificationFactory.confirmation(function() {\r\n\t\t\t\t\t$rootScope.$apply(function() {\r\n\t\t\t\t\t\tvar i = tagArray.length;\r\n\t\t\t\t\t\twhile(i--) {\r\n\t\t\t\t\t\t\tif(tagArray[i].text === text) {\r\n\t\t\t\t\t\t\t\ttagArray.splice(i, 1);\r\n\t\t\t\t\t\t\t\tNotificationFactory.warning('Dropped!', 'Tag was successfully dropped');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\treturn service;\r\n\t}\r\n\r\n})();\r\n\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('core').controller('HeaderController', HeaderController);\r\n\tHeaderController.$inject = ['$scope', 'Authentication', 'Menus', '$location'];\r\n\r\n\tfunction HeaderController($scope, Authentication, Menus, $location) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.changeTheme = changeTheme;\r\n\t\tctrl.isActive = isActive;\r\n\t\tctrl.isCollapsed = false;\r\n\t\tctrl.isTimedTheme = localStorage.getItem('timedTheme');\r\n\t\tctrl.menu = Menus.getMenu('topbar');\r\n\t\tctrl.saved = localStorage.getItem('theme');\r\n\t\tctrl.styles = [\r\n        { name: 'Day', url: 'dist/main-day.css' },\r\n        { name: 'Night', url: 'dist/main-night.css' }\r\n    ];\r\n\t\tctrl.theme = (localStorage.getItem('theme')!==null) ? JSON.parse(ctrl.saved) : ctrl.styles[1].url;\r\n\t\tctrl.timedTheme = (localStorage.getItem('timedTheme')!==null) ? JSON.parse(ctrl.isTimedTheme) : false;\r\n\t\tctrl.toggleCollapsibleMenu = toggleCollapsibleMenu;\r\n\r\n\t\tlocalStorage.setItem('theme', JSON.stringify(ctrl.theme));\r\n  \tlocalStorage.setItem('timedTheme', JSON.stringify(ctrl.timedTheme));\r\n\r\n\t\tfunction toggleCollapsibleMenu() {\r\n\t\t\tctrl.isCollapsed = !ctrl.isCollapsed;\r\n\t\t}\r\n\r\n\t\t// Collapsing the menu after navigation\r\n\t\t$scope.$on('$stateChangeSuccess', function() {\r\n\t\t\tctrl.isCollapsed = false;\r\n\t\t});\r\n\r\n    function isActive(viewLocation) {\r\n        return viewLocation === $location.path();\r\n    }\r\n\r\n    function changeTheme() {\r\n        localStorage.setItem('timedTheme', JSON.stringify(ctrl.timedTheme));\r\n        var timeOfDayTheme = localStorage.getItem('timedTheme');\r\n        if (timeOfDayTheme === 'false') {\r\n            localStorage.setItem('theme', JSON.stringify(ctrl.theme));\r\n        } else {\r\n            var time = new Date().getHours();\r\n            if (time > 20 || time < 8) {\r\n                localStorage.setItem('theme', JSON.stringify(ctrl.styles[1].url));\r\n            } else if (time > 8) {\r\n                localStorage.setItem('theme', JSON.stringify(ctrl.styles[0].url));\r\n            }\r\n        }\r\n        var storedValue = localStorage.getItem('theme'),\r\n        link = document.getElementById('app-theme');\r\n        link.href = storedValue.substr(1, storedValue.lastIndexOf('\\\"') - 1); //remove quotes for whatever reason.\r\n        ctrl.theme = storedValue.substr(1, storedValue.lastIndexOf('\\\"') - 1); //remove quotes for whatever reason. //set the dropdown to the correct value;\r\n    }\r\n\r\n\t}\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('anywhereButHere', anywhereButHere);\r\n  anywhereButHere.$inject = ['$compile'];\r\n\r\n  function anywhereButHere($compile) {\r\n      return {\r\n          restrict: 'A',\r\n          scope: {\r\n            showBackdrop: '=ngShow'\r\n          },\r\n          link: function (scope, element, attrs) {\r\n            var body = document.body,\r\n                backdrop = angular.element('<div id=\"anywhere-but-here-backdrop\" ng-show=\"showBackdrop\" ng-click=\"triggerAnywhereButHere()\"></div>')[0];\r\n            body.appendChild(backdrop);\r\n            $compile(backdrop)(scope);\r\n\r\n            scope.triggerAnywhereButHere = function() {\r\n              scope.showBackdrop = false;\r\n            };\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('clickPass', clickPass);\r\n  clickPass.$inject = ['$timeout'];\r\n\r\n   function clickPass($timeout) {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        element.bind('click', function(event) {\r\n          $timeout(function() {\r\n            event.stopPropagation();\r\n            document.getElementById(attrs.clickPass).click();\r\n          }, 0);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('formatDate', formatDate);\r\n   function formatDate(){\r\n    return {\r\n     require: 'ngModel',\r\n      link: function(scope, elem, attr, modelCtrl) {\r\n        modelCtrl.$formatters.push(function(modelValue){\r\n          return (modelValue === null) ? null : new Date(modelValue);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('loadingSpinner', loadingSpinner);\r\n  loadingSpinner.$inject = ['$http', 'spinnerService'];\r\n\r\n   function loadingSpinner($http, spinnerService) {\r\n      return {\r\n          restrict: 'A',\r\n          transclude: true,\r\n          replace: true,\r\n          templateUrl: '/modules/core/templates/loading-spinner.html',\r\n          scope: {\r\n              name: '@',\r\n              size: '@?'\r\n          },\r\n          bindToController: 'loadingSpinner',\r\n          controller: [\"$scope\", function ($scope) {\r\n              $scope.active = false;\r\n  //            $scope.isLoading = function () {\r\n  //                return $http.pendingRequests.length > 0;\r\n  //            };\r\n\r\n  //            $scope.$watch($scope.isLoading, function (v) {\r\n  //                if ($scope.size === 'fullscreen') {\r\n  //                    if(v) {\r\n  //                        $scope.active = true;\r\n  //                    } else {\r\n  //                        $scope.active = false;\r\n  //                    }\r\n  //                }\r\n  //            });\r\n\r\n              var api = {\r\n                  name: $scope.name,\r\n                  show: function () {\r\n                      $scope.active = true;\r\n                  },\r\n                  hide: function () {\r\n                      $scope.active = false;\r\n                  },\r\n                  toggle: function () {\r\n                      $scope.active = !$scope.active;\r\n                  }\r\n              };\r\n\r\n              spinnerService._register(api);\r\n              $scope.$on('$destroy', function () {\r\n                  spinnerService._unregister($scope.name);\r\n              });\r\n          }]\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('malSearch', malSearch);\r\n  malSearch.$inject = ['MalService', '$timeout'];\r\n\r\n  function malSearch(MalService, $timeout) {\r\n      return {\r\n          restrict: 'A',\r\n          replace: true,\r\n          scope: {\r\n            type: '=malSearch',\r\n            selectItem: '=malSearchSelect',\r\n            searchString: '=malSearchModel',\r\n            options: '=malSearchOptions'\r\n          },\r\n          controllerAs: 'malSearchCtrl',\r\n          bindToController: true,\r\n          templateUrl: '/modules/core/templates/mal-search.html',\r\n          controller: [\"$scope\", function ($scope) {\r\n            var self = this,\r\n                timeoutPromise,\r\n                delayInMs = 2000;\r\n\r\n            self.displayActions = false;\r\n            self.displaySelectedItemActions = displaySelectedItemActions;\r\n            self.hasFocus = false;\r\n            self.hasSearchResults = false;\r\n            self.processItem = processItem;\r\n            self.searchResults = [];\r\n            self.selectedItem = null;\r\n            self.selectedItemActions = [\r\n              {\r\n                displayText: 'Remove selected',\r\n                action: function() {\r\n                  self.processItem(null);\r\n                  self.searchString = undefined;\r\n                  self.displayActions = false;\r\n                }\r\n              },\r\n              {\r\n                displayText: 'Display raw json',\r\n                action: function() {\r\n                  self.displayRawJson = true;\r\n                }\r\n              }\r\n            ];\r\n            self.toggleSearchDropdownOnFocus = toggleSearchDropdownOnFocus;\r\n\r\n            function processItem(item) {\r\n              self.selectItem(item);\r\n              self.selectedItem = item;\r\n            }\r\n\r\n            function displaySelectedItemActions() {\r\n              self.displayActions = true;\r\n            }\r\n\r\n            function searchMal(type, searchString) {\r\n              MalService.search(type, searchString).then(function (result) {\r\n                self.searchResults = result;\r\n                self.hasSearchResults = true;\r\n              });\r\n            }\r\n\r\n            function toggleSearchDropdownOnFocus(event) {\r\n              $timeout(function() {\r\n                self.hasFocus = event.type === 'focus';\r\n              }, 500);\r\n            }\r\n\r\n            $scope.$watch('malSearchCtrl.searchString', function(newValue) {\r\n              self.hasFocus = true;\r\n              if(newValue !== undefined && newValue.length > 2 && self.selectedItem === null && !self.options.disabled) {\r\n                $timeout.cancel(timeoutPromise);\r\n                timeoutPromise = $timeout(function() {\r\n                     searchMal(self.type, newValue);\r\n                }, delayInMs);\r\n              }\r\n            });\r\n\r\n            $scope.$watch('malSearchCtrl.displayActions', function(newValue) {\r\n              if(newValue !== undefined && !newValue) {\r\n                self.displayRawJson = newValue;\r\n              }\r\n            });\r\n\r\n          }]\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('myProgress', myProgress);\r\n\r\n   function myProgress() {\r\n      return function(scope, element, attrs) {\r\n          scope.$watch(attrs.myProgress, function(val) {\r\n              var type = 'checklist-progress';\r\n              element.html('<div class=\"' + type + '\" style=\"width: ' + val + '%;height: 100%\"></div>');\r\n          });\r\n        };\r\n    }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('calendarFilter', calendarFilter);\r\n\r\n   function calendarFilter() {\r\n      return function(array, datesSelected) {\r\n          if (array) {\r\n              return array.filter(function(item) {\r\n                  //date filter\r\n                  if (item.date === null || item.date === undefined) {\r\n                      if (datesSelected === false) {\r\n                          return item;\r\n                      }\r\n                      return false;\r\n                  }\r\n\r\n                  var day = new Date().getDay(),\r\n                      diff = new Date().getDate() - day + (day === 0 ? 0:7),\r\n                      temp = new Date(),\r\n                      wkEnd = new Date(temp.setDate(diff)),\r\n                      currentWkEnd = wkEnd.toISOString().substring(0,10),\r\n                      iDate = new Date(item.date).toISOString(),\r\n                      itemDate = { year: iDate.substr(0,4), month: iDate.substr(5,2), day: iDate.substr(8,2) },\r\n                      currentDate = { year: currentWkEnd.substr(0,4), month: currentWkEnd.substr(5,2), day: currentWkEnd.substr(8,2) };\r\n\r\n                  if (datesSelected === false) {\r\n                      if (itemDate.year < currentDate.year) {\r\n                          return item;\r\n                      } else if (itemDate.year === currentDate.year) {\r\n                          if (itemDate.month < currentDate.month) {\r\n                              return item;\r\n                          } else if (itemDate.month === currentDate.month) {\r\n                              if (itemDate.day <= currentDate.day) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  } else if (datesSelected === true) {\r\n                      if (itemDate.year > currentDate.year) {\r\n                          return item;\r\n                      } else if (itemDate.year === currentDate.year) {\r\n                          if (itemDate.month > currentDate.month) {\r\n                              return item;\r\n                          } else if (itemDate.month === currentDate.month) {\r\n                              if (itemDate.day > currentDate.day) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  dateSuffix.$inject = [\"$filter\"];\r\n  angular.module('core')\r\n  .filter('dateSuffix', dateSuffix);\r\n\r\n   function dateSuffix($filter) {\r\n    var suffixes = ['th', 'st', 'nd', 'rd'];\r\n    return function(input) {\r\n      if(input !== undefined){\r\n          var dtfilter = $filter('date')(input, 'MMMM d'),\r\n              day = parseInt(dtfilter.slice(-2)),\r\n              relevantDigits = (day < 30) ? day % 20 : day % 30,\r\n              suffix = (relevantDigits <= 3) ? suffixes[relevantDigits] : suffixes[0],\r\n              dateArray = dtfilter.split(' '),\r\n              month = dateArray[0];\r\n          return dateArray[1] + suffix + ' ' + month + ' ' + $filter('date')(input, 'yyyy');\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('dayFilter', dayFilter);\r\n\r\n   function dayFilter() {\r\n    return function(array, daySelected) {\r\n        return array.filter(function(item) {\r\n            //special day filter\r\n//            console.log(item);\r\n            var ds = daySelected;\r\n            if (ds==='1' && item.day==='Monday') {\r\n                return item;\r\n            } else if (ds==='2' && item.day==='Tuesday') {\r\n                return item;\r\n            } else if (ds==='3' && item.day==='Wednesday') {\r\n                return item;\r\n            } else if (ds==='4' && item.day==='Thursday') {\r\n                return item;\r\n            } else if (ds==='5' && item.day==='Friday') {\r\n                return item;\r\n            } else if (ds==='6' && item.day==='Saturday') {\r\n                return item;\r\n            } else if (ds==='0' && item.day==='Sunday') {\r\n                return item;\r\n            } else if (ds==='' || ds===null || ds===undefined) {\r\n                return item;\r\n            } else if (ds==='Any' && item.day==='Any') {\r\n                return item;\r\n            }\r\n        });\r\n    };\r\n}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('numberFixedLen', numberFixedLen);\r\n\r\n   function numberFixedLen() {\r\n    return function (n, len) {\r\n        var num = parseInt(n, 10);\r\n        len = parseInt(len, 10);\r\n        if (isNaN(num) || isNaN(len)) {\r\n            return n;\r\n        }\r\n        num = ''+num;\r\n        while (num.length < len) {\r\n            num = '0'+num;\r\n        }\r\n        return num;\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('core')\r\n\t.service('Enums', Enums);\r\n\r\n\tfunction Enums() {\r\n\t\tvar obj = {\r\n\t\t\tmalStatus: {\r\n        anime: {\r\n          ongoing: 'Currently Airing',\r\n          complete: 'Finished Airing'\r\n        },\r\n        manga: {\r\n          ongoing: 'Publishing',\r\n          complete: 'Finished'\r\n        }\r\n      }\r\n\t\t};\r\n\t\treturn obj;\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('core')\r\n\t.service('FunctionService', FunctionService);\r\n\tFunctionService.$inject = ['moment'];\r\n\r\n\tfunction FunctionService(moment) {\r\n\t\tvar obj = {\r\n\t\t\tpad: pad\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n    function pad(number, width, padChar) {\r\n      padChar = padChar || '0';\r\n      number = number + '';\r\n      return number.length >= width ? number : new Array(width - number.length + 1).join(padChar) + number;\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('core')\r\n\t.factory('MalService', MalService);\r\n\tMalService.$inject = ['$http', '$resource'];\r\n\r\n\tfunction MalService($http, $resource) {\r\n\t\tvar malService = $resource('', {},\r\n\t\t\t {\r\n\t\t\t\tsearch: {\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\turl: 'malSearch/:type',\r\n\t\t\t\t\tparams: { type: '@_type', searchString: '@_searchString' },\r\n\t\t\t\t\tisArray: true\r\n\t\t\t\t}\r\n\t\t\t });\r\n\r\n\t\tfunction xmlToJson(xml) {\r\n\t\t\tvar ELEMENT_NODE_TYPE = 1,\r\n\t\t\t\tTEXT_NODE_TYPE = 3,\r\n\t\t\t\tobj = {};\r\n\r\n\t\t\tif (xml.nodeType === ELEMENT_NODE_TYPE) {\r\n\t\t\t\tif (xml.attributes.length > 0) {\r\n\t\t\t\tobj['@attributes'] = {};\r\n\t\t\t\t\tfor (var j = 0; j < xml.attributes.length; j++) {\r\n\t\t\t\t\t\tvar attribute = xml.attributes.item(j);\r\n\t\t\t\t\t\tobj['@attributes'][attribute.nodeName] = attribute.nodeValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (xml.nodeType === TEXT_NODE_TYPE) {\r\n\t\t\t\tobj = xml.nodeValue;\r\n\t\t\t}\r\n\r\n\t\t\tif (xml.hasChildNodes() && xml.childNodes.length === 1 && xml.childNodes[0].nodeType === TEXT_NODE_TYPE) {\r\n\t\t\t\tobj = xml.childNodes[0].nodeValue;\r\n\t\t\t}\r\n\t\t\telse if (xml.hasChildNodes()) {\r\n\t\t\t\tfor(var i = 0; i < xml.childNodes.length; i++) {\r\n\t\t\t\t\tvar item = xml.childNodes.item(i),\r\n\t\t\t\t\t\tnodeName = item.nodeName;\r\n\t\t\t\t\tif (typeof(obj[nodeName]) === 'undefined') {\r\n\t\t\t\t\t\tobj[nodeName] = xmlToJson(item);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (typeof(obj[nodeName].push) === 'undefined') {\r\n\t\t\t\t\t\t\tvar old = obj[nodeName];\r\n\t\t\t\t\t\t\tobj[nodeName] = [];\r\n\t\t\t\t\t\t\tobj[nodeName].push(old);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobj[nodeName].push(xmlToJson(item));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn obj;\r\n\t\t}\r\n\r\n\t\tfunction xmlProcessor(type, data) {\r\n\t\t\tvar searchResult = [],\r\n\t\t\t\txml = data.responseXML,\r\n\t\t\t\tnodes = xml.evaluate(`//${type}/entry`, xml, null, XPathResult.ANY_TYPE, null),\r\n\t\t\t\tresult = nodes.iterateNext();\r\n\t\t\twhile (result) {\r\n\t\t\t\tsearchResult.push(xmlToJson(result));\r\n\t\t\t\tresult = nodes.iterateNext();\r\n\t\t\t}\r\n\t\t\treturn searchResult;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tsearch: function (queryType, searchString) {\r\n\t\t\t\treturn malService.search({ type: queryType, searchString: searchString }).$promise;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n})();\r\n\r\n'use strict';\r\n\r\n//Menu service used for managing  menus\r\nangular.module('core').service('Menus', [\r\n\r\n\tfunction() {\r\n\t\t// Define a set of default roles\r\n\t\tthis.defaultRoles = ['*'];\r\n\r\n\t\t// Define the menus object\r\n\t\tthis.menus = {};\r\n\r\n\t\t// A private function for rendering decision \r\n\t\tvar shouldRender = function(user) {\r\n\t\t\tif (user) {\r\n\t\t\t\tif (!!~this.roles.indexOf('*')) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (var userRoleIndex in user.roles) {\r\n\t\t\t\t\t\tfor (var roleIndex in this.roles) {\r\n\t\t\t\t\t\t\tif (this.roles[roleIndex] === user.roles[userRoleIndex]) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn this.isPublic;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Validate menu existance\r\n\t\tthis.validateMenuExistance = function(menuId) {\r\n\t\t\tif (menuId && menuId.length) {\r\n\t\t\t\tif (this.menus[menuId]) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('Menu does not exists');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('MenuId was not provided');\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Get the menu object by menu id\r\n\t\tthis.getMenu = function(menuId) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add new menu object by menu id\r\n\t\tthis.addMenu = function(menuId, isPublic, roles) {\r\n\t\t\t// Create the new menu\r\n\t\t\tthis.menus[menuId] = {\r\n\t\t\t\tisPublic: isPublic || false,\r\n\t\t\t\troles: roles || this.defaultRoles,\r\n\t\t\t\titems: [],\r\n\t\t\t\tshouldRender: shouldRender\r\n\t\t\t};\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeMenu = function(menuId) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\tdelete this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add menu item object\r\n\t\tthis.addMenuItem = function(menuId, menuItemTitle, menuItemURL, menuItemType, menuItemUIRoute, isPublic, roles, position) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Push new menu item\r\n\t\t\tthis.menus[menuId].items.push({\r\n\t\t\t\ttitle: menuItemTitle,\r\n\t\t\t\tlink: menuItemURL,\r\n\t\t\t\tmenuItemType: menuItemType || 'item',\r\n\t\t\t\tmenuItemClass: menuItemType,\r\n\t\t\t\tuiRoute: menuItemUIRoute || ('/' + menuItemURL),\r\n\t\t\t\tisPublic: ((isPublic === null || typeof isPublic === 'undefined') ? this.menus[menuId].isPublic : isPublic),\r\n\t\t\t\troles: ((roles === null || typeof roles === 'undefined') ? this.menus[menuId].roles : roles),\r\n\t\t\t\tposition: position || 0,\r\n\t\t\t\titems: [],\r\n\t\t\t\tshouldRender: shouldRender\r\n\t\t\t});\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add submenu item object\r\n\t\tthis.addSubMenuItem = function(menuId, rootMenuItemURL, menuItemTitle, menuItemURL, menuItemUIRoute, isPublic, roles, position) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tif (this.menus[menuId].items[itemIndex].link === rootMenuItemURL) {\r\n\t\t\t\t\t// Push new submenu item\r\n\t\t\t\t\tthis.menus[menuId].items[itemIndex].items.push({\r\n\t\t\t\t\t\ttitle: menuItemTitle,\r\n\t\t\t\t\t\tlink: menuItemURL,\r\n\t\t\t\t\t\tuiRoute: menuItemUIRoute || ('/' + menuItemURL),\r\n\t\t\t\t\t\tisPublic: ((isPublic === null || typeof isPublic === 'undefined') ? this.menus[menuId].items[itemIndex].isPublic : isPublic),\r\n\t\t\t\t\t\troles: ((roles === null || typeof roles === 'undefined') ? this.menus[menuId].items[itemIndex].roles : roles),\r\n\t\t\t\t\t\tposition: position || 0,\r\n\t\t\t\t\t\tshouldRender: shouldRender\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeMenuItem = function(menuId, menuItemURL) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item to remove\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tif (this.menus[menuId].items[itemIndex].link === menuItemURL) {\r\n\t\t\t\t\tthis.menus[menuId].items.splice(itemIndex, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeSubMenuItem = function(menuId, submenuItemURL) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item to remove\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tfor (var subitemIndex in this.menus[menuId].items[itemIndex].items) {\r\n\t\t\t\t\tif (this.menus[menuId].items[itemIndex].items[subitemIndex].link === submenuItemURL) {\r\n\t\t\t\t\t\tthis.menus[menuId].items[itemIndex].items.splice(subitemIndex, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t//Adding the topbar menu\r\n\t\tthis.addMenu('topbar');\r\n\t}\r\n]);\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .factory('NotificationFactory', NotificationFactory);\r\n\r\n   function NotificationFactory() {\r\n    var self = this;\r\n    /*global swal */\r\n    /*global toastr */\r\n        toastr.options = {\r\n                'closeButton': false,\r\n                'debug': false,\r\n                'newestOnTop': false,\r\n                'progressBar': false,\r\n                'positionClass': 'toast-bottom-right',\r\n                'preventDuplicates': false,\r\n                'onclick': null,\r\n                'showDuration': '300',\r\n                'hideDuration': '1000',\r\n                'timeOut': '5000',\r\n                'extendedTimeOut': '1000',\r\n                'showEasing': 'swing',\r\n                'hideEasing': 'linear',\r\n                'showMethod': 'fadeIn',\r\n                'hideMethod': 'fadeOut'\r\n            };\r\n    return {\r\n        success: function (title, text) {\r\n            toastr.success(text, title, 'Success');\r\n        },\r\n        warning: function (title, text) {\r\n            toastr.warning(text, title, 'Warning');\r\n        },\r\n        error: function (title, text) {\r\n            toastr.error(text, title, 'Error');\r\n        },\r\n        popup: function (title, text, type) {\r\n            swal({\r\n                title: title,\r\n                text: text,\r\n                type: type\r\n            });\r\n        },\r\n        confirmation: function (thenDo) {\r\n              //are you sure option...\r\n            swal({\r\n                title: 'Are you sure?',\r\n                text: 'Are you sure that you want to delete this?',\r\n                type: 'warning',\r\n                showCancelButton: true,\r\n                closeOnConfirm: true,\r\n                confirmButtonText: 'Yes, delete it!',\r\n                confirmButtonColor: '#ec6c62'\r\n            }, thenDo);\r\n        }\r\n    };\r\n}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .factory('spinnerService', SpinnerService);\r\n  SpinnerService.$inject = ['$q'];\r\n   function SpinnerService($q) {\r\n    var spinners = {},\r\n        queue = {},\r\n        loads = {};\r\n\r\n      return {\r\n          spinners: spinners,\r\n        // private method for spinner registration.\r\n        _register: function (data) {\r\n            if (!data.hasOwnProperty('name')) {\r\n                throw new Error('Spinner must specify a name when registering with the spinner service.');\r\n            }\r\n            if (spinners.hasOwnProperty(data.name)) {\r\n                throw new Error('A spinner with the name \\'' + data.name + '\\' has already been registered.');\r\n            }\r\n            spinners[data.name] = data;\r\n            // Increase the spinner count.\r\n            this.count++;\r\n\r\n            // Check if spinnerId was in the queue, if so then fire the\r\n            // queued function.\r\n            if (queue[data.name]) {\r\n    //            console.log(queue, loads);\r\n                if(loads[data.name]) {\r\n    //                console.log(loads[data.name]);\r\n                    this[queue[data.name]](data.name, loads[data.name]);\r\n                    delete loads[data.name];\r\n                    delete queue[data.name];\r\n                } else {\r\n    //                console.log('queued', queue);\r\n                    this[queue[data.name]](data.name);\r\n                    delete queue[data.name];\r\n                }\r\n            }\r\n    //        console.log(spinners);\r\n        },\r\n        _unregister: function (name) {\r\n          if (spinners.hasOwnProperty(name)) {\r\n            delete spinners[name];\r\n          }\r\n        },\r\n        loading: function (name, optionsOrPromise) {\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'loading';\r\n                loads[name] = optionsOrPromise;\r\n    //            console.log('defer', loads[name]);\r\n                return;\r\n            }\r\n            var spinner = spinners[name];\r\n            spinner.show(name);\r\n            optionsOrPromise = optionsOrPromise || {};\r\n\r\n            //Check if it's promise\r\n            if (optionsOrPromise.always || optionsOrPromise['finally']) {\r\n                optionsOrPromise = {\r\n                    promise: optionsOrPromise\r\n                };\r\n            }\r\n\r\n            var options = angular.extend({}, optionsOrPromise);\r\n\r\n            if (options.promise) {\r\n                if (options.promise.always) {\r\n                    options.promise.always(function () {\r\n                        spinner.hide(name);\r\n                    });\r\n                } else if (options.promise['finally']) {\r\n                    options.promise['finally'](function () {\r\n                        spinner.hide(name);\r\n                    });\r\n                }\r\n            }\r\n        },\r\n        show: function (name) {\r\n    //        console.log('show');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'show';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.show();\r\n        },\r\n        hide: function (name) {\r\n    //        console.log('hide');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'hide';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.hide();\r\n        },\r\n        toggle: function (name) {\r\n    //        console.log('toggle');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'toggle';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.toggle();\r\n        },\r\n        count: 0\r\n      };\r\n\r\n  }\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('history').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('history', {\r\n\t\t\turl: '/history',\r\n\t\t\ttemplateUrl: 'modules/history/views/history.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n  'use strict';\r\n  angular.module('history').controller('HistoryController', HistoryController);\r\n  HistoryController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'AnimeHistory', 'MangaHistory', 'HistoryService', 'ListService', 'spinnerService'];\r\n\r\n  function HistoryController($scope, $stateParams, $location, Authentication, AnimeHistory, MangaHistory, HistoryService, ListService, spinnerService) {\r\n\t\tvar ctrl = this,\r\n\t\t    latestDate = new Date().setDate(new Date().getDate() - 29);\r\n\r\n    ctrl.authentication = Authentication;\r\n    ctrl.buildHistory = buildHistory;\r\n    ctrl.filterConfig = {\r\n\t\t\thistoryFilter: 'Today'\r\n    };\r\n    ctrl.happenedWhen = happenedWhen;\r\n    ctrl.historyGroups = [\r\n      { name: 'Today' },\r\n      { name: 'Yesterday' },\r\n      { name: 'This week' },\r\n      { name: 'Last week' },\r\n      { name: 'Two weeks ago' },\r\n      { name: 'Three weeks ago' },\r\n      { name: 'Four weeks ago' },\r\n    ];\r\n    ctrl.view = 'Anime';\r\n\r\n\r\n    function buildHistory() {\r\n\t    spinnerService.loading('history', AnimeHistory.query({ latest: latestDate }).$promise.then(function(result) {\r\n\t\t\t\t\treturn HistoryService.buildHistoryList(result);\r\n\t\t\t}).then(function(result) {\r\n\t      //  console.log('build anime history: ', result);\r\n\t\t\t\tctrl.animeHistory = result;\r\n\t      return MangaHistory.query({ latest: latestDate }).$promise;\r\n\t    }).then(function(result) {\r\n\t\t\t\t//    console.log('manga', result);\r\n\t\t\t\treturn HistoryService.buildHistoryList(result);\r\n\t    }).then(function(result) {\r\n\t\t\t\t//                    console.log('build manga history: ', result);\r\n\t\t\t\tctrl.mangaHistory = result;\r\n\t\t\t})\r\n\t\t  );\r\n    }\r\n\r\n    //Needed to catch 'Character' setting and skip it.\r\n    $scope.$watch('view', function(newValue) {\r\n      if (ctrl.view !== undefined) {\r\n          if (newValue !== 'Anime' && newValue !== 'Manga') {\r\n              ctrl.view = 'Anime';\r\n          }\r\n      }\r\n    });\r\n\r\n    function happenedWhen(when) {\r\n        return HistoryService.happenedWhen(when);\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('tasks').controller('ViewHistoryController', ViewHistoryController);\r\n  ViewHistoryController.$inject =  ['$scope', 'data', '$stateParams', 'Authentication', 'ItemService', 'NotificationFactory', 'spinnerService', '$uibModalInstance'];\r\n\r\nfunction ViewHistoryController($scope, data, $stateParams, Authentication, ItemService, NotificationFactory, spinnerService, $uibModalInstance) {\r\n  var ctrl = this,\r\n      historyStore = [];\r\n\r\n  ctrl.cancel = cancel;\r\n  ctrl.deleteHistory = deleteHistory;\r\n  ctrl.submit = submit;\r\n  ctrl.type = data.type;\r\n  ctrl.updated = false;\r\n  ctrl.viewItem = data.viewItem;\r\n\r\n  function deleteHistory(item, history) {\r\n      //are you sure option...\r\n      NotificationFactory.confirmation(function() {\r\n        if(historyStore.length === 0) {\r\n          historyStore = ctrl.viewItem.meta.history;\r\n        }\r\n        ctrl.viewItem = ItemService.deleteHistory(item, history);\r\n        ctrl.updated = true;\r\n      });\r\n  }\r\n\r\n  function submit() {\r\n    $uibModalInstance.close(ctrl.updated);\r\n  }\r\n\r\n  function cancel() {\r\n    if(ctrl.updated) {\r\n      ctrl.viewItem.meta.history = historyStore;\r\n    }\r\n    $uibModalInstance.dismiss();\r\n  }\r\n\r\n}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .filter('historySeparator', historySeparator);\r\n  historySeparator.$inject = ['HistoryService', 'moment'];\r\n\r\n  function historySeparator(HistoryService, moment) {\r\n    return function(array, level, timeframe) {\r\n        var itemDate,\r\n            attr = (level === 'group') ? 'latest' : 'date';\r\n        if (array !== undefined) {\r\n            return array.filter(function(item) {\r\n                itemDate = moment(item[attr]).startOf('day');\r\n                return HistoryService.filterItemHistory(timeframe.toLowerCase(), itemDate) ? item : false;\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  //History service used to communicate Animeitems REST endpoints\r\n  angular.module('history')\r\n  .factory('AnimeHistory', AnimeHistory);\r\n  AnimeHistory.$inject = ['$resource'];\r\n\r\n    function AnimeHistory($resource) {\r\n      return $resource('history/anime/:latest', { latest: '@_latest' }, { update: { method: 'PUT' } });\r\n    }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .service('HistoryService', HistoryService);\r\n  HistoryService.$inject = ['moment', '$q'];\r\n\r\n   function HistoryService(moment, $q) {\r\n     var service = {\r\n           buildHistoryList: buildHistoryList,\r\n           extractHistory: extractHistory,\r\n           filterItemHistory: filterItemHistory,\r\n           getEndsOfWeek: getEndsOfWeek,\r\n           getSetDaysAgo: getSetDaysAgo,\r\n           groupItemHistory: groupItemHistory,\r\n           happenedWhen: happenedWhen,\r\n           today: moment(new Date()).startOf('day'),\r\n           weekBeginning: weekBeginning,\r\n           weekEnding: weekEnding\r\n         },\r\n         endsOfWeek = getEndsOfWeek(),\r\n         mondays = endsOfWeek.mondays,\r\n         sundays = endsOfWeek.sundays;\r\n         return service;\r\n\r\n    // getting mondays and sundays for this, last, two and three weeks ago.\r\n    function getEndsOfWeek() {\r\n        var endsOfWeek = [], thisMonday = service.weekBeginning(), thisSunday = service.weekEnding();\r\n        endsOfWeek = {\r\n            mondays: [ thisMonday, service.getSetDaysAgo(thisMonday, 7), service.getSetDaysAgo(thisMonday, 14), service.getSetDaysAgo(thisMonday, 21), service.getSetDaysAgo(thisMonday, 28) ],\r\n            sundays: [ thisSunday, service.getSetDaysAgo(thisSunday, 7), service.getSetDaysAgo(thisSunday, 14), service.getSetDaysAgo(thisSunday, 21), service.getSetDaysAgo(thisSunday, 28) ]\r\n        };\r\n        return endsOfWeek;\r\n    }\r\n\r\n    //get 'daysAgo' days ago from 'thisEnd' date.\r\n    function getSetDaysAgo(thisEnd, daysAgo) {\r\n        var newDate = moment(thisEnd).subtract(daysAgo, 'days');\r\n        return newDate;\r\n    }\r\n\r\n    //get 'this' monday.\r\n    function weekBeginning() {\r\n        var date = new Date(),\r\n            day = date.getDay(),\r\n            diff = date.getDate() - day + (day === 0 ? -6:1),\r\n            temp = new Date(),\r\n            wkBeg = new Date(temp.setDate(diff));\r\n        return moment(wkBeg.toISOString()).startOf('day');\r\n    }\r\n\r\n    //get 'this' sunday.\r\n    function weekEnding() {\r\n        var date = new Date(),\r\n            day = date.getDay(),\r\n            diff = date.getDate() - day + (day === 0 ? 0:7),\r\n            temp = new Date(),\r\n            wkEnd = new Date(temp.setDate(diff));\r\n        return moment(wkEnd.toISOString()).endOf('day');\r\n    }\r\n\r\n    function buildHistoryList(items) {\r\n        var deferred = $q.defer(),\r\n            promise = service.extractHistory(items).then(function(result) {\r\n//                console.log('extract history: ', result);\r\n                result.sort(function (a, b) {\r\n                    var dateA = a.date,\r\n                        dateB = b.date;\r\n                    if(dateA > dateB) return -1;\r\n                    if(dateA < dateB) return 1;\r\n                    if(dateA === dateB) return 0;\r\n                });\r\n                return service.groupItemHistory(result);\r\n            }).then(function(result) {\r\n//                console.log('grouped', result);\r\n                deferred.resolve(result);\r\n            });\r\n        return deferred.promise;\r\n    }\r\n\r\n    function extractHistory(items) {\r\n        var deferred = $q.defer(),\r\n            itemHistory = [], today = moment(new Date()).startOf('day');\r\n        angular.forEach(items, function(item) {\r\n            angular.forEach(item.meta.history, function(history) {\r\n                var cutoff = moment(history.date).startOf('day'),\r\n                    diff = today.diff(cutoff, 'days');\r\n//                console.log(diff);\r\n                if (diff < 29) {\r\n                    itemHistory.push({ date: history.date, value: history.value, title: item.title, id: item._id });\r\n                }\r\n            });\r\n        });\r\n        deferred.resolve(itemHistory);\r\n        return deferred.promise;\r\n    }\r\n\r\n    function groupItemHistory(itemHistory) {\r\n        var deferred = $q.defer(),\r\n            index, prevItem, item, group,\r\n            length = itemHistory.length,\r\n            groupedHistory = [];\r\n        for(var i = 0; i < length; i++) {\r\n            item = itemHistory[i];\r\n            if (i === 0) {\r\n                groupedHistory.push({\r\n                    title: item.title,\r\n                    items: [],\r\n                    count: 1,\r\n                    latest: item.date,\r\n                    oldest: item.date\r\n                });\r\n                groupedHistory[0].items.push(item);\r\n            } else if (i !== 0) {\r\n                prevItem = itemHistory[i - 1];\r\n                index = groupedHistory.length - 1;\r\n                if (prevItem.title === item.title) {\r\n                    groupedHistory[index].items.push(item);\r\n                    groupedHistory[index].count++;\r\n                    groupedHistory[index].oldest = item.date;\r\n                } else if (prevItem.title !== item.title) {\r\n                    group = {\r\n                        title: item.title,\r\n                        items: [],\r\n                        count: 1,\r\n                        latest: item.date,\r\n                        oldest: item.date\r\n                    };\r\n                    group.items.push(item);\r\n                    groupedHistory.push(group);\r\n                }\r\n            }\r\n        }\r\n        deferred.resolve(groupedHistory);\r\n        return deferred.promise;\r\n    }\r\n\r\n    function filterItemHistory(timeframe, itemDate) {\r\n        var diff = service.today.diff(itemDate, 'days');\r\n        switch(timeframe) {\r\n            case 'today':\r\n                return diff === 0;\r\n\r\n            case 'yesterday':\r\n                return diff === 1;\r\n\r\n            case 'this week':\r\n                return mondays[0] <= itemDate && itemDate <= sundays[0];\r\n\r\n            case 'last week':\r\n                return mondays[1] <= itemDate && itemDate <= sundays[1];\r\n\r\n            case 'two weeks ago':\r\n                return mondays[2] <= itemDate && itemDate <= sundays[2];\r\n\r\n            case 'three weeks ago':\r\n                return mondays[3] <= itemDate && itemDate <= sundays[3];\r\n\r\n            case 'four weeks ago':\r\n                return mondays[4] <= itemDate && itemDate <= sundays[4];\r\n        }\r\n    }\r\n\r\n    /** function to display relative time.\r\n     *  Using diff because fromNow will create conflicts between\r\n     *  the item date and the 'group date'.\r\n     */\r\n    function happenedWhen(when) {\r\n//          console.log(latest, updated);\r\n        var today = moment(new Date()).startOf('day'), thisDate = moment(when).startOf('day'),\r\n            diff = today.diff(thisDate, 'days');\r\n\r\n        //for 0 and 1 day(s) ago use the special term.\r\n        if (diff === 0) {\r\n            return 'Today at ' + moment(when).format('HH:mm');\r\n        } else if (diff === 1) {\r\n            return 'Yesterday at ' + moment(when).format('HH:mm');\r\n        } else {\r\n            return diff + ' days ago at ' + moment(when).format('HH:mm');\r\n        }\r\n    }\r\n\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .factory('MangaHistory', MangaHistory);\r\n  MangaHistory.$inject = ['$resource'];\r\n\r\n  function MangaHistory($resource) {\r\n    return $resource('history/manga/:latest', { latest: '@_latest' }, { update: { method: 'PUT' } });\r\n  }\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('mangaitems').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Mangaitems', 'mangaitems', 'dropdown', '/mangaitems(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'mangaitems', 'List Mangaitems', 'mangaitems');\r\n\t\tMenus.addSubMenuItem('topbar', 'mangaitems', 'New Mangaitem', 'mangaitems/create');\r\n\t}\r\n]);\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('mangaitems').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Mangaitems state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listMangaitems', {\r\n\t\t\turl: '/mangaitems',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/list-mangaitems.client.view.html'\r\n\t\t}).\r\n\t\tstate('createMangaitem', {\r\n\t\t\turl: '/mangaitems/create',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/create-mangaitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewMangaitem', {\r\n\t\t\turl: '/mangaitems/:mangaitemId',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/view-mangaitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('editMangaitem', {\r\n\t\t\turl: '/mangaitems/:mangaitemId/edit',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/create-mangaitem.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('mangaitems')\r\n\t.controller('CreateMangaController', CreateMangaController);\r\n\tCreateMangaController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'MangaFactory', 'spinnerService', 'TagService', 'Enums'];\r\n\r\n\tfunction CreateMangaController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, fileUpload, $sce, $window, ItemService, ListService, NotificationFactory, MangaFactory, spinnerService, TagService, Enums) {\r\n\t\tvar ctrl = this,\r\n        mangaitemId = $stateParams.mangaitemId;\r\n\r\n\t\tctrl.addedChapters = addedChapters;\r\n    ctrl.addedVolumes = addedVolumes;\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.mangaitem = {};\r\n\t\tctrl.authentication = Authentication;\r\n    ctrl.config = {\r\n      title: 'Create',\r\n\t\t\tupdateHistory: false,\r\n      ratingActions: {\r\n          maxRating: 10,\r\n          percent: undefined,\r\n          overStar: null\r\n      },\r\n      statTags: [],\r\n      commonArrays: ListService.getCommonArrays(),\r\n\t\t\tmalSearchType: 'manga'\r\n    };\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.finalNumbers = false; //default show status of final number fields in edit view.\r\n\t\tctrl.find = find;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.findAnime = findAnime;\r\n    ctrl.imgPath = ''; //image path\r\n\t\tctrl.itemUpdate = new Date(); // today's date as 'yyyy-MM-dd' for the auto-pop of 'latest' in edit page.\r\n    ctrl.init = init;\r\n\t\tctrl.malSearchOptions = {\r\n\t\t\tplaceholder: 'Title',\r\n\t\t\tname: 'title',\r\n\t\t\trequired: true,\r\n\t\t\tautocomplete: 'off',\r\n\t\t\tdisabled: true\r\n\t\t};\r\n\t\tctrl.removeTag = removeTag;\r\n\t\tctrl.sections = {\r\n\t\t\tshowAdditional: false,\r\n\t\t\tshowCompletion: false,\r\n\t\t\tshowItemTags: false\r\n\t\t};\r\n\t\tctrl.selectMalEntry = selectMalEntry;\r\n\t\tctrl.submit = submit;\r\n    ctrl.tagArray = []; // holding tags pre-submit\r\n    ctrl.tagArrayRemove = [];\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\r\n    function init() {\r\n      ctrl.config.isCreate = mangaitemId === undefined;\r\n      if(ctrl.config.isCreate) {\r\n\t\t\t\tctrl.mangaitem.chapters = 0;\r\n\t\t\t\tctrl.mangaitem.volumes = 0;\r\n\t\t\t\tctrl.mangaitem.start = ctrl.itemUpdate;\r\n\t\t\t\tctrl.mangaitem.latest = ctrl.itemUpdate;\r\n\t\t\t\tctrl.malSearchOptions.disabled = false;\r\n\t\t\t} else if(!ctrl.config.isCreate) {\r\n        ctrl.config.title = 'Edit';\r\n        ctrl.findOne();\r\n      }\r\n      ctrl.find();\r\n      ctrl.findAnime();\r\n    }\r\n    ctrl.init();\r\n\r\n\t\tfunction selectMalEntry(malEntry) {\r\n\t\t\tif(malEntry) {\r\n\t\t\t\tctrl.mangaitem.title = malEntry.title;\r\n\t\t\t\tctrl.mangaitem.finalChapter = malEntry.chapters;\r\n\t\t\t\tctrl.mangaitem.finalVolume = malEntry.volumes;\r\n\t\t\t\tctrl.imgPath = malEntry.image;\r\n\t\t\t\tctrl.mangaitem.mal = {\r\n\t\t\t\t\tid: malEntry.id\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tctrl.mangaitem.finalChapter = 0;\r\n\t\t\t\tctrl.mangaitem.finalVolume = 0;\r\n\t\t\t\tctrl.mangaitem.mal = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\r\n    //For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.mangaitem.tags, text);\r\n\t\t}\r\n\r\n\t\tfunction addedChapters() {\r\n\t\t\tctrl.mangaitem.latest = ctrl.itemUpdate;\r\n\t\t\tctrl.config.updateHistory = true;\r\n      if (ctrl.mangaitem.chapters === ctrl.mangaitem.finalChapter && ctrl.mangaitem.finalChapter !== 0 && ctrl.mangaitem.reReading === false) {\r\n        ctrl.mangaitem.end = ctrl.itemUpdate;\r\n      }\r\n      if (ctrl.mangaitem.chapters > ctrl.mangaitem.finalChapter && ctrl.mangaitem.finalChapter !== 0) {\r\n        ctrl.mangaitem.chapters = ctrl.mangaitem.finalChapter;\r\n      }\r\n\t\t}\r\n\r\n    function addedVolumes() {\r\n      if (ctrl.mangaitem.volumes > ctrl.mangaitem.finalVolume && ctrl.mangaitem.finalVolume !== 0) {\r\n        ctrl.mangaitem.volumes = ctrl.mangaitem.finalVolume;\r\n      }\r\n    }\r\n\r\n    // Create new Mangaitem\r\n    function create() {\r\n\r\n      var mangaitem = new Mangaitems();\r\n      //Handle situation if objects not selected.\r\n      // Create new Mangaitem object\r\n     mangaitem = new Mangaitems ({\r\n      title: ctrl.mangaitem.title,\r\n      chapters: ctrl.mangaitem.chapters,\r\n      volumes: ctrl.mangaitem.volumes,\r\n      start: ctrl.mangaitem.start,\r\n      latest: ctrl.mangaitem.latest,\r\n      finalChapter: ctrl.mangaitem.finalChapter,\r\n      finalVolume: ctrl.mangaitem.finalVolume,\r\n      image: ctrl.imgPath,\r\n      hardcopy: ctrl.mangaitem.hardcopy,\r\n      anime: ctrl.mangaitem.anime !== undefined && ctrl.mangaitem.anime !== null ? ctrl.mangaitem.anime._id : ctrl.mangaitem.anime,\r\n      tags: ctrl.tagArray,\r\n      mal: ctrl.mangaitem.mal,\r\n      user: ctrl.user\r\n    });\r\n      // Redirect after save\r\n      mangaitem.$save(function(response) {\r\n        $location.path('/mangaitems');\r\n        NotificationFactory.success('Saved!', 'Manga was saved successfully');\r\n\r\n      }, function(errorResponse) {\r\n        ctrl.error = errorResponse.data.message;\r\n        NotificationFactory.error('Error!', errorResponse.data.message);\r\n      });\r\n    }\r\n\r\n    // Update existing Mangaitem\r\n    function update() {\r\n      var mangaitem = ctrl.mangaitem;\r\n      ctrl.mangaitem = undefined;\r\n      MangaFactory.update(mangaitem, ctrl.tagArray, ctrl.config.updateHistory, ctrl.imgPath);\r\n    }\r\n\r\n\t\tfunction submit() {\r\n\t\t\tif(ctrl.config.isCreate) ctrl.create();\r\n\t\t\tif(!ctrl.config.isCreate) ctrl.update();\r\n\t\t}\r\n\r\n    // Find a list of Mangaitems\r\n\t\tfunction find() {\r\n      Mangaitems.query().$promise.then(function(result) {\r\n          ctrl.mangaitems = result;\r\n\t\t\t\t\tctrl.config.statTags = ItemService.buildStatTags(result, 0);\r\n      });\r\n\t\t}\r\n\r\n\t\t// Find existing Animeitem\r\n\t\tfunction findOne() {\r\n\t    spinnerService.loading('editManga', Mangaitems.get({ mangaitemId: $stateParams.mangaitemId }).$promise.then(function(result) {\r\n          ctrl.mangaitem = result;\r\n\t\t\t\t\tctrl.malSearchOptions.disabled = (ctrl.mangaitem.mal && ctrl.mangaitem.mal.id > 0) || false;\r\n\t    }));\r\n\t\t}\r\n\r\n    // Find a list of Animeitems for dropdowns.\r\n    function findAnime() {\r\n      ctrl.animeitems = Animeitems.query();\r\n    }\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/mangaitems/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUpload');\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('mangaitems').controller('MangaitemsController', MangaitemsController);\r\n\tMangaitemsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Mangaitems', 'Animeitems', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'MangaFactory', 'spinnerService', '$uibModal'];\r\n\r\n\tfunction MangaitemsController($scope, $stateParams, $location, Authentication, Mangaitems, Animeitems, $sce, $window, ItemService, ListService, NotificationFactory, MangaFactory, spinnerService, $uibModal) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n    ctrl.filterConfig = {\r\n        showingCount: 0,\r\n        sortType: '',\r\n        sortReverse: true,\r\n        ratingLevel: undefined,\r\n        ratingActions: {\r\n            maxRating: 10,\r\n            percent: undefined,\r\n            overStar: null\r\n        },\r\n        searchTags: '',\r\n        tagsForFilter: [],\r\n        taglessItem: false,\r\n        areTagless: false,\r\n        selectListOptions: {},\r\n        statTags: [],\r\n\t\t\t\tviewItem: ''\r\n    };\r\n\t\tctrl.find = find;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.latestDate = latestDate;\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 10\r\n    };\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n\t\tctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.viewItemHistory = viewItemHistory;\r\n\t\tctrl.whichController = 'mangaitem';\r\n\r\n    //allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n\r\n\t\t// Remove existing Mangaitem\r\n\t\tfunction remove(mangaitem) {\r\n      //are you sure option...\r\n      NotificationFactory.confirmation(function() {\r\n          if ( mangaitem ) {\r\n              mangaitem.$remove();\r\n\r\n              for (var i in ctrl.mangaitems) {\r\n                  if (ctrl.mangaitems [i] === mangaitem) {\r\n                      ctrl.mangaitems.splice(i, 1);\r\n                  }\r\n              }\r\n          } else {\r\n              ctrl.mangaitem.$remove(function() {\r\n                  $location.path('/mangaitems');\r\n              });\r\n          }\r\n          NotificationFactory.warning('Deleted!', 'Manga was successfully deleted.');\r\n      });\r\n\t\t}\r\n\r\n\t\t// Update existing Mangaitem\r\n\t\tfunction update() {\r\n\t\t\tvar mangaitem = ctrl.mangaitem;\r\n            ctrl.mangaitem = undefined;\r\n            MangaFactory.update(mangaitem, ctrl.tagArray, ctrl.updateHistory, ctrl.imgPath);\r\n\t\t}\r\n\r\n\t\tfunction tickOff(item) {\r\n        item.chapters += 1;\r\n        item.latest = new Date(); //update latest.\r\n        ctrl.updateHistory = true; //add to history.\r\n        ctrl.mangaitem = item;\r\n        ctrl.update();\r\n    }\r\n\r\n    //latest date display format.\r\n    function latestDate(latest, updated) {\r\n        return ItemService.latestDate(latest, updated);\r\n    }\r\n\r\n\t\tfunction viewItemHistory() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/history/views/item-history.html',\r\n        controller: 'ViewHistoryController as viewHistory',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { viewItem: ctrl.filterConfig.viewItem, type: 'manga' };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed history: ', result, ctrl.filterConfig.viewItem.meta);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tctrl.mangaitem = ctrl.filterConfig.viewItem;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n      });\r\n\t\t}\r\n\r\n\t\t// Find existing Mangaitem\r\n\t\tfunction findOne() {\r\n\t    Mangaitems.get({ mangaitemId: $stateParams.mangaitemId }).$promise.then(function(result) {\r\n\t        ctrl.mangaitem = result;\r\n\t        //            console.log(ctrl.mangaitem);\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Find a list of Mangaitems\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n      spinnerService.loading('manga', Mangaitems.query().$promise.then(function(result) {\r\n          ctrl.mangaitems = result;\r\n\t\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\t\tctrl.filterConfig.statTags = ItemService.buildStatTags(result, 0);\r\n      }));\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('mangaItemModel', mangaItemModel);\r\n\r\n  function mangaItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/mangaitems/templates/manga-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('mangaitems')\r\n\t.factory('MangaFactory', MangaFactory);\r\n\tMangaFactory.$inject = ['Mangaitems', 'ListService', 'ItemService', 'NotificationFactory', '$location'];\r\n\r\n\tfunction MangaFactory(Mangaitems, ListService, ItemService, NotificationFactory, $location) {\r\n    return {\r\n        update: function(item, tagArray, updateHistory, imgPath) {\r\n            var mangaitem = item;\r\n            console.log(mangaitem);\r\n            //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n            if (item.anime!==null && item.anime!==undefined) {\r\n                mangaitem.anime = item.anime._id;\r\n            }\r\n\r\n            if (tagArray!==undefined) {\r\n                mangaitem.tags = ListService.concatenateTagArrays(mangaitem.tags, tagArray);\r\n            }\r\n\r\n            //update the item history.\r\n            mangaitem = ItemService.itemHistory(mangaitem, updateHistory, 'manga');\r\n\r\n            if (imgPath!==undefined && imgPath!==null && imgPath!=='') {\r\n                mangaitem.image = imgPath;\r\n            }\r\n            //console.log($scope.imgPath);\r\n            //console.log(mangaitem.image);\r\n\r\n            //handle end date\r\n            if (mangaitem.chapters===mangaitem.finalChapter && mangaitem.finalChapter!==0) {\r\n                if (mangaitem.end===undefined || mangaitem.end===null) {\r\n                    mangaitem.volumes = mangaitem.finalVolume;\r\n                    mangaitem.end = mangaitem.latest;\r\n                    //console.log(animeitem.end);\r\n                }\r\n            } else if (mangaitem.reReading === false) {\r\n                mangaitem.end = null;\r\n            }\r\n\r\n            //handle status: completed.\r\n            if(mangaitem.end!==undefined && mangaitem.end!==null) {\r\n                mangaitem.status = true;\r\n            } else {\r\n                mangaitem.status = false;\r\n            }\r\n\r\n            //handle re-reading, re-read count.\r\n            if (mangaitem.reReading===true && mangaitem.chapters===mangaitem.finalChapter) {\r\n                mangaitem.volumes = mangaitem.finalVolume;\r\n                mangaitem.reReadCount += 1;\r\n                mangaitem.reReading = false;\r\n            }\r\n\r\n\t\t\tmangaitem.$update(function() {\r\n\t\t\t\tif (window.location.href.indexOf('tasks') === -1) $location.path('/mangaitems');\r\n\r\n                NotificationFactory.success('Saved!', 'Manga was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tvar error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\r\n\r\n        }\r\n    };\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\t//Mangaitems service used to communicate Mangaitems REST endpoints\r\n\tangular.module('mangaitems')\r\n\t.factory('Mangaitems',  MangaitemsFactory);\r\n\tMangaitemsFactory.$inject = ['$resource'];\r\n\r\n\tfunction MangaitemsFactory($resource) {\r\n\t\treturn $resource('mangaitems/:mangaitemId', { mangaitemId: '@_id'\r\n\t\t}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('orders').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Orders', 'orders', 'dropdown', '/orders(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'orders', 'List Orders', 'orders');\r\n\t\tMenus.addSubMenuItem('topbar', 'orders', 'New Order', 'orders/create');\r\n\t}\r\n]);\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('orders').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Orders state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listOrders', {\r\n\t\t\turl: '/orders',\r\n\t\t\ttemplateUrl: 'modules/orders/views/list-orders.client.view.html'\r\n\t\t}).\r\n\t\tstate('createOrder', {\r\n\t\t\turl: '/orders/create',\r\n\t\t\ttemplateUrl: 'modules/orders/views/create-order.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewOrder', {\r\n\t\t\turl: '/orders/:orderId',\r\n\t\t\ttemplateUrl: 'modules/orders/views/view-order.client.view.html'\r\n\t\t}).\r\n\t\tstate('editOrder', {\r\n\t\t\turl: '/orders/:orderId/edit',\r\n\t\t\ttemplateUrl: 'modules/orders/views/create-order.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n\r\n'use strict';\r\nvar CompleteOrdersController = (function () {\r\n    function CompleteOrdersController($scope, $uibModalInstance, order) {\r\n        this.$scope = $scope;\r\n        this.$uibModalInstance = $uibModalInstance;\r\n        this.order = order;\r\n        this.newPrice = {\r\n            company: '',\r\n            price: null\r\n        };\r\n    }\r\n    CompleteOrdersController.prototype.editOrder = function (index) {\r\n        var item = this.order.nextVolume.prices[index];\r\n        this.newPrice.company = item.company;\r\n        this.newPrice.price = item.price;\r\n        this.order.nextVolume.prices.splice(index, 1);\r\n    };\r\n    CompleteOrdersController.prototype.completeOrder = function () {\r\n        this.order.nextVolume.prices.push({ company: this.newPrice.company, date: this.newPrice.date, price: this.newPrice.price, rrp: this.order.rrp, paid: true });\r\n        this.$uibModalInstance.close(this.order);\r\n    };\r\n    CompleteOrdersController.prototype.cancel = function () {\r\n        this.$uibModalInstance.dismiss('cancel');\r\n    };\r\n    CompleteOrdersController.controllerId = 'CompleteOrdersController';\r\n    CompleteOrdersController.$inject = ['$scope', '$uibModalInstance', 'order'];\r\n    return CompleteOrdersController;\r\n}());\r\nangular.module('orders').controller(CompleteOrdersController.controllerId, CompleteOrdersController);\r\n\r\n'use strict';\r\nvar CreateOrdersController = (function () {\r\n    function CreateOrdersController($scope, $stateParams, $location, Authentication, $q, Orders, Mangaitems, $uibModal, NotificationFactory) {\r\n        this.$scope = $scope;\r\n        this.$stateParams = $stateParams;\r\n        this.$location = $location;\r\n        this.Authentication = Authentication;\r\n        this.$q = $q;\r\n        this.Orders = Orders;\r\n        this.Mangaitems = Mangaitems;\r\n        this.$uibModal = $uibModal;\r\n        this.NotificationFactory = NotificationFactory;\r\n        this.isCreateMode = this.$stateParams.orderId === undefined;\r\n        this.order = {};\r\n        this.orderCopy = {\r\n            series: '',\r\n            nextVolume: {\r\n                volume: 1,\r\n                date: Date.now(),\r\n                rrp: 0.00,\r\n                prices: []\r\n            },\r\n            rrp: 0.00,\r\n            orderHistory: []\r\n        };\r\n        this.authentication = this.Authentication;\r\n        this.stepConfig = {\r\n            stepHeaders: [\r\n                { text: 'Set next order' },\r\n                { text: 'Set prices' }\r\n            ],\r\n            currentStep: 1,\r\n            stepCount: 2,\r\n            items: []\r\n        };\r\n        this.init();\r\n    }\r\n    CreateOrdersController.prototype.init = function () {\r\n        var _this = this;\r\n        angular.copy(this.orderCopy, this.order);\r\n        if (this.isCreateMode) {\r\n            console.log('create mode');\r\n            this.Mangaitems.query().$promise.then(function (result) {\r\n                _this.stepConfig.items = result;\r\n                console.log('items: ', result);\r\n            });\r\n        }\r\n        else {\r\n            console.log('edit mode');\r\n            this.findOne();\r\n        }\r\n        console.log('init done: ');\r\n    };\r\n    CreateOrdersController.prototype.takeStep = function (step, direction) {\r\n        console.log('stepping: ', step, direction);\r\n        this.stepConfig.currentStep = (direction) ? step + 1 : step - 1;\r\n    };\r\n    CreateOrdersController.prototype.processOrder = function () {\r\n        if (this.order.nextVolume.volume > 0) {\r\n            var temp = angular.copy(this.order.nextVolume);\r\n            this.order.orderHistory.push(this.order.nextVolume);\r\n            this.order.nextVolume = {\r\n                volume: temp.volume + 1,\r\n                date: null,\r\n                rrp: this.order.rrp,\r\n                prices: []\r\n            };\r\n            this.update();\r\n        }\r\n    };\r\n    CreateOrdersController.prototype.cancel = function () {\r\n        this.$location.path('orders');\r\n    };\r\n    CreateOrdersController.prototype.create = function () {\r\n        var _this = this;\r\n        var order = new this.Orders({\r\n            series: this.order.series._id,\r\n            nextVolume: {\r\n                date: this.order.nextVolume.date,\r\n                volume: this.order.nextVolume.volume,\r\n                rrp: this.order.nextVolume.rrp,\r\n                prices: this.order.nextVolume.prices\r\n            },\r\n            rrp: this.order.rrp,\r\n            orderHistory: this.order.orderHistory\r\n        });\r\n        order.$save(function (response) {\r\n            _this.$location.path('orders/' + response._id);\r\n            _this.NotificationFactory.success('Saved!', 'New Order was successfully saved!');\r\n            angular.copy(_this.orderCopy, _this.order);\r\n        }, function (errorResponse) {\r\n            this.error = errorResponse.data.message;\r\n            this.NotificationFactory.error('Error!', 'Order failed to save!');\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.update = function () {\r\n        var _this = this;\r\n        var order = this.order;\r\n        order.$update(function () {\r\n            _this.$location.path('orders/' + order._id);\r\n            _this.NotificationFactory.success('Saved!', 'Order was successfully saved!');\r\n        }, function (errorResponse) {\r\n            this.error = errorResponse.data.message;\r\n            this.NotificationFactory.error('Error!', 'Order failed to save!');\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.openBoughtDialog = function () {\r\n        var _this = this;\r\n        var modalInstance = this.$uibModal.open({\r\n            animation: true,\r\n            templateUrl: '/modules/orders/views/complete-order.client.view.html',\r\n            controller: 'CompleteOrdersController as modal',\r\n            size: 'md',\r\n            resolve: {\r\n                order: function () {\r\n                    return _this.order;\r\n                }\r\n            }\r\n        });\r\n        modalInstance.result.then(function (result) {\r\n            console.log(result);\r\n            _this.order = result;\r\n            _this.processOrder();\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.findOne = function () {\r\n        this.order = this.Orders.get({ orderId: this.$stateParams.orderId });\r\n        console.log('found one: ', this.order);\r\n    };\r\n    CreateOrdersController.controllerId = 'CreateOrdersController';\r\n    CreateOrdersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', '$q', 'Orders', 'Mangaitems', '$uibModal', 'NotificationFactory'];\r\n    return CreateOrdersController;\r\n}());\r\nangular.module('orders').controller(CreateOrdersController.controllerId, CreateOrdersController);\r\n\r\n'use strict';\r\nvar OrderHistoryController = (function () {\r\n    function OrderHistoryController($scope, $uibModalInstance, order, $filter) {\r\n        this.$scope = $scope;\r\n        this.$uibModalInstance = $uibModalInstance;\r\n        this.order = order;\r\n        this.$filter = $filter;\r\n        this.processHistory();\r\n    }\r\n    OrderHistoryController.prototype.processHistory = function () {\r\n        var _this = this;\r\n        angular.forEach(this.order.orderHistory, function (item) {\r\n            console.log('order history: ', item);\r\n            var len = item.prices.length;\r\n            for (var i = 0; i < len; i++) {\r\n                if (item.prices[i].paid) {\r\n                    var cost = _this.$filter('number')(item.prices[i].price, 2), rrp = _this.$filter('number')(item.prices[i].rrp, 2);\r\n                    item.purchaseDate = item.prices[i].date;\r\n                    item.paid = cost;\r\n                    item.rrpInstance = rrp;\r\n                    item.saving = ((cost / rrp) * 100).toFixed(2);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    OrderHistoryController.prototype.cancel = function () {\r\n        this.$uibModalInstance.dismiss('cancel');\r\n    };\r\n    OrderHistoryController.controllerId = 'OrderHistoryController';\r\n    OrderHistoryController.$inject = ['$scope', '$uibModalInstance', 'order', '$filter'];\r\n    return OrderHistoryController;\r\n}());\r\nangular.module('orders').controller(OrderHistoryController.controllerId, OrderHistoryController);\r\n\r\n'use strict';\r\nvar OrdersController = (function () {\r\n    function OrdersController($scope, $stateParams, $location, Authentication, Orders, spinnerService, $uibModal) {\r\n        this.$scope = $scope;\r\n        this.$stateParams = $stateParams;\r\n        this.$location = $location;\r\n        this.Authentication = Authentication;\r\n        this.Orders = Orders;\r\n        this.spinnerService = spinnerService;\r\n        this.$uibModal = $uibModal;\r\n        this.authentication = this.Authentication;\r\n        this.order = undefined;\r\n        this.orders = [];\r\n        this.pageConfig = {\r\n            currentPage: 0,\r\n            pageSize: 10\r\n        };\r\n        this.init();\r\n    }\r\n    OrdersController.prototype.init = function () {\r\n        console.log('init: ', this.$stateParams);\r\n        if (this.$stateParams.orderId) {\r\n            console.log('find one');\r\n            this.findOne();\r\n        }\r\n        else {\r\n            console.log('find all');\r\n            this.find();\r\n        }\r\n    };\r\n    OrdersController.prototype.remove = function (order) {\r\n        if (order) {\r\n            order.$remove();\r\n            for (var i = 0, length = this.order.length; i < length; i++) {\r\n                if (this.orders[i] === order) {\r\n                    this.orders.splice(i, 1);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.order.$remove(function () {\r\n                this.$location.path('orders');\r\n            });\r\n        }\r\n    };\r\n    OrdersController.prototype.find = function () {\r\n        var _this = this;\r\n        this.spinnerService.loading('orders', this.Orders.query().$promise.then(function (result) {\r\n            _this.orders = result;\r\n        }));\r\n    };\r\n    OrdersController.prototype.findOne = function () {\r\n        var _this = this;\r\n        this.spinnerService.loading('orders', this.Orders.get({ orderId: this.$stateParams.orderId }).$promise.then(function (result) {\r\n            _this.order = result;\r\n        }));\r\n    };\r\n    OrdersController.prototype.openOrderHistoryDialog = function () {\r\n        var _this = this;\r\n        var modalInstance = this.$uibModal.open({\r\n            animation: true,\r\n            templateUrl: '/modules/orders/views/order-history.client.view.html',\r\n            controller: 'OrderHistoryController as modal',\r\n            size: 'md',\r\n            resolve: {\r\n                order: function () {\r\n                    return _this.order;\r\n                }\r\n            }\r\n        });\r\n    };\r\n    OrdersController.controllerId = 'OrdersController';\r\n    OrdersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Orders', 'spinnerService', '$uibModal'];\r\n    return OrdersController;\r\n}());\r\nangular.module('orders').controller(OrdersController.controllerId, OrdersController);\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('orders').factory('Orders', OrdersFactory);\r\n\tOrdersFactory.$inject = ['$resource'];\r\n\r\n\tfunction OrdersFactory($resource) {\r\n\t\treturn $resource('orders/:orderId', { orderId: '@_id'\r\n\t\t}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('ratings').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('ratings', {\r\n\t\t\turl: '/ratings',\r\n\t\t\ttemplateUrl: 'modules/ratings/views/ratings.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('ratings')\r\n\t.controller('RatingsController', RatingsController);\r\n\tRatingsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'ListService', 'NotificationFactory', 'StatisticsService', 'spinnerService'];\r\n\tfunction RatingsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, ListService, NotificationFactory, StatisticsService, spinnerService) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.episodeScore = episodeScore;\r\n\t\tctrl.find = find;\r\n\t\tctrl.go = go;\r\n\t\tctrl.hoveringOver = hoveringOver;\r\n\t\tctrl.itemScore = itemScore;\r\n\t\tctrl.maxRating = 10;\r\n\t\tctrl.modelOptions = { debounce: 700 };\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 20\r\n    };\r\n    ctrl.ratingLevel = undefined; //default rating filter\r\n    ctrl.sortReverse = true;\r\n    ctrl.sortType = 'rating';\r\n\t\tctrl.view = 'Anime';\r\n\t\tctrl.viewEpisodeRatings = viewEpisodeRatings;\r\n    ctrl.viewItem = undefined;\r\n\r\n\t\t//rating 'tooltip' function\r\n    function hoveringOver(value) {\r\n        ctrl.overStar = value;\r\n        ctrl.percent = 100 * (value / ctrl.maxRating);\r\n    }\r\n\r\n    function go(id) {\r\n        $location.path('/mangaitems/' + id);\r\n    }\r\n\r\n    function getItems(view) {\r\n        if (view === 'Anime') {\r\n            spinnerService.loading('rating', Animeitems.query().$promise.then(function(result) {\r\n                ctrl.items = result;\r\n            }));\r\n        } else if (view === 'Manga') {\r\n            spinnerService.loading('rating', Mangaitems.query().$promise.then(function(result) {\r\n                ctrl.items = result;\r\n            }));\r\n        }\r\n        ctrl.viewItem = undefined;\r\n    }\r\n\r\n    function find(view) {\r\n\t\t\tif(view === 'Anime' || view === 'Manga') {\r\n\t\t\t\t getItems(view);\r\n\t\t\t } else {\r\n\t\t\t\tctrl.view = 'Anime';\r\n\t\t\t\tgetItems(ctrl.view);\r\n\t\t\t }\r\n    }\r\n\r\n    //apply new score.\r\n    function itemScore(item, score) {\r\n        if (item.rating !== score) {\r\n            item.rating = score;\r\n\r\n            item.$update(function() {\r\n                $location.path('ratings');\r\n                NotificationFactory.success('Saved!', 'New rating was saved successfully');\r\n            }, function(errorResponse) {\r\n                ctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Your change failed!');\r\n            });\r\n//                console.log('update');\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /** Episode rating functions below here.\r\n     */\r\n    function viewEpisodeRatings(item) {\r\n        ctrl.viewItem = (ctrl.viewItem !== item) ? item : undefined;\r\n        ctrl.isEqual = (ctrl.viewItem === item) ? true : false;\r\n        ctrl.search = (ctrl.viewItem === item) ? item.title : '';\r\n        if (ctrl.viewItem !== undefined) {\r\n            spinnerService.loading('summary', StatisticsService.buildSummaryFunctions(ctrl.viewItem.meta.history).then(function(result) {\r\n                ctrl.summaryFunctions = result;\r\n            }));\r\n        }\r\n    }\r\n\r\n    function episodeScore(finished) {\r\n//            console.log('finished: ', finished, ctrl.viewItem.meta.history);\r\n        if (finished) {\r\n            var item = ctrl.viewItem;\r\n            item.$update(function() {\r\n                $location.path('ratings');\r\n                NotificationFactory.success('Saved!', 'New episode rating was saved successfully');\r\n                spinnerService.loading('summary', StatisticsService.buildSummaryFunctions(ctrl.viewItem.meta.history).then(function(result) {\r\n                    ctrl.summaryFunctions = result;\r\n                }));\r\n            }, function(errorResponse) {\r\n                ctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Your change failed!');\r\n            });\r\n        }\r\n    }\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n    focusOnShow.$inject = [\"$timeout\"];\r\n  angular.module('ratings')\r\n  .directive('focusOnShow', focusOnShow);\r\n\r\n  function focusOnShow($timeout) {\r\n    return function(scope, element, attrs) {\r\n       scope.$watch(attrs.focusOnShow, function (newValue) {\r\n//            console.log('preview changed!')\r\n            $timeout(function() {\r\n                var myValue = newValue && element[0].focus();\r\n                return myValue;\r\n            });\r\n         },true);\r\n      };\r\n    }\r\n})();\r\n\r\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('statistics').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('statistics', {\r\n\t\t\turl: '/statistics',\r\n\t\t\ttemplateUrl: 'modules/statistics/views/statistics.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('statistics').controller('StatisticsController', StatisticsController);\r\n\tStatisticsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'Characters', 'Toptens', 'ListService', 'ItemService', 'CharacterService', 'StatisticsService', '$filter', 'spinnerService'];\r\n\r\n\t\tfunction StatisticsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, Characters, Toptens, ListService, ItemService, CharacterService, StatisticsService, $filter, spinnerService) {\r\n\t\t\tvar ctrl = this,\r\n\t\t\t\t\tfilter = $filter('filter');\r\n\t\t\tctrl.authentication = Authentication;\r\n\t\t\tctrl.colours = { red: '#c9302c', green: '#449d44', blue: '#31b0d5' }; //'red'; '#d9534f'; ////'green';'#5cb85c'; ////'blue';'#5bc0de'; //\r\n\t\t\tctrl.commonArrays = ListService.getCommonArrays('statistics');\r\n\t\t\tctrl.dataStore = { anime: [], manga: [], character: [], toptens: { anime: {}, manga: {}, character: {} } };\r\n\t\t\tctrl.detail = {\r\n\t\t\t\t\tisVisible: false,\r\n\t\t\t\t\tyear: '',\r\n\t\t\t\t\tdivision: '',\r\n\t\t\t\t\tdivisionText: '',\r\n\t\t\t\t\thistory: 'months',\r\n\t\t\t\t\tsummary: {\r\n\t\t\t\t\t\t\ttype: '',\r\n\t\t\t\t\t\t\tisVisible: false\r\n\t\t\t\t\t},\r\n\t\t\t\t\tisEpisodeRatings: false\r\n\t\t\t};\r\n\t\t\tctrl.filterConfig = {\r\n          show: {\r\n              tag: false,\r\n              series: false,\r\n              voice: false\r\n          },\r\n          sort: {\r\n\t\t\t\t\t\t\tepisodeRating: {\r\n\t\t\t\t\t\t\t\ttype: 'title',\r\n\t\t\t\t\t\t\t\treverse: false\r\n\t\t\t\t\t\t\t},\r\n              tag: {\r\n                  type: 'ratingWeighted',\r\n                  reverse: true\r\n              },\r\n              tagDetail: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n              series: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n              voice: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n\t\t\t\t\t\t\ttopten: {\r\n\t\t\t\t\t\t\t\ttype: 'count',\r\n\t\t\t\t\t\t\t\treverse: true\r\n\t\t\t\t\t\t\t}\r\n          },\r\n          search: {\r\n              tag: '',\r\n              tagDetail: '',\r\n              series: '',\r\n              voice: '',\r\n\t\t\t\t\t\t\ttopten: ''\r\n          },\r\n\t\t\t\t\ttopten: {\r\n\t\t\t\t\t\tisRanked: false,\r\n\t\t\t\t\t\tisFavourite: false\r\n\t\t\t\t\t}\r\n      };\r\n\t\t\tctrl.find = find;\r\n\t\t\tctrl.gender = {}; //holds gender summary details.\r\n\t\t\tctrl.generateSeasons = generateSeasons;\r\n\t\t\tctrl.getFilteredItems = getFilteredItems;\r\n\t\t\tctrl.getToptenItemStatistics = getToptenItemStatistics;\r\n\t\t\tctrl.historyDetail = historyDetail;\r\n      ctrl.historyDetails = {};\r\n      ctrl.overview = {}; //holds summary/overview details.\r\n      ctrl.ratingsDistribution = []; //counts for each rating.\r\n      ctrl.statSeries = []; //for series statistics;\r\n      ctrl.statTags = []; //for tag statistics;\r\n\t\t\tctrl.tableDetail = tableDetail;\r\n\t\t\tctrl.tableDetails = {};\r\n      ctrl.taglessItem = false; //filter variable for showing tagless items.\r\n      ctrl.toptens = {\r\n\t\t\t\ttype: 'anime',\r\n\t\t\t\tanime: { listCount: 0, items: [] }, manga:  { listCount: 0, items: [] }, character:  { listCount: 0, items: [] }, detail: { items: [] }\r\n\t\t\t };\r\n      ctrl.view = 'Anime';\r\n      ctrl.voiceActors = []; //for voice actor list;\r\n\r\n\t\t\tfunction getItemStatistics(view, items) {\r\n\t\t\t\tif(view === 'Anime' || view === 'Manga') {\r\n\t\t\t\t\tctrl.overview = ItemService.buildOverview(items);\r\n\t\t\t\t\tctrl.historyDetails.months = ItemService.completeByMonth(items);\r\n\t\t\t\t\tif (view === 'Anime') ctrl.historyDetails.seasons = ItemService.completeBySeason(items);\r\n\t\t\t\t\tctrl.ratingValues = ItemService.getRatingValues(items);\r\n\t\t\t\t\tctrl.ratingsDistribution = ItemService.buildRatingsDistribution(items);\r\n\t\t\t\t\tctrl.statTags = ItemService.buildStatTags(items, ctrl.ratingValues.averageRating);\r\n\t\t\t\t} else if (view === 'Character') {\r\n\t\t\t\t\tctrl.statTags = CharacterService.buildCharacterTags(items);\r\n\t\t\t\t\tctrl.statSeries = CharacterService.buildSeriesList(items);\r\n\t\t\t\t\tctrl.voiceActors = CharacterService.buildVoiceActors(items);\r\n\t\t\t\t\tCharacterService.buildGenderDistribution(ctrl.statTags, items.length).then(function(result) {\r\n\t\t\t\t\t\t\tctrl.gender = result;\r\n\t\t\t\t\t\t\tctrl.gender[0].colour = ctrl.colours.red;\r\n\t\t\t\t\t\t\tctrl.gender[1].colour = ctrl.colours.green;\r\n\t\t\t\t\t\t\tctrl.gender[2].colour = ctrl.colours.blue;\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (view ==='Topten') {\r\n\t\t\t\t\tStatisticsService.buildToptenModeList(items, ctrl.toptens.type).then(function(result) {\r\n\t\t\t\t\t\tctrl.toptens.detail.items = result.sort(function(a, b) {\r\n\t\t\t\t\t\t\tif(a.count < b.count) return 1;\r\n\t\t\t\t\t\t\tif(a.count > b.count) return -1;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.log('topten stat process: ', items, ctrl.toptens);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//handle getting view items and setting view specific defaults.\r\n      function getItems(view) {\r\n          //reset defaults that are shared between views.\r\n          ctrl.detail.history = 'months';\r\n          ctrl.filterConfig.search.tag = '';\r\n          ctrl.detail.isVisible = false;\r\n          ctrl.detail.isEpisodeRatings = false;\r\n          ctrl.statTags = []; //clear to stop multiple views tags appearing.\r\n          ctrl.ratingsDistribution = [];\r\n          if (view === 'Anime') {\r\n              ctrl.filterConfig.sort.tag.type = 'ratingWeighted'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.anime.length === 0) {\r\n                spinnerService.loading('items', Animeitems.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.anime = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t                getItemStatistics(view, result);\r\n\t\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.anime;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.anime);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - anime');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Manga') {\r\n              ctrl.filterConfig.sort.tag.type = 'ratingWeighted'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.manga.length === 0) {\r\n              \tspinnerService.loading('items',\tMangaitems.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.manga = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t\t\t\t\t\t\t\t\tgetItemStatistics(view, result);\r\n              \t}));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.manga;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.manga);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - anime');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Character') {\r\n              ctrl.filterConfig.sort.tag.type = 'count'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.character.length === 0) {\r\n\t\t\t\t\t\t\t\tspinnerService.loading('character', Characters.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.character = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t\t\t\t\t\t\t\t\tgetItemStatistics(view, result);\r\n                }));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.character;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.character);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - character');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Topten') {\r\n\t\t\t\t\t\tif (ctrl.dataStore.toptens.anime.totalListCount === undefined) {\r\n              spinnerService.loading('topten', Toptens.query().$promise.then(function(result) {\r\n                return ListService.groupItemsByProperties(result, ['type']);\r\n              }).then(function(result) {\r\n\t\t\t\t\t\t\t\tfor(var i = 0, type = ''; i < 3; i++) {\r\n\t\t\t\t\t\t\t\t\ttype = result[i][0].type;\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.toptens[type].items = result[i];\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.toptens[type].totalListCount = result[i].length;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn StatisticsService.buildToptenDataStructure(ctrl.toptens, result);\r\n              }).then(function(result) {\r\n\t\t\t\t\t\t\t\tctrl.toptens = result;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, result[ctrl.toptens.type].items);\r\n\t\t\t\t\t\t\t\tconsole.log('topten arrays: ', ctrl.toptens);\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.toptens[ctrl.toptens.type].items);\r\n\t\t\t\t\t\t\tconsole.log('from cache - topten');\r\n\t\t\t\t\t\t}\r\n          }\r\n\t\t\t\t\tconsole.log('dataStore check: ', ctrl.dataStore);\r\n      }\r\n      function find(view) {\r\n          getItems(view);\r\n      }\r\n\r\n\t\t\tfunction getToptenItemStatistics(view, toptenType) {\r\n\t\t\t\tconsole.log('get topten stats: ', toptenType);\r\n\t\t\t\tvar filteredItems = ctrl.dataStore.toptens[toptenType].items;\r\n\t\t\t\tif(ctrl.filterConfig.topten.isRanked) filteredItems = filter(filteredItems, { isRanked: true });\r\n\t\t\t\tif(ctrl.filterConfig.topten.isFavourite) filteredItems = filter(filteredItems, { isFavourite: true });\r\n\t\t\t\tconsole.log('post filtering: ', filteredItems);\r\n\t\t\t\tif(filteredItems.length > 0) {\r\n\t\t\t\t\tctrl.toptens[toptenType].items = []; //clear items so you won't get repeats.\r\n\t\t\t\t\tStatisticsService.buildToptenDataStructure(ctrl.toptens, [filteredItems]).then(function(result) {\r\n\t\t\t\t\t\tctrl.toptens = result;\r\n\t\t\t\t\t\tconsole.log('topten data structure - result: ', result, ctrl.toptens);\r\n\t\t\t\t\t\tgetItemStatistics(view, result[toptenType].items);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctrl.toptens[toptenType].listCount = 0;\r\n\t\t\t\t\tctrl.toptens.detail.items = filteredItems;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n      //Builds ratings aggregates.\r\n      function getSummaryFunctions(array) {\r\n      \tspinnerService.loading('detail', StatisticsService.buildSummaryFunctions(array).then(function(result) {\r\n        \tctrl.historyDetails.summaryFunctions = result;\r\n\t\t\t\t\tconsole.log('got summary functions: ', ctrl.detail, ctrl.historyDetails);\r\n        }));\r\n        if (ctrl.detail.summary.isVisible === true) {\r\n\t        spinnerService.loading('detail',\r\n\t            StatisticsService.buildYearSummary(array, ctrl.detail.year, ctrl.detail.summary.type).then(function(result) {\r\n\t                ctrl.historyDetails.yearSummary = result;\r\n\t\t\t\t\t\t\t\t\tconsole.log('got year summary: ', ctrl.detail, ctrl.historyDetails);\r\n\t            })\r\n\t        );\r\n        }\r\n\t\t\t\tif(ctrl.detail.isEpisodeRatings && array[0].meta.episodeSummaryFunctions === undefined) { //If the first item has it already, they all do and this is pointless.\r\n          spinnerService.loading('detail', StatisticsService.buildEpisodeSummaries(array).then(function(result) {\r\n                  console.log(array);\r\n          }));\r\n\t\t\t\t}\r\n//            console.log(array, $scope.historyDetails);\r\n      }\r\n\r\n      function historyDetail(year, division, divisionText, summaryType) {\r\n\t      ctrl.detail.isVisible = true;\r\n\t      ctrl.detail.year = year;\r\n\t      ctrl.detail.division = division;\r\n\t      ctrl.detail.divisionText = divisionText;\r\n\t\t\t\tctrl.detail.summary.type = summaryType;\r\n\t      ctrl.detail.summary.isVisible = (summaryType === undefined) ? false : true;\r\n\t\t\t\tctrl.getFilteredItems();\r\n      }\r\n\r\n      function tableDetail(type, name) {\r\n          if (ctrl.tableDetails[type] === name) {\r\n              ctrl.filterConfig.search[type] = '';\r\n              ctrl.filterConfig.show[type] = false;\r\n              ctrl.tableDetails[type] = '';\r\n              if (type === 'tag') ctrl.tableDetails.isEqual = false;\r\n          } else {\r\n              ctrl.filterConfig.search[type] = name;\r\n              ctrl.tableDetails[type] = name;\r\n              ctrl.filterConfig.show[type] = true;\r\n              if (type === 'tag') {\r\n                  ctrl.tagDetailResult = CharacterService.buildRelatedCharacterTags(ctrl.items, name);\r\n                  ctrl.tableDetails.isEqual = true;\r\n              }\r\n          }\r\n      }\r\n\r\n\t\t\tfunction getFilteredItems(historyChange) {\r\n\t\t\t\tif(historyChange) {\r\n\t\t\t\t\tctrl.detail.isVisible = false;\r\n\t\t\t\t\tctrl.detail.summary.isVisible = false;\r\n\t\t\t\t\tif(ctrl.detail.history === 'months') ctrl.detail.isEpisodeRatings = false;\r\n\t\t\t\t}\r\n\t\t\t\tvar filtered = $filter('statisticsDetailFilter')(ctrl.items, ctrl.detail.history, ctrl.detail.year, ctrl.detail.division);\r\n\t\t\t\tgetSummaryFunctions(filtered);\r\n\t\t\t}\r\n\r\n      /** Using the start date of confirmed 'in-season' shows\r\n       *  to populate the new season attrs. that will work with the new\r\n       *  filters in the hopes accuracy and speed will increase.\r\n       */\r\n      function generateSeasons() {\r\n          if (ctrl.view === 'Anime') {\r\n              var array = ItemService.setSeason(ctrl.items, ctrl.detailSeasonYear, ctrl.detailSeason);\r\n              angular.forEach(array, function(item) {\r\n                  item.$update(function() {\r\n                      console.log(item);\r\n                  }, function(errorResponse) {\r\n                      ctrl.error = errorResponse.data.message;\r\n                  });\r\n              });\r\n          }\r\n      }\r\n\t\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('detectFlood', detectFlood);\r\n  detectFlood.$inject = ['$timeout'];\r\n\r\n  function detectFlood($timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function(scope, element, attrs) {\r\n            var el = element[0];\r\n\r\n            function overflowCheck() {\r\n                if (el.scrollWidth > el.offsetWidth) {\r\n                    el.classList.add('flooded');\r\n                } else {\r\n                    el.classList.remove('flooded');\r\n                }\r\n            }\r\n            overflowCheck();\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: el.offsetWidth,\r\n                    };\r\n                }, function () {\r\n//                    console.log('detect flood?');\r\n                        overflowCheck();\r\n                }, true\r\n            );\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('percentageBarContainer', percentageBarContainer);\r\n\r\n  function percentageBarContainer() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        scope: {\r\n          border: '@?'\r\n        },\r\n        transclude: true,\r\n        bindToController: true,\r\n        template: '<div class=\"relative {{percentageBarContainer.border}}\" style=\"height: 20px;\" ng-transclude></div>',\r\n        controllerAs: 'percentageBarContainer',\r\n        controller: [\"$scope\", function($scope) {\r\n\r\n        }]\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('percentageBar', percentageBar);\r\n\r\n  function percentageBar() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        scope: {\r\n            type: '@?',\r\n            percentage: '@',\r\n            colour: '@?',\r\n            display: '@?'\r\n        },\r\n        require: '^percentageBarContainer',\r\n        templateUrl: '/modules/statistics/templates/percentage-bar.html',\r\n        link: function(scope, element, attrs, percentageBarContainerCtrl) {\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('tabContainer', tabContainer);\r\n\r\n  function tabContainer() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        scope: {\r\n            model: '=ngModel'\r\n        },\r\n        templateUrl: '/modules/statistics/templates/tab-container.html',\r\n        require: '?ngModel',\r\n        bindToController: true,\r\n        controllerAs: 'tabContainer',\r\n        controller: [\"$scope\", function($scope) {\r\n            var self = this;\r\n            self.tabs = [];\r\n            self.currentTab = undefined;\r\n            self.listShift = 0;\r\n\r\n            self.addTab = function addTab(tab) {\r\n                self.tabs.push(tab);\r\n\r\n                if(self.tabs.length === 1) {\r\n                    tab.active = true;\r\n                }\r\n            };\r\n\r\n            self.disable = function(disabledTab) {\r\n                if(disabledTab.active) {\r\n                    angular.forEach(self.tabs, function(tab) {\r\n                        if(!tab.disabled) {\r\n                            self.select(tab);\r\n                            return;\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n\r\n            self.select = function(selectedTab) {\r\n                if(!selectedTab.disabled) {\r\n                    angular.forEach(self.tabs, function(tab) {\r\n                        if(tab.active && tab !== selectedTab) {\r\n                          tab.active = false;\r\n                        }\r\n                    });\r\n                    selectedTab.active = true;\r\n                    self.currentTab = ($scope.tabContainer.model === undefined) ? undefined : selectedTab.heading;\r\n                }\r\n            };\r\n\r\n            self.shiftTabs = function(direction) {\r\n                switch(direction) {\r\n                    case 'origin':\r\n//                        console.log(self.listShift, (self.listShift - 100));\r\n                        if ((self.listShift + 100) > 0) {\r\n                            self.listShift = 0;\r\n                        } else {\r\n                            self.listShift += 100;\r\n                        }\r\n                        break;\r\n\r\n                    case 'offset':\r\n                        if ((self.listShift - 100) < ($scope.elWidth - $scope.ulWidth)) {\r\n                            self.listShift = $scope.elWidth - $scope.ulWidth;\r\n                        } else {\r\n                            self.listShift -= 100;\r\n                        }\r\n                        break;\r\n                }\r\n            };\r\n\r\n        }],\r\n        link: function(scope, element, attrs, model) {\r\n            var el = element[0],\r\n                ul = el.children[0].children[0];\r\n            scope.elWidth = el.offsetWidth;\r\n            scope.ulWidth = ul.offsetWidth;\r\n\r\n            scope.$watch('tabContainer.currentTab', function(newValue) {\r\n                if (newValue !== undefined && model.$viewValue !== undefined) {\r\n                    model.$setViewValue(newValue);\r\n                }\r\n            });\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: el.offsetWidth,\r\n                    };\r\n                }, function () {\r\n                    scope.elWidth = el.offsetWidth;\r\n                }, true\r\n            );\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: ul.offsetWidth,\r\n                    };\r\n                }, function () {\r\n                    scope.ulWidth = ul.offsetWidth;\r\n                }, true\r\n            );\r\n\r\n            scope.$watch('tabContainer.listShift', function(newValue) {\r\n                if(newValue !== undefined) {\r\n                    var shift = (newValue === 0) ? '' : 'px';\r\n                    ul.style.left = newValue + shift;\r\n                }\r\n            });\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('tabView', tabView);\r\n\r\n  function tabView() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        template: '<div class=\"tab-view\" role=\"tabpanel\" ng-show=\"active\" ng-transclude></div>',\r\n        require: '^tabContainer',\r\n        scope: {\r\n            heading: '@',\r\n            disabled: '='\r\n        },\r\n        link: function (scope, element, attrs, tabContainerCtrl) {\r\n            scope.active = false;\r\n            tabContainerCtrl.addTab(scope);\r\n\r\n            scope.$watch('disabled', function(newValue) {\r\n                if(newValue !== undefined) {\r\n                    if(newValue) {\r\n                        console.log(scope.heading, newValue);\r\n                        tabContainerCtrl.disable(scope);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  //Statistics service\r\n  angular.module('statistics')\r\n  .service('StatisticsService', StatisticsService);\r\n  StatisticsService.$inject = ['$filter', 'ListService', '$q'];\r\n\r\n   function StatisticsService($filter, ListService, $q) {\r\n      var service = {\r\n        buildEpisodeSummaries: buildEpisodeSummaries,\r\n        buildSummaryFunctions: buildSummaryFunctions,\r\n        buildToptenDataStructure: buildToptenDataStructure,\r\n        buildToptenModeList: buildToptenModeList,\r\n        buildYearSummary: buildYearSummary,\r\n        getModeMap: getModeMap,\r\n        occuranceCounter: occuranceCounter\r\n      };\r\n      return service;\r\n\r\n      function buildSummaryFunctions(array) {\r\n          return $q(function(resolve, reject) {\r\n              if (array !== undefined) {\r\n                  var i = array.length, highestRating = 0, lowestRating = 10, averageRating = 0, modeRating = {}, ratings = { count: 0, sum: 0 };\r\n                  while(i--) {\r\n      //                console.log(array[i]);\r\n                      highestRating = array[i].rating > highestRating ? array[i].rating : highestRating;\r\n                      lowestRating = 0 < array[i].rating && array[i].rating < lowestRating ? array[i].rating : lowestRating;\r\n                      ratings.count += array[i].rating > 0 ? 1 : 0;\r\n                      ratings.sum += array[i].rating;\r\n                      averageRating = (ratings.sum / ratings.count).toFixed(2);\r\n                      modeRating = service.getModeMap(array, 'rating', 0);\r\n                  }\r\n                  resolve([\r\n                      { metric: 'Average rating', value: averageRating },\r\n                      { metric: 'Highest rating', value: highestRating },\r\n                      { metric: 'Lowest rating',  value: (lowestRating === 10) ? 0 : lowestRating },\r\n                      { metric: 'Mode rating',    value: (modeRating.value === undefined) ? 0 : modeRating.value }\r\n                  ]);\r\n              }\r\n          });\r\n      }\r\n\r\n      function processYearSummary(summary, array) {\r\n          var i = array.length;\r\n          if (summary.length < 1) {\r\n              while(i--) {\r\n                  summary.push({\r\n                      metric: array[i].metric,\r\n                      values: []\r\n                  });\r\n              }\r\n              summary.reverse();\r\n          }\r\n          i = array.length;\r\n          for(var j = 0; j < i; j++) {\r\n              summary[j].values.push({ value: array[j].value });\r\n          }\r\n          return summary;\r\n      }\r\n\r\n      function buildYearSummary(array, year, type) {\r\n          return $q(function(resolve, reject) {\r\n              var filter = (type === 'months') ? 'endedMonth' : 'season',\r\n                  attr   = (type === 'months') ? 'number'     : 'text'  ,\r\n                  commonArrays = ListService.getCommonArrays(),\r\n                  i = commonArrays[type].length,\r\n                  yearSummary = [], results = [];\r\n\r\n              for(var j = 0; j < i; j++) {\r\n                  var filteredArray = $filter(filter)(array, year, commonArrays[type][j][attr]),\r\n                      promise = service.buildSummaryFunctions(filteredArray);\r\n                  results.push(promise);\r\n              }\r\n              angular.forEach(results, function(promise) {\r\n                  promise.then(function(result) {\r\n                      yearSummary = processYearSummary(yearSummary, result);\r\n                  });\r\n              });\r\n              resolve(yearSummary);\r\n          });\r\n      }\r\n\r\n      function buildEpisodeSummaries(array) {\r\n          return $q(function(resolve, reject) {\r\n              angular.forEach(array, function(item) {\r\n                  service.buildSummaryFunctions(item.meta.history).then(function(result) {\r\n                      item.meta.episodeSummaryFunctions = result;\r\n                  });\r\n              });\r\n              resolve(array);\r\n          });\r\n      }\r\n\r\n      function getModeMap(array, attr, ignore) {\r\n          var modeMap = {},\r\n              max = {\r\n                  count: 0,\r\n                  value: ''\r\n              };\r\n          for(var i = 0; i < array.length; i++) {\r\n              var value = array[i][attr];\r\n              if(modeMap[value] === null || modeMap[value] === undefined) {\r\n                  modeMap[value] = 1;\r\n              } else {\r\n                  modeMap[value]++;\r\n              }\r\n              if(modeMap[value] > max.count) {\r\n                  //Ignore is a value you might not care about e.g. 0;\r\n                  if (ignore !== value) {\r\n                      max.count = modeMap[value];\r\n                      max.value = value;\r\n                  }\r\n              }\r\n          }\r\n  //        console.log(max);\r\n          return max;\r\n      }\r\n\r\n      function occuranceCounter(array, attr) {\r\n        return $q(function(resolve, reject) {\r\n          var occuranceCounter = [];\r\n          ListService.groupItemsByProperties(array, [attr]).then(function(result) {\r\n            for(var i = 0, len = result.length; i < len; i++) {\r\n              occuranceCounter.push({\r\n                value: result[i][0][attr],\r\n                count: result[i].length\r\n              });\r\n            }\r\n          });\r\n          resolve(occuranceCounter);\r\n        });\r\n      }\r\n\r\n      function buildToptenDataStructure(obj, arrayOfArrays) {\r\n        return $q(function(resolve, reject) {\r\n          angular.forEach(arrayOfArrays, function(array) {\r\n            var type = array[0].type, listType = type + 'List', len = array.length;\r\n            obj[type].listCount = len;\r\n            for(var i = 0; i < len; i++) {\r\n              var itemLen = array[i][listType].length;\r\n              for(var j = 0; j < itemLen; j++) {\r\n                obj[type].items.push(array[i][listType][j]);\r\n              }\r\n            }\r\n          });\r\n          resolve(obj);\r\n        });\r\n      }\r\n\r\n      function buildToptenModeList(array, type) {\r\n        var attr = type === 'character' ? 'name' : 'title';\r\n        return service.occuranceCounter(array, attr);\r\n      }\r\n\r\n    }\r\n\r\n  })();\r\n\r\n'use strict';\r\n\r\n//// Configuring the Articles module\r\n//angular.module('tasks').run(['Menus',\r\n//\tfunction(Menus) {\r\n//\t\t// Set top bar menu items\r\n//\t\tMenus.addMenuItem('topbar', 'Tasks', 'tasks', 'dropdown', '/tasks(/create)?');\r\n//\t\tMenus.addSubMenuItem('topbar', 'tasks', 'List Tasks', 'tasks');\r\n//\t\tMenus.addSubMenuItem('topbar', 'tasks', 'New Task', 'tasks/create');\r\n//\t}\r\n//]);\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('tasks').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Tasks state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listTasks', {\r\n\t\t\turl: '/tasks',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/list-tasks.client.view.html'\r\n\t\t}).\r\n\t\tstate('createTask', {\r\n\t\t\turl: '/tasks/create',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/create-task.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewTask', {\r\n\t\t\turl: '/tasks/:taskId',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/view-task.client.view.html'\r\n\t\t}).\r\n\t\tstate('editTask', {\r\n\t\t\turl: '/tasks/:taskId/edit',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/edit-task.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('tasks').controller('CreateTaskController', CreateTaskController);\r\n  CreateTaskController.$inject =  ['$scope', 'data', '$stateParams', '$location', 'Authentication', 'Tasks', 'ListService', 'NotificationFactory', 'TaskFactory', 'spinnerService', '$uibModalInstance', 'Animeitems', 'Mangaitems'];\r\n\r\nfunction CreateTaskController($scope, data, $stateParams, $location, Authentication, Tasks, ListService, NotificationFactory, TaskFactory, spinnerService, $uibModalInstance, Animeitems, Mangaitems) {\r\n  var ctrl = this,\r\n      newTaskModel = {};\r\n  ctrl.addChecklistItem = addChecklistItem;\r\n  ctrl.backStep = backStep;\r\n  ctrl.cancel = cancel;\r\n  ctrl.commonArrays = data.commonArrays;\r\n  ctrl.create = create;\r\n  ctrl.dropChecklistItem = dropChecklistItem;\r\n  ctrl.stepConfig = {\r\n      currentStep: 1,\r\n      stepCount: 2\r\n  };\r\n  ctrl.submit = submit;\r\n  ctrl.takeStep = takeStep;\r\n\r\n  function setNewTask() {\r\n      ctrl.newTask = {\r\n          description: '',\r\n          link: {\r\n              linked: false,\r\n              type: '',\r\n              anime: undefined,\r\n              manga: undefined\r\n          },\r\n          day: '',\r\n          date: new Date(),\r\n          repeat: 0,\r\n          category: '',\r\n          daily: false,\r\n          checklist: false,\r\n          checklistItems: [],\r\n          isAddTask: false\r\n      };\r\n  }\r\n  setNewTask();\r\n  angular.copy(ctrl.newTask, newTaskModel);\r\n\r\n\r\n  //for adding/removing options.\r\n  function addChecklistItem() {\r\n          if (ctrl.newTask.checklistItem!=='' && ctrl.newTask.checklistItem!==undefined) {\r\n              var i = 0;\r\n              var alreadyAdded = false;\r\n              if (ctrl.newTask.checklistItems.length > 0) {\r\n                  while(i < ctrl.newTask.checklistItems.length) {\r\n                      if (ctrl.newTask.checklistItems[i].text === ctrl.newTask.checklistItem) {\r\n                          alreadyAdded = true;\r\n                      }\r\n                      i++;\r\n                  }\r\n                  //if not in array add it.\r\n                  if (alreadyAdded === false) {\r\n                      ctrl.newTask.checklistItems.push({ text: ctrl.newTask.checklistItem, complete: false });\r\n                  }\r\n              } else {\r\n                  ctrl.newTask.checklistItems.push({ text: ctrl.newTask.checklistItem, complete: false });\r\n              }\r\n          }\r\n          ctrl.newTask.checklistItem = '';\r\n  }\r\n  function dropChecklistItem(text) {\r\n      var deletingItem = ctrl.newTask.checklistItems;\r\n      ctrl.newTask.checklistItems = [];\r\n      //update the task.\r\n      angular.forEach(deletingItem, function(item) {\r\n          if (item.text !== text) {\r\n              ctrl.newTask.checklistItems.push(item);\r\n          }\r\n      });\r\n  }\r\n\r\n  // Create new Task\r\n  function create() {\r\n//            console.log(this.newTask);\r\n    // Create new Task object\r\n    var task = new Tasks ({\r\n        description: ctrl.newTask.description,\r\n        link: {\r\n            linked: ctrl.newTask.link.linked,\r\n            type: (ctrl.newTask.link.linked === false) ? ''      :\r\n                  (ctrl.newTask.category === 'Watch')  ? 'anime' :\r\n                                                         'manga' ,\r\n            anime: (ctrl.newTask.link.anime === undefined) ? undefined : ctrl.newTask.link.anime._id ,\r\n            manga: (ctrl.newTask.link.manga === undefined) ? undefined : ctrl.newTask.link.manga._id\r\n        },\r\n        day: ctrl.newTask.daily === true ? 'Any' : ctrl.newTask.day,\r\n        date: ctrl.newTask.date === '' ? new Date() : ctrl.newTask.date,\r\n        repeat: (ctrl.newTask.link.linked === false) ? ctrl.newTask.repeat                     :\r\n                (ctrl.newTask.category === 'Watch')  ? ctrl.newTask.link.anime.finalEpisode    :\r\n                                                       1    ,\r\n        completeTimes: (ctrl.newTask.link.linked === false) ? 0                                     :\r\n                       (ctrl.newTask.category === 'Watch')  ? ctrl.newTask.link.anime.episodes      :\r\n                                                              0      ,\r\n        updateCheck: new Date().getDay() === 1 ? true : false,\r\n        complete: false,\r\n        category: ctrl.newTask.category === '' ? 'Other' : ctrl.newTask.category,\r\n        daily: ctrl.newTask.daily,\r\n        checklist: ctrl.newTask.checklist,\r\n        checklistItems: ctrl.newTask.checklistItems\r\n    });\r\n//\t\t\t// Redirect after save\r\n    task.$save(function(response) {\r\n      $location.path('tasks');\r\n      NotificationFactory.success('Saved!', 'New Task was successfully saved!');\r\n    }, function(errorResponse) {\r\n      ctrl.error = errorResponse.data.message;\r\n      console.log(errorResponse);\r\n      NotificationFactory.error('Error!', 'New Task failed to save!');\r\n    });\r\n  }\r\n\r\n  function backStep(step) {\r\n      ctrl.stepConfig.currentStep -= 1;\r\n  }\r\n  function takeStep(step) {\r\n      var check = process(step);\r\n      if (check.valid) {\r\n          ctrl.stepConfig.currentStep += 1;\r\n      } else {\r\n          NotificationFactory.popup('Attention!', check.message, 'warning');\r\n      }\r\n  }\r\n  function submit() {\r\n    ctrl.create();\r\n    $uibModalInstance.close();\r\n  }\r\n  function cancel() {\r\n    $uibModalInstance.dismiss();\r\n  }\r\n\r\n  function process(step) {\r\n      switch(step) {\r\n          case 1:\r\n              if (ctrl.newTask.link.linked === true) {\r\n                  var category = ctrl.newTask.category;\r\n                  if (category === 'Watch') {\r\n                      ctrl.linkItems = Animeitems.query({\r\n                          status: 0\r\n                      });\r\n                      ctrl.linkType = 'anime';\r\n                      ctrl.newTask.checklistItems = [];\r\n                      ctrl.newTask.checklist = false;\r\n                  } else if (category === 'Read') {\r\n                      ctrl.linkItems = Mangaitems.query({\r\n                          status: 0\r\n                      });\r\n                      ctrl.linkType = 'manga';\r\n                  } else {\r\n                      return { valid: false, message: 'Category must be either Watch or Read for linked items!' };\r\n                  }\r\n              } else {\r\n                  //Ensure that stuff is cleared when not linked.\r\n                  ctrl.linkType = '';\r\n                  ctrl.newTask.link.anime = undefined;\r\n                  ctrl.newTask.link.manga = undefined;\r\n              }\r\n              return { valid: true };\r\n      }\r\n  }\r\n}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('tasks').controller('ScheduleCalendarTaskController', ScheduleCalendarTaskController);\r\n\tScheduleCalendarTaskController.$inject = ['$scope', '$uibModalInstance', 'moment', 'data', 'ListService', 'TaskFactory'];\r\n\r\n\tfunction ScheduleCalendarTaskController($scope, $uibModalInstance, moment, data, ListService, TaskFactory) {\r\n    var ctrl = this,\r\n\t\t\t\trefresh = false,\r\n\t\t\t\ttimeDiff = Math.abs(new Date(data.date).getTime() - new Date().getTime());\r\n\r\n\t\tctrl.cancel = cancel;\r\n    ctrl.date = new Date(data.date);\r\n\t\tctrl.day = ctrl.date.getDay() > 0 ? ctrl.date.getDay() - 1 : 6;\r\n\t\tctrl.days = data.days;\r\n\t\tctrl.daysFromToday = Math.ceil(timeDiff / (1000 * 3600 * 24));\r\n    ctrl.events = [];\r\n\t\tctrl.init = init;\r\n\t\tctrl.insertChecklistItem = insertChecklistItem;\r\n\t\tctrl.removeTask = removeTask;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.tickOffChecklist = tickOffChecklist;\r\n\t\tctrl.today = new Date();\r\n\t\tctrl.updateTask = updateTask;\r\n\t\tconsole.log('data: ', data, 'days: ', ctrl.days, ctrl.day, ctrl.date);\r\n\r\n\t\tfunction init() {\r\n\t\t\tvar weekEnds = new Date(ListService.weekEndingForDate(ctrl.date));\r\n\t\t\tangular.forEach(data.events, function(event) {\r\n\t\t\t\tif(new Date(event.date) < weekEnds && ((event.day.substring(0, 3) === ctrl.days[ctrl.day].text) || (event.day === 'Any'))) {\r\n\t\t\t\t\t// console.log('daysFromToday: ', ctrl.daysFromToday);\r\n\t\t\t\t\tif(!event.daily) {\r\n\t\t\t\t\t\t//in weeks\r\n\t\t\t\t\t\t// console.log('weeks: ', event.completeTimes, Math.floor(ctrl.daysFromToday / 7), event.repeat);\r\n\t\t\t\t\t\tif((event.completeTimes + Math.floor(ctrl.daysFromToday / 7) <= event.repeat) || event.repeat === 0) {\r\n\t\t\t\t\t\t\tctrl.events.push(event);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if(event.daily) {\r\n\t\t\t\t\t\t//in days\r\n\t\t\t\t\t\t// console.log('days: ', event.completeTimes, ctrl.daysFromToday, event.repeat);\r\n\t\t\t\t\t\tif(((event.completeTimes + ctrl.daysFromToday) <= event.repeat) || event.repeat === 0) {\r\n\t\t\t\t\t\t\tctrl.events.push(event);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tctrl.events.sort(function(a, b) {\r\n\t\t\t\tvar aDate = a.date, bDate = b.date;\r\n\t\t\t\treturn aDate < bDate ? 1 :\r\n\t\t\t\t\t\t\t aDate > bDate ? -1 : 0;\r\n\t\t\t});\r\n\t\t}\r\n\t\tctrl.init();\r\n\r\n\t\tfunction removeTask(task) {\r\n\t\t\tTaskFactory.removeTask(task, ctrl.events, true);\r\n\t\t}\r\n\t\t//Update task.\r\n\t\tfunction updateTask(task) {\r\n\t\t\t\tTaskFactory.updateTask(task);\r\n\t\t}\r\n    //Add new checklist item.\r\n    function insertChecklistItem(task, newChecklistItem) {\r\n        TaskFactory.insertChecklistItem(task, newChecklistItem);\r\n    }\r\n\t\t//Tick off a task.\r\n\t\tfunction tickOff(task) {\r\n\t\t    TaskFactory.tickOff(task).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOff: ', result);\r\n\t\t\t\t\trefresh = result.refresh;\r\n\t\t\t\t});\r\n\t\t}\r\n    //Tick of a checklist item.\r\n    function tickOffChecklist(task, index) {\r\n        TaskFactory.tickOffChecklist(task, index).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOffChecklist: ', result);\r\n\t\t\t\t\trefresh = result.refresh;\r\n\t\t\t\t});\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.close(refresh);\r\n    }\r\n\t}\r\n})();\r\n\r\n(function() {\r\n'use strict';\r\n\r\n\t// Tasks controller\r\n\tangular.module('tasks').controller('TasksController', TasksController);\r\n\tTasksController.$inject =  ['$scope', '$timeout', '$stateParams', '$location', 'Authentication', 'Tasks', 'ListService', 'NotificationFactory', 'TaskFactory', 'spinnerService', '$uibModal', 'moment'];\r\n\r\n\tfunction TasksController($scope, $timeout, $stateParams, $location, Authentication, Tasks, ListService, NotificationFactory, TaskFactory, spinnerService, $uibModal, moment) {\r\n\t\tvar ctrl = this,\r\n\t\t\t\ttoday = new Date(),\r\n\t\t\t\tday = today.getDay();\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.commonArrays = ListService.getCommonArrays();\r\n\t\tctrl.createTask = createTask;\r\n\t\tctrl.dateOptions = {\r\n\t\t\tdateDisabled: false,\r\n\t\t\tformatYear: 'yy',\r\n\t\t\tmaxDate: new Date(2020, 5, 22),\r\n\t\t\tminDate: new Date(),\r\n\t\t\tstartingDay: 1\r\n\t\t};\r\n\t\tctrl.filterConfig = {\r\n\t\t\tview: 'list',\r\n      showingCount: 0,\r\n      sortType: '',\r\n      sortReverse: true,\r\n      search: {\r\n          description: '',\r\n          day: ''\r\n      },\r\n      datesSelected: false\r\n    };\r\n\t\tctrl.insertChecklistItem = insertChecklistItem;\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 10\r\n    };\r\n\t\tctrl.refreshItems = refreshItems;\r\n\t\tctrl.removeTask = removeTask;\r\n\t\tctrl.setTabFilterDay = setTabFilterDay;\r\n\t\tctrl.tabFilter = tabFilter;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.tickOffChecklist = tickOffChecklist;\r\n\t\tctrl.updateTask = updateTask;\r\n\t\tctrl.weekBeginning = weekBeginning;\r\n\t\tctrl.whichController = 'task';\r\n\r\n    function tabFilter(tabName) {\r\n        ctrl.filterConfig.search.day = tabName;\r\n    }\r\n\r\n    function weekBeginning() {\r\n        return TaskFactory.getWeekBeginning();\r\n    }\r\n\r\n\t\tfunction createTask() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/tasks/views/create-task.client.view.html',\r\n        controller: 'CreateTaskController as taskCreate',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { commonArrays: ctrl.commonArrays };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed create task: ', result);\r\n\t\t\t\tfind();\r\n      });\r\n\t\t}\r\n\r\n\t\t// Remove existing Task\r\n\t\tfunction removeTask(task) {\r\n\t\t\tTaskFactory.removeTask(task, ctrl.tasks, true);\r\n\t\t}\r\n\t\t//Update task.\r\n\t\tfunction updateTask(task) {\r\n\t\t\t\tTaskFactory.updateTask(task);\r\n\t\t}\r\n    //Add new checklist item.\r\n    function insertChecklistItem(task, newChecklistItem) {\r\n        TaskFactory.insertChecklistItem(task, newChecklistItem);\r\n    }\r\n\t\t//Tick off a task.\r\n\t\tfunction tickOff(task) {\r\n\t\t    TaskFactory.tickOff(task).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOff: ', result);\r\n\t\t\t\t\tif(result.refresh) find();\r\n\t\t\t\t});\r\n\t\t}\r\n    //Tick of a checklist item.\r\n\t\tfunction tickOffChecklist(task, index) {\r\n        TaskFactory.tickOffChecklist(task, index).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOffChecklist: ', result);\r\n\t\t\t\t\tif(result.refresh) find();\r\n\t\t\t\t});\r\n    }\r\n\r\n    //Defaults the tab filter to the current day of the week.\r\n    function setTabFilterDay(day) {\r\n        var index = day === 0 ? 7 : day; //Adjust for Sunday.\r\n        ctrl.filterConfig.search.day = ctrl.commonArrays.days[index].name;\r\n        console.log(day, ctrl.filterConfig.search.day);\r\n    }\r\n    ctrl.setTabFilterDay(day);\r\n\r\n    //check things\r\n    function checkStatus() {\r\n        if (day === 1) {\r\n            console.log('monday', day);\r\n            angular.forEach(ctrl.tasks, function (task) {\r\n                //has it been updated today?\r\n                if(task.updateCheck === false) {\r\n                    console.log('updating - ', task.description);\r\n                    var type = task.link.type;\r\n                    if ((task.link.linked === false) || (type === 'manga')) {\r\n                        //has it reached the necessary number of repeats?\r\n                        if(task.completeTimes !== task.repeat) {\r\n                            console.log('not complete', task.description);\r\n                            task.complete = false;\r\n                            task.updateCheck = true;\r\n                            TaskFactory.updateTask(task);\r\n                        } else if (task.completeTimes === task.repeat) {\r\n                            console.log('complete - delete', task.description);\r\n                            TaskFactory.removeTask(task, ctrl.tasks);\r\n                        }\r\n                    } else if (task.link.type === 'anime') {\r\n                        console.log('linked');\r\n                            var parts = { single: 'episodes', all: 'finalEpisode' };\r\n                        if (task.link[type][parts.single] !== task.link[type][parts.all]) {\r\n                            console.log('linked not complete', task.description);\r\n                            task.complete = false;\r\n                            task.updateCheck = true;\r\n                            TaskFactory.updateTask(task);\r\n                        } else if (task.link[type][parts.single] === task.link[type][parts.all]) {\r\n                            console.log('linked complete - delete', task.description);\r\n                            TaskFactory.removeTask(task, ctrl.tasks);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n            console.log('not monday', day);\r\n            angular.forEach(ctrl.tasks, function (task) {\r\n                var change = task.updateCheck === false ? false : true;\r\n                task.updateCheck = false;\r\n                //is it a daily task?\r\n                if (task.daily === true) {\r\n                    console.log('daily', task.description);\r\n                    //has it reached the necessary number of repeats?\r\n                    if(task.completeTimes !== task.repeat) {\r\n                        console.log('not complete', task.description);\r\n                        var refresh = today.toISOString().slice(0,10);\r\n                        //has it been refreshed today?\r\n                        if (task.dailyRefresh.slice(0,10) !== refresh) {\r\n                            console.log('not complete - update', task.description);\r\n                            task.complete = false;\r\n                            task.dailyRefresh = refresh;\r\n                            TaskFactory.updateTask(task);\r\n                        }\r\n                    } else if (task.completeTimes === task.repeat) {\r\n                        console.log('complete - delete', task.description);\r\n                        TaskFactory.removeTask(task, ctrl.tasks);\r\n                    }\r\n                } else if ((task.daily === false) && change) {\r\n                    console.log('weekly update: ', task.description);\r\n                    TaskFactory.updateTask(task);\r\n                }\r\n            });\r\n        }\r\n        find();\r\n    }\r\n\r\n\t\t// Find a list of Tasks\r\n\t\tfunction find(check) {\r\n\t\t\t$timeout(function () {\r\n\t\t    spinnerService.loading('tasks', Tasks.query().$promise.then(function(result) {\r\n\t\t\t\t\tconsole.log('found! : ', result);\r\n\t\t        ctrl.tasks = result;\r\n\t\t        if (check === true) checkStatus();\r\n\t\t    }));\r\n\t\t\t}, 250);\r\n\t\t}\r\n\t\tfind(true);\r\n\r\n\t\tfunction refreshItems() {\r\n\t\t\tfind();\r\n      NotificationFactory.warning('Refreshed!', 'Task list refreshed!');\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('tasks').controller('UpdateAnimeTaskController', UpdateAnimeTaskController);\r\n\tUpdateAnimeTaskController.$inject = ['$scope', '$uibModalInstance', 'data', 'FunctionService'];\r\n\r\n\tfunction UpdateAnimeTaskController($scope, $uibModalInstance, data, FunctionService) {\r\n    var ctrl = this;\r\n\t\tctrl.cancel = cancel;\r\n\t\tctrl.episodeCompleted = data.item.link.anime.episodes + 1;\r\n    ctrl.episodeNumber = FunctionService.pad(ctrl.episodeCompleted, 3);\r\n    ctrl.episodeRating = 0;\r\n    ctrl.item = data.item;\r\n    ctrl.isComplete = ctrl.episodeCompleted === ctrl.item.link.anime.finalEpisode && ctrl.item.link.anime.finalEpisode !== 0;\r\n    ctrl.ratingLimit = 10;\r\n    ctrl.stepConfig = {\r\n        currentStep: 1,\r\n        stepCount: 1\r\n    };\r\n\t\tctrl.submit = submit;\r\n\r\n    function submit() {\r\n      $uibModalInstance.close({ task: ctrl.item, episodeRating: ctrl.episodeRating });\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('tasks').controller('UpdateMangaTaskController', UpdateMangaTaskController);\r\n\tUpdateMangaTaskController.$inject = ['$scope', '$uibModalInstance', 'data'];\r\n\r\n\tfunction UpdateMangaTaskController($scope, $uibModalInstance, data) {\r\n    var ctrl = this;\r\n\t\tctrl.cancel = cancel;\r\n    ctrl.item = data.item;\r\n    ctrl.stepConfig = {\r\n        currentStep: 1,\r\n        stepCount: 1\r\n    };\r\n\t\tctrl.submit = submit;\r\n    console.log('update linked manga item: ', ctrl.item);\r\n\r\n    function submit() {\r\n      $uibModalInstance.close(ctrl.item);\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  loseInterest.$inject = [\"$document\", \"$window\"];\r\n  angular.module('tasks')\r\n  .directive('loseInterest', loseInterest);\r\n\r\n   function loseInterest($document, $window) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attrs) {\r\n            element.data('interesting', true);\r\n            /** On click, check what you clicked and whether you can ignore it.\r\n             *    Based on checks false the ng-show of the anywhere-but-here element.\r\n             */\r\n            angular.element($document[0].body).on('click', function (e) {\r\n                var interesting = angular.element(e.target).inheritedData('interesting'),\r\n                    elm = angular.element(e.target)[0].tagName,\r\n                    alsoInteresting = (elm === 'A') || (elm === 'I');\r\n                    //console.log(elm);\r\n                if (!interesting && !alsoInteresting) {\r\n                    scope.$apply(function () {\r\n                        scope.collapseFilters();\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('scheduleCalendar', scheduleCalendar);\r\n  scheduleCalendar.$inject = ['$uibModal', 'moment', 'ListService'];\r\n\r\n   function scheduleCalendar($uibModal, moment, ListService) {\r\n\r\n    function _removeTime(date) {\r\n      return date.day(1).hour(12).minute(0).second(0).millisecond(0);\r\n    }\r\n\r\n    function _buildMonth(scope, start, month) {\r\n         scope.weeks = [];\r\n         var done = false, date = moment(start), monthIndex = date.month(), count = 0;\r\n         while (!done) {\r\n           var days = _buildWeek(moment(date), month);\r\n           if(ListService.findWithAttr(days, 'isCurrentMonth', true) > -1) {\r\n             scope.weeks.push({ days: days });\r\n           }\r\n             date.add(1, 'w');\r\n             done = count++ > 2 && monthIndex !== date.month();\r\n             monthIndex = date.month();\r\n         }\r\n     }\r\n\r\n     function _buildWeek(date, month) {\r\n         var days = [];\r\n         for (var i = 0; i < 7; i++) {\r\n             days.push({\r\n                 name: date.format('dd').substring(0, 1),\r\n                 number: date.date(),\r\n                 isCurrentMonth: date.month() === month.month(),\r\n                 isToday: date.isSame(new Date(), 'day'),\r\n                 date: date\r\n             });\r\n             date = moment(date);\r\n             date.add(1, 'd');\r\n         }\r\n         return days;\r\n     }\r\n\r\n     function _displayEvents(events, date, days) {\r\n       var modalInstance = $uibModal.open({\r\n         animation: true,\r\n         templateUrl: '/modules/tasks/views/schedule-calendar-task.client.view.html',\r\n         controller: 'ScheduleCalendarTaskController as ctrl',\r\n         size: 'lg',\r\n         resolve: {\r\n           data: function () {\r\n             return { events: events, date: date, days: days };\r\n           }\r\n         }\r\n       }).result.then(function(result) {\r\n         console.log('closed - require refresh: ', result);\r\n       });\r\n     }\r\n\r\n    return {\r\n         restrict: 'A',\r\n         templateUrl: 'modules/tasks/templates/schedule-calendar.html',\r\n         scope: {\r\n           events: '='\r\n         },\r\n         link: function(scope) {\r\n             scope.days = [{ text: 'Mon' }, { text: 'Tue' }, { text: 'Wed' }, { text: 'Thu' }, { text: 'Fri' }, { text: 'Sat' }, { text: 'Sun' }];\r\n             scope.selected = moment(new Date());\r\n             scope.month = moment(scope.selected);\r\n\r\n             var start = moment(_removeTime(angular.copy(scope.selected)));\r\n             start.date(-6);\r\n             _removeTime(start.day(0));\r\n\r\n             _buildMonth(scope, start, scope.month);\r\n\r\n             scope.select = function(day) {\r\n               if(scope.selected === day.date){\r\n                 _displayEvents(scope.events, day.date, scope.days);\r\n               }\r\n               scope.selected = day.date;\r\n             };\r\n\r\n             scope.next = function() {\r\n                 var next = moment(scope.month);\r\n                 _removeTime(next.month(next.month()+1).date(0));\r\n                 scope.month.month(scope.month.month()+1);\r\n                 _buildMonth(scope, next, scope.month);\r\n             };\r\n\r\n             scope.previous = function() {\r\n                 var previous = moment(scope.month);\r\n                 _removeTime(previous.month(previous.month()-1).date(0));\r\n                 scope.month.month(scope.month.month()-1);\r\n                 _buildMonth(scope, previous, scope.month);\r\n             };\r\n         }\r\n     };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('shadowModel', shadowModel);\r\n\r\n   function shadowModel() {\r\n    return {\r\n      scope: true,\r\n      link: function(scope, el, att) {\r\n        console.log('shadow: ', scope);\r\n        scope[att.shadow] = angular.copy(scope[att.shadow]);\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('taskItemModel', taskItemModel);\r\n\r\n  function taskItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/tasks/templates/task-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('passClick', passClick);\r\n\r\n  function passClick() {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        element.bind('click', function(event) {\r\n          var passTo = document.getElementById(attrs.passClick);\r\n          passTo.focus();\r\n          passTo.click();\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks').factory('TaskFactory', TaskFactory);\r\n  TaskFactory.$inject = ['$q', 'Animeitems', 'Mangaitems', 'AnimeFactory', 'MangaFactory', 'NotificationFactory', 'ListService', '$uibModal'];\r\n\r\n    function TaskFactory($q, Animeitems, Mangaitems, AnimeFactory, MangaFactory, NotificationFactory, ListService, $uibModal) {\r\n      var obj = {\r\n        getWeekBeginning: getWeekBeginning,\r\n        insertChecklistItem: insertChecklistItem,\r\n        removeTask: removeTask,\r\n        updateAnimeitem: updateAnimeitem,\r\n        updateMangaitem: updateMangaitem,\r\n        updateTask: updateTask,\r\n        tickOff: tickOff,\r\n        tickOffChecklist: tickOffChecklist,\r\n      };\r\n      return obj;\r\n\r\n          function getWeekBeginning() {\r\n              var newDate = new Date(),\r\n                  day = newDate.getDay(),\r\n                  diff = newDate.getDate() - day + (day === 0 ? -6:1); // adjust when day is sunday\r\n              var wkBeg = new Date();\r\n              return new Date(wkBeg.setDate(diff));\r\n          }\r\n\r\n          function updateAnimeitem(task, episodeRating) {\r\n            return $q(function(resolve, reject) {\r\n              var query = Animeitems.get({\r\n  \t\t\t\t\t\t\tanimeitemId: task.link.anime._id\r\n  \t\t\t\t\t\t});\r\n              query.$promise.then(function(data) {\r\n                  console.log('update animeitem for ', task, data);\r\n                  data.episodes += 1;\r\n                  data.rating = task.link.anime.rating || data.rating;\r\n                  data.latest = new Date();\r\n                  AnimeFactory.update(data, undefined, true, undefined, episodeRating);\r\n                  resolve(data);\r\n              });\r\n            });\r\n          }\r\n\r\n          function updateMangaitem(task, chapters, volumes) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n              var query = Mangaitems.get({\r\n  \t\t\t\t\t\t\tmangaitemId: task.link.manga._id\r\n  \t\t\t\t\t\t});\r\n              query.$promise.then(function(data) {\r\n                  //console.log(data);\r\n                  data.chapters = chapters;\r\n                  data.volumes = volumes;\r\n                  data.latest = new Date();\r\n                  MangaFactory.update(data, undefined, true, undefined);\r\n  \t\t\t\t\t\t\t\tresolve(data);\r\n              });\r\n  \t\t\t\t\t});\r\n          }\r\n\r\n  \t\t\t\t/** Task Update,Edit,Delete and other functions below here.\r\n  \t\t\t\t */\r\n\r\n  \t\t\t // Update existing Task\r\n  \t\t\t function updateTask(task, refresh) {\r\n  \t\t\t\t return $q(function(resolve, reject) {\r\n  \t\t\t\t\t //console.log('update');\r\n  \t\t\t\t\t if (task.link.anime) {\r\n  \t\t\t\t\t\t task.link.anime = task.link.anime._id;\r\n  \t\t\t\t\t } else if (task.link.manga) {\r\n  \t\t\t\t\t\t task.link.manga = task.link.manga._id;\r\n  \t\t\t\t\t }\r\n\r\n  \t\t\t\t\t\ttask.$update(function() {\r\n  \t\t\t\t\t\t\tNotificationFactory.success('Saved!', 'Task was successfully updated!');\r\n  \t\t\t\t\t\t  //Refresh items if the callee wasn't checkStatus.\r\n  \t\t\t\t\t\t  console.log('update, refresh items ? ', refresh);\r\n  \t\t\t\t\t\t  resolve({ refresh: refresh });\r\n  \t\t\t\t\t\t}, function(errorResponse) {\r\n  \t\t\t\t\t\t\tvar errorMessage = errorResponse.data.message;\r\n  \t\t\t\t\t\t\treject(errorMessage);\r\n  \t\t\t\t\t\t  //console.log(errorResponse);\r\n  \t\t\t\t\t\t  NotificationFactory.error('Error!', 'Task failed to save!');\r\n  \t\t\t\t\t\t});\r\n  \t\t\t\t\t});\r\n  \t\t\t }\r\n\r\n  \t\t\t //Remove a task.\r\n  \t\t\t\tfunction removeTask(task, tasks, userCheck) {\r\n  \t\t\t\t\tif(userCheck) {\r\n  \t\t\t\t\t\t//console.log('launch');\r\n  \t\t\t\t\t\tNotificationFactory.confirmation(function remove() {\r\n  \t\t          removeTaskProcess(task, tasks);\r\n  \t\t\t\t\t\t});\r\n  \t\t\t\t\t} else {\r\n  \t\t\t\t\t\tremoveTaskProcess(task, tasks);\r\n  \t\t\t\t\t}\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\tfunction removeTaskProcess(task, tasks) {\r\n  \t\t\t\t\tif ( task ) {\r\n  \t\t\t\t\t\t\ttask.$remove();\r\n  \t\t\t\t\t\t\tfor (var i in tasks) {\r\n  \t\t\t\t\t\t\t\t\tif (tasks[i] === task) {\r\n  \t\t\t\t\t\t\t\t\t\t\ttasks.splice(i, 1);\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\tNotificationFactory.warning('Deleted!', 'Task was successfully deleted.');\r\n  \t\t\t\t\t}\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Linked manga need special options dialog.\r\n  \t\t\t\tfunction launchMangaUpdateDialog(task, checklistIndex) {\r\n  \t\t\t\t\tvar modalInstance = $uibModal.open({\r\n  \t\t\t\t\t\tanimation: true,\r\n  \t\t      \ttemplateUrl: '/modules/tasks/views/update-manga-task.client.view.html',\r\n  \t\t      \tcontroller: 'UpdateMangaTaskController as ctrl',\r\n  \t\t      \tsize: 'md',\r\n  \t\t      \tresolve: {\r\n  \t\t        \tdata: function () {\r\n  \t\t          \treturn { item: angular.copy(task), itemOriginal: task };\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t\treturn modalInstance;\r\n  \t\t\t\t}\r\n\r\n          //Linked anime need special options dialog.\r\n  \t\t\t\tfunction launchAnimeUpdateDialog(task, checklistIndex) {\r\n  \t\t\t\t\tvar modalInstance = $uibModal.open({\r\n  \t\t\t\t\t\tanimation: true,\r\n  \t\t      \ttemplateUrl: '/modules/tasks/views/update-anime-task.client.view.html',\r\n  \t\t      \tcontroller: 'UpdateAnimeTaskController as ctrl',\r\n  \t\t      \tsize: 'md',\r\n  \t\t      \tresolve: {\r\n  \t\t        \tdata: function () {\r\n  \t\t          \treturn { item: angular.copy(task), itemOriginal: task };\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t\treturn modalInstance;\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Completes a task.\r\n  \t\t\t\tfunction tickOff(task) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n  \t\t\t\t\t\tvar isLinked = task.link.linked;\r\n  \t\t\t\t    //Is it linked?\r\n  \t\t\t\t    if (!isLinked) {\r\n  \t\t\t\t        task.completeTimes += 1;\r\n  \t\t\t\t    } else if (isLinked) {\r\n  \t\t\t\t        /** Anime or manga?\r\n  \t\t\t\t         *   Update the item value AND the complete/repeat values.\r\n  \t\t\t\t         */\r\n  \t\t\t\t        if (task.link.type === 'anime') {\r\n                    task.complete = false;\r\n                      var animeDialog = launchAnimeUpdateDialog(task);\r\n                      animeDialog.result.then(function(result) {\r\n                        console.log('update anime task result: ', result);\r\n                        task = result.task;\r\n                        task.completeTimes = task.link.anime.episodes + 1;\r\n                        task.complete = true;\r\n                        task.repeat = task.link.anime.finalEpisode;\r\n                        obj.updateAnimeitem(task, result.episodeRating).then(function(result) {\r\n                          return obj.updateTask(task, true);\r\n                        }).then(function(result) {\r\n                          console.log('update anime into update task: ', result);\r\n                          resolve(result);\r\n                        });\r\n                      });\r\n  \t\t\t\t        } else if (task.link.type === 'manga') {\r\n  \t\t\t\t\t\t\t\t\t  task.complete = false;\r\n  \t\t\t\t            var dialog = launchMangaUpdateDialog(task);\r\n  \t\t\t\t\t\t\t\t\t\tdialog.result.then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\ttask = result;\r\n  \t\t\t\t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t\t\t\t\t\t\t\t\ttask.complete = true;\r\n  \t\t\t\t\t\t\t\t\t\t\tobj.updateMangaitem(task, task.link.manga.chapters, task.link.manga.volumes).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\t\tconsole.log('updated manga: ', result);\r\n  \t\t\t\t\t\t\t\t\t\t\t\treturn obj.updateTask(task, true);\r\n  \t\t\t\t\t\t\t\t\t\t\t}).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\t\tconsole.log('update manga into update task: ', result);\r\n  \t\t\t\t\t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t        }\r\n  \t\t\t\t    }\r\n  \t\t\t\t\t\tif(!isLinked) {\r\n  \t\t\t\t\t    obj.updateTask(task, isLinked).then(function(result) {\r\n  \t\t\t\t\t\t\t\tconsole.log('update task resolve: ', result);\r\n  \t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Completes a checklist item.\r\n  \t\t\t\tfunction tickOffChecklist(task, index) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n  \t\t\t\t\t\t//update the option for the task.\r\n  \t\t\t\t\t\tvar isLinked = task.link.linked;\r\n  \t\t\t\t\t\tif (isLinked && task.link.type === 'manga') {\r\n  \t\t\t\t\t\t\t\ttask.checklistItems[index].complete = false;\r\n  \t\t\t\t\t\t\t\tvar dialog = launchMangaUpdateDialog(task, index);\r\n  \t\t\t\t\t\t\t\tdialog.result.then(function(result) {\r\n  \t\t\t\t\t\t\t\t\ttask = result;\r\n  \t\t\t\t\t\t\t\t\ttask.checklistItems[index].complete = true;\r\n  \t\t\t\t\t\t\t\t\tif(ListService.findWithAttr(task.checklistItems, 'complete', false) === -1) {\r\n  \t\t\t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t              task.complete = true;\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t\t\tobj.updateMangaitem(task, task.link.manga.chapters, task.link.manga.volumes).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\tconsole.log('updated manga: ', result);\r\n  \t\t\t\t\t\t\t\t\t\treturn obj.updateTask(task, true);\r\n  \t\t\t\t\t\t\t\t\t}).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\tconsole.log('update manga into update task: ', result);\r\n  \t\t\t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t} else if(!isLinked) {\r\n  \t\t\t\t\t\t\tif(ListService.findWithAttr(task.checklistItems, 'complete', false) === -1) {\r\n  \t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t\t\t\t\t\ttask.complete = true;\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t//console.log('tickoff checklist: ', task);\r\n  \t\t\t\t\t    obj.updateTask(task, isLinked).then(function(result) {\r\n  \t\t\t\t\t\t\t\tconsole.log('update task resolve: ', result);\r\n  \t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Add additional items to a checklist.\r\n  \t\t\t\tfunction insertChecklistItem(task, newChecklistItem) {\r\n  \t\t\t\t\tif (newChecklistItem!=='' && newChecklistItem!==undefined) {\r\n  \t\t\t\t\t\t\tvar alreadyAdded = false;\r\n  \t\t\t\t\t\t\t//find the item and insert the option.\r\n  \t\t\t\t\t\t\tangular.forEach(task.checklistItems, function (item) {\r\n  \t\t\t\t\t\t\t\t\tif (item === newChecklistItem) {\r\n  \t\t\t\t\t\t\t\t\t\t\talreadyAdded = true;\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t});\r\n\r\n  \t\t\t\t\t\t\t//if not in array add it.\r\n  \t\t\t\t\t\t\tif (alreadyAdded === false) {\r\n  \t\t\t\t\t\t\t\t\ttask.checklistItems.push({ text: newChecklistItem, complete: false });\r\n  \t\t\t\t\t\t\t} else if (alreadyAdded === true) {\r\n  \t\t\t\t\t\t\t\t\tNotificationFactory.popup('Option already exists.', 'Please re-name and try again.', 'error');\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t}\r\n  \t\t\t\t\tobj.updateTask(task);\r\n  \t\t\t\t}\r\n\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\t//Tasks service used to communicate Tasks REST endpoints\r\n\tangular.module('tasks').factory('Tasks', Tasks);\r\n\tTasks.$inject = ['$resource'];\r\n\r\n\t\tfunction Tasks($resource) {\r\n\t\t\treturn $resource('tasks/:taskId', { taskId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('toptens').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Toptens', 'toptens', 'dropdown', '/toptens(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'toptens', 'List Toptens', 'toptens');\r\n\t\tMenus.addSubMenuItem('topbar', 'toptens', 'New Topten', 'toptens/create');\r\n\t}\r\n]);\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('toptens').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Toptens state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listToptens', {\r\n\t\t\turl: '/toptens',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/list-toptens.client.view.html'\r\n\t\t}).\r\n\t\tstate('createTopten', {\r\n\t\t\turl: '/toptens/create',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/create-topten.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewTopten', {\r\n\t\t\turl: '/toptens/:toptenId',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/view-topten.client.view.html'\r\n\t\t}).\r\n\t\tstate('editTopten', {\r\n\t\t\turl: '/toptens/:toptenId/edit',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/create-topten.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('toptens').controller('CreateToptenController', CreateToptenController);\r\n\tCreateToptenController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Toptens', 'ListService', 'Animeitems', 'Mangaitems', 'Characters', 'NotificationFactory', 'CharacterService', 'ItemService', '$filter'];\r\n\r\n\tfunction CreateToptenController($scope, $stateParams, $location, Authentication, Toptens, ListService, Animeitems, Mangaitems, Characters, NotificationFactory, CharacterService, ItemService, $filter) {\r\n\t\tvar ctrl = this,\r\n\t\t\t\ttoptenCopy = {\r\n\t        name: '',\r\n\t        description: '',\r\n\t        type: '',\r\n\t        isFavourite: false,\r\n\t        isRanked: false,\r\n\t        animeList: [],\r\n\t        mangaList: [],\r\n\t        characterList: [],\r\n\t        conditions: {\r\n\t            limit: null,\r\n\t            series: [],\r\n\t            tags: [],\r\n\t\t\t\t\t\t\tseason: null,\r\n\t\t\t\t\t\t\tyear: null\r\n\t        }\r\n\t\t\t\t};\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.cancel = cancel;\r\n\t\tctrl.create = create;\r\n\t\tctrl.commonArrays = ListService.getCommonArrays();\r\n\t\tctrl.imgSize = {\r\n\t\t\t\theight: '50px',\r\n\t\t\t\twidth: '100px'\r\n\t\t};\r\n\t\tctrl.isCreate = true;\r\n\t\tctrl.pushCondition = pushCondition;\r\n\t\tctrl.pushItem = pushItem;\r\n\t\tctrl.removeCondition = removeCondition;\r\n\t\tctrl.removeItem = removeItem;\r\n    ctrl.stepConfig = {\r\n        steps: [1,2,3,4,5,6,7,8,9,10],\r\n        stepHeaders: [\r\n            { text: 'Select attributes' },\r\n            { text: 'Set conditions' },\r\n            { text: 'Populate list' }\r\n        ],\r\n        currentStep: 1,\r\n        stepCount: 3,\r\n        listGen: {\r\n            itemsCached: [],\r\n            items: [],\r\n            displayList: [],\r\n            seriesList: [],\r\n            typeDisplay: '',\r\n            toptenItem: '',\r\n            seriesLimit: '',\r\n            tagLimit: '',\r\n            series: [],\r\n            tags: []\r\n        },\r\n        limitMin: 0,\r\n\t\t\t\tswapping: {\r\n\t\t\t\t\tone: '',\r\n\t\t\t\t\ttwo: ''\r\n\t\t\t\t}\r\n    };\r\n\t\tctrl.swappingItems = swappingItems;\r\n\t\tctrl.takeStep = takeStep;\r\n    ctrl.topten = {};\r\n    angular.copy(toptenCopy, ctrl.topten);\r\n\t\tctrl.update = update;\r\n\t\tctrl.years = [];\r\n\t\t// Create new Topten\r\n\t\tfunction create() {\r\n            // console.log(ctrl.topten, ctrl.topten);\r\n\t\t\t// Create new Topten object\r\n\t\t\tvar topten = new Toptens();\r\n\t\t\ttopten = new Toptens ({\r\n\t\t\t\tname: ctrl.topten.name,\r\n                description: ctrl.topten.description,\r\n                type: ctrl.topten.type,\r\n                isFavourite: ctrl.topten.isFavourite,\r\n                isRanked: ctrl.topten.isRanked,\r\n                animeList: ctrl.topten.animeList.length > 0 ? ctrl.topten.animeList : null,\r\n                characterList: ctrl.topten.characterList.length > 0 ? ctrl.topten.characterList : null,\r\n                mangaList: ctrl.topten.mangaList.length > 0 ? ctrl.topten.mangaList : null,\r\n                conditions: {\r\n                    limit: ctrl.topten.conditions.limit,\r\n                    series: ctrl.topten.conditions.series,\r\n                    tags: ctrl.topten.conditions.tags,\r\n\t\t\t\t\t\t\t\t\t\tseason: ctrl.topten.conditions.season,\r\n\t\t\t\t\t\t\t\t\t\tyear: ctrl.topten.conditions.year,\r\n                }\r\n\t\t\t});\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\ttopten.$save(function(response) {\r\n\t\t\t\t$location.path('toptens/' + response._id);\r\n\t\t\t\tNotificationFactory.success('Saved!', 'New List was successfully saved!');\r\n\t\t\t\t// Clear form fields\r\n\t\t\t\tangular.copy(toptenCopy, ctrl.topten);\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n\t\t\t\tNotificationFactory.error('Error!', 'Something went wrong!');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Update existing Topten\r\n\t\tfunction update() {\r\n\t\t\tvar topten = ctrl.topten;\r\n\r\n\t\t\ttopten.$update(function() {\r\n\t\t\t\t$location.path('toptens/' + topten._id);\r\n                NotificationFactory.success('Updated!', 'List update was successful!');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Something went wrong!');\r\n\t\t\t});\r\n\t\t}\r\n\r\n    function typeSetItemPopulate() {\r\n        var type = ListService.manipulateString(ctrl.topten.type, 'upper', true);\r\n        switch(type) {\r\n            case 'Anime':\r\n                Animeitems.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'title';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n\t\t\t\t\t\t\t\t\t\tctrl.years = ItemService.endingYears(result);\r\n                });\r\n                break;\r\n            case 'Manga':\r\n                Mangaitems.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'title';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n                });\r\n                break;\r\n            case 'Character':\r\n                Characters.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'name';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n                    ctrl.stepConfig.listGen.series = CharacterService.buildSeriesList(result);\r\n\t\t\t\t\t\t\t\t\t\tvar getYears = [];\r\n\t\t\t\t\t\t\t\t\t\tangular.forEach(result, function (item) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(item.anime) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tgetYears.push(item.anime);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tctrl.years = ItemService.endingYears(getYears);\r\n                });\r\n                break;\r\n        }\r\n        // console.log('type set: ', ctrl.stepConfig.listGen);\r\n\t\t\t}\r\n\r\n    //Processing on step submits.\r\n    function process(number, direction, callback) {\r\n        // console.log(number, direction);\r\n        switch(number) {\r\n            case 1:\r\n                if (ctrl.topten.type !== '' && ctrl.isCreate) {\r\n                    typeSetItemPopulate();\r\n                    callback();\r\n                } else if (ctrl.topten.type !== '' && !ctrl.isCreate) {\r\n                    if (ctrl.stepConfig.listGen.displayList.length < 1) {\r\n                        angular.forEach(ctrl.topten[ctrl.topten.type + 'List'], function(item) {\r\n                            var index = ListService.findWithAttr(ctrl.stepConfig.listGen.items, '_id', item._id);\r\n                            ctrl.stepConfig.listGen.displayList.push(ctrl.stepConfig.listGen.items[index]);\r\n                        });\r\n                        ctrl.stepConfig.limitMin = ctrl.stepConfig.listGen.displayList.length;\r\n                    }\r\n                    callback();\r\n                } else if (ctrl.topten.type === '') {\r\n                    NotificationFactory.popup('Invalid form', 'You MUST select a type to continue.', 'error');\r\n                }\r\n                break;\r\n\r\n            case 2:\r\n\t\t\t\t\t\t\t\tif(direction) {\r\n\t\t\t\t\t\t\t\t\tvar i = 0, j = 0, length;\r\n                  angular.copy(ctrl.stepConfig.listGen.items, ctrl.stepConfig.listGen.itemsCached);\r\n                  // console.log('pre conditions: ', ctrl.stepConfig.listGen.items.length, ctrl.stepConfig.listGen.itemsCached.length);\r\n\r\n\t\t\t\t\t\t\t\t\tif(ctrl.topten.type === 'anime') {\r\n\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.season) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('season')(ctrl.stepConfig.listGen.items, ctrl.topten.conditions.year, ctrl.topten.conditions.season);\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tNotificationFactory.popup('Invalid form', 'A year MUST be selected when selecting a season.', 'error');\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('filter')(ctrl.stepConfig.listGen.items, { season: { year: ctrl.topten.conditions.year } });\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else if(ctrl.topten.type === 'character') {\r\n\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.season) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('seasonForCharacterAnime')(ctrl.stepConfig.listGen.items, ctrl.topten.conditions.year, ctrl.topten.conditions.season);\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tNotificationFactory.popup('Invalid form', 'A year MUST be selected when selecting a season.', 'error');\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('filter')(ctrl.stepConfig.listGen.items, { anime: { season: { year: ctrl.topten.conditions.year } } });\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n                  if(ctrl.topten.conditions.series.length > 0) {\r\n                      i = ctrl.stepConfig.listGen.items.length;\r\n                      while(i--) {\r\n                          var remove = true,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tattr = (ctrl.stepConfig.listGen.items[i].anime !== null) ? 'anime' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t (ctrl.stepConfig.listGen.items[i].anime !== null) ? 'manga' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t null;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlength = ctrl.topten.conditions.series.length;\r\n\t\t\t\t\t\t\t\t\t\t\t\t//  console.log('tag while: ', i, length, attr);\r\n                          if(attr !== null) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag item: ', ctrl.stepConfig.listGen.items[i]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor(j = 0; j < length; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar series = ctrl.topten.conditions.series[j];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log(ctrl.stepConfig.listGen.items[i][attr].title, series.name, ctrl.stepConfig.listGen.items[i][attr].title.indexOf(series.name));\r\n                              if(ctrl.stepConfig.listGen.items[i][attr].title.indexOf(series.name) > -1) {\r\n                                  remove = false;\r\n                              }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                            if(remove) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('remove as remove: ' + remove);\r\n                                ctrl.stepConfig.listGen.items.splice(i, 1);\r\n                            }\r\n                          } else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('straight remove');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n                          }\r\n                      }\r\n                  }\r\n\r\n                  if(ctrl.topten.conditions.tags.length > 0) {\r\n                      i = ctrl.stepConfig.listGen.items.length;\r\n                      while(i--) {\r\n                          var count = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlength = ctrl.topten.conditions.tags.length;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag while: ', i, length);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(ctrl.stepConfig.listGen.items[i].tags.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag item: ', ctrl.stepConfig.listGen.items[i].tags);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor(j = 0; j < length; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar tag = ctrl.topten.conditions.tags[j];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag round: ' + i + '-' + j, ctrl.stepConfig.listGen.items[i].tags, tag.tag, ListService.findWithAttr(ctrl.stepConfig.listGen.items[i].tags, 'text', tag.tag));\r\n\t                                if(ListService.findWithAttr(ctrl.stepConfig.listGen.items[i].tags, 'text', tag.tag) > -1) {\r\n\t                                    count++;\r\n\t                                }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                            if(count !== length) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('remove as count: ' + count + ' > length: ' + length);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n                            }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('straight remove');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                      }\r\n                  }\r\n\t\t\t\t\t\t\t\t\t// console.log('post conditions: ', ctrl.stepConfig.listGen.items.length, ctrl.stepConfig.listGen.itemsCached.length);\r\n\t\t\t\t\t\t\t\t}\r\n                callback();\r\n                break;\r\n\r\n            case 3:\r\n                if(!direction) {\r\n                    ctrl.stepConfig.listGen.items = angular.copy(ctrl.stepConfig.listGen.itemsCached);\r\n                }\r\n                callback();\r\n                break;\r\n        }\r\n    }\r\n\r\n    function pushItem(item) {\r\n        if(ctrl.topten.conditions.limit === null || ctrl.topten.conditions.limit === 0 || ctrl.topten.conditions.limit > ctrl.stepConfig.listGen.displayList.length) {\r\n            var index = ctrl.topten[ctrl.topten.type+'List'].indexOf(item._id);\r\n            if (!ctrl.isCreate && index === -1) {\r\n                index = ListService.findWithAttr(ctrl.topten[ctrl.topten.type+'List'], '_id', item._id);\r\n            }\r\n            if (index === -1) {\r\n                ctrl.topten[ctrl.topten.type + 'List'].push(item._id);\r\n                ctrl.stepConfig.listGen.displayList.push(item);\r\n            } else {\r\n                NotificationFactory.warning('Duplicate!', 'Item has already been added to list.');\r\n            }\r\n        } else {\r\n            NotificationFactory.error('Full!', 'Item list has reached the defined capacity.');\r\n        }\r\n        ctrl.stepConfig.listGen.toptenItem = '';\r\n    }\r\n\r\n    function removeItem(item) {\r\n        //For display array.\r\n        var index = ctrl.stepConfig.listGen.displayList.indexOf(item);\r\n        ctrl.stepConfig.listGen.displayList.splice(index, 1);\r\n\r\n        //For topten list.\r\n        index = ctrl.topten[ctrl.topten.type + 'List'].indexOf(item._id);\r\n        if (!ctrl.isCreate && index === -1) {\r\n            index = ListService.findWithAttr(ctrl.topten[ctrl.topten.type+'List'], '_id', item._id);\r\n        }\r\n        ctrl.topten[ctrl.topten.type + 'List'].splice(index, 1);\r\n        NotificationFactory.warning('Removed!', 'Item has been removed from list.');\r\n    }\r\n\r\n    function pushCondition(type, item) {\r\n        var index, indexTwo;\r\n        switch(type) {\r\n            case 'series':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.series, 'name', item.name);\r\n                if(index === -1) {\r\n                    ctrl.topten.conditions.series.push(item);\r\n                } else {\r\n                    NotificationFactory.warning('Duplicate!', 'Series has already been added to list.');\r\n                }\r\n                ctrl.stepConfig.listGen.seriesLimit = '';\r\n                break;\r\n\r\n            case 'tag':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.tags, 'tag', item.tag);\r\n                if(index === -1) {\r\n                    ctrl.topten.conditions.tags.push(item);\r\n                } else {\r\n                    NotificationFactory.warning('Duplicate!', 'Tag has already been added to list.');\r\n                }\r\n                ctrl.stepConfig.listGen.tagLimit = '';\r\n                break;\r\n        }\r\n    }\r\n\r\n    function removeCondition(type, item) {\r\n        var index, indexTwo;\r\n        switch(type) {\r\n            case 'series':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.series, 'name', item.name);\r\n\t\t\t\t\t\t\t\tctrl.topten.conditions.series.splice(index, 1);\r\n                NotificationFactory.warning('Removed!', 'Series has been removed from list.');\r\n                break;\r\n\r\n            case 'tag':\r\n                index = ctrl.topten.conditions.tags.indexOf(item);\r\n                ctrl.topten.conditions.tags.splice(index, 1);\r\n                NotificationFactory.warning('Removed!', 'Tag has been removed from list.');\r\n                break;\r\n        }\r\n    }\r\n\r\n    //Step related functions:\r\n    function takeStep(number, direction) {\r\n        process(number, direction, function() {\r\n            ctrl.stepConfig.currentStep = (direction) ? number + 1 : number - 1;\r\n        });\r\n        // console.log('step: ', ctrl.stepConfig, ctrl.topten);\r\n    }\r\n    function cancel() {\r\n        $location.path('toptens');\r\n    }\r\n\r\n    function inital() {\r\n        // console.log('state params: ', $stateParams);\r\n        if ($stateParams.toptenId !== undefined) {\r\n            ctrl.isCreate = false;\r\n            Toptens.get({ toptenId: $stateParams.toptenId }).$promise.then(function(result) {\r\n                ctrl.topten = result;\r\n\t\t\t\t\t\t\t\t// console.log('topten: ', result);\r\n                typeSetItemPopulate();\r\n            });\r\n        }\r\n    }\r\n    inital();\r\n\r\n\t\tfunction swappingItems(index) {\r\n\t\t\t// console.log('item selected: ', index);\r\n\t\t\tif(ctrl.stepConfig.swapping.one === '') {\r\n\t\t\t\tctrl.stepConfig.swapping.one = index;\r\n\t\t\t} else if(ctrl.stepConfig.swapping.one === index) {\r\n\t\t\t\tctrl.stepConfig.swapping.one = '';\r\n\t\t\t} else {\r\n\t\t\t\tctrl.stepConfig.swapping.two = index;\r\n\t\t\t\t//Re-order display list.\r\n\t\t\t\tvar temp = ctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.one];\r\n\t\t\t\tctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.one] = ctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.two];\r\n\t\t\t\tctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.two] = temp;\r\n\t\t\t\t//Re-order topten item list.\r\n\t\t\t\ttemp = ctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.one];\r\n\t\t\t\tctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.one] = ctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.two];\r\n\t\t\t\tctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.two] = temp;\r\n\t\t\t\t//Clear.\r\n\t\t\t\tctrl.stepConfig.swapping.one = '';\r\n\t\t\t\tctrl.stepConfig.swapping.two = '';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens').controller('StatisticsTopten', StatisticsTopten);\r\n  StatisticsTopten.$inject = ['$scope','$uibModalInstance','list', 'CharacterService'];\r\n\r\n   function StatisticsTopten($scope, $uibModalInstance, list, CharacterService) {\r\n     var ctrl = this;\r\n\r\n     ctrl.cancel = cancel;\r\n     ctrl.list = list;\r\n     ctrl.toptenInfo = {\r\n       tags: [],\r\n       series: []\r\n     };\r\n\r\n     function process() {\r\n       var listType = ctrl.list.type + 'List';\r\n       ctrl.toptenInfo.tags = CharacterService.buildCharacterTags(ctrl.list[listType]);\r\n       if(ctrl.list.type === 'character') {\r\n         ctrl.toptenInfo.series = CharacterService.buildSeriesList(ctrl.list[listType]);\r\n       }\r\n     }\r\n     process();\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('toptens').controller('ToptensController', ToptensController);\r\n\tToptensController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', '$uibModal', 'Toptens', 'NotificationFactory', 'ListService', 'spinnerService'];\r\n\r\n\tfunction ToptensController($scope, $stateParams, $location, Authentication, $uibModal, Toptens, NotificationFactory, ListService, spinnerService) {\r\n\t\tvar ctrl = this;\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.filterConfig = {\r\n\t\t\t\tshowingCount: 0,\r\n\t\t\t\texpandFilters: false,\r\n\t\t\t\tsortType: '',\r\n\t\t\t\tsortReverse: false,\r\n\t\t\t\tratingLevel: undefined,\r\n\t\t\t\tsearch: {},\r\n\t\t\t\tsearchTags: '',\r\n\t\t\t\ttagsForFilter: [],\r\n\t\t\t\ttaglessItem: false,\r\n\t\t\t\tareTagless: false,\r\n\t\t\t\tselectListOptions: {},\r\n\t\t\t\tcommonArrays: ListService.getCommonArrays()\r\n\t\t};\r\n\t\tctrl.find = find;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.openListStats = openListStats;\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.viewConfig = {\r\n        displayType: '',\r\n        linkSuffix: '',\r\n\t\t\t\ttags: [],\r\n\t\t\t\tseries: []\r\n    };\r\n    ctrl.whichController = 'topten';\r\n\r\n\t\t// Remove existing Topten\r\n\t\tfunction remove(topten) {\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( topten ) {\r\n\t            topten.$remove();\r\n\t            for (var i in ctrl.toptens) {\r\n\t                if (ctrl.toptens [i] === topten) {\r\n\t                    ctrl.toptens.splice(i, 1);\r\n\t                }\r\n\t            }\r\n\t        } else {\r\n\t            ctrl.topten.$remove(function() {\r\n\t                $location.path('toptens');\r\n\t            });\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Anime was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Find a list of Toptens\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t    spinnerService.loading('topten', Toptens.query().$promise.then(function(result) {\r\n\t        ctrl.toptens = result;\r\n\t    }));\r\n\t\t\tconsole.log(ctrl.toptens);\r\n\t\t}\r\n\r\n\t\t// Find existing Topten\r\n\t\tfunction findOne() {\r\n\t    Toptens.get({ toptenId: $stateParams.toptenId }).$promise.then(function(result) {\r\n\t        ctrl.topten = result;\r\n\t        ctrl.viewConfig.displayType = (ctrl.topten.type === 'character') ? 'name' : 'title';\r\n\t        ctrl.viewConfig.linkSuffix = (ctrl.topten.type === 'character') ? 's' : 'items';\r\n\t    });\r\n\t\t}\r\n\r\n\t\tfunction openListStats() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n\t\t\t\tanimation: true,\r\n      \ttemplateUrl: '/modules/toptens/views/statistics-topten.client.view.html',\r\n      \tcontroller: 'StatisticsTopten as ctrl',\r\n      \tsize: 'lg',\r\n      \tresolve: {\r\n        \tlist: function () {\r\n          \treturn ctrl.topten;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('horizontalListItem', horizontalListItem);\r\n\r\n   function horizontalListItem() {\r\n      return {\r\n          restrict: 'A',\r\n          replace: true,\r\n          transclude: true,\r\n          scope: {},\r\n          templateUrl: '/modules/toptens/templates/horizontal-list-item.html',\r\n          require: '^horizontalList',\r\n          link: function(scope, element, attr, horizontalListCtrl) {\r\n              scope.isVisible = false;\r\n              scope.itemWidth = horizontalListCtrl.itemWidth;\r\n              scope.position = element.index();\r\n              horizontalListCtrl.register(scope);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('horizontalList', horizontalList);\r\n\r\n   function horizontalList() {\r\n      return {\r\n          restrict: 'A',\r\n          transclude: true,\r\n          require: 'horizontalList',\r\n          scope: {},\r\n          templateUrl: '/modules/toptens/templates/horizontal-list.html',\r\n          bindToController: true,\r\n          controllerAs: 'horizontalList',\r\n          controller: [\"$scope\", function($scope) {\r\n              var self = this;\r\n              self.clicks = 0;\r\n              self.items = [];\r\n              self.moveItems = moveItems;\r\n              self.register = register;\r\n              self.shift = 0;\r\n\r\n              function register(item) {\r\n                  self.items.push(item);\r\n                  if([0, 1, 2].indexOf(item.position) > -1) {\r\n                      item.isVisible = true;\r\n                  }\r\n              }\r\n\r\n              function setVisibility() {\r\n                  var values = [],\r\n                      check = self.clicks * 3;\r\n                  for(var i = 0; i < 3; i++) {\r\n                      values.push(check + i);\r\n                  }\r\n                  angular.forEach(self.items, function(item) {\r\n                      item.isVisible = (values.indexOf(item.position) > -1);\r\n                  });\r\n              }\r\n\r\n              function moveItems(direction) {\r\n                  if(direction === 'left') {\r\n                      if((self.clicks - 1) < 0) {\r\n                          self.clicks = 0;\r\n                      } else {\r\n                          self.clicks -= 1;\r\n                      }\r\n                      setVisibility();\r\n                  } else if (direction === 'right') {\r\n                      if ((self.clicks + 1) < Math.ceil(self.items.length / 3)) {\r\n                          self.clicks += 1;\r\n                      }\r\n                      setVisibility();\r\n                  }\r\n              }\r\n\r\n          }],\r\n          link: function(scope, element, attr, ctrl) {\r\n              var el = element[0],\r\n                  child = el.children[0];\r\n              scope.settings = {\r\n                  child: child,\r\n                  style: child.style,\r\n                  value: 0\r\n              };\r\n\r\n              function listSettings() {\r\n                  ctrl.shift = -el.offsetWidth;\r\n                  ctrl.itemWidth = el.offsetWidth / 3;\r\n                  angular.forEach(ctrl.items, function(item) {\r\n                      item.itemWidth = ctrl.itemWidth;\r\n                  });\r\n              }\r\n              listSettings();\r\n\r\n              window.addEventListener('resize', function(e) {\r\n                  if(el.offsetWidth !== Math.abs(ctrl.shift)) {\r\n                      listSettings();\r\n                      scope.$apply();\r\n                  }\r\n              });\r\n\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('ngMax', ngMax);\r\n\r\n  function ngMax() {\r\n      return {\r\n          restrict: 'A',\r\n          require: 'ngModel',\r\n          link: function(scope, elem, attr, ctrl) {\r\n\r\n              scope.$watch(attr.ngMax, function(){\r\n                  if (ctrl.$isDirty) ctrl.$setViewValue(ctrl.$viewValue);\r\n              });\r\n\r\n              var isEmpty = function(value) {\r\n                 return angular.isUndefined(value) || value === '' || value === null;\r\n              };\r\n\r\n              var maxValidator = function(value) {\r\n                var max = scope.$eval(attr.ngMax) || Infinity;\r\n                if (!isEmpty(value) && value > max) {\r\n                  ctrl.$setValidity('ngMax', false);\r\n                  return undefined;\r\n                } else {\r\n                  ctrl.$setValidity('ngMax', true);\r\n                  return value;\r\n                }\r\n              };\r\n\r\n              ctrl.$parsers.push(maxValidator);\r\n              ctrl.$formatters.push(maxValidator);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('ngMin', ngMin);\r\n\r\n  function ngMin() {\r\n      return {\r\n          restrict: 'A',\r\n          require: 'ngModel',\r\n          link: function(scope, elem, attr, ctrl) {\r\n              scope.$watch(attr.ngMin, function(){\r\n                  if (ctrl.$isDirty) ctrl.$setViewValue(ctrl.$viewValue);\r\n              });\r\n\r\n              var isEmpty = function(value) {\r\n                 return angular.isUndefined(value) || value === '' || value === null;\r\n              };\r\n\r\n              var minValidator = function(value) {\r\n                var min = scope.$eval(attr.ngMin) || 0;\r\n                if (!isEmpty(value) && value < min) {\r\n                  ctrl.$setValidity('ngMin', false);\r\n                  return undefined;\r\n                } else {\r\n                  ctrl.$setValidity('ngMin', true);\r\n                  return value;\r\n                }\r\n              };\r\n\r\n              ctrl.$parsers.push(minValidator);\r\n              ctrl.$formatters.push(minValidator);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('oneStep', oneStep);\r\n\r\n  function oneStep() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        transclude: true,\r\n        scope: {},\r\n        require: '^steps',\r\n        templateUrl: '/modules/toptens/templates/step.html',\r\n        link: function(scope, elm, attrs, stepsController) {\r\n            scope.active = false;\r\n            scope.stepNumber = elm.index() + 1;\r\n            stepsController.register(scope);\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('stepControls', stepControls);\r\n    function stepControls() {\r\n       return {\r\n           restrict: 'A',\r\n           replace: true,\r\n           transclude: true,\r\n           template: '<div class=\"step-controls step-button-group padding-5\" ng-transclude>' +\r\n                      '</div>'\r\n       };\r\n    }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('steps', steps);\r\n  function steps() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        scope: {\r\n            stepConfig: '='\r\n        },\r\n        template: '<div class=\"steps\" ng-transclude>' +\r\n                  '</div>',\r\n        bindToController: true,\r\n        controllerAs: 'steps',\r\n        controller: [\"$scope\", function($scope) {\r\n            var self = this;\r\n\r\n            self.register = register;\r\n            self.steps = [];\r\n\r\n            function register(step) {\r\n                self.steps.push(step);\r\n                if(step.stepNumber === 1) {\r\n                    step.active = true;\r\n                }\r\n            }\r\n        }],\r\n        link: function(scope, element, attrs, stepsController) {\r\n          scope.$watch('steps.stepConfig.currentStep', function(newValue) {\r\n              if (newValue !== undefined) {\r\n                console.log('steps: ', newValue);\r\n                  angular.forEach(stepsController.steps, function(step) {\r\n                      if(step.stepNumber !== newValue) {\r\n                          step.active = false;\r\n                      } else {\r\n                          step.active = true;\r\n                      }\r\n                  });\r\n              }\r\n          });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('sticky', sticky);\r\n\r\n  function sticky() {\r\n      return {\r\n          restrict: 'A',\r\n          scope: {},\r\n          link: function(scope, element, attrs) {\r\n\r\n              window.addEventListener('scroll', function (evt) {\r\n                  var stickyClass = 'sticky-scroll-top',\r\n                      stickyInnerClass = 'sticky-inner-container',\r\n                      scrollTop = document.body.scrollTop,\r\n                      elm = element[0],\r\n                      inner = elm.children[0],\r\n                      viewportOffset = elm.getBoundingClientRect(),\r\n                      distance_from_top = viewportOffset.top; // This value is your scroll distance from the top\r\n\r\n                  // The element has scrolled to the top of the page. Set appropriate style.\r\n                  if (distance_from_top < 56) {\r\n  //                    console.log('top hit : ', distance_from_top);\r\n                      elm.classList.add(stickyClass);\r\n                      inner.classList.add(stickyInnerClass);\r\n                  }\r\n\r\n                  // The element has not reached the top.\r\n                  if(distance_from_top > 55 || scrollTop < 10) {\r\n  //                    console.log('we are at: ', distance_from_top);\r\n                      elm.classList.remove(stickyClass);\r\n                      inner.classList.remove(stickyInnerClass);\r\n                  }\r\n            });\r\n\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .filter('toptenFilter', toptenFilter);\r\n\r\n  function toptenFilter() {\r\n    return function(array, displayType, value) {\r\n        if(array !== undefined) {\r\n            return array.filter(function(item) {\r\n                if(item[displayType].toLowerCase().indexOf(value.toLowerCase()) > -1) {\r\n                    return item;\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\t//Toptens service used to communicate Toptens REST endpoints\r\n\tangular.module('toptens').factory('Toptens', ToptensFactory);\r\n\tToptensFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction ToptensFactory($resource) {\r\n\t\t\treturn $resource('toptens/:toptenId', { toptenId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n})();\r\n\r\n'use strict';\r\n\r\n// Config HTTP Error Handling\r\nangular.module('users').config(['$httpProvider',\r\n\tfunction($httpProvider) {\r\n\t\t// Set the httpProvider \"not authorized\" interceptor\r\n\t\t$httpProvider.interceptors.push(['$q', '$location', 'Authentication',\r\n\t\t\tfunction($q, $location, Authentication) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tresponseError: function(rejection) {\r\n\t\t\t\t\t\tswitch (rejection.status) {\r\n\t\t\t\t\t\t\tcase 401:\r\n\t\t\t\t\t\t\t\t// Deauthenticate the global user\r\n\t\t\t\t\t\t\t\tAuthentication.user = null;\r\n\r\n\t\t\t\t\t\t\t\t// Redirect to signin page\r\n\t\t\t\t\t\t\t\t$location.path('signin');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 403:\r\n\t\t\t\t\t\t\t\t// Add unauthorized behaviour \r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn $q.reject(rejection);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t]);\r\n\t}\r\n]);\r\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('users').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Users state routing\r\n\t\t$stateProvider.\r\n\t\tstate('profile', {\r\n\t\t\turl: '/settings/profile',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/edit-profile.client.view.html'\r\n\t\t}).\r\n\t\tstate('password', {\r\n\t\t\turl: '/settings/password',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/change-password.client.view.html'\r\n\t\t}).\r\n\t\tstate('accounts', {\r\n\t\t\turl: '/settings/accounts',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/social-accounts.client.view.html'\r\n\t\t}).\r\n//\t\tstate('signup', {\r\n//\t\t\turl: '/signup',\r\n//\t\t\ttemplateUrl: 'modules/users/views/authentication/signup.client.view.html'\r\n//\t\t}).\r\n\t\tstate('signin', {\r\n\t\t\turl: '/signin',\r\n\t\t\ttemplateUrl: 'modules/users/views/authentication/signin.client.view.html'\r\n\t\t}).\r\n\t\tstate('forgot', {\r\n\t\t\turl: '/password/forgot',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/forgot-password.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset-invalid', {\r\n\t\t\turl: '/password/reset/invalid',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password-invalid.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset-success', {\r\n\t\t\turl: '/password/reset/success',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password-success.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset', {\r\n\t\t\turl: '/password/reset/:token',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('users').controller('AuthenticationController', AuthenticationController);\r\n\tAuthenticationController.$inject = ['$scope', '$http', '$location', 'Authentication'];\r\n\r\n\tfunction AuthenticationController($scope, $http, $location, Authentication) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.signin = signin;\r\n\t\tctrl.signup = signup;\r\n\r\n\t\tfunction signup() {\r\n\t\t\t$http.post('/auth/signup', ctrl.credentials).success(function(response) {\r\n\t\t\t\t// If successful we assign the response to the global user model\r\n\t\t\t\tctrl.authentication.user = response;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/signin');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\tctrl.error = response.message;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction signin() {\r\n\t\t\tctrl.credentials.username = 'username';\r\n\t\t\t$http.post('/auth/signin', ctrl.credentials).success(function(response) {\r\n\t\t\t\t// If successful we assign the response to the global user model\r\n\t\t\t\tctrl.authentication.user = response;\r\n\t\t\t\tctrl.loginBody = true;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/tasks');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\tctrl.error = response.message;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\r\n'use strict';\r\n\r\nangular.module('users').controller('PasswordController', ['$scope', '$stateParams', '$http', '$location', 'Authentication',\r\n\tfunction($scope, $stateParams, $http, $location, Authentication) {\r\n\t\t$scope.authentication = Authentication;\r\n\r\n\t\t//If user is signed in then redirect back home\r\n\t\tif ($scope.authentication.user) $location.path('/');\r\n\r\n\t\t// Submit forgotten password account id\r\n\t\t$scope.askForPasswordReset = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/auth/forgot', $scope.credentials).success(function(response) {\r\n\t\t\t\t// Show user success message and clear form\r\n\t\t\t\t$scope.credentials = null;\r\n\t\t\t\t$scope.success = response.message;\r\n\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t// Show user error message and clear form\r\n\t\t\t\t$scope.credentials = null;\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Change user password\r\n\t\t$scope.resetUserPassword = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/auth/reset/' + $stateParams.token, $scope.passwordDetails).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.passwordDetails = null;\r\n\r\n\t\t\t\t// Attach user profile\r\n\t\t\t\tAuthentication.user = response;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/password/reset/success');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n]);\r\n'use strict';\r\n\r\nangular.module('users').controller('SettingsController', ['$scope', '$http', '$location', 'Users', 'Authentication',\r\n\tfunction($scope, $http, $location, Users, Authentication) {\r\n\t\t$scope.user = Authentication.user;\r\n\r\n\t\t// If user is not signed in then redirect back home\r\n\t\tif (!$scope.user) $location.path('/');\r\n\r\n\t\t// Check if there are additional accounts \r\n\t\t$scope.hasConnectedAdditionalSocialAccounts = function(provider) {\r\n\t\t\tfor (var i in $scope.user.additionalProvidersData) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Check if provider is already in use with current user\r\n\t\t$scope.isConnectedSocialAccount = function(provider) {\r\n\t\t\treturn $scope.user.provider === provider || ($scope.user.additionalProvidersData && $scope.user.additionalProvidersData[provider]);\r\n\t\t};\r\n\r\n\t\t// Remove a user social account\r\n\t\t$scope.removeUserSocialAccount = function(provider) {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.delete('/users/accounts', {\r\n\t\t\t\tparams: {\r\n\t\t\t\t\tprovider: provider\r\n\t\t\t\t}\r\n\t\t\t}).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.success = true;\r\n\t\t\t\t$scope.user = Authentication.user = response;\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Update a user profile\r\n\t\t$scope.updateUserProfile = function(isValid) {\r\n\t\t\tif (isValid) {\r\n\t\t\t\t$scope.success = $scope.error = null;\r\n\t\t\t\tvar user = new Users($scope.user);\r\n\r\n\t\t\t\tuser.$update(function(response) {\r\n\t\t\t\t\t$scope.success = true;\r\n\t\t\t\t\tAuthentication.user = response;\r\n\t\t\t\t}, function(response) {\r\n\t\t\t\t\t$scope.error = response.data.message;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t$scope.submitted = true;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Change user password\r\n\t\t$scope.changeUserPassword = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/users/password', $scope.passwordDetails).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.success = true;\r\n\t\t\t\t$scope.passwordDetails = null;\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\t// Authentication service for user variables\r\n\tangular.module('users').factory('Authentication', AuthenticationFactory);\r\n\r\n\tfunction AuthenticationFactory() {\r\n\t\tvar _this = this;\r\n\r\n\t\t_this._data = {\r\n\t\t\tuser: window.user\r\n\t\t};\r\n\r\n\t\treturn _this._data;\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\t// Users service used for communicating with the users REST endpoint\r\n\tangular.module('users').factory('Users', UsersFactory);\r\n\tUsersFactory.$inject = ['$resource'];\r\n\r\n\tfunction UsersFactory($resource) {\r\n\t\treturn $resource('users', {}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n"]}