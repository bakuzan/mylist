<div class="taskItem" layout="column">
  <div layout="row">
    <md-checkbox ng-model="taskItem.complete" ng-change="ctrl.tickOff(taskItem)" ng-disabled="taskItem.complete || taskItem.checklist"
                 aria-label="tick off task">
    </md-checkbox>
    <span class="task-description-text complete-{{taskItem.complete}} display-inline-block" ng-class="taskItem.checklist === true ? 'clickable' : ''"
          ng-click="taskItem.checklist === true ? viewTask = !viewTask : ''">
        {{taskItem.description}}
    </span>
    <span class="task-times-text complete-{{taskItem.complete}} hover-data-right margin-left-10"
          hover-data="{{ (taskItem.link.type==='manga') ? 'Ch ' + taskItem.link.manga.chapters + ', Vol ' +  taskItem.link.manga.volumes : '' }}">
        <span ng-if="taskItem.link.type!=='anime'">
            {{taskItem.completeTimes}}/{{taskItem.repeat}}
        </span>
        <span ng-if="taskItem.link.type==='anime'">
            {{taskItem.link.anime.episodes}}/{{taskItem.link.anime.finalEpisode}}
        </span>
    </span>
    <span flex></span>
    <span class="category-{{taskItem.category}} hover-data-left"
          hover-data="{{taskItem.link.linked ? (taskItem.link.type ===  'anime') ?
                                                taskItem.link.anime.title        :
                                                taskItem.link.manga.title        :
                                                ''
                      }}">
        {{taskItem.category}}
    </span>
    <md-button class="md-warn md-icon-button" aria-hidden="true" ng-click="ctrl.removeTask(taskItem)">
      <md-tooltip md-direction="bottom">
        delete task
      </md-tooltip>
      <md-icon>delete</md-icon>
    </md-button>
  </div>
  <div class="taskDate complete-{{taskItem.complete}} margin-left-20" layout="row">
    <span class="margin-right-10">
      <span ng-bind="taskItem.date | date: 'dd MMM yyyy'" ng-if="taskItem.complete"></span>
      <md-datepicker class="or-shrink" ng-model="taskItem.date" ng-change="ctrl.updateTask(taskItem)" md-placeholder="Enter date" ng-if="!taskItem.complete" format-date></md-datepicker>
    </span>
    <span ng-hide="taskItem.daily">
      <span ng-bind="taskItem.day" ng-if="taskItem.complete"></span>
      <md-select class="transform-uppercase margin-0" ng-model="taskItem.day" ng-change="ctrl.updateTask(taskItem)" aria-label="task day" ng-if="!taskItem.complete">
        <md-option ng-repeat="obj in ctrl.commonArrays.days" value="{{obj.name}}">
          {{obj.name}}
        </md-option>
      </md-select>
    </span>
    <span ng-show="taskItem.daily">
      DAILY
    </span>
  </div>
  <div class="margin-top-10" percentage-bar-container border="alter-border" ng-if="taskItem.checklist">
    <div percentage-bar percentage="{{ ((taskItem.checklistItems | filter: {complete: true}).length / taskItem.checklistItems.length) * 100}}"
         type="white-text accent-alter-background"
         hover-data="{{ ((taskItem.checklistItems | filter: {complete: true}).length / taskItem.checklistItems.length)*100 | number: 2 }}%"></div>
  </div>
  <div ng-if="taskItem.checklist" class="checklist-list-container" ng-show="viewTask">
    <md-button class="md-accent" ng-show="!taskItem.complete" ng-click="addingToChecklist=!addingToChecklist">
        <md-icon ng-hide="addingToChecklist">add</md-icon>
        <md-icon ng-show="addingToChecklist">remove</md-icon>
    </md-button>
    <md-input-container class="margin-bottom-0" flex ng-show="!taskItem.complete && addingToChecklist">
      <label>new checklist item</label>
      <input type="text" ng-model="insertNewChecklistItem" enter-tag="ctrl.insertChecklistItem(taskItem, insertNewChecklistItem); insertNewChecklistItem = ''">
    </md-input-container>
    <md-button class="md-accent" ng-show="!taskItem.complete && addingToChecklist" ng-click="ctrl.insertChecklistItem(taskItem, insertNewChecklistItem); insertNewChecklistItem = ''"
       ng-disabled="insertNewChecklistItem==='' || insertNewChecklistItem===null || insertNewChecklistItem===undefined">
        Add
    </md-button>
    <md-list class="checklist-list">
      <md-list-item ng-repeat="option in taskItem.checklistItems">
        <md-checkbox ng-model="option.complete" ng-change="ctrl.tickOffChecklist(taskItem, $index)" ng-disabled="option.complete"
                     aria-label="tick off checklist item">
        </md-checkbox>
        <span class="complete-{{option.complete}}">
            {{option.text}}
        </span>
      </md-list-item>
    </md-list>
  </div>
</div>
