{"version":3,"sources":["application.js"],"names":["ApplicationConfiguration","applicationModuleName","applicationModuleVendorDependencies","registerModule","moduleName","dependencies","angular","module","requires","push","config","$locationProvider","hashPrefix","run","$rootScope","$state","Authentication","$on","event","toState","name","user","_id","preventDefault","go","element","document","ready","location","hash","window","bootstrap","Menus","addMenuItem","addSubMenuItem","$stateProvider","state","url","templateUrl","controller","AnimeitemsController","$scope","$stateParams","$location","Animeitems","Mangaitems","fileUpload","$sce","$window","ItemService","ListService","NotificationFactory","AnimeFactory","spinnerService","TagService","$uibModal","getAnime","value","loading","query","status","$promise","then","result","ctrl","animeitems","filterConfig","areTagless","checkForTagless","statTags","buildStatTags","authentication","ongoingList","showingCount","expandFilters","sortType","sortReverse","ratingLevel","ratingActions","maxRating","percent","overStar","search","searchTags","tagsForFilter","taglessItem","selectListOptions","commonArrays","getCommonArrays","getItemsAvailable","onHold","viewItem","findOne","get","animeitemId","animeitem","console","log","latestDate","latest","updated","pageConfig","currentPage","pageSize","remove","confirmation","i","$remove","splice","path","warning","tickOff","item","episodes","Date","update","trustAsResourceUrl","usedTags","viewItemHistory","open","animation","size","resolve","data","type","meta","whichController","getSelectListOptions","$inject","CreateAnimeController","Enums","addedEpisodes","itemUpdate","updateHistory","finalEpisode","reWatching","end","addTag","tagArray","newTag","title","malSearchType","create","start","image","imgPath","season","convertDateToSeason","disc","manga","tags","mal","$save","response","success","errorResponse","error","message","dropTag","text","finalNumbers","find","malSearchOptions","disabled","id","findManga","mangaitems","init","isCreate","placeholder","required","autocomplete","removeTag","sections","showAdditional","showCompletion","showItemTags","selectMalEntry","malEntry","malStatus","anime","ongoing","setInSeason","year","substring","submit","tagArrayRemove","uploadFile","myFile","uploadFileToUrl","WatchAnimeController","$timeout","updateWatchedList","localStorage","setItem","JSON","stringify","watchedList","parse","getItem","saved","playVideo","videoFile","file","findWithAttr","video","files","parseInt","number","startRewatch","length","processed","$watch","nVal","URL","createObjectURL","WatchListController","WatchAnime","sortOptions","sortOption","v","watchAnime","directive","restrict","replace","fileModel","$parse","link","scope","attrs","model","modelSetter","assign","bind","$apply","e","altKey","keyCode","isList","view","listBack","css","items","page","passTag","tag","indexOf","split","hoveringOver","itemsAvailable","collapseFilters","el","addEventListener","swOnplay","pageCount","Math","ceil","last","first","next","prev","ctrlKey","filter","array","month","substr","endedSeason","moment","num","startMonth","startYear","diff","weeks","pad","slice","rating","input","statisticsDetailFilter","$filter","division","filterPart","episodeRating","concatenateTagArrays","itemHistory","itemRevisits","reWatchCount","$update","href","factory","AnimeitemsFactory","$resource","method","$http","uploadUrl","fd","FormData","append","post","transformRequest","identity","headers","err","popup","service","obj","buildOverview","overview","completed","buildRatingsDistribution","maxCount","ratingsDistribution","count","colour","percentage","toFixed","checkedRating","add","maxTagCount","itemCount","forEach","len","ratedCount","ratings","ratingAdded","ratingAvg","ratingWeighted","ratingsWeighted","completeByMonth","monthDetails","completeByMonthItems","maxCompleteMonth","itemYears","endingYears","months","max","completeBySeason","seasonDetails","completeBySeasonItems","maxCompleteSeason","seasons","date","getFullYear","getMonth","deleteHistory","history","temp","past","years","getRatingValues","tempRating","maxRatedCount","averageRating","values","latestHistory","chapters","reReading","now","repeating","currentPart","finalPart","index","revisits","displayDate","today","toISOString","fromNow","format","modeMap","weights","total","k","isNaN","setSeason","$q","getGroupProperties","groups","group","groupBy","f","o","Object","keys","map","itemTags","alreadyAdded","j","attr","categories","days","summaryFunctions","itemTypes","n","searchName","media","mediaType","repeatType","groupItemsByProperties","groupProperties","groupedArrays","manipulateString","string","transform","onlyFirst","toLowerCase","charAt","toUpperCase","numberOfPages","pagingDetails","stringReverse","reverse","join","weekEndingForDate","convertToSunday","day","getDay","getDate","wkEnd","setDate","endOf","CharactersController","Characters","CharacterService","character","voice","seriesFilter","voiceActors","series","characters","buildCharacterTags","buildVoiceActors","buildSeriesList","findAnime","characterId","findOneAnime","findOneManga","mangaitem","mangaitemId","maxItemCount","characterBack","characterTags","deleteSearchTag","disableNgAnimate","$animate","enabled","deletingItem","$parent","which","$eval","enterTag","entry_type","slider","slides","interval","bindToController","controllerAs","timer","autoSlide","self","currentIndex","enter","filteredSlides","locked","cancel","goToSlide","slide","isFullscreen","leave","repeater","toggleFullscreen","visible","elem","childElementCount","detailSeriesName","found","tagsToSearch","buildGenderDistribution","check","gender","buildRelatedCharacterTags","tagDetailCollection","tagDetailResult","bit","statSeries","CharacterFactory","HeaderController","changeTheme","timedTheme","timeOfDayTheme","theme","time","getHours","styles","storedValue","getElementById","lastIndexOf","isActive","viewLocation","isCollapsed","isTimedTheme","menu","getMenu","toggleCollapsibleMenu","anywhereButHere","$compile","showBackdrop","body","backdrop","appendChild","triggerAnywhereButHere","clickPass","stopPropagation","click","require","modelCtrl","$formatters","modelValue","loadingSpinner","transclude","active","api","show","hide","toggle","_register","_unregister","malSearch","MalService","selectItem","searchString","options","searchMal","searchResults","hasSearchResults","timeoutPromise","displayActions","displaySelectedItemActions","hasFocus","processItem","selectedItem","selectedItemActions","displayText","action","displayRawJson","toggleSearchDropdownOnFocus","newValue","myProgress","val","html","datesSelected","currentWkEnd","iDate","itemDate","currentDate","suffixes","dtfilter","relevantDigits","suffix","dateArray","daySelected","ds","complete","FunctionService","width","padChar","Array","xmlToJson","xml","TEXT_NODE_TYPE","nodeType","nodeValue","attributes","attribute","nodeName","hasChildNodes","childNodes","old","malService","params","isArray","queryType","defaultRoles","menus","shouldRender","roles","userRoleIndex","roleIndex","isPublic","validateMenuExistance","menuId","Error","addMenu","removeMenu","menuItemTitle","menuItemURL","menuItemType","menuItemUIRoute","position","menuItemClass","uiRoute","rootMenuItemURL","itemIndex","removeMenuItem","removeSubMenuItem","submenuItemURL","subitemIndex","toastr","swal","thenDo","showCancelButton","closeOnConfirm","confirmButtonText","confirmButtonColor","SpinnerService","spinners","queue","loads","hasOwnProperty","optionsOrPromise","spinner","always","promise","extend","$urlRouterProvider","otherwise","HistoryController","AnimeHistory","MangaHistory","HistoryService","buildHistory","buildHistoryList","animeHistory","mangaHistory","historyFilter","happenedWhen","when","historyGroups","ViewHistoryController","$uibModalInstance","historyStore","dismiss","close","historySeparator","level","timeframe","startOf","filterItemHistory","getEndsOfWeek","endsOfWeek","thisMonday","weekBeginning","thisSunday","weekEnding","mondays","getSetDaysAgo","sundays","deferred","defer","extractHistory","sort","a","b","dateA","dateB","groupItemHistory","cutoff","thisEnd","daysAgo","newDate","subtract","prevItem","groupedHistory","oldest","thisDate","wkBeg","MangaitemsController","MangaFactory","volumes","finalChapter","finalVolume","hardcopy","reReadCount","MangaitemsFactory","CompleteOrdersController","order","newPrice","company","price","prototype","editOrder","nextVolume","prices","completeOrder","rrp","paid","controllerId","CreateOrdersController","Orders","isCreateMode","orderId","orderCopy","volume","orderHistory","stepConfig","stepHeaders","currentStep","stepCount","_this","copy","takeStep","step","direction","processOrder","openBoughtDialog","modalInstance","OrderHistoryController","processHistory","cost","purchaseDate","rrpInstance","saving","OrdersController","orders","openOrderHistoryDialog","OrdersFactory","RatingsController","StatisticsService","getItems","episodeScore","finished","buildSummaryFunctions","itemScore","score","modelOptions","debounce","viewEpisodeRatings","isEqual","focusOnShow","myValue","focus","StatisticsController","Toptens","getItemStatistics","historyDetails","ratingValues","colours","red","green","blue","buildToptenModeList","toptens","detail","isVisible","isEpisodeRatings","dataStore","totalListCount","buildToptenDataStructure","getSummaryFunctions","summary","buildYearSummary","yearSummary","episodeSummaryFunctions","buildEpisodeSummaries","divisionText","tagDetail","topten","isRanked","isFavourite","generateSeasons","detailSeasonYear","detailSeason","getFilteredItems","historyChange","filtered","getToptenItemStatistics","toptenType","filteredItems","listCount","historyDetail","summaryType","tableDetail","tableDetails","detectFlood","overflowCheck","scrollWidth","offsetWidth","classList","border","template","display","tabs","currentTab","listShift","addTab","tab","disable","disabledTab","select","selectedTab","tabContainer","heading","shiftTabs","elWidth","ulWidth","ul","children","$viewValue","$setViewValue","shift","style","left","tabContainerCtrl","processYearSummary","metric","highestRating","lowestRating","modeRating","sum","getModeMap","arrayOfArrays","listType","itemLen","occuranceCounter","results","filteredArray","ignore","CreateTaskController","Tasks","TaskFactory","process","newTask","linked","category","linkItems","linkType","checklistItems","checklist","valid","addChecklistItem","checklistItem","backStep","task","description","daily","repeat","completeTimes","updateCheck","dropChecklistItem","isAddTask","ScheduleCalendarTaskController","refresh","timeDiff","abs","getTime","daysFromToday","events","weekEnds","floor","aDate","bDate","insertChecklistItem","newChecklistItem","removeTask","tickOffChecklist","updateTask","TasksController","checkStatus","tasks","parts","single","all","change","dailyRefresh","createTask","dateOptions","dateDisabled","formatYear","maxDate","minDate","startingDay","refreshItems","setTabFilterDay","tabFilter","tabName","getWeekBeginning","UpdateAnimeTaskController","episodeCompleted","episodeNumber","isComplete","ratingLimit","UpdateMangaTaskController","$document","on","interesting","target","inheritedData","elm","tagName","scheduleCalendar","_removeTime","hour","minute","second","millisecond","_buildMonth","done","monthIndex","_buildWeek","isCurrentMonth","isToday","isSame","_displayEvents","selected","previous","att","shadow","passTo","passClick","removeTaskProcess","launchMangaUpdateDialog","itemOriginal","launchAnimeUpdateDialog","userCheck","updateAnimeitem","updateMangaitem","reject","errorMessage","isLinked","animeDialog","dialog","taskId","CreateToptenController","typeSetItemPopulate","listGen","typeDisplay","getYears","callback","displayList","limitMin","itemsCached","conditions","toptenCopy","animeList","mangaList","characterList","limit","imgSize","height","pushCondition","seriesLimit","tagLimit","pushItem","toptenItem","removeCondition","removeItem","steps","seriesList","swapping","one","two","swappingItems","toptenId","StatisticsTopten","list","toptenInfo","ToptensController","viewConfig","displayType","linkSuffix","openListStats","horizontalListCtrl","itemWidth","register","setVisibility","clicks","moveItems","listSettings","child","settings","ngMax","$isDirty","isEmpty","isUndefined","maxValidator","$setValidity","$parsers","ngMin","minValidator","min","stepsController","stepNumber","stickyClass","stickyInnerClass","scrollTop","inner","viewportOffset","getBoundingClientRect","distance_from_top","top","ToptensFactory","$httpProvider","interceptors","responseError","rejection","AuthenticationController","signin","credentials","username","loginBody","signup","askForPasswordReset","resetUserPassword","token","passwordDetails","Users","hasConnectedAdditionalSocialAccounts","additionalProvidersData","isConnectedSocialAccount","provider","removeUserSocialAccount","delete","updateUserProfile","isValid","submitted","changeUserPassword","_data","UsersFactory"],"mappings":"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","file":"application.min.js","sourcesContent":["'use strict';\r\n\r\n// Init the application configuration module for AngularJS application\r\nvar ApplicationConfiguration = (function() {\r\n\t// Init module configuration options\r\n\tvar applicationModuleName = 'mylist';\r\n\tvar applicationModuleVendorDependencies = ['ngResource', 'ngCookies',  'ngAnimate',  'ngTouch',  'ngSanitize',  'ui.router', 'ui.bootstrap', 'ui.utils', 'angularFileUpload', 'angularMoment'];\r\n\r\n\t// Add a new vertical module\r\n\tvar registerModule = function(moduleName, dependencies) {\r\n\t\t// Create angular module\r\n\t\tangular.module(moduleName, dependencies || []);\r\n\r\n\t\t// Add the module to the AngularJS configuration file\r\n\t\tangular.module(applicationModuleName).requires.push(moduleName);\r\n\t};\r\n\r\n\treturn {\r\n\t\tapplicationModuleName: applicationModuleName,\r\n\t\tapplicationModuleVendorDependencies: applicationModuleVendorDependencies,\r\n\t\tregisterModule: registerModule\r\n\t};\r\n})();\n'use strict';\r\n\r\n//Start by defining the main module and adding the module dependencies\r\nangular.module(ApplicationConfiguration.applicationModuleName, ApplicationConfiguration.applicationModuleVendorDependencies);\r\n\r\n// Setting HTML5 Location Mode\r\nangular.module(ApplicationConfiguration.applicationModuleName).config(['$locationProvider',\r\n\tfunction($locationProvider) {\r\n\t\t$locationProvider.hashPrefix('!');\r\n\t}\r\n]);\r\n\r\nangular.module(ApplicationConfiguration.applicationModuleName)\r\n     .run(['$rootScope', '$state', 'Authentication', function ($rootScope, $state, Authentication) {\r\n        $rootScope.$on('$stateChangeStart', function (event, toState) {\r\n\t\t\t\t\tif(toState.name === 'signin') {\r\n\t\t\t\t\t\tif(Authentication.user._id) {\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\t$state.go('listTasks');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t        if (!Authentication.user) {\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t$state.go('signin');\r\n\t        }\r\n\t\t\t\t});\r\n}]);\r\n\r\n//Then define the init function for starting up the application\r\nangular.element(document).ready(function() {\r\n\t//Fixing facebook bug with redirect\r\n\tif (window.location.hash === '#_=_') window.location.hash = '#!';\r\n\r\n\t//Then init the app\r\n\tangular.bootstrap(document, [ApplicationConfiguration.applicationModuleName]);\r\n});\r\n\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('animeitems');\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('characters');\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('core');\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('history');\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('mangaitems');\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('orders');\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('ratings');\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('statistics');\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('tasks');\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('toptens');\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('users');\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('animeitems').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Animeitems', 'animeitems', 'dropdown');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'List Animeitems', 'animeitems');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'Watch Animeitems', 'animeitems/watch-list');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'New Animeitem', 'animeitems/create');\r\n\t}\r\n]);\r\n\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('animeitems').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Animeitems state routing\r\n\t\t$stateProvider.\r\n        state('listAnimeitems', {\r\n\t\t\turl: '/animeitems',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/list-animeitems.client.view.html',\r\n\t\t\tcontroller: 'AnimeitemsController as ctrl'\r\n\t\t}).\r\n\t\tstate('watchListAnimeitems', {\r\n\t\t\turl: '/animeitems/watch-list',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/list-animeitems.client.view.html',\r\n\t\t\tcontroller: 'WatchListController as ctrl'\r\n\t\t}).\r\n\t\tstate('createAnimeitem', {\r\n\t\t\turl: '/animeitems/create',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/create-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewAnimeitem', {\r\n\t\t\turl: '/animeitems/:animeitemId',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/view-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('editAnimeitem', {\r\n\t\t\turl: '/animeitems/:animeitemId/edit',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/create-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('watchAnimeitem', {\r\n\t\t\turl: '/animeitems/watch/:animeitemId',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/watch-animeitem.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('AnimeitemsController', AnimeitemsController);\r\n\tAnimeitemsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'AnimeFactory', 'spinnerService', 'TagService', '$uibModal'];\r\n\r\n\tfunction AnimeitemsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, fileUpload, $sce, $window, ItemService, ListService, NotificationFactory, AnimeFactory, spinnerService, TagService, $uibModal) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n    ctrl.filterConfig = {\r\n        ongoingList: true,\r\n        showingCount: 0,\r\n        expandFilters: false,\r\n        sortType: '',\r\n        sortReverse: true,\r\n        ratingLevel: undefined,\r\n        ratingActions: {\r\n            maxRating: 10,\r\n            percent: undefined,\r\n            overStar: null\r\n        },\r\n        search: {},\r\n        searchTags: '',\r\n        tagsForFilter: [],\r\n        taglessItem: false,\r\n        areTagless: false,\r\n        selectListOptions: {},\r\n        statTags: [],\r\n        commonArrays: ListService.getCommonArrays(),\r\n\t\t\t\tgetItemsAvailable: getItemsAvailable,\r\n\t\t\t\tviewItem: ''\r\n    };\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.latestDate = latestDate;\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.viewItemHistory = viewItemHistory;\r\n\t\tctrl.whichController = 'animeitem';\r\n\r\n\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\r\n    //allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n\r\n\t\t// Remove existing Animeitem\r\n\t\tfunction remove(animeitem) {\r\n\t     //are you sure option...\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( animeitem ) {\r\n\t          animeitem.$remove();\r\n\r\n\t          for (var i in ctrl.animeitems) {\r\n\t            if (ctrl.animeitems [i] === animeitem) {\r\n\t            \tctrl.animeitems.splice(i, 1);\r\n\t            }\r\n\t          }\r\n\t        } else {\r\n\t\t\t\t\t\tctrl.animeitem.$remove(function() {\r\n\t          \t$location.path('animeitems');\r\n\t\t\t\t\t\t});\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Anime was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Update existing Animeitem\r\n\t\tfunction update() {\r\n\t\t\tvar animeitem = ctrl.animeitem;\r\n\t\t\tctrl.animeitem = undefined;\r\n      AnimeFactory.update(animeitem, undefined, true, undefined);\r\n\t\t}\r\n\r\n    function tickOff(item) {\r\n        item.episodes += 1;\r\n        item.latest = new Date(); //update latest.\r\n        ctrl.animeitem = item;\r\n        ctrl.update();\r\n    }\r\n\r\n    //latest date display format.\r\n    function latestDate(latest, updated) {\r\n        return ItemService.latestDate(latest, updated);\r\n    }\r\n\r\n\t\tfunction viewItemHistory() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/history/views/item-history.html',\r\n        controller: 'ViewHistoryController as viewHistory',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { viewItem: ctrl.filterConfig.viewItem, type: 'anime' };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed history: ', result, ctrl.filterConfig.viewItem.meta);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tctrl.animeitem = ctrl.filterConfig.viewItem;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n      });\r\n\t\t}\r\n\r\n\t\t// Find existing Animeitem\r\n\t\tfunction findOne() {\r\n\t    Animeitems.get({ animeitemId: $stateParams.animeitemId }).$promise.then(function(result) {\r\n\t        ctrl.animeitem = result;\r\n\t   \t\t\tconsole.log(ctrl.animeitem);\r\n\t    });\r\n\t\t}\r\n\r\n\t\t/** Find a list of Animeitems for values:\r\n         *  (0) returns only ongoing series. (1) returns all series.\r\n         */\r\n\t\tfunction getAnime(value) {\r\n\t    spinnerService.loading('anime', Animeitems.query({ status: value }).$promise.then(function(result) {\r\n\t        ctrl.animeitems = result;\r\n\t\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\t\tctrl.filterConfig.statTags = ItemService.buildStatTags(result, 0);\r\n\t    }));\r\n\t\t}\r\n\r\n    //Set defaults on requery and \"neutralise\" the other search variable.\r\n    function getItemsAvailable() {\r\n        ctrl.animeitems = undefined;\r\n        if (ctrl.filterConfig.ongoingList === true) {\r\n            ctrl.filterConfig.search.onHold = false;\r\n            ctrl.filterConfig.search.status = '';\r\n            getAnime(0);\r\n        } else {\r\n            ctrl.filterConfig.search.onHold = '';\r\n            ctrl.filterConfig.search.status = false;\r\n            getAnime(1);\r\n        }\r\n    }\r\n\t\tctrl.filterConfig.getItemsAvailable();\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('CreateAnimeController', CreateAnimeController);\r\n\tCreateAnimeController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'AnimeFactory', 'spinnerService', 'TagService', 'Enums'];\r\n\r\n\tfunction CreateAnimeController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, fileUpload, $sce, $window, ItemService, ListService, NotificationFactory, AnimeFactory, spinnerService, TagService, Enums) {\r\n\t\tvar ctrl = this,\r\n        animeitemId = $stateParams.animeitemId;\r\n\r\n\t\tctrl.addedEpisodes = addedEpisodes;\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.animeitem = {};\r\n\t\tctrl.authentication = Authentication;\r\n    ctrl.config = {\r\n      title: 'Create',\r\n\t\t\tupdateHistory: false,\r\n      ratingActions: {\r\n          maxRating: 10,\r\n          percent: undefined,\r\n          overStar: null\r\n      },\r\n      statTags: [],\r\n      commonArrays: ListService.getCommonArrays(),\r\n\t\t\tmalSearchType: 'anime'\r\n    };\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.finalNumbers = false; //default show status of final number fields in edit view.\r\n\t\tctrl.find = find;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.findManga = findManga;\r\n    ctrl.imgPath = ''; //image path\r\n\t\tctrl.itemUpdate = new Date(); // today's date as 'yyyy-MM-dd' for the auto-pop of 'latest' in edit page.\r\n    ctrl.init = init;\r\n\t\tctrl.malSearchOptions = {\r\n\t\t\tplaceholder: 'Title',\r\n\t\t\tname: 'title',\r\n\t\t\trequired: true,\r\n\t\t\tautocomplete: 'off',\r\n\t\t\tdisabled: true\r\n\t\t};\r\n\t\tctrl.removeTag = removeTag;\r\n\t\tctrl.sections = {\r\n\t\t\tshowAdditional: false,\r\n\t\t\tshowCompletion: false,\r\n\t\t\tshowItemTags: false\r\n\t\t};\r\n\t\tctrl.selectMalEntry = selectMalEntry;\r\n\t\tctrl.setInSeason = setInSeason;\r\n\t\tctrl.submit = submit;\r\n    ctrl.tagArray = []; // holding tags pre-submit\r\n    ctrl.tagArrayRemove = [];\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\r\n    function init() {\r\n      ctrl.config.isCreate = animeitemId === undefined;\r\n      if(ctrl.config.isCreate) {\r\n\t\t\t\tctrl.animeitem.episodes = 0;\r\n\t\t\t\tctrl.animeitem.start = ctrl.itemUpdate;\r\n\t\t\t\tctrl.animeitem.latest = ctrl.itemUpdate;\r\n\t\t\t\tctrl.malSearchOptions.disabled = false;\r\n\t\t\t} else if(!ctrl.config.isCreate) {\r\n        ctrl.config.title = 'Edit';\r\n        ctrl.findOne();\r\n      }\r\n      ctrl.find();\r\n      ctrl.findManga();\r\n    }\r\n    ctrl.init();\r\n\r\n\t\tfunction selectMalEntry(malEntry) {\r\n\t\t\tif(malEntry) {\r\n\t\t\t\tctrl.animeitem.title = malEntry.title;\r\n\t\t\t\tctrl.animeitem.finalEpisode = malEntry.episodes;\r\n\t\t\t\tctrl.imgPath = malEntry.image;\r\n\t\t\t\tctrl.season = malEntry.status === Enums.malStatus.anime.ongoing;\r\n\t\t\t\tctrl.animeitem.mal = {\r\n\t\t\t\t\tid: malEntry.id\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tctrl.animeitem.finalEpisode = 0;\r\n\t\t\t\tctrl.animeitem.mal = undefined;\r\n\t\t\t\tctrl.season = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n    //For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for animeitem tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.animeitem.tags, text);\r\n\t\t}\r\n\r\n\t\tfunction addedEpisodes() {\r\n\t\t\tctrl.animeitem.latest = ctrl.itemUpdate;\r\n\t\t\tctrl.config.updateHistory = true;\r\n\t\t\tif(ctrl.animeitem.episodes === ctrl.animeitem.finalEpisode && ctrl.animeitem.finalEpisode !== 0 && ctrl.animeitem.reWatching === false) {\r\n\t\t\t\tctrl.animeitem.end = ctrl.itemUpdate;\r\n\t\t\t}\r\n\t\t\tif(ctrl.animeitem.episodes > ctrl.animeitem.finalEpisode && ctrl.animeitem.finalEpisode !== 0) {\r\n\t\t\t\tctrl.animeitem.episodes = ctrl.animeitem.finalEpisode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction setInSeason() {\r\n\t\t\tif(ctrl.animeitem.season.season === null) {\r\n\t\t\t\t ctrl.animeitem.season.year = null;\r\n\t\t\t } else {\r\n\t\t\t\t ctrl.animeitem.season.year = ctrl.animeitem.start.substring(0,4);\r\n\t\t\t }\r\n\t\t}\r\n\r\n\t\t// Create new Animeitem\r\n\t\tfunction create() {\r\n\t\t\t// Create new Animeitem object\r\n      var animeitem = new Animeitems();\r\n      animeitem = new Animeitems ({\r\n          title: ctrl.animeitem.title,\r\n          episodes: ctrl.animeitem.episodes,\r\n          start: ctrl.animeitem.start,\r\n          latest: ctrl.animeitem.latest,\r\n          finalEpisode: ctrl.animeitem.finalEpisode,\r\n\t\t\t\t\timage: ctrl.imgPath,\r\n          season: ctrl.season === true ? ItemService.convertDateToSeason(new Date(ctrl.animeitem.start)) : '',\r\n          disc: ctrl.animeitem.disc,\r\n          manga: ctrl.animeitem.manga!==undefined && ctrl.animeitem.manga!==null ? ctrl.animeitem.manga._id : ctrl.animeitem.manga,\r\n          tags: ctrl.tagArray,\r\n\t\t\t\t\tmal: ctrl.animeitem.mal,\r\n          user: ctrl.user\r\n       });\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\tanimeitem.$save(function(response) {\r\n\t\t\t\t$location.path('/animeitems/' + response._id);\r\n\t\t\t\tNotificationFactory.success('Saved!', 'Anime was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n        NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Update existing Animeitem\r\n\t\tfunction update() {\r\n\t\t\tvar animeitem = ctrl.animeitem;\r\n\t\t\tctrl.animeitem = undefined;\r\n      AnimeFactory.update(animeitem, ctrl.tagArray, ctrl.config.updateHistory, ctrl.imgPath);\r\n\t\t}\r\n\r\n\t\tfunction submit() {\r\n\t\t\tif(ctrl.config.isCreate) ctrl.create();\r\n\t\t\tif(!ctrl.config.isCreate) ctrl.update();\r\n\t\t}\r\n\r\n    // Find a list of Animeitems\r\n    function find() {\r\n        Animeitems.query().$promise.then(function(result) {\r\n\t\t\t\t\tctrl.animeitems = result;\r\n\t\t\t\t\t\tctrl.config.statTags = ItemService.buildStatTags(result, 0);\r\n\t\t\t\t});\r\n    }\r\n\r\n\t\t// Find existing Animeitem\r\n\t\tfunction findOne() {\r\n\t    spinnerService.loading('editAnime', Animeitems.get({ animeitemId: animeitemId }).$promise.then(function(result) {\r\n\t        ctrl.animeitem = result;\r\n\t\t\t\t\tctrl.malSearchOptions.disabled = (ctrl.animeitem.mal && ctrl.animeitem.mal.id > 0) || false;\r\n\t    }));\r\n\t\t}\r\n\r\n    // Find list of mangaitems for dropdown.\r\n    function findManga() {\r\n        ctrl.mangaitems = Mangaitems.query();\r\n    }\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/animeitems/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUploadAnime');\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('WatchAnimeController', WatchAnimeController);\r\n\tWatchAnimeController.$inject = ['$scope', 'Authentication', '$stateParams', '$timeout', 'Animeitems', '$sce', 'ListService', 'AnimeFactory'];\r\n\r\n\tfunction WatchAnimeController($scope, Authentication, $stateParams, $timeout, Animeitems, $sce, ListService, AnimeFactory) {\r\n\t\t\t\tvar ctrl = this,\r\n\t\t\t\t\t\tsaved = localStorage.getItem('watched');\r\n\r\n        ctrl.authentication = Authentication;\r\n\t\t\t\tctrl.findOne = findOne;\r\n\t\t\t\tctrl.playVideo = playVideo;\r\n\t\t\t\tctrl.startRewatch = startRewatch;\r\n\t\t\t\tctrl.update = update;\r\n        ctrl.videoFile = {\r\n  \t\t\t\tprocessed: '',\r\n  \t\t\t\tfile: '',\r\n\t\t\t\t\tnumber: '',\r\n  \t\t\t\tmessage: 'Please select an episode.'\r\n        };\r\n\t\t\t\tctrl.watchedList = (localStorage.getItem('watched') !== null) ? JSON.parse(saved) : {};\r\n\r\n\t\t\t\tfunction updateWatchedList() {\r\n\t\t\t\t\tlocalStorage.setItem('watched', JSON.stringify(ctrl.watchedList));\r\n\t\t\t\t\tctrl.watchedList = JSON.parse(localStorage.getItem('watched'));\r\n\t\t\t\t}\r\n\r\n        $scope.$watch('fileGrab', function(nVal, oVal) {\r\n          if(nVal) {\r\n\t\t\t\t\t\tctrl.videoFile.message = ''; //clear any error.\r\n            ctrl.videoFile.file = nVal.name;\r\n\t\t\t\t\t\tctrl.videoFile.number = ctrl.animeitem.video.files[ListService.findWithAttr(ctrl.animeitem.video.files, 'file', nVal.name)].number;\r\n            ctrl.videoFile.processed = $sce.trustAsResourceUrl(window.URL.createObjectURL(nVal));\r\n          }\r\n        });\r\n\r\n\t\t\t\tfunction playVideo() {\r\n\t\t\t\t\tctrl.watchedList[ctrl.videoFile.file] = true;\r\n\t\t\t\t\tupdateWatchedList();\r\n\t\t\t\t\tif(ctrl.animeitem.reWatching && (ListService.findWithAttr(ctrl.animeitem.video.files, 'file', ctrl.videoFile.file) > -1)) {\r\n\t\t\t\t\t\tctrl.animeitem.episodes = parseInt(ctrl.videoFile.number, 10);\r\n\t\t\t\t\t\tctrl.update();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction startRewatch() {\r\n\t\t\t\t\tconsole.log('startRewatch: ');\r\n\t\t\t\t\tvar i = ctrl.animeitem.video.files.length;\r\n\t\t\t\t\twhile(i--) {\r\n\t\t\t\t\t\tctrl.watchedList[ctrl.animeitem.video.files[i].file] = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdateWatchedList();\r\n\t\t\t\t\tctrl.animeitem.episodes = 0;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Update existing Animeitem\r\n\t\t\t\tfunction update() {\r\n\t\t\t\t\tctrl.animeitem.latest = new Date();\r\n\t\t      AnimeFactory.update(ctrl.animeitem, undefined, false, '');\r\n\t\t\t\t}\r\n\r\n        // Find existing Animeitem\r\n    \t\tfunction findOne() {\r\n    \t    Animeitems.get({ animeitemId: $stateParams.animeitemId }).$promise.then(function(result) {\r\n    \t        ctrl.animeitem = result;\r\n    \t   \t\t\tconsole.log(ctrl.animeitem);\r\n    \t    });\r\n    \t\t}\r\n        ctrl.findOne();\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('WatchListController', WatchListController);\r\n\tWatchListController.$inject = ['$scope', 'Authentication', '$state', '$sce', 'spinnerService', 'ItemService', 'ListService', 'WatchAnime', '$filter'];\r\n\r\n\tfunction WatchListController($scope, Authentication, $state, $sce, spinnerService, ItemService, ListService, WatchAnime, $filter) {\r\n\t\t\t\tvar ctrl = this;\r\n\r\n        ctrl.authentication = Authentication;\r\n\t\t\t\tctrl.filterConfig = {\r\n\t\t        ongoingList: true,\r\n\t\t        showingCount: 0,\r\n\t\t        expandFilters: false,\r\n\t\t        sortType: '',\r\n\t\t        sortReverse: true,\r\n\t\t        ratingLevel: undefined,\r\n\t\t        ratingActions: {\r\n\t\t            maxRating: 10,\r\n\t\t            percent: undefined,\r\n\t\t            overStar: null\r\n\t\t        },\r\n\t\t        search: {},\r\n\t\t        searchTags: '',\r\n\t\t        tagsForFilter: [],\r\n\t\t        taglessItem: false,\r\n\t\t        areTagless: false,\r\n\t\t        selectListOptions: {},\r\n\t\t        statTags: [],\r\n\t\t        commonArrays: ListService.getCommonArrays()\r\n\t\t    };\r\n\t\t\t\tctrl.find = find;\r\n\t\t\t\tctrl.latestDate = latestDate;\r\n\t\t\t\tctrl.pageConfig = {\r\n\t\t\t\t\t\tcurrentPage: 0,\r\n\t\t\t\t\t\tpageSize: 10\r\n\t\t\t\t};\r\n\t\t\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\t\t\tctrl.watchAnime = watchAnime;\r\n\t\t\t\tctrl.whichController = 'watch';\r\n\r\n\t\t\t\tfunction watchAnime(id) {\r\n\t\t\t\t\t$state.go('watchAnimeitem', { animeitemId: id });\r\n\t\t\t\t}\r\n\r\n        // Find a list of Animeitems\r\n        function find() {\r\n\t\t\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t\t\t\t\tctrl.filterConfig.sortType = ctrl.filterConfig.selectListOptions.sortOptions[ctrl.filterConfig.selectListOptions.sortOption].v; //Set sort order.\r\n          spinnerService.loading('watch', WatchAnime.query().$promise.then(function(result) {\r\n  \t\t\t\t\tctrl.animeitems = result;\r\n\t\t\t\t\t\tconsole.log('watch list: ', result, 'filterConfig: ', ctrl.filterConfig);\r\n  \t\t\t\t}));\r\n        }\r\n        ctrl.find();\r\n\r\n\t\t\t\t//allow retreival of local resource\r\n\t\t    function trustAsResourceUrl(url) {\r\n\t\t        return $sce.trustAsResourceUrl(url);\r\n\t\t    }\r\n\r\n\t\t\t\t//latest date display format.\r\n\t\t    function latestDate(latest, updated) {\r\n\t\t        return ItemService.latestDate(latest, updated);\r\n\t\t    }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('animeItemModel', animeItemModel);\r\n\r\n  function animeItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/animeitems/templates/anime-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('fileModel', fileModel);\r\n  fileModel.$inject = ['$parse'];\r\n\r\n  function fileModel($parse) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function(scope, element, attrs) {\r\n            var model = $parse(attrs.fileModel);\r\n            var modelSetter = model.assign;\r\n\r\n            element.bind('change', function(){\r\n                scope.$apply(function(){\r\n                    modelSetter(scope, element[0].files[0]);\r\n                });\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('keycuts', keycuts);\r\n\r\n  function keycuts() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function postLink(scope, element, attrs) {\r\n              //keydown catch - alt+v for view\r\n              scope.$on('my:keydown', function(event, e) {\r\n  //                console.log(event, e);\r\n                  if (e.altKey && e.keyCode===86) {\r\n                      if (scope.isList==='list') {\r\n                          scope.isList = 'slider';\r\n                      } else if (scope.isList==='slider') {\r\n                          scope.isList = 'list';\r\n                      } else if (scope.view === 'Anime') {\r\n                          scope.view = 'Manga';\r\n                      } else if (scope.view === 'Manga') {\r\n                          scope.view = 'Character';\r\n                      } else if (scope.view === 'Character') {\r\n                          scope.view = 'Anime';\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('listBack', listBack);\r\n   function listBack() {\r\n      return function(scope, element, attrs){\r\n          var url = attrs.listBack;\r\n          element.css({\r\n              'background-image': 'url(' + url +')',\r\n              'background-size' : '50%',\r\n              'background-repeat': 'no-repeat',\r\n              'background-position': 'right'\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('listFilters', listFilters);\r\n\r\n  function listFilters() {\r\n      return {\r\n          restrict: 'EA',\r\n          replace: true,\r\n          scope: {\r\n              filterConfig: '=',\r\n              items: '=',\r\n              page: '='\r\n          },\r\n          templateUrl: '/modules/animeitems/templates/list-filters.html',\r\n          link: function(scope, elem, attrs) {\r\n              scope.filterConfig.searchTags = '';\r\n              scope.passTag = function(tag) {\r\n                if (scope.filterConfig.searchTags.indexOf(tag) === -1) {\r\n                    scope.filterConfig.searchTags += tag + ',';\r\n                    scope.filterConfig.tagsForFilter = scope.filterConfig.searchTags.substring(0, scope.filterConfig.searchTags.length - 1).split(',');\r\n                }\r\n              };\r\n              //rating 'tooltip' function\r\n              scope.hoveringOver = function(value) {\r\n                scope.filterConfig.ratingActions.overStar = value;\r\n                scope.filterConfig.ratingActions.percent = 100 * (value / scope.filterConfig.ratingActions.maxRating);\r\n              };\r\n\r\n              scope.itemsAvailable = function() {\r\n                scope.filterConfig.getItemsAvailable();\r\n              };\r\n\r\n              scope.collapseFilters = function() {\r\n                scope.filterConfig.expandFilters = false;\r\n              };\r\n\r\n          }\r\n\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('swOnplay', swOnplay);\r\n\r\n  function swOnplay() {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        var el = element[0];\r\n        el.addEventListener('play', function() {\r\n          scope.$apply(attrs.swOnplay);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('pageControls', pageControls);\r\n\r\n  function pageControls() {\r\n    return {\r\n        restrict: 'EA',\r\n        replace: true,\r\n        scope: {\r\n            pageConfig: '=',\r\n            showingCount: '='\r\n        },\r\n        templateUrl: '/modules/animeitems/templates/page-controls.html',\r\n        link: function(scope, elem, attrs) {\r\n            /** Calculate page count.\r\n             *    If showingCount isn't caluclated in time...\r\n             *    If the pageSize is altered...\r\n             */\r\n                scope.$watch('showingCount', function() {\r\n                    scope.pageCount = Math.ceil(scope.showingCount / scope.pageConfig.pageSize);\r\n                    if (scope.pageConfig.currentPage > scope.pageCount - 1) {\r\n                        scope.last(); //in the event changing page size would put you above the last page.\r\n                    } else if (scope.pageConfig.currentPage < 0) {\r\n                        scope.first();\r\n                    }\r\n                });\r\n\r\n            /** Button Functions\r\n             *    go to next/prev pages. skip to first/last page.\r\n             */\r\n            scope.first = function() {\r\n  //              console.log('first');\r\n                scope.pageConfig.currentPage = 0;\r\n            };\r\n            scope.last = function() {\r\n  //              console.log('last');\r\n                scope.pageConfig.currentPage = scope.pageCount - 1;\r\n            };\r\n            scope.next = function() {\r\n  //              console.log('next');\r\n                scope.pageConfig.currentPage += 1;\r\n            };\r\n            scope.prev = function() {\r\n  //              console.log('prev');\r\n                scope.pageConfig.currentPage -= 1;\r\n            };\r\n\r\n            //Catches ctrl+left/right keypresses to change pages.\r\n            scope.$on('my:keydown', function(event, e) {\r\n  //              console.log(event, e);\r\n              if (e.ctrlKey && e.keyCode===39 && scope.pageConfig.currentPage < scope.pageCount - 1) {\r\n                  scope.next();\r\n              } else if (e.ctrlKey && e.keyCode===37 && scope.pageConfig.currentPage > 0) {\r\n                  scope.prev();\r\n              }\r\n            });\r\n\r\n        }\r\n    };\r\n\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('endedMonth', endedMonth);\r\n\r\n  function endedMonth() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n          //ended stat month filter\r\n                  if (item.end!==undefined && item.end!==null) {\r\n                      if (item.end.substring(0,4)===year) {\r\n                          if (item.end.substr(5,2)===month) {\r\n                              return item;\r\n                          }\r\n                      }\r\n                  }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('endedSeason', endedSeason);\r\n  endedSeason.$inject = ['moment'];\r\n\r\n  function endedSeason(moment) {\r\n      //ended stat season filter\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n                  var start = moment(item.start), end = moment(item.end), num, startMonth, startYear, diff, weeks, pad = '00';\r\n                  if (item.end!==undefined && item.end!==null) {\r\n                      /**\r\n                       *  Can currently handle shows of 1 or 2 seasons with 'standard' lengths (10-13) / (22-26) that\r\n                       *  start and finish in the 'normal' season months (J-M,A-J,J-S,O-D) / (J-J,A-S,J-D,O-M).\r\n                       */\r\n                      if (9 < item.finalEpisode && item.finalEpisode < 14) {\r\n                          startMonth = (pad + (month - 2)).slice(-pad.length);\r\n                          if ((item.end.substring(0,4) === year && item.end.substr(5,2) === month) || (item.start.substring(0,4) === year && item.start.substr(5,2) === startMonth)) {\r\n                              diff = end.diff(start, 'days');\r\n                              weeks = Math.ceil(diff / 7) + 1; //add one to correct for the first ep. counting as week 0 in an equation.\r\n                              if (weeks >= item.episodes) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      } else if (13 < item.finalEpisode && item.finalEpisode < 26) {\r\n                          num = (month - 5) > 0 ? (month - 5) : 10;\r\n                          startYear = (month - 5) > 0 ? year : year - 1;\r\n                          startMonth = (pad + num).slice(-pad.length);\r\n                          if ((item.end.substring(0,4) === year && item.end.substr(5,2) === month) || (item.start.substring(0,4) === startYear && item.start.substr(5,2) === startMonth)) {\r\n                              diff = end.diff(start, 'days');\r\n                              weeks = Math.ceil(diff / 7) + 1; //add one to correct for the first ep. counting as week 0 in an equation.\r\n                              if (weeks >= item.episodes) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('ratingFilter', ratingFilter);\r\n\r\n  function ratingFilter() {\r\n      return function(array, rating) {\r\n          if (array !== undefined) {\r\n              //filter for rating stars\r\n              return array.filter(function(item) {\r\n      //            console.log(item);\r\n                  if (item.rating===rating) {\r\n                      return item;\r\n                  } else if (rating===undefined) {\r\n                      return item;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('seasonForCharacterAnime', seasonForCharacterAnime);\r\n\r\n  function seasonForCharacterAnime() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n              if (item.anime && item.anime.season !== undefined && item.anime.season !== null) {\r\n                  if (item.anime.season.year === year && item.anime.season.season === month) {\r\n                      return item;\r\n                  }\r\n              }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('season', season);\r\n\r\n  function season() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n              if (item.season !== undefined && item.season !== null) {\r\n                  if (item.season.year === year && item.season.season === month) {\r\n                      return item;\r\n                  }\r\n              }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('startFrom', startFrom);\r\n\r\n   function startFrom() {\r\n      return function(input, start) {\r\n          if (input !== undefined) {\r\n              start = +start; //parse to int\r\n              return input.slice(start);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('statisticsDetailFilter',statisticsDetailFilter);\r\n   statisticsDetailFilter.$inject = ['$filter'];\r\n\r\n   function statisticsDetailFilter($filter) {\r\n      return function(array, type, year, division) {\r\n          var filter = (division === '')   ? 'summaryYear' :\r\n                       (type === 'months') ? 'endedMonth'  :\r\n                                             'season'      ,\r\n              filterPart = (division === '') ? type : division;\r\n          return $filter(filter)(array, year, filterPart);\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('summaryYear', summaryYear);\r\n\r\n  function summaryYear() {\r\n      return function(array, year, type) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                if (type === 'months' && item.end !== undefined && item.end !== null) {\r\n                    if (item.end.substring(0,4) === year) {\r\n                        return item;\r\n                    }\r\n                } else if (type === 'seasons') {\r\n                    if (item.season.year === year) {\r\n                        return item;\r\n                    }\r\n                }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('AnimeFactory', AnimeFactory);\r\n\tAnimeFactory.$inject = ['Animeitems', 'ListService', 'ItemService', 'NotificationFactory', '$location'];\r\n\r\n\tfunction AnimeFactory(Animeitems, ListService, ItemService, NotificationFactory, $location) {\r\n\t    return {\r\n\t        update: function(item, tagArray, updateHistory, imgPath, episodeRating) {\r\n\t            var animeitem = item;\r\n\t            console.log(animeitem);\r\n\t            //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n\t            if (item.manga!==null && item.manga!==undefined) {\r\n\t                animeitem.manga = item.manga._id;\r\n\t            }\r\n\r\n\t            if (tagArray!==undefined) {\r\n\t                animeitem.tags = ListService.concatenateTagArrays(animeitem.tags, tagArray);\r\n\t            }\r\n\r\n\t            //update the item history.\r\n\t            animeitem = ItemService.itemHistory(animeitem, updateHistory, 'anime', episodeRating);\r\n\r\n\t            if (imgPath!==undefined && imgPath!==null && imgPath!=='') {\r\n\t                animeitem.image = imgPath;\r\n\t            }\r\n\t            //console.log($scope.imgPath);\r\n\t            //console.log(animeitem.image);\r\n\r\n\t            //handle end date\r\n\t            if (animeitem.episodes === animeitem.finalEpisode && animeitem.finalEpisode!==0) {\r\n\t                if (animeitem.end===undefined || animeitem.end === null) {\r\n\t                    animeitem.end = animeitem.latest;\r\n\t//                    console.log(animeitem.end);\r\n\t                }\r\n\t            } else if (animeitem.reWatching === false) {\r\n\t                //in the event the 'complete-ness' of an entry needs to be undone.\r\n\t                //this will undo the end date.\r\n\t                animeitem.end = null;\r\n\t//                console.log(animeitem.end);\r\n\t            }\r\n\r\n\t            //handle status: completed.\r\n\t            if(animeitem.end!==undefined && animeitem.end!==null) {\r\n\t                animeitem.status = true;\r\n\t                animeitem.onHold = false;\r\n\t            } else {\r\n\t                //if no end date, not complete.\r\n\t                animeitem.status = false;\r\n\t            }\r\n\r\n\t            //handle re-reading, re-read count.\r\n\t            if (animeitem.reWatching===true) {\r\n\t\t\t\t\t\t\t\tanimeitem = ItemService.itemRevisits(animeitem, 'anime');\r\n\t\t\t\t\t\t\t\tif(animeitem.episodes===animeitem.finalEpisode) {\r\n\t                animeitem.reWatchCount += 1;\r\n\t                animeitem.reWatching = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t            }\r\n\r\n\t\t\t\tanimeitem.$update(function() {\r\n\t\t\t\t\tif (window.location.href.indexOf('tasks') === -1 && window.location.href.indexOf('watch') === -1 ) $location.path('animeitems');\r\n\r\n\t\t\t\t    NotificationFactory.success('Saved!', 'Anime was saved successfully');\r\n\t\t\t\t}, function(errorResponse) {\r\n\t\t\t\t\tvar error = errorResponse.data.message;\r\n\t                NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t\t});\r\n\t        }\r\n\t    };\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('Animeitems', AnimeitemsFactory);\r\n\tAnimeitemsFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction AnimeitemsFactory($resource) {\r\n\t\t\treturn $resource('animeitems/:animeitemId', { animeitemId: '@_id' }, { update: { method: 'PUT' } });\r\n\t\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('fileUpload', fileUpload);\r\n\tfileUpload.$inject = ['$http', 'NotificationFactory'];\r\n\r\n\tfunction fileUpload($http, NotificationFactory) {\r\n\t\tvar obj = {\r\n\t\t\tuploadFileToUrl: uploadFileToUrl\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n    function uploadFileToUrl(file, uploadUrl){\r\n        var fd = new FormData();\r\n        fd.append('file', file);\r\n        $http.post(uploadUrl, fd, {\r\n            transformRequest: angular.identity,\r\n            headers: {'Content-Type': undefined}\r\n        })\r\n        .success(function(response){\r\n            NotificationFactory.success('Uploaded!', 'Image was saved successfully');\r\n        })\r\n        .error(function(err){\r\n            NotificationFactory.popup('Woops!', 'Something went wrong! \\n' + err, 'error');\r\n        });\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('ItemService', ItemService);\r\n\tItemService.$inject = ['moment', '$filter', 'ListService'];\r\n\r\n\tfunction ItemService(moment, $filter, ListService) {\r\n\t\tvar obj = {\r\n\t\t\tbuildOverview: buildOverview,\r\n\t\t\tbuildRatingsDistribution: buildRatingsDistribution,\r\n\t\t\tbuildStatTags: buildStatTags,\r\n\t\t\tcompleteByMonth: completeByMonth,\r\n\t\t\tcompleteBySeason: completeBySeason,\r\n\t\t\tconvertDateToSeason: convertDateToSeason,\r\n\t\t\tdeleteHistory: deleteHistory,\r\n\t\t\tendingYears: endingYears,\r\n\t\t\tgetRatingValues: getRatingValues,\r\n\t\t\titemHistory: itemHistory,\r\n\t\t\titemRevisits: itemRevisits,\r\n\t\t\tlatestDate: latestDate,\r\n\t\t\tmaxCompleteMonth: maxCompleteMonth,\r\n\t\t\tmaxTagCount: maxTagCount,\r\n\t\t\tratingsWeighted: ratingsWeighted,\r\n\t\t\tsetSeason: setSeason\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n\t        //Using the date, returns the season.\r\n\t        function convertDateToSeason(date) {\r\n\t            var season = '', year = date.getFullYear(), month = date.getMonth() + 1, commonArrays = ListService.getCommonArrays(),\r\n\t                i = commonArrays.seasons.length;\r\n\t//            console.log('convert: ', year, month);\r\n\t            while(i--) {\r\n\t                if (month > Number(commonArrays.seasons[i].number) && season === '') {\r\n\t                    season = { season: commonArrays.seasons[i+1].text, year: year };\r\n\t                }\r\n\t                //catch winter.\r\n\t                if (i === 0 && season === '') {\r\n\t                    season = { season: commonArrays.seasons[i].text, year: year };\r\n\t                }\r\n\t            }\r\n\t//            console.log('to: ', season);\r\n\t            return season;\r\n\t        }\r\n\r\n\t        //add history entry to item.\r\n\t        function itemHistory(item, updateHistory, type, episodeRating) {\r\n\t            console.log('item history: ', item, item.meta, episodeRating);\r\n\t            //populate the history of when each part was 'checked' off.\r\n\t            if (item.meta.history.length !== 0) {\r\n\t                var latestHistory = item.meta.history[item.meta.history.length - 1].value,\r\n\t                    length = type === 'anime' ? item.episodes - latestHistory : item.chapters - latestHistory;\r\n\t                if (length > 0 && (type === 'anime' ? item.reWatching === false : item.reReading === false)) {\r\n\t                    for(var i = 1; i <= length; i++) {\r\n\t                        item.meta.history.push({\r\n\t                            date: Date.now(),\r\n\t                            value: latestHistory + i,\r\n\t                            rating: episodeRating || 0,\r\n\t                            title: item.title,\r\n\t                            id: item._id\r\n\t                        });\r\n\t                    }\r\n\t                }\r\n\t            } else {\r\n\t                if (updateHistory && (type === 'anime' ? item.reWatching === false : item.reReading === false)) {\r\n\t                    item.meta.history.push({\r\n\t                        date: Date.now(),\r\n\t                        value: (type === 'anime' ? item.episodes : item.chapters),\r\n\t                        rating: episodeRating || 0,\r\n\t                        title: item.title,\r\n\t                        id: item._id\r\n\t                    });\r\n\t                }\r\n\t            }\r\n\t            return item;\r\n\t        }\r\n\r\n\t        //remove an entry from an items history.\r\n\t        function deleteHistory(item, history) {\r\n\t            var temp = [];\r\n\t            angular.forEach(item.meta.history, function(past) {\r\n\t                if (past.value !== history.value) {\r\n\t                    temp.push(past);\r\n\t                }\r\n\t            });\r\n\t            item.meta.history = temp;\r\n\t            return item;\r\n\t        }\r\n\r\n\t\t\t\t\tfunction itemRevisits(item, type) {\r\n\t\t\t\t\t\tvar anime = { count: 'reWatchCount', currentPart: 'episodes', finalPart: 'finalEpisode' },\r\n\t\t\t\t\t\t\t\tmanga = { count: 'reReadCount',  currentPart: 'chapters', finalPart: 'finalChapter' },\r\n\t\t\t\t\t\t\t\trepeating = type === 'anime' ? anime : manga,\r\n\t\t\t\t\t\t\t\tindex = ListService.findWithAttr(item.meta.revisits, 'value', item[repeating.count] + 1);\r\n\t\t\t\t\t\tif(index === -1) {\r\n\t\t\t\t\t\t\titem.meta.revisits.push({\r\n\t\t\t\t\t\t\t\tid: item.id,\r\n\t\t\t\t\t\t\t\ttitle: item.title,\r\n\t\t\t\t\t\t\t\tvalue: item[repeating.count] + 1,\r\n\t\t\t\t\t\t\t\trating: 0,\r\n\t\t\t\t\t\t\t\tstart: item.latest,\r\n\t\t\t\t\t\t\t\tend: item[repeating.currentPart] === item[repeating.finalPart] ? item.latest : null\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else if(index > -1 && item[repeating.currentPart] === item[repeating.finalPart]) {\r\n\t\t\t\t\t\t\titem.meta.revisits[index].end = item.latest;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\r\n\t        //function to display relative time - using latest or updated date.\r\n\t        function latestDate(latest, updated) {\r\n\t            //latest date display format.\r\n\t//          console.log(latest, updated);\r\n\t            var today = moment(new Date()), displayDate, diff;\r\n\r\n\t            if (moment(latest).toISOString().substring(0,10)===moment(updated).toISOString().substring(0,10)) {\r\n\t                 displayDate = moment(updated);\r\n\t                 diff = displayDate.fromNow();\r\n\r\n\t                if (diff==='a day ago') {\r\n\t                    return 'Yesterday at ' + displayDate.format('HH:mm');\r\n\t                } else if (diff.indexOf('days') > -1) {\r\n\t                    return diff + ' at ' + displayDate.format('HH:mm');\r\n\t                } else {\r\n\t                    return diff + '.';\r\n\t                }\r\n\t            } else {\r\n\t                 displayDate = moment(latest);\r\n\t                 diff = today.diff(displayDate, 'days');\r\n\r\n\t                //for 0 and 1 day(s) ago use the special term.\r\n\t                if (diff===0) {\r\n\t                    return 'Today';\r\n\t                } else if (diff===1) {\r\n\t                    return 'Yesterday';\r\n\t                } else {\r\n\t                    return diff + ' days ago.';\r\n\t                }\r\n\t            }\r\n\t        }\r\n\r\n\t        //build statistics item overview details.\r\n\t        function buildOverview(items) {\r\n\t            var overview = {\r\n\t                ongoing: $filter('filter')(items, {status: false }).length,\r\n\t                completed: $filter('filter')(items, {status: true }).length\r\n\t            };\r\n\t//            console.log('overview ' , overview);\r\n\t            return overview;\r\n\t        }\r\n\r\n\t        //calculate which month has the most anime completed in it.\r\n\t        function maxCompleteMonth(items) {\r\n\t            var modeMap = {}, maxCount = 0;\r\n\t            for(var i = 0; i < items.length; i++) {\r\n\t                if (items[i].end!==undefined && items[i].end!==null) {\r\n\t                    var end = items[i].end.substring(0,7);\r\n\t                    if(modeMap[end] === null || modeMap[end] === undefined) {\r\n\t                        modeMap[end] = 1;\r\n\t                    } else {\r\n\t                        modeMap[end]++;\r\n\t                    }\r\n\t                    if(modeMap[end] > maxCount) {\r\n\t                        maxCount = modeMap[end];\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            return maxCount;\r\n\t        }\r\n\r\n\t        //calculate the rating values - max rated count and average rating.\r\n\t        function getRatingValues(items) {\r\n\t            var tempRating = 0,\r\n\t                maxRatedCount = 0,\r\n\t                averageRating = 0;\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.rating !== 0) {\r\n\t                    tempRating += item.rating;\r\n\t                    maxRatedCount++;\r\n\t                }\r\n\t            });\r\n\t            averageRating = tempRating / maxRatedCount;\r\n\t            var values = {\r\n\t                maxRatedCount: maxRatedCount,\r\n\t                averageRating: averageRating\r\n\t            };\r\n\t//            console.log('values', values);\r\n\t            return values;\r\n\t        }\r\n\r\n\t        //calculate which month has the most anime completed in it.\r\n\t        function maxTagCount(items) {\r\n\t            var modeMap = {}, maxCount = 0;\r\n\t            angular.forEach(items, function(item) {\r\n\t                angular.forEach(item.tags, function(tag) {\r\n\t                    var text = tag.text;\r\n\t                    if(modeMap[text] === null || modeMap[text] === undefined) {\r\n\t                        modeMap[text] = 1;\r\n\t                    } else {\r\n\t                        modeMap[text]++;\r\n\t                    }\r\n\t                    if(modeMap[text] > maxCount) {\r\n\t                        maxCount = modeMap[text];\r\n\t                    }\r\n\t                });\r\n\t            });\r\n\t            return maxCount;\r\n\t        }\r\n\r\n\t        //build stat tags including counts, averages etc.\r\n\t        function buildStatTags(items, averageItemRating) {\r\n\t            var add = true, statTags = [], checkedRating, maxTagCount = obj.maxTagCount(items), itemCount = items.length;\r\n\t            //is tag in array?\r\n\t            angular.forEach(items, function(item) {\r\n\t                angular.forEach(item.tags, function(tag) {\r\n\t                    for(var i=0, len = statTags.length; i < len; i++) {\r\n\t                        if (statTags[i].tag===tag.text) {\r\n\t                            add = false;\r\n\t                            statTags[i].count += 1;\r\n\t                            statTags[i].ratedCount += item.rating === 0 ? 0 : 1;\r\n\t                            statTags[i].ratings.push(item.rating);\r\n\t                            statTags[i].ratingAdded += item.rating;\r\n\t                            statTags[i].ratingAvg = statTags[i].ratingAdded === 0 ? 0 : statTags[i].ratingAdded / statTags[i].ratedCount;\r\n\t                            statTags[i].ratingWeighted = obj.ratingsWeighted(statTags[i].ratings);\r\n\t                        }\r\n\t                    }\r\n\t                    // add if not in\r\n\t                    if (add===true) {\r\n\t                        checkedRating = item.rating === 0 ? 0 : 1;\r\n\t                        statTags.push({ tag: tag.text, count: 1, ratedCount: checkedRating, ratings: [item.rating], ratingAdded: item.rating, ratingAvg: item.rating, ratingWeighted: 0 });\r\n\t                    }\r\n\t                    add = true; //reset add status.\r\n\t                });\r\n\t//                    console.log(statTags);\r\n\t            });\r\n\t            return statTags;\r\n\t        }\r\n\r\n\t        //function to calculate the weighted mean ratings for the genre tags.\r\n\t        function ratingsWeighted(ratings) {\r\n\t            var values = [], weights = [], unratedCount = 0, total = 0, count = 0;\r\n\t            /**\r\n\t             *  create array (weights) with key(rating).\r\n\t             */\r\n\t            for (var i=0, len = ratings.length; i < len; i++) {\r\n\t                if (ratings[i] in values) {\r\n\t                    weights[ratings[i]]++;\r\n\t                } else {\r\n\t                    values.push(ratings[i]);\r\n\t                    weights[ratings[i]] = 1;\r\n\t                }\r\n\t            }\r\n\t            /**\r\n\t             *  using the key(rating) multiply by the value(weight).\r\n\t             *  calculated weighted total and count.\r\n\t             */\r\n\t            for (var k in weights){\r\n\t                if (typeof weights[k] !== 'function') {\r\n\t                    if (!isNaN(weights[k])) {\r\n\t                        total += k * weights[k];\r\n\t                        count += weights[k];\r\n\t                    }\r\n\t                }\r\n\t                if (k === 0) {\r\n\t                    unratedCount = weights[k];\r\n\t                }\r\n\t            }\r\n\t\t\t\t\t\t\t/* Weighted average.\r\n\t\t\t\t\t\t\t * total = (nth_rating_value * number_of_that_value + ...)\r\n\t\t\t\t\t\t\t * count = number of ratings.\r\n\t\t\t\t\t\t\t */\r\n\t            return total / count;\r\n\t        }\r\n\r\n\t        //builds counts for number of items given for each rating.\r\n\t        function buildRatingsDistribution(items) {\r\n\t            var maxCount = items.length, possibleValues = [10,9,8,7,6,5,4,3,2,1,0], ratingsDistribution = [], i = possibleValues.length;\r\n\t            while(i--) {\r\n\t                var count = $filter('filter')(items, { rating: i }, true).length;\r\n\t                ratingsDistribution.push({ number: i === 0 ? '-' : i,\r\n\t                                           text: i === 0 ? count + ' entries unrated.' : count + ' entries rated ' + i,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t colour: i > 6 \t\t ? '#449d44' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t 7 > i && i > 3 ? '#31b0d5' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t i !== 0 ? '#c9302c' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t\t '#000000',\r\n\t                                           count: count,\r\n\t                                           percentage: ((count / maxCount) * 100).toFixed(2)\r\n\t                                         });\r\n\t            }\r\n\t//            console.log('RD: ', ratingsDistribution);\r\n\t            return ratingsDistribution;\r\n\t        }\r\n\r\n\t        // 'sub-function' of the completeBy... functions.\r\n\t        function endingYears(items) {\r\n\t            var years = [],\r\n\t\t\t\t\t\t\t\t\titemYears = $filter('unique')(items, 'end.substring(0,4)'); //get unqiue years as items.\r\n\t            \t\titemYears = $filter('orderBy')(itemYears, '-end.substring(0,4)'); //order desc.\r\n\t\t\t\t\t\t\tangular.forEach(itemYears, function(item) {\r\n\t\t\t\t\t\t\t\tif(item.end !== undefined && item.end !== null) {\r\n\t\t\t\t\t\t\t\t\tyears.push({ year: item.end.substring(0,4) });\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t            return years;\r\n\t        }\r\n\r\n\t        //complete by month stats\r\n\t        function completeByMonth(items) {\r\n\t            var monthDetails = {}, completeByMonthItems = [], maxCompleteMonth = 0, itemYears = obj.endingYears(items), i = itemYears.length;\r\n\t            //build comlpeteByMonths object.\r\n\t            while(i--) {\r\n\t                //chuck the null end date. push the year part of the other end dates with months array.\r\n\t                if (itemYears[i].year !== undefined && itemYears[i].year !== null) {\r\n\t                    completeByMonthItems.push({ year: itemYears[i].year,\r\n\t                                          months: [\r\n\t                                                    { number: '01', text: 'January', count: $filter('endedMonth')(items, itemYears[i].year, '01').length  },\r\n\t                                                    { number: '02', text: 'February', count: $filter('endedMonth')(items, itemYears[i].year, '02').length },\r\n\t                                                    { number: '03', text: 'March', count: $filter('endedMonth')(items, itemYears[i].year, '03').length },\r\n\t                                                    { number: '04', text: 'April', count: $filter('endedMonth')(items, itemYears[i].year, '04').length },\r\n\t                                                    { number: '05', text: 'May', count: $filter('endedMonth')(items, itemYears[i].year, '05').length },\r\n\t                                                    { number: '06', text: 'June', count: $filter('endedMonth')(items, itemYears[i].year, '06').length },\r\n\t                                                    { number: '07', text: 'July', count: $filter('endedMonth')(items, itemYears[i].year, '07').length },\r\n\t                                                    { number: '08', text: 'August', count: $filter('endedMonth')(items, itemYears[i].year, '08').length },\r\n\t                                                    { number: '09', text: 'September', count: $filter('endedMonth')(items, itemYears[i].year, '09').length },\r\n\t                                                    { number: '10', text: 'October', count: $filter('endedMonth')(items, itemYears[i].year, '10').length },\r\n\t                                                    { number: '11', text: 'November', count: $filter('endedMonth')(items, itemYears[i].year, '11').length },\r\n\t                                                    { number: '12', text: 'December', count: $filter('endedMonth')(items, itemYears[i].year, '12').length }\r\n\t                                          ]\r\n\t                                         });\r\n\t                }\r\n\t            }\r\n\t            maxCompleteMonth = obj.maxCompleteMonth(items);\r\n\t            monthDetails = { months: completeByMonthItems, max: maxCompleteMonth };\r\n\r\n\t//            console.log('completeByMonthItems', completeByMonthItems);\r\n\t            return monthDetails;\r\n\t        }\r\n\r\n\t        //complete by season stats.\r\n\t        function completeBySeason(items) {\r\n\t            var seasonDetails = {}, completeBySeasonItems = [], maxCompleteSeason = 0, itemYears = obj.endingYears(items), i = itemYears.length;\r\n\t            //build completeBySeasonItems object.\r\n\t            while(i--) {\r\n\t                //chuck the null end date. push the year part of the other end dates with seasons array.\r\n\t                if (itemYears[i].year !== undefined && itemYears[i].year !== null) {\r\n\t                    completeBySeasonItems.push({ year: itemYears[i].year,\r\n\t                                            seasons: [\r\n\t                                                        { number: '03', text: 'Winter', count: $filter('season')(items, itemYears[i].year, 'Winter').length },\r\n\t                                                        { number: '06', text: 'Spring', count: $filter('season')(items, itemYears[i].year, 'Spring').length },\r\n\t                                                        { number: '09', text: 'Summer', count: $filter('season')(items, itemYears[i].year, 'Summer').length },\r\n\t                                                        { number: '12', text: 'Fall', count: $filter('season')(items, itemYears[i].year, 'Fall').length }\r\n\t                                            ]\r\n\t                                          });\r\n\t                }\r\n\t            }\r\n\t            //find maximum complete in a season.\r\n\t            angular.forEach(completeBySeasonItems, function(item) {\r\n\t                var i = item.seasons.length;\r\n\t                while(i--) {\r\n\t                    if (item.seasons[i].count > maxCompleteSeason) {\r\n\t                        maxCompleteSeason = item.seasons[i].count;\r\n\t                    }\r\n\t                }\r\n\t            });\r\n\t            seasonDetails = { seasons: completeBySeasonItems, max: maxCompleteSeason };\r\n\t//            console.log('completeBySeasonItems', seasonDetails);\r\n\t            return seasonDetails;\r\n\t        }\r\n\r\n\t        //Temporary function to generate the season data for pre-exisiting items in db.\r\n\t        function setSeason(items, year, season) {\r\n\t            var array = $filter('endedSeason')(items, year, season);\r\n\t            angular.forEach(array, function(item) {\r\n\t                console.log(item.title);\r\n\t                item.season = obj.convertDateToSeason(new Date(item.start));\r\n\t            });\r\n\t            return array;\r\n\t        }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('ListService', ListService);\r\n\tListService.$inject = ['moment', '$q'];\r\n\r\n\tfunction ListService(moment, $q) {\r\n\t\tvar service = {\r\n\t\t\tcheckForTagless: checkForTagless,\r\n\t\t\tconcatenateTagArrays: concatenateTagArrays,\r\n\t\t\tfindWithAttr: findWithAttr,\r\n\t\t\tgetCommonArrays: getCommonArrays,\r\n\t\t\tgetSelectListOptions: getSelectListOptions,\r\n\t\t\tgroupItemsByProperties: groupItemsByProperties,\r\n\t\t\tmanipulateString: manipulateString,\r\n\t\t\tnumberOfPages: numberOfPages,\r\n\t\t\tstringReverse: stringReverse,\r\n\t\t\tweekEndingForDate: weekEndingForDate\r\n\t\t};\r\n\t\treturn service;\r\n\r\n\t        function stringReverse(string) {\r\n\t            return string.split('').reverse().join('');\r\n\t        }\r\n\r\n\t        //get number of pages for list.\r\n\t        function numberOfPages(showingCount, pageSize, currentPage) {\r\n\t            var pageCount = Math.ceil(showingCount/pageSize);\r\n\t            //reset number of pages to be the final page if the number of pages\r\n\t            //becomes less than the one you are on.\r\n\t            if (currentPage + 1 >= pageCount && pageCount !== 0) {\r\n\t                currentPage = pageCount-1;\r\n\t            }\r\n\t            if (pageCount!==0 && currentPage < 0) {\r\n\t                currentPage = 0;\r\n\t            }\r\n\t            var pagingDetails = { currentPage: currentPage, pageCount: pageCount };\r\n\t            return pagingDetails;\r\n\t        }\r\n\r\n\t        //find index of object with given attr.\r\n\t        function findWithAttr(array, attr, value) {\r\n\t            if (array !== undefined) {\r\n\t                for(var i = 0; i < array.length; i += 1) {\r\n\t                    if(array[i][attr] === value) {\r\n\t                        return i;\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            return -1;\r\n\t        }\r\n\r\n\t\t\t\t\t/** Splitting array into multiple arrays by grouping by attributes.\r\n\t\t\t\t\t */\r\n\t\t\t\t\t function groupItemsByProperties(array, groupProperties) {\r\n\t\t\t\t\t\t return $q(function (resolve, reject) {\r\n\t\t\t\t\t\t\t\t var groupedArrays = groupBy(array, function (item) {\r\n\t\t\t\t\t\t\t\t\t\t return getGroupProperties(item, groupProperties);\r\n\t\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t\t resolve(groupedArrays);\r\n\t\t\t\t\t\t });\r\n\t\t\t\t\t }\r\n\t\t\t\t\t //Retrieve the item values for grouping by\r\n\t\t\t\t\t function getGroupProperties(item, groups) {\r\n\t\t\t\t\t\t\t var array = [];\r\n\t\t\t\t\t\t\t angular.forEach(groups, function (group) {\r\n\t\t\t\t\t\t\t\t\t array.push(item[group]);\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t return array;\r\n\t\t\t\t\t }\r\n\t\t\t\t\t //Group the items into arrays using the values.\r\n\t\t\t\t\t function groupBy(array, f) {\r\n\t\t\t\t\t\t\t var groups = {};\r\n\t\t\t\t\t\t\t array.forEach(function (o) {\r\n\t\t\t\t\t\t\t\t\t var group = JSON.stringify(f(o));\r\n\t\t\t\t\t\t\t\t\t groups[group] = groups[group] || [];\r\n\t\t\t\t\t\t\t\t\t groups[group].push(o);\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t return Object.keys(groups).map(function (group) {\r\n\t\t\t\t\t\t\t\t\t return groups[group];\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t }\r\n\r\n\t        function manipulateString(string, transform, onlyFirst) {\r\n\t            switch(transform.toLowerCase()) {\r\n\t                case 'lower':\r\n\t                    if (onlyFirst)  return string.charAt(0).toLowerCase() + string.slice(1);\r\n\t                    if (!onlyFirst) return string.toLowerCase();\r\n\t                    break;\r\n\t                case 'upper':\r\n\t                    if (onlyFirst) return string.charAt(0).toUpperCase() + string.slice(1);\r\n\t                    if (!onlyFirst) return string.toUpperCase();\r\n\t                    break;\r\n\t                default:\r\n\t                    return string.toLowerCase();\r\n\t            }\r\n\t        }\r\n\r\n\t\t\t\t\tfunction weekEndingForDate(convertToSunday) {\r\n\t\t\t        var date = new Date(convertToSunday),\r\n\t\t\t            day = date.getDay(),\r\n\t\t\t            diff = date.getDate() - day + (day === 0 ? 0:7),\r\n\t\t\t            temp = new Date(convertToSunday),\r\n\t\t\t            wkEnd = new Date(temp.setDate(diff));\r\n\t\t\t        return moment(wkEnd.toISOString()).endOf('day');\r\n\t\t\t    }\r\n\r\n\t        //returns the options for the various filters in list pages.\r\n\t        function getSelectListOptions(controller) {\r\n\t            var selectListOptions = {};\r\n\t            if (controller !== 'character' && controller !== 'topten') {\r\n\t                selectListOptions.status = [ { v: '', n: 'All' }, { v: false, n: 'Ongoing' }, { v: true, n: 'Completed' } ];\r\n\t                selectListOptions.searchName = 'title';\r\n\t                if (controller === 'animeitem' || controller === 'watch') {\r\n\t                    selectListOptions.onHold = [ { v: '', n: 'All' }, { v: false, n: 'Ongoing' }, { v: true, n: 'On Hold' } ];\r\n\t                    selectListOptions.sortOptions = [ { v: 'title', n: 'Title' },{ v: 'episodes', n: 'Episodes' },{ v: 'start', n: 'Start date' },\r\n\t                                                      { v: 'end', n: 'End date' },{ v: ['latest', 'meta.updated'], n: 'Latest' },{ v: 'rating', n: 'Rating' }\r\n\t                                                    ];\r\n\t                    selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Latest');\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: false, n: 'Online' }, { v: true, n: 'Disc' } ];\r\n\t                    selectListOptions.mediaType = 'disc';\r\n\t                    selectListOptions.repeating = [ { v: '', n: 'All' }, { v: false, n: 'Not Re-watching' }, { v: true, n: 'Re-watching' } ];\r\n\t                    selectListOptions.repeatType = 'reWatching';\r\n\t                } else if (controller === 'mangaitem') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'title', n: 'Title' },{ v: 'chapters', n: 'Chapters' },{ v: 'volumes', n: 'Volumes' },{ v: 'start', n: 'Start date' },\r\n\t                                                      { v: 'end', n: 'End date' },{ v: ['latest', 'meta.updated'], n: 'Latest' },{ v: 'rating', n: 'Rating' }\r\n\t                                                    ];\r\n\t                    selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Latest');\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: false, n: 'Online' }, { v: true, n: 'Hardcopy' } ];\r\n\t                    selectListOptions.mediaType = 'hardcopy';\r\n\t                    selectListOptions.repeating = [ { v: '', n: 'All' }, { v: false, n: 'Not Re-reading' }, { v: true, n: 'Re-reading' } ];\r\n\t                    selectListOptions.repeatType = 'reReading';\r\n\t                }\r\n\t            } else {\r\n\t                if (controller === 'character') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'name', n: 'Name' }, { v: 'anime.title', n: 'Anime' }, { v: 'manga.title', n: 'Manga' }, { v: 'voice', n: 'Voice' }  ];\r\n\t                    selectListOptions.media = [\r\n\t                        { v: '', n: '-- choose media type --' }, { v: 'none', n: 'None' }, { v: 'anime', n: 'Anime-only' }, { v: 'manga', n: 'Manga-only' }, { v: 'both', n: 'Both' }\r\n\t                    ];\r\n\t                } else if (controller === 'topten') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'name', n: 'Name' } ];\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: 'anime', n: 'Anime' }, { v: 'manga', n: 'Manga' }, { v: 'character', n: 'Character' } ];\r\n\t                    selectListOptions.mediaType = 'type';\r\n\t                }\r\n\t                selectListOptions.searchName = 'name';\r\n\t                selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Name');\r\n\t            }\r\n\t//            console.log(selectListOptions);\r\n\t            return selectListOptions;\r\n\t        }\r\n\r\n\t        function concatenateTagArrays(itemTags, tagArray) {\r\n\t            if (itemTags.length > 0) {\r\n\t                var i = 0, alreadyAdded = false;\r\n\t                while(i < tagArray.length) {\r\n\t                    for(var j = 0; j < itemTags.length; j++) {\r\n\t                        if (itemTags[j].text === tagArray[i].text) {\r\n\t                            alreadyAdded = true;\r\n\t                        }\r\n\t                    }\r\n\t                    //add if isn't already in the array.\r\n\t                    if (alreadyAdded === false) {\r\n\t                        itemTags.push(tagArray[i]);\r\n\t                    }\r\n\t                    i++;\r\n\t                    alreadyAdded = false;\r\n\t                }\r\n\t//                console.log(itemTags);\r\n\t                return itemTags;\r\n\t            } else {\r\n\t                //if there are no tags for item, then just return the new tags.\r\n\t                return tagArray;\r\n\t            }\r\n\t        }\r\n\r\n\t        //check to see if there are items with no tags.\r\n\t        function checkForTagless(items) {\r\n\t            var areTagless = false;\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.tags.length === 0) {\r\n\t                    areTagless = true;\r\n\t                }\r\n\t            });\r\n\t            return areTagless;\r\n\t        }\r\n\r\n\t        function getCommonArrays(controller) {\r\n\t            var commonArrays = {},\r\n\t                itemTypes = [\r\n\t                    { name: 'anime' },\r\n\t                    { name: 'manga' },\r\n\t                    { name: 'character' }\r\n\t                ],\r\n\t                seasons = [\r\n\t                    { number: '03', text: 'Winter' },\r\n\t                    { number: '06', text: 'Spring' },\r\n\t                    { number: '09', text: 'Summer' },\r\n\t                    { number: '12', text: 'Fall' }\r\n\t                ],\r\n\t                months = [\r\n\t                    { number: '01', text: 'January' },\r\n\t                    { number: '02', text: 'February' },\r\n\t                    { number: '03', text: 'March' },\r\n\t                    { number: '04', text: 'April' },\r\n\t                    { number: '05', text: 'May' },\r\n\t                    { number: '06', text: 'June' },\r\n\t                    { number: '07', text: 'July' },\r\n\t                    { number: '08', text: 'August' },\r\n\t                    { number: '09', text: 'September' },\r\n\t                    { number: '10', text: 'October' },\r\n\t                    { number: '11', text: 'November' },\r\n\t                    { number: '12', text: 'December' }\r\n\t                ],\r\n\t                categories = [\r\n\t                    {name: 'Watch'},\r\n\t                    {name: 'Read'},\r\n\t                    {name: 'Play'},\r\n\t                    {name: 'Other'}\r\n\t                ],\r\n\t                days = [\r\n\t                    {name: 'Any'},\r\n\t                    {name: 'Monday'},\r\n\t                    {name: 'Tuesday'},\r\n\t                    {name: 'Wednesday'},\r\n\t                    {name: 'Thursday'},\r\n\t                    {name: 'Friday'},\r\n\t                    {name: 'Saturday'},\r\n\t                    {name: 'Sunday'}\r\n\t                ],\r\n\t                summaryFunctions = [\r\n\t                    { name: 'Average' },\r\n\t                    { name: 'Highest' },\r\n\t                    { name: 'Lowest' },\r\n\t                    { name: 'Mode' }\r\n\t                ];\r\n\t            commonArrays = { months: months, seasons: seasons, categories: categories, days: days, summaryFunctions: summaryFunctions, itemTypes: itemTypes };\r\n\t            return commonArrays;\r\n\t        }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('WatchAnime', WatchAnime);\r\n\tWatchAnime.$inject = ['$resource'];\r\n\r\n\t\tfunction WatchAnime($resource) {\r\n\t\t\treturn $resource('animeitems/watch-list', { }, { update: { method: 'PUT' } });\r\n\t\t}\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('characters').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Characters', 'characters', 'dropdown', '/characters(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'characters', 'List Characters', 'characters');\r\n\t\tMenus.addSubMenuItem('topbar', 'characters', 'New Character', 'characters/create');\r\n\t}\r\n]);\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('characters').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Characters state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listCharacters', {\r\n\t\t\turl: '/characters',\r\n\t\t\ttemplateUrl: 'modules/characters/views/list-characters.client.view.html'\r\n\t\t}).\r\n\t\tstate('createCharacter', {\r\n\t\t\turl: '/characters/create',\r\n\t\t\ttemplateUrl: 'modules/characters/views/create-character.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewCharacter', {\r\n\t\t\turl: '/characters/:characterId',\r\n\t\t\ttemplateUrl: 'modules/characters/views/view-character.client.view.html'\r\n\t\t}).\r\n\t\tstate('editCharacter', {\r\n\t\t\turl: '/characters/:characterId/edit',\r\n\t\t\ttemplateUrl: 'modules/characters/views/edit-character.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.controller('CharactersController', CharactersController);\r\n\tCharactersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Characters', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ListService', 'CharacterService', 'NotificationFactory', 'spinnerService', 'TagService'];\r\n\r\n\tfunction CharactersController($scope, $stateParams, $location, Authentication, Characters, Animeitems, Mangaitems, fileUpload, $sce, $window, ListService, CharacterService, NotificationFactory, spinnerService, TagService) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.filterConfig = {\r\n\t\t\tisList: 'list', //show list? or slider.\r\n      showingCount: 0,\r\n      sortType: '',\r\n      sortReverse: false,\r\n      searchTags: '',\r\n      media: '',\r\n      seriesFilter: '',\r\n      tagsForFilter: [],\r\n      taglessItem: false,\r\n      areTagless: false,\r\n      selectListOptions: {},\r\n      statTags: [],\r\n      voiceActors: [],\r\n      series: []\r\n    };\r\n\t\tctrl.find = find;\r\n\t\tctrl.findAnime = findAnime;\r\n\t\tctrl.findManga = findManga;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.findOneAnime = findOneAnime;\r\n\t\tctrl.findOneManga = findOneManga;\r\n    ctrl.imgPath = ''; //image path\r\n\t\tctrl.maxItemCount = 0; //number of characters.\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.removeTag = removeTag;\r\n    ctrl.tagArray = []; // holding tags pre-submit\r\n    ctrl.tagArrayRemove = [];\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.whichController = 'character';\r\n\r\n\r\n\t\t//allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n    //For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for animeitem tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.mangaitem.tags, text);\r\n\t\t}\r\n\r\n\t\t// Create new Character\r\n\t\tfunction create() {\r\n\t    //console.log(ctrl.tagArray);\r\n\t    var character = new Characters();\r\n\t\t\t// Create new Character object\r\n\t\t\tcharacter = new Characters ({\r\n\t\t\t\tname: ctrl.name,\r\n      \timage: ctrl.imgPath,\r\n        anime: ctrl.anime!==undefined && ctrl.anime!==null ? ctrl.anime._id : ctrl.anime,\r\n        manga: ctrl.manga!==undefined && ctrl.manga!==null ? ctrl.manga._id : ctrl.manga,\r\n        voice: ctrl.voice,\r\n        tags: ctrl.tagArray,\r\n        user: ctrl.user\r\n\t\t\t});\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\tcharacter.$save(function(response) {\r\n\t\t\t\t$location.path('characters/' + response._id);\r\n        NotificationFactory.success('Saved!', 'Character was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n\t\t\t\tNotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Remove existing Character\r\n\t\tfunction remove(character) {\r\n      //are you sure option...\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( character ) {\r\n\t          character.$remove();\r\n\t          for (var i in ctrl.characters) {\r\n\t            if (ctrl.characters [i] === character) {\r\n\t                ctrl.characters.splice(i, 1);\r\n\t            }\r\n\t          }\r\n\t        } else {\r\n\t          ctrl.character.$remove(function() {\r\n\t\t\t\t\t\t\t$location.path('characters');\r\n\t          });\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Character was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Update existing Character\r\n\t\tfunction update() {\r\n\t\t\tvar character = ctrl.character;\r\n      //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n      if (ctrl.character.manga!==null && ctrl.character.manga!==undefined) {\r\n          character.manga = ctrl.character.manga._id;\r\n      }\r\n//            console.log(ctrl.character.anime);\r\n      if (ctrl.character.anime!==null && ctrl.character.anime!==undefined) {\r\n          character.anime = ctrl.character.anime._id;\r\n      }\r\n\r\n      if (ctrl.tagArray!==undefined) {\r\n          character.tags = ListService.concatenateTagArrays(character.tags, ctrl.tagArray);\r\n      }\r\n\r\n      if (ctrl.imgPath!==undefined && ctrl.imgPath!==null && ctrl.imgPath!=='') {\r\n          character.image = ctrl.imgPath;\r\n      }\r\n\r\n\t\t\tcharacter.$update(function() {\r\n\t\t\t\t$location.path('characters');\r\n\t\t\t\tNotificationFactory.success('Saved!', 'Character was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n        NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Find a list of Characters\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t\t\tspinnerService.loading('characters', Characters.query().$promise.then(function(result) {\r\n\t\t\t\tctrl.characters = result;\r\n\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\tctrl.filterConfig.statTags = CharacterService.buildCharacterTags(result);\r\n\t\t\t\tctrl.filterConfig.voiceActors = CharacterService.buildVoiceActors(result);\r\n\t\t\t\tctrl.filterConfig.series = CharacterService.buildSeriesList(result);\r\n\t\t\t\tconsole.log('find characters: ', ctrl.characters, ctrl.filterConfig);\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\t// Find existing Character\r\n\t\tfunction findOne() {\r\n\t\t\tctrl.character = Characters.get({\r\n\t\t\t\tcharacterId: $stateParams.characterId\r\n\t\t\t});\r\n\t\t}\r\n\r\n    // Find a list of Animeitems\r\n\t\tfunction findAnime() {\r\n\t\t\tctrl.animeitems = Animeitems.query();\r\n\t\t}\r\n\r\n    // Find existing Animeitem\r\n\t\tfunction findOneAnime(anime) {\r\n\t\t\tctrl.animeitem = Animeitems.get({\r\n\t\t\t\tanimeitemId: anime\r\n\t\t\t});\r\n\t\t}\r\n\r\n    // Find a list of Mangaitems\r\n\t\tfunction findManga() {\r\n\t\t\tctrl.mangaitems = Mangaitems.query();\r\n\t\t}\r\n\r\n    // Find existing Animeitem\r\n\t\tfunction findOneManga(manga) {\r\n\t\t\tctrl.mangaitem = Mangaitems.get({\r\n\t\t\t\tmangaitemId: manga\r\n\t\t\t});\r\n\t\t}\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/characters/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUploadCharacter');\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('characterBack', characterBack);\r\n\r\n   function characterBack(){\r\n      return function(scope, element, attrs){\r\n          var url = attrs.characterBack;\r\n          element.css({\r\n              'background-image': 'url(' + url +')',\r\n              'background-size' : 'cover',\r\n              'background-repeat': 'no-repeat',\r\n              'background-position': 'center'\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('clearTagValues', clearTagValues);\r\n\r\n  function clearTagValues() {\r\n      return function (scope, element, attrs) {\r\n          element.bind('click', function(event) {\r\n  //            console.log('clear tags');\r\n              scope.$apply(function() {\r\n                  scope.filterConfig.searchTags = '';\r\n                  scope.filterConfig.characterTags = '';\r\n                  scope.filterConfig.tagsForFilter = [];\r\n              });\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('deleteSearchTag', deleteSearchTag);\r\n\r\n  function deleteSearchTag() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function(scope, element, attrs) {\r\n              element.bind('click', function(event) {\r\n                  scope.$apply(function() {\r\n                      var tag = attrs.deleteSearchTag;\r\n                      var index = scope.filterConfig.tagsForFilter.indexOf(tag);\r\n  //                    console.log(tag, index);\r\n                      scope.filterConfig.searchTags = scope.filterConfig.searchTags.replace(tag + ',', '');\r\n                      scope.filterConfig.tagsForFilter.splice(index, 1);\r\n  //                    console.log(scope.searchTags, scope.tagsForFilter);\r\n                  });\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('disableNgAnimate', disableNgAnimate);\r\n  disableNgAnimate.$inject = ['$animate'];\r\n\r\n  function disableNgAnimate($animate) {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element) {\r\n        $animate.enabled(false, element);\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('dropTag', dropTag);\r\n  dropTag.$inject = ['NotificationFactory'];\r\n\r\n   function dropTag(NotificationFactory) {\r\n      return function(scope, element, attrs) {\r\n          element.bind('click', function(event) {\r\n              var text = attrs.dropTag;\r\n               //are you sure option...\r\n              NotificationFactory.confirmation(function() {\r\n                  scope.$apply(function() {\r\n                      var deletingItem = scope.tagArray;\r\n                      scope.$parent.tagArray = [];\r\n  //                    console.log('dropping tag - ', text);\r\n                      //update the complete task.\r\n                      angular.forEach(deletingItem, function(tag) {\r\n                          if (tag.text !== text) {\r\n                              scope.$parent.tagArray.push(tag);\r\n                          }\r\n                      });\r\n                  });\r\n                  NotificationFactory.warning('Dropped!', 'Tag was successfully dropped');\r\n              });\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('enterTag', enterTag);\r\n  function enterTag() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function (scope, element, attrs) {\r\n              element.bind('keydown keypress', function (event) {\r\n                  if(event.which === 13) {\r\n                      scope.$apply(function (){\r\n                          scope.$eval(attrs.enterTag);\r\n                      });\r\n                      event.preventDefault();\r\n                   }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('removeTag', removeTag);\r\n  removeTag.$inject = ['NotificationFactory'];\r\n\r\n   function removeTag(NotificationFactory) {\r\n      return {\r\n          restrict: 'A',\r\n          link: function(scope, element, attrs) {\r\n              element.bind('click', function(event) {\r\n                  var tag = attrs.removeTag,\r\n                      i,\r\n                      entry_type = scope.whichController;\r\n                  //are you sure option...\r\n                NotificationFactory.confirmation(function() {\r\n                      scope.$apply(function () {\r\n                          var index;\r\n                          if (entry_type === 'character') {\r\n                              for(i=0; i < scope.character.tags.length; i++) {\r\n                                  if (scope.character.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.character.tags.splice(index, 1);\r\n                          } else if (entry_type === 'animeitem') {\r\n                              for(i=0; i < scope.animeitem.tags.length; i++) {\r\n                                  if (scope.animeitem.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.animeitem.tags.splice(index, 1);\r\n                          } else if (entry_type === 'mangaitem') {\r\n                              for(i=0; i < scope.mangaitem.tags.length; i++) {\r\n                                  if (scope.mangaitem.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.mangaitem.tags.splice(index, 1);\r\n                          }\r\n  //                        console.log(index, tag);\r\n                      });\r\n                      NotificationFactory.warning('Deleted!', 'Tag was successfully deleted');\r\n                  });\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('slider', slider);\r\n  slider.$inject = ['$timeout', '$sce'];\r\n\r\n  function slider($timeout, $sce) {\r\n    return {\r\n        restrict: 'AE',\r\n        replace: true,\r\n        scope: {\r\n            slides: '=?',\r\n            interval: '=?',\r\n            filterConfig: '=?'\r\n        },\r\n        bindToController: true,\r\n        controllerAs: 'sliderController',\r\n        templateUrl: '/modules/characters/templates/slider.html',\r\n        controller: function($scope) {\r\n          var self = this,\r\n              timer,\r\n              autoSlide;\r\n          self.currentIndex = -1; //pre-first slide to stop 'cannot assign to undefined' error.\r\n          self.enter = enter;\r\n          self.goToSlide = goToSlide;\r\n          self.interval = self.interval === undefined ? 3000 : self.interval; //is there a custom interval?\r\n          self.isFullscreen = false;\r\n          self.leave = leave;\r\n          self.next = next;\r\n          self.prev = prev;\r\n          self.repeater = self.slides === undefined ? false : true; //is there a collection to iterate through?\r\n          self.toggleFullscreen = toggleFullscreen;\r\n          self.trustAsResourceUrl = trustAsResourceUrl;\r\n\r\n          //allow retreival of local resource\r\n          function trustAsResourceUrl(url) {\r\n              return $sce.trustAsResourceUrl(url);\r\n          }\r\n\r\n          //if no collection, make a dummy collection to cycle throught the children.\r\n          if (!self.repeater) {\r\n            self.slides = []; //used to allow cycling.\r\n            for(var i = 0; i < length; i++) {\r\n                self.slides.push({ index: i });\r\n            }\r\n          }\r\n          function goToSlide(slide) {\r\n  //              console.log('go to', slide);\r\n              if (self.currentIndex !== slide) {\r\n                  //reached end of slides?\r\n                  if (slide !== $scope.filteredSlides.length) {\r\n                    self.currentIndex = slide;\r\n                  } else {\r\n                    self.currentIndex = 0;\r\n                  }\r\n              } else {\r\n                  if ($scope.filteredSlides[self.currentIndex].locked) {\r\n                    //unlock, i.e start timer.\r\n                    $scope.filteredSlides[self.currentIndex].locked = false;\r\n                      autoSlide();\r\n                  } else {\r\n                    //lock, i.e. cancel timer.\r\n                    $scope.filteredSlides[self.currentIndex].locked = true;\r\n                    $timeout.cancel(timer);\r\n                  }\r\n              }\r\n          }\r\n\r\n          function next() {\r\n              if (self.currentIndex < $scope.filteredSlides.length - 1) {\r\n                  self.currentIndex += 1;\r\n\r\n              } else {\r\n                  self.currentIndex = 0;\r\n              }\r\n          }\r\n\r\n          function prev() {\r\n              if (self.currentIndex > 0) {\r\n                  self.currentIndex -= 1;\r\n              } else {\r\n                  self.currentIndex = $scope.filteredSlides.length - 1;\r\n              }\r\n          }\r\n\r\n          $scope.$watch('sliderController.currentIndex', function() {\r\n              //  console.log('index', self.currentIndex, 'filtered slides ', $scope.filteredSlides);\r\n              if (self.currentIndex > -1 && $scope.filteredSlides.length > 0) {\r\n                    $scope.filteredSlides.forEach(function(slide) {\r\n                        slide.visible = false; // make every slide invisible\r\n                        slide.locked = false; // make every slide unlocked\r\n                    });\r\n                    $scope.filteredSlides[self.currentIndex].visible = true; // make the current slide visible\r\n              }\r\n          });\r\n\r\n          autoSlide = function() {\r\n              timer = $timeout(function() {\r\n                  self.next();\r\n                  timer = $timeout(autoSlide, self.interval);\r\n              }, self.interval);\r\n          };\r\n          autoSlide();\r\n          $scope.$on('$destroy', function() {\r\n              $timeout.cancel(timer); // when the scope is destroyed, cancel the timer\r\n          });\r\n\r\n          //Stop timer on enter.\r\n          function enter() {\r\n  //              console.log('entered');\r\n              if ($scope.filteredSlides[self.currentIndex].locked !== true) {\r\n                $timeout.cancel(timer);\r\n  //                  console.log('cancelled');\r\n              }\r\n          }\r\n          //Restart timer on leave.\r\n          function leave() {\r\n  //              console.log('left');\r\n              if ($scope.filteredSlides[self.currentIndex].locked !== true) {\r\n                timer = $timeout(autoSlide, self.interval);\r\n  //                  console.log('restarted');\r\n              }\r\n          }\r\n\r\n          //Fullscreen capability\r\n          function toggleFullscreen() {\r\n              self.isFullscreen = !self.isFullscreen;\r\n          }\r\n\r\n        },\r\n        link: function(scope, elem, attrs, sliderController) {\r\n            scope.childElementCount = elem[0].childElementCount - 1;\r\n        }\r\n    };\r\n\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('mediaFilter', mediaFilter);\r\n\r\n  function mediaFilter() {\r\n      return function(array, media) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  if (media==='anime') {\r\n                      if (item.anime!==null && item.manga===null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='manga') {\r\n                      if (item.manga!==null && item.anime===null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='both') {\r\n                      if (item.anime!==null && item.manga!==null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='none') {\r\n                      if (item.anime===null && item.manga===null) {\r\n                          return true;\r\n                      }\r\n                  } else {\r\n                      return true;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('seriesDetailFilter', seriesDetailFilter);\r\n\r\n  function seriesDetailFilter() {\r\n    return function(array, detailSeriesName) {\r\n        if (array !== undefined) {\r\n            return array.filter(function(item) {\r\n                if (detailSeriesName !== '') {\r\n                    //filter stat series detail.\r\n                    if (item.anime!==null && item.anime!==undefined) {\r\n                        if (item.anime.title===detailSeriesName) {\r\n                            return item;\r\n                        }\r\n                    } else if (item.manga!==null && item.manga!==undefined) {\r\n                        if (item.manga.title===detailSeriesName) {\r\n                            return item;\r\n                        }\r\n                    }\r\n                } else {\r\n                    return item;\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('seriesFilter', seriesFilter);\r\n\r\n  function seriesFilter() {\r\n      return function(array, series) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  if (series !== '' && series !== undefined) {\r\n                      //filter stat series detail.\r\n                      if (item.anime!==null && item.anime!==undefined) {\r\n                          return item.anime.title.toLowerCase().indexOf(series.toLowerCase()) > -1;\r\n                      } else if (item.manga!==null && item.manga!==undefined) {\r\n                          return item.manga.title.toLowerCase().indexOf(series.toLowerCase()) > -1;\r\n                      }\r\n                  } else {\r\n                      return item;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('tagFilter', tagFilter);\r\n\r\n  function tagFilter() {\r\n      return function(array, searchTags, taglessItem) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  //special tag filter\r\n                  var found = false;\r\n                  var i = 0;\r\n                  var tagsToSearch = [];\r\n                  var tagsForFilter;\r\n\r\n                  //if tagless is checked return tagless and nothing else.\r\n                  if (taglessItem===true) {\r\n                      if (item.tags.length===0) {\r\n                          return item;\r\n                      }\r\n                  } else {\r\n                      if (searchTags===undefined || searchTags==='') {\r\n                          return true;\r\n                      } else {\r\n                          //get tags that are being looked for\r\n                          tagsForFilter = searchTags.substring(0, searchTags.length - 1).split(',');\r\n                          //console.log(tagsForFilter);\r\n\r\n                          //get tags of items to filter\r\n                          angular.forEach(item.tags, function(tag) {\r\n                              tagsToSearch.push(tag.text);\r\n                          });\r\n\r\n                          //filter: check in 'query' is in tags.\r\n                          for(i = 0; i < tagsForFilter.length; i++) {\r\n                              if (tagsToSearch.indexOf(tagsForFilter[i]) !== -1) {\r\n                                  found = true;\r\n                              } else {\r\n                                  return false;\r\n                              }\r\n                          }\r\n                          return found;\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.service('CharacterService', CharacterService);\r\n\tCharacterService.$inject = ['$q'];\r\n\r\n\tfunction CharacterService($q) {\r\n\r\n\t    //build the character gender distribution.\r\n\t    this.buildGenderDistribution = function(items, maxCount) {\r\n\t        return $q(function(resolve, reject) {\r\n\t            var check, gender = [];\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.tag === 'male') {\r\n\t                    gender.push({\r\n\t                        type: 'male',\r\n\t                        count: item.count,\r\n\t                        percentage: Number(((item.count / maxCount) * 100).toFixed(2)),\r\n\t                        text: '% male.'\r\n\t                    });\r\n\t                } else if (item.tag === 'female') {\r\n\t                    gender.push({\r\n\t                        type: 'female',\r\n\t                        count: item.count,\r\n\t                        percentage: Number(((item.count / maxCount) * 100).toFixed(2)),\r\n\t                        text: '% female.'\r\n\t                    });\r\n\t                }\r\n\t            });\r\n\t            gender.push({\r\n\t                type: 'unassigned',\r\n\t                count: maxCount - gender[0].count - gender[1].count,\r\n\t                percentage: Number(((maxCount - gender[0].count - gender[1].count / maxCount) * 100).toFixed(2)),\r\n\t                text: '% unassigned.'\r\n\t            });\r\n\r\n\t            //Fudge any rounding errors.\r\n\t            check = gender[0].percentage + gender[1].percentage + gender[2].percentage;\r\n\t            if (check > 100) {\r\n\t                gender[2].percentage -= (check - 100).toFixed(2);\r\n\t            } else if (check < 100) {\r\n\t                gender[2].percentage += (100 - check).toFixed(2);\r\n\t            }\r\n\t            resolve(gender);\r\n\t        });\r\n\t    };\r\n\r\n\t    this.buildCharacterTags = function(items) {\r\n\t        var add = true, statTags = [];\r\n\t        //is tag in array?\r\n\t        angular.forEach(items, function(item) {\r\n\t            angular.forEach(item.tags, function(tag) {\r\n\t                for(var i=0; i < statTags.length; i++) {\r\n\t                    if (statTags[i].tag === tag.text) {\r\n\t                        add = false;\r\n\t                        statTags[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t                // add if not in\r\n\t                if (add===true) {\r\n\t                    statTags.push({ tag: tag.text, count: 1 });\r\n\t                }\r\n\t                add = true; //reset add status.\r\n\t            });\r\n\t//          console.log($scope.statTags);\r\n\t        });\r\n\r\n\t        return statTags;\r\n\t    };\r\n\r\n\t    this.buildRelatedCharacterTags = function(items, name) {\r\n\t        var add = true, tagDetailCollection = [], tagDetailResult = [];\r\n\t        //get all character tag arrays that contain the chosen tag into a collection.\r\n\t        angular.forEach(items, function(item){\r\n\t            for(var i=0; i < item.tags.length; i++) {\r\n\t                if (item.tags[i].text === name) {\r\n\t                    tagDetailCollection.push(item.tags);\r\n\t                }\r\n\t            }\r\n\t        });\r\n\t//        console.log(tagDetailCollection);\r\n\t        angular.forEach(tagDetailCollection, function(item) {\r\n\t            angular.forEach(item, function(bit) {\r\n\t//              console.log(bit);\r\n\t                for(var i=0; i < tagDetailResult.length; i++) {\r\n\t                    //if exists and not the search value - increment the count.\r\n\t                    if (tagDetailResult[i].name===bit.text && bit.text!==name) {\r\n\t                        add = false;\r\n\t                        tagDetailResult[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t                //add if true and not the tag we searched on.\r\n\t                if (add===true && bit.text!==name) {\r\n\t                    tagDetailResult.push({ name: bit.text, count: 1 });\r\n\t                }\r\n\t                add = true;\r\n\t            });\r\n\t        });\r\n\t//        console.log(tagDetailResult);\r\n\t        return tagDetailResult;\r\n\t    };\r\n\r\n\t    this.buildVoiceActors = function(items) {\r\n\t        var add = true, voiceActors = [];\r\n\t        //is voice actor in array?\r\n\t        angular.forEach(items, function(item) {\r\n\t            for(var i=0; i < voiceActors.length; i++) {\r\n\t                if (voiceActors[i].name === item.voice) {\r\n\t                    add = false;\r\n\t                    voiceActors[i].count += 1;\r\n\t                }\r\n\t            }\r\n\t            // add if not in\r\n\t            if (add===true) {\r\n\t                voiceActors.push({ name: item.voice, count: 1 });\r\n\t            }\r\n\t            add = true; //reset add status.\r\n\t        });\r\n\r\n\t        return voiceActors;\r\n\t    };\r\n\r\n\t    this.buildSeriesList = function(items) {\r\n\t        var add = true, statSeries = [];\r\n\t        //get series counts.\r\n\t        angular.forEach(items, function(item) {\r\n\t            for(var i=0; i < statSeries.length; i++) {\r\n\t                if (item.anime) {\r\n\t                    if (statSeries[i].name === item.anime.title) {\r\n\t                        add = false;\r\n\t                        statSeries[i].count += 1;\r\n\t                    }\r\n\t                } else if (item.manga) {\r\n\t                    if (statSeries[i].name === item.manga.title) {\r\n\t                        add = false;\r\n\t                        statSeries[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            // add if not in\r\n\t            if (add === true) {\r\n\t                if (typeof(item.anime) === 'object' && item.anime !== null) {\r\n\t                    statSeries.push({ _id: item.anime._id, name: item.anime.title, count: 1 });\r\n\t                } else if (typeof(item.manga) === 'object' && item.manga !== null) {\r\n\t                    statSeries.push({ _id: item.manga._id, name: item.manga.title, count: 1 });\r\n\t                }\r\n\t            }\r\n\t            add = true; //reset add status.\r\n\t        });\r\n\r\n\t        return statSeries;\r\n\t    };\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.factory('Characters', CharacterFactory);\r\n\t CharacterFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction CharacterFactory($resource) {\r\n\t\t\treturn $resource('characters/:characterId', { characterId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.service('TagService', TagService);\r\n\tTagService.$inject = ['$rootScope', 'NotificationFactory'];\r\n\r\n\t function TagService($rootScope, NotificationFactory) {\r\n\t\t\tvar service = {};\r\n\r\n\t\t\t//Add newTag to tagArray\r\n\t\t\tservice.addTag = function(tagArray, newTag) {\r\n\t\t\t    if (newTag!=='' && newTag!==undefined) {\r\n\t\t\t        var i = 0, alreadyAdded = false;\r\n\t\t\t        if (tagArray.length > 0) {\r\n\t\t\t            while(i < tagArray.length) {\r\n\t\t\t                if (tagArray[i].text === newTag) {\r\n\t\t\t                    alreadyAdded = true;\r\n\t\t\t                }\r\n\t\t\t                i++;\r\n\t\t\t            }\r\n\t\t\t            //if not in array add it.\r\n\t\t\t            if (alreadyAdded === false) {\r\n\t\t\t                tagArray.push({ text: newTag });\r\n\t\t\t            }\r\n\t\t\t        } else {\r\n\t\t\t            tagArray.push({ text: newTag });\r\n\t\t\t        }\r\n\t\t\t    }\r\n\t\t\t};\r\n\r\n\t\t\t//Drop tag with text = text, from tagArray\r\n\t\t\tservice.dropTag = function(tagArray, text) {\r\n\t\t\t\t //are you sure option...\r\n\t\t\t\tNotificationFactory.confirmation(function() {\r\n\t\t\t\t\t$rootScope.$apply(function() {\r\n\t\t\t\t\t\tvar i = tagArray.length;\r\n\t\t\t\t\t\twhile(i--) {\r\n\t\t\t\t\t\t\tif(tagArray[i].text === text) {\r\n\t\t\t\t\t\t\t\ttagArray.splice(i, 1);\r\n\t\t\t\t\t\t\t\tNotificationFactory.warning('Dropped!', 'Tag was successfully dropped');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\treturn service;\r\n\t}\r\n\r\n})();\r\n\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('core').controller('HeaderController', HeaderController);\r\n\tHeaderController.$inject = ['$scope', 'Authentication', 'Menus', '$location'];\r\n\r\n\tfunction HeaderController($scope, Authentication, Menus, $location) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.changeTheme = changeTheme;\r\n\t\tctrl.isActive = isActive;\r\n\t\tctrl.isCollapsed = false;\r\n\t\tctrl.isTimedTheme = localStorage.getItem('timedTheme');\r\n\t\tctrl.menu = Menus.getMenu('topbar');\r\n\t\tctrl.saved = localStorage.getItem('theme');\r\n\t\tctrl.styles = [\r\n        { name: 'Day', url: 'dist/main-day.css' },\r\n        { name: 'Night', url: 'dist/main-night.css' }\r\n    ];\r\n\t\tctrl.theme = (localStorage.getItem('theme')!==null) ? JSON.parse(ctrl.saved) : ctrl.styles[1].url;\r\n\t\tctrl.timedTheme = (localStorage.getItem('timedTheme')!==null) ? JSON.parse(ctrl.isTimedTheme) : false;\r\n\t\tctrl.toggleCollapsibleMenu = toggleCollapsibleMenu;\r\n\r\n\t\tlocalStorage.setItem('theme', JSON.stringify(ctrl.theme));\r\n  \tlocalStorage.setItem('timedTheme', JSON.stringify(ctrl.timedTheme));\r\n\r\n\t\tfunction toggleCollapsibleMenu() {\r\n\t\t\tctrl.isCollapsed = !ctrl.isCollapsed;\r\n\t\t}\r\n\r\n\t\t// Collapsing the menu after navigation\r\n\t\t$scope.$on('$stateChangeSuccess', function() {\r\n\t\t\tctrl.isCollapsed = false;\r\n\t\t});\r\n\r\n    function isActive(viewLocation) {\r\n        return viewLocation === $location.path();\r\n    }\r\n\r\n    function changeTheme() {\r\n        localStorage.setItem('timedTheme', JSON.stringify(ctrl.timedTheme));\r\n        var timeOfDayTheme = localStorage.getItem('timedTheme');\r\n        if (timeOfDayTheme === 'false') {\r\n            localStorage.setItem('theme', JSON.stringify(ctrl.theme));\r\n        } else {\r\n            var time = new Date().getHours();\r\n            if (time > 20 || time < 8) {\r\n                localStorage.setItem('theme', JSON.stringify(ctrl.styles[1].url));\r\n            } else if (time > 8) {\r\n                localStorage.setItem('theme', JSON.stringify(ctrl.styles[0].url));\r\n            }\r\n        }\r\n        var storedValue = localStorage.getItem('theme'),\r\n        link = document.getElementById('app-theme');\r\n        link.href = storedValue.substr(1, storedValue.lastIndexOf('\\\"') - 1); //remove quotes for whatever reason.\r\n        ctrl.theme = storedValue.substr(1, storedValue.lastIndexOf('\\\"') - 1); //remove quotes for whatever reason. //set the dropdown to the correct value;\r\n    }\r\n\r\n\t}\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('anywhereButHere', anywhereButHere);\r\n  anywhereButHere.$inject = ['$compile'];\r\n\r\n  function anywhereButHere($compile) {\r\n      return {\r\n          restrict: 'A',\r\n          scope: {\r\n            showBackdrop: '=ngShow'\r\n          },\r\n          link: function (scope, element, attrs) {\r\n            var body = document.body,\r\n                backdrop = angular.element('<div id=\"anywhere-but-here-backdrop\" ng-show=\"showBackdrop\" ng-click=\"triggerAnywhereButHere()\"></div>')[0];\r\n            body.appendChild(backdrop);\r\n            $compile(backdrop)(scope);\r\n\r\n            scope.triggerAnywhereButHere = function() {\r\n              scope.showBackdrop = false;\r\n            };\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('clickPass', clickPass);\r\n  clickPass.$inject = ['$timeout'];\r\n\r\n   function clickPass($timeout) {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        element.bind('click', function(event) {\r\n          $timeout(function() {\r\n            event.stopPropagation();\r\n            document.getElementById(attrs.clickPass).click();\r\n          }, 0);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('formatDate', formatDate);\r\n   function formatDate(){\r\n    return {\r\n     require: 'ngModel',\r\n      link: function(scope, elem, attr, modelCtrl) {\r\n        modelCtrl.$formatters.push(function(modelValue){\r\n          return (modelValue === null) ? null : new Date(modelValue);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('loadingSpinner', loadingSpinner);\r\n  loadingSpinner.$inject = ['$http', 'spinnerService'];\r\n\r\n   function loadingSpinner($http, spinnerService) {\r\n      return {\r\n          restrict: 'A',\r\n          transclude: true,\r\n          replace: true,\r\n          templateUrl: '/modules/core/templates/loading-spinner.html',\r\n          scope: {\r\n              name: '@',\r\n              size: '@?'\r\n          },\r\n          bindToController: 'loadingSpinner',\r\n          controller: function ($scope) {\r\n              $scope.active = false;\r\n  //            $scope.isLoading = function () {\r\n  //                return $http.pendingRequests.length > 0;\r\n  //            };\r\n\r\n  //            $scope.$watch($scope.isLoading, function (v) {\r\n  //                if ($scope.size === 'fullscreen') {\r\n  //                    if(v) {\r\n  //                        $scope.active = true;\r\n  //                    } else {\r\n  //                        $scope.active = false;\r\n  //                    }\r\n  //                }\r\n  //            });\r\n\r\n              var api = {\r\n                  name: $scope.name,\r\n                  show: function () {\r\n                      $scope.active = true;\r\n                  },\r\n                  hide: function () {\r\n                      $scope.active = false;\r\n                  },\r\n                  toggle: function () {\r\n                      $scope.active = !$scope.active;\r\n                  }\r\n              };\r\n\r\n              spinnerService._register(api);\r\n              $scope.$on('$destroy', function () {\r\n                  spinnerService._unregister($scope.name);\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('malSearch', malSearch);\r\n  malSearch.$inject = ['MalService', '$timeout'];\r\n\r\n  function malSearch(MalService, $timeout) {\r\n      return {\r\n          restrict: 'A',\r\n          replace: true,\r\n          scope: {\r\n            type: '=malSearch',\r\n            selectItem: '=malSearchSelect',\r\n            searchString: '=malSearchModel',\r\n            options: '=malSearchOptions'\r\n          },\r\n          controllerAs: 'malSearchCtrl',\r\n          bindToController: true,\r\n          templateUrl: '/modules/core/templates/mal-search.html',\r\n          controller: function ($scope) {\r\n            var self = this,\r\n                timeoutPromise,\r\n                delayInMs = 2000;\r\n\r\n            self.displayActions = false;\r\n            self.displaySelectedItemActions = displaySelectedItemActions;\r\n            self.hasFocus = false;\r\n            self.hasSearchResults = false;\r\n            self.processItem = processItem;\r\n            self.searchResults = [];\r\n            self.selectedItem = null;\r\n            self.selectedItemActions = [\r\n              {\r\n                displayText: 'Remove selected',\r\n                action: function() {\r\n                  self.processItem(null);\r\n                  self.searchString = undefined;\r\n                  self.displayActions = false;\r\n                }\r\n              },\r\n              {\r\n                displayText: 'Display raw json',\r\n                action: function() {\r\n                  self.displayRawJson = true;\r\n                }\r\n              }\r\n            ];\r\n            self.toggleSearchDropdownOnFocus = toggleSearchDropdownOnFocus;\r\n\r\n            function processItem(item) {\r\n              self.selectItem(item);\r\n              self.selectedItem = item;\r\n            }\r\n\r\n            function displaySelectedItemActions() {\r\n              self.displayActions = true;\r\n            }\r\n\r\n            function searchMal(type, searchString) {\r\n              MalService.search(type, searchString).then(function (result) {\r\n                self.searchResults = result;\r\n                self.hasSearchResults = true;\r\n              });\r\n            }\r\n\r\n            function toggleSearchDropdownOnFocus(event) {\r\n              $timeout(function() {\r\n                self.hasFocus = event.type === 'focus';\r\n              }, 500);\r\n            }\r\n\r\n            $scope.$watch('malSearchCtrl.searchString', function(newValue) {\r\n              self.hasFocus = true;\r\n              if(newValue !== undefined && newValue.length > 2 && self.selectedItem === null && !self.options.disabled) {\r\n                $timeout.cancel(timeoutPromise);\r\n                timeoutPromise = $timeout(function() {\r\n                     searchMal(self.type, newValue);\r\n                }, delayInMs);\r\n              }\r\n            });\r\n\r\n            $scope.$watch('malSearchCtrl.displayActions', function(newValue) {\r\n              if(newValue !== undefined && !newValue) {\r\n                self.displayRawJson = newValue;\r\n              }\r\n            });\r\n\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('myProgress', myProgress);\r\n\r\n   function myProgress() {\r\n      return function(scope, element, attrs) {\r\n          scope.$watch(attrs.myProgress, function(val) {\r\n              var type = 'checklist-progress';\r\n              element.html('<div class=\"' + type + '\" style=\"width: ' + val + '%;height: 100%\"></div>');\r\n          });\r\n        };\r\n    }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('calendarFilter', calendarFilter);\r\n\r\n   function calendarFilter() {\r\n      return function(array, datesSelected) {\r\n          if (array) {\r\n              return array.filter(function(item) {\r\n                  //date filter\r\n                  if (item.date === null || item.date === undefined) {\r\n                      if (datesSelected === false) {\r\n                          return item;\r\n                      }\r\n                      return false;\r\n                  }\r\n\r\n                  var day = new Date().getDay(),\r\n                      diff = new Date().getDate() - day + (day === 0 ? 0:7),\r\n                      temp = new Date(),\r\n                      wkEnd = new Date(temp.setDate(diff)),\r\n                      currentWkEnd = wkEnd.toISOString().substring(0,10),\r\n                      iDate = new Date(item.date).toISOString(),\r\n                      itemDate = { year: iDate.substr(0,4), month: iDate.substr(5,2), day: iDate.substr(8,2) },\r\n                      currentDate = { year: currentWkEnd.substr(0,4), month: currentWkEnd.substr(5,2), day: currentWkEnd.substr(8,2) };\r\n\r\n                  if (datesSelected === false) {\r\n                      if (itemDate.year < currentDate.year) {\r\n                          return item;\r\n                      } else if (itemDate.year === currentDate.year) {\r\n                          if (itemDate.month < currentDate.month) {\r\n                              return item;\r\n                          } else if (itemDate.month === currentDate.month) {\r\n                              if (itemDate.day <= currentDate.day) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  } else if (datesSelected === true) {\r\n                      if (itemDate.year > currentDate.year) {\r\n                          return item;\r\n                      } else if (itemDate.year === currentDate.year) {\r\n                          if (itemDate.month > currentDate.month) {\r\n                              return item;\r\n                          } else if (itemDate.month === currentDate.month) {\r\n                              if (itemDate.day > currentDate.day) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('dateSuffix', dateSuffix);\r\n\r\n   function dateSuffix($filter) {\r\n    var suffixes = ['th', 'st', 'nd', 'rd'];\r\n    return function(input) {\r\n      if(input !== undefined){\r\n          var dtfilter = $filter('date')(input, 'MMMM d'),\r\n              day = parseInt(dtfilter.slice(-2)),\r\n              relevantDigits = (day < 30) ? day % 20 : day % 30,\r\n              suffix = (relevantDigits <= 3) ? suffixes[relevantDigits] : suffixes[0],\r\n              dateArray = dtfilter.split(' '),\r\n              month = dateArray[0];\r\n          return dateArray[1] + suffix + ' ' + month + ' ' + $filter('date')(input, 'yyyy');\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('dayFilter', dayFilter);\r\n\r\n   function dayFilter() {\r\n    return function(array, daySelected) {\r\n        return array.filter(function(item) {\r\n            //special day filter\r\n//            console.log(item);\r\n            var ds = daySelected;\r\n            if (ds==='1' && item.day==='Monday') {\r\n                return item;\r\n            } else if (ds==='2' && item.day==='Tuesday') {\r\n                return item;\r\n            } else if (ds==='3' && item.day==='Wednesday') {\r\n                return item;\r\n            } else if (ds==='4' && item.day==='Thursday') {\r\n                return item;\r\n            } else if (ds==='5' && item.day==='Friday') {\r\n                return item;\r\n            } else if (ds==='6' && item.day==='Saturday') {\r\n                return item;\r\n            } else if (ds==='0' && item.day==='Sunday') {\r\n                return item;\r\n            } else if (ds==='' || ds===null || ds===undefined) {\r\n                return item;\r\n            } else if (ds==='Any' && item.day==='Any') {\r\n                return item;\r\n            }\r\n        });\r\n    };\r\n}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('numberFixedLen', numberFixedLen);\r\n\r\n   function numberFixedLen() {\r\n    return function (n, len) {\r\n        var num = parseInt(n, 10);\r\n        len = parseInt(len, 10);\r\n        if (isNaN(num) || isNaN(len)) {\r\n            return n;\r\n        }\r\n        num = ''+num;\r\n        while (num.length < len) {\r\n            num = '0'+num;\r\n        }\r\n        return num;\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('core')\r\n\t.service('Enums', Enums);\r\n\r\n\tfunction Enums() {\r\n\t\tvar obj = {\r\n\t\t\tmalStatus: {\r\n        anime: {\r\n          ongoing: 'Currently Airing',\r\n          complete: 'Finished Airing'\r\n        },\r\n        manga: {\r\n          ongoing: 'Publishing',\r\n          complete: 'Finished'\r\n        }\r\n      }\r\n\t\t};\r\n\t\treturn obj;\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('core')\r\n\t.service('FunctionService', FunctionService);\r\n\tFunctionService.$inject = ['moment'];\r\n\r\n\tfunction FunctionService(moment) {\r\n\t\tvar obj = {\r\n\t\t\tpad: pad\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n    function pad(number, width, padChar) {\r\n      padChar = padChar || '0';\r\n      number = number + '';\r\n      return number.length >= width ? number : new Array(width - number.length + 1).join(padChar) + number;\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('core')\r\n\t.factory('MalService', MalService);\r\n\tMalService.$inject = ['$http', '$resource'];\r\n\r\n\tfunction MalService($http, $resource) {\r\n\t\tvar malService = $resource('', {},\r\n\t\t\t {\r\n\t\t\t\tsearch: {\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\turl: 'malSearch/:type',\r\n\t\t\t\t\tparams: { type: '@_type', searchString: '@_searchString' },\r\n\t\t\t\t\tisArray: true\r\n\t\t\t\t}\r\n\t\t\t });\r\n\r\n\t\tfunction xmlToJson(xml) {\r\n\t\t\tvar ELEMENT_NODE_TYPE = 1,\r\n\t\t\t\tTEXT_NODE_TYPE = 3,\r\n\t\t\t\tobj = {};\r\n\r\n\t\t\tif (xml.nodeType === ELEMENT_NODE_TYPE) {\r\n\t\t\t\tif (xml.attributes.length > 0) {\r\n\t\t\t\tobj['@attributes'] = {};\r\n\t\t\t\t\tfor (var j = 0; j < xml.attributes.length; j++) {\r\n\t\t\t\t\t\tvar attribute = xml.attributes.item(j);\r\n\t\t\t\t\t\tobj['@attributes'][attribute.nodeName] = attribute.nodeValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (xml.nodeType === TEXT_NODE_TYPE) {\r\n\t\t\t\tobj = xml.nodeValue;\r\n\t\t\t}\r\n\r\n\t\t\tif (xml.hasChildNodes() && xml.childNodes.length === 1 && xml.childNodes[0].nodeType === TEXT_NODE_TYPE) {\r\n\t\t\t\tobj = xml.childNodes[0].nodeValue;\r\n\t\t\t}\r\n\t\t\telse if (xml.hasChildNodes()) {\r\n\t\t\t\tfor(var i = 0; i < xml.childNodes.length; i++) {\r\n\t\t\t\t\tvar item = xml.childNodes.item(i),\r\n\t\t\t\t\t\tnodeName = item.nodeName;\r\n\t\t\t\t\tif (typeof(obj[nodeName]) === 'undefined') {\r\n\t\t\t\t\t\tobj[nodeName] = xmlToJson(item);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (typeof(obj[nodeName].push) === 'undefined') {\r\n\t\t\t\t\t\t\tvar old = obj[nodeName];\r\n\t\t\t\t\t\t\tobj[nodeName] = [];\r\n\t\t\t\t\t\t\tobj[nodeName].push(old);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobj[nodeName].push(xmlToJson(item));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn obj;\r\n\t\t}\r\n\r\n\t\tfunction xmlProcessor(type, data) {\r\n\t\t\tvar searchResult = [],\r\n\t\t\t\txml = data.responseXML,\r\n\t\t\t\tnodes = xml.evaluate(`//${type}/entry`, xml, null, XPathResult.ANY_TYPE, null),\r\n\t\t\t\tresult = nodes.iterateNext();\r\n\t\t\twhile (result) {\r\n\t\t\t\tsearchResult.push(xmlToJson(result));\r\n\t\t\t\tresult = nodes.iterateNext();\r\n\t\t\t}\r\n\t\t\treturn searchResult;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tsearch: function (queryType, searchString) {\r\n\t\t\t\treturn malService.search({ type: queryType, searchString: searchString }).$promise;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n})();\r\n\n'use strict';\r\n\r\n//Menu service used for managing  menus\r\nangular.module('core').service('Menus', [\r\n\r\n\tfunction() {\r\n\t\t// Define a set of default roles\r\n\t\tthis.defaultRoles = ['*'];\r\n\r\n\t\t// Define the menus object\r\n\t\tthis.menus = {};\r\n\r\n\t\t// A private function for rendering decision \r\n\t\tvar shouldRender = function(user) {\r\n\t\t\tif (user) {\r\n\t\t\t\tif (!!~this.roles.indexOf('*')) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (var userRoleIndex in user.roles) {\r\n\t\t\t\t\t\tfor (var roleIndex in this.roles) {\r\n\t\t\t\t\t\t\tif (this.roles[roleIndex] === user.roles[userRoleIndex]) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn this.isPublic;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Validate menu existance\r\n\t\tthis.validateMenuExistance = function(menuId) {\r\n\t\t\tif (menuId && menuId.length) {\r\n\t\t\t\tif (this.menus[menuId]) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('Menu does not exists');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('MenuId was not provided');\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Get the menu object by menu id\r\n\t\tthis.getMenu = function(menuId) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add new menu object by menu id\r\n\t\tthis.addMenu = function(menuId, isPublic, roles) {\r\n\t\t\t// Create the new menu\r\n\t\t\tthis.menus[menuId] = {\r\n\t\t\t\tisPublic: isPublic || false,\r\n\t\t\t\troles: roles || this.defaultRoles,\r\n\t\t\t\titems: [],\r\n\t\t\t\tshouldRender: shouldRender\r\n\t\t\t};\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeMenu = function(menuId) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\tdelete this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add menu item object\r\n\t\tthis.addMenuItem = function(menuId, menuItemTitle, menuItemURL, menuItemType, menuItemUIRoute, isPublic, roles, position) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Push new menu item\r\n\t\t\tthis.menus[menuId].items.push({\r\n\t\t\t\ttitle: menuItemTitle,\r\n\t\t\t\tlink: menuItemURL,\r\n\t\t\t\tmenuItemType: menuItemType || 'item',\r\n\t\t\t\tmenuItemClass: menuItemType,\r\n\t\t\t\tuiRoute: menuItemUIRoute || ('/' + menuItemURL),\r\n\t\t\t\tisPublic: ((isPublic === null || typeof isPublic === 'undefined') ? this.menus[menuId].isPublic : isPublic),\r\n\t\t\t\troles: ((roles === null || typeof roles === 'undefined') ? this.menus[menuId].roles : roles),\r\n\t\t\t\tposition: position || 0,\r\n\t\t\t\titems: [],\r\n\t\t\t\tshouldRender: shouldRender\r\n\t\t\t});\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add submenu item object\r\n\t\tthis.addSubMenuItem = function(menuId, rootMenuItemURL, menuItemTitle, menuItemURL, menuItemUIRoute, isPublic, roles, position) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tif (this.menus[menuId].items[itemIndex].link === rootMenuItemURL) {\r\n\t\t\t\t\t// Push new submenu item\r\n\t\t\t\t\tthis.menus[menuId].items[itemIndex].items.push({\r\n\t\t\t\t\t\ttitle: menuItemTitle,\r\n\t\t\t\t\t\tlink: menuItemURL,\r\n\t\t\t\t\t\tuiRoute: menuItemUIRoute || ('/' + menuItemURL),\r\n\t\t\t\t\t\tisPublic: ((isPublic === null || typeof isPublic === 'undefined') ? this.menus[menuId].items[itemIndex].isPublic : isPublic),\r\n\t\t\t\t\t\troles: ((roles === null || typeof roles === 'undefined') ? this.menus[menuId].items[itemIndex].roles : roles),\r\n\t\t\t\t\t\tposition: position || 0,\r\n\t\t\t\t\t\tshouldRender: shouldRender\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeMenuItem = function(menuId, menuItemURL) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item to remove\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tif (this.menus[menuId].items[itemIndex].link === menuItemURL) {\r\n\t\t\t\t\tthis.menus[menuId].items.splice(itemIndex, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeSubMenuItem = function(menuId, submenuItemURL) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item to remove\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tfor (var subitemIndex in this.menus[menuId].items[itemIndex].items) {\r\n\t\t\t\t\tif (this.menus[menuId].items[itemIndex].items[subitemIndex].link === submenuItemURL) {\r\n\t\t\t\t\t\tthis.menus[menuId].items[itemIndex].items.splice(subitemIndex, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t//Adding the topbar menu\r\n\t\tthis.addMenu('topbar');\r\n\t}\r\n]);\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .factory('NotificationFactory', NotificationFactory);\r\n\r\n   function NotificationFactory() {\r\n    var self = this;\r\n    /*global swal */\r\n    /*global toastr */\r\n        toastr.options = {\r\n                'closeButton': false,\r\n                'debug': false,\r\n                'newestOnTop': false,\r\n                'progressBar': false,\r\n                'positionClass': 'toast-bottom-right',\r\n                'preventDuplicates': false,\r\n                'onclick': null,\r\n                'showDuration': '300',\r\n                'hideDuration': '1000',\r\n                'timeOut': '5000',\r\n                'extendedTimeOut': '1000',\r\n                'showEasing': 'swing',\r\n                'hideEasing': 'linear',\r\n                'showMethod': 'fadeIn',\r\n                'hideMethod': 'fadeOut'\r\n            };\r\n    return {\r\n        success: function (title, text) {\r\n            toastr.success(text, title, 'Success');\r\n        },\r\n        warning: function (title, text) {\r\n            toastr.warning(text, title, 'Warning');\r\n        },\r\n        error: function (title, text) {\r\n            toastr.error(text, title, 'Error');\r\n        },\r\n        popup: function (title, text, type) {\r\n            swal({\r\n                title: title,\r\n                text: text,\r\n                type: type\r\n            });\r\n        },\r\n        confirmation: function (thenDo) {\r\n              //are you sure option...\r\n            swal({\r\n                title: 'Are you sure?',\r\n                text: 'Are you sure that you want to delete this?',\r\n                type: 'warning',\r\n                showCancelButton: true,\r\n                closeOnConfirm: true,\r\n                confirmButtonText: 'Yes, delete it!',\r\n                confirmButtonColor: '#ec6c62'\r\n            }, thenDo);\r\n        }\r\n    };\r\n}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .factory('spinnerService', SpinnerService);\r\n  SpinnerService.$inject = ['$q'];\r\n   function SpinnerService($q) {\r\n    var spinners = {},\r\n        queue = {},\r\n        loads = {};\r\n\r\n      return {\r\n          spinners: spinners,\r\n        // private method for spinner registration.\r\n        _register: function (data) {\r\n            if (!data.hasOwnProperty('name')) {\r\n                throw new Error('Spinner must specify a name when registering with the spinner service.');\r\n            }\r\n            if (spinners.hasOwnProperty(data.name)) {\r\n                throw new Error('A spinner with the name \\'' + data.name + '\\' has already been registered.');\r\n            }\r\n            spinners[data.name] = data;\r\n            // Increase the spinner count.\r\n            this.count++;\r\n\r\n            // Check if spinnerId was in the queue, if so then fire the\r\n            // queued function.\r\n            if (queue[data.name]) {\r\n    //            console.log(queue, loads);\r\n                if(loads[data.name]) {\r\n    //                console.log(loads[data.name]);\r\n                    this[queue[data.name]](data.name, loads[data.name]);\r\n                    delete loads[data.name];\r\n                    delete queue[data.name];\r\n                } else {\r\n    //                console.log('queued', queue);\r\n                    this[queue[data.name]](data.name);\r\n                    delete queue[data.name];\r\n                }\r\n            }\r\n    //        console.log(spinners);\r\n        },\r\n        _unregister: function (name) {\r\n          if (spinners.hasOwnProperty(name)) {\r\n            delete spinners[name];\r\n          }\r\n        },\r\n        loading: function (name, optionsOrPromise) {\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'loading';\r\n                loads[name] = optionsOrPromise;\r\n    //            console.log('defer', loads[name]);\r\n                return;\r\n            }\r\n            var spinner = spinners[name];\r\n            spinner.show(name);\r\n            optionsOrPromise = optionsOrPromise || {};\r\n\r\n            //Check if it's promise\r\n            if (optionsOrPromise.always || optionsOrPromise['finally']) {\r\n                optionsOrPromise = {\r\n                    promise: optionsOrPromise\r\n                };\r\n            }\r\n\r\n            var options = angular.extend({}, optionsOrPromise);\r\n\r\n            if (options.promise) {\r\n                if (options.promise.always) {\r\n                    options.promise.always(function () {\r\n                        spinner.hide(name);\r\n                    });\r\n                } else if (options.promise['finally']) {\r\n                    options.promise['finally'](function () {\r\n                        spinner.hide(name);\r\n                    });\r\n                }\r\n            }\r\n        },\r\n        show: function (name) {\r\n    //        console.log('show');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'show';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.show();\r\n        },\r\n        hide: function (name) {\r\n    //        console.log('hide');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'hide';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.hide();\r\n        },\r\n        toggle: function (name) {\r\n    //        console.log('toggle');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'toggle';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.toggle();\r\n        },\r\n        count: 0\r\n      };\r\n\r\n  }\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('history').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('history', {\r\n\t\t\turl: '/history',\r\n\t\t\ttemplateUrl: 'modules/history/views/history.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n  'use strict';\r\n  angular.module('history').controller('HistoryController', HistoryController);\r\n  HistoryController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'AnimeHistory', 'MangaHistory', 'HistoryService', 'ListService', 'spinnerService'];\r\n\r\n  function HistoryController($scope, $stateParams, $location, Authentication, AnimeHistory, MangaHistory, HistoryService, ListService, spinnerService) {\r\n\t\tvar ctrl = this,\r\n\t\t    latestDate = new Date().setDate(new Date().getDate() - 29);\r\n\r\n    ctrl.authentication = Authentication;\r\n    ctrl.buildHistory = buildHistory;\r\n    ctrl.filterConfig = {\r\n\t\t\thistoryFilter: 'Today'\r\n    };\r\n    ctrl.happenedWhen = happenedWhen;\r\n    ctrl.historyGroups = [\r\n      { name: 'Today' },\r\n      { name: 'Yesterday' },\r\n      { name: 'This week' },\r\n      { name: 'Last week' },\r\n      { name: 'Two weeks ago' },\r\n      { name: 'Three weeks ago' },\r\n      { name: 'Four weeks ago' },\r\n    ];\r\n    ctrl.view = 'Anime';\r\n\r\n\r\n    function buildHistory() {\r\n\t    spinnerService.loading('history', AnimeHistory.query({ latest: latestDate }).$promise.then(function(result) {\r\n\t\t\t\t\treturn HistoryService.buildHistoryList(result);\r\n\t\t\t}).then(function(result) {\r\n\t      //  console.log('build anime history: ', result);\r\n\t\t\t\tctrl.animeHistory = result;\r\n\t      return MangaHistory.query({ latest: latestDate }).$promise;\r\n\t    }).then(function(result) {\r\n\t\t\t\t//    console.log('manga', result);\r\n\t\t\t\treturn HistoryService.buildHistoryList(result);\r\n\t    }).then(function(result) {\r\n\t\t\t\t//                    console.log('build manga history: ', result);\r\n\t\t\t\tctrl.mangaHistory = result;\r\n\t\t\t})\r\n\t\t  );\r\n    }\r\n\r\n    //Needed to catch 'Character' setting and skip it.\r\n    $scope.$watch('view', function(newValue) {\r\n      if (ctrl.view !== undefined) {\r\n          if (newValue !== 'Anime' && newValue !== 'Manga') {\r\n              ctrl.view = 'Anime';\r\n          }\r\n      }\r\n    });\r\n\r\n    function happenedWhen(when) {\r\n        return HistoryService.happenedWhen(when);\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('tasks').controller('ViewHistoryController', ViewHistoryController);\r\n  ViewHistoryController.$inject =  ['$scope', 'data', '$stateParams', 'Authentication', 'ItemService', 'NotificationFactory', 'spinnerService', '$uibModalInstance'];\r\n\r\nfunction ViewHistoryController($scope, data, $stateParams, Authentication, ItemService, NotificationFactory, spinnerService, $uibModalInstance) {\r\n  var ctrl = this,\r\n      historyStore = [];\r\n\r\n  ctrl.cancel = cancel;\r\n  ctrl.deleteHistory = deleteHistory;\r\n  ctrl.submit = submit;\r\n  ctrl.type = data.type;\r\n  ctrl.updated = false;\r\n  ctrl.viewItem = data.viewItem;\r\n\r\n  function deleteHistory(item, history) {\r\n      //are you sure option...\r\n      NotificationFactory.confirmation(function() {\r\n        if(historyStore.length === 0) {\r\n          historyStore = ctrl.viewItem.meta.history;\r\n        }\r\n        ctrl.viewItem = ItemService.deleteHistory(item, history);\r\n        ctrl.updated = true;\r\n      });\r\n  }\r\n\r\n  function submit() {\r\n    $uibModalInstance.close(ctrl.updated);\r\n  }\r\n\r\n  function cancel() {\r\n    if(ctrl.updated) {\r\n      ctrl.viewItem.meta.history = historyStore;\r\n    }\r\n    $uibModalInstance.dismiss();\r\n  }\r\n\r\n}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .filter('historySeparator', historySeparator);\r\n  historySeparator.$inject = ['HistoryService', 'moment'];\r\n\r\n  function historySeparator(HistoryService, moment) {\r\n    return function(array, level, timeframe) {\r\n        var itemDate,\r\n            attr = (level === 'group') ? 'latest' : 'date';\r\n        if (array !== undefined) {\r\n            return array.filter(function(item) {\r\n                itemDate = moment(item[attr]).startOf('day');\r\n                return HistoryService.filterItemHistory(timeframe.toLowerCase(), itemDate) ? item : false;\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  //History service used to communicate Animeitems REST endpoints\r\n  angular.module('history')\r\n  .factory('AnimeHistory', AnimeHistory);\r\n  AnimeHistory.$inject = ['$resource'];\r\n\r\n    function AnimeHistory($resource) {\r\n      return $resource('history/anime/:latest', { latest: '@_latest' }, { update: { method: 'PUT' } });\r\n    }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .service('HistoryService', HistoryService);\r\n  HistoryService.$inject = ['moment', '$q'];\r\n\r\n   function HistoryService(moment, $q) {\r\n     var service = {\r\n           buildHistoryList: buildHistoryList,\r\n           extractHistory: extractHistory,\r\n           filterItemHistory: filterItemHistory,\r\n           getEndsOfWeek: getEndsOfWeek,\r\n           getSetDaysAgo: getSetDaysAgo,\r\n           groupItemHistory: groupItemHistory,\r\n           happenedWhen: happenedWhen,\r\n           today: moment(new Date()).startOf('day'),\r\n           weekBeginning: weekBeginning,\r\n           weekEnding: weekEnding\r\n         },\r\n         endsOfWeek = getEndsOfWeek(),\r\n         mondays = endsOfWeek.mondays,\r\n         sundays = endsOfWeek.sundays;\r\n         return service;\r\n\r\n    // getting mondays and sundays for this, last, two and three weeks ago.\r\n    function getEndsOfWeek() {\r\n        var endsOfWeek = [], thisMonday = service.weekBeginning(), thisSunday = service.weekEnding();\r\n        endsOfWeek = {\r\n            mondays: [ thisMonday, service.getSetDaysAgo(thisMonday, 7), service.getSetDaysAgo(thisMonday, 14), service.getSetDaysAgo(thisMonday, 21), service.getSetDaysAgo(thisMonday, 28) ],\r\n            sundays: [ thisSunday, service.getSetDaysAgo(thisSunday, 7), service.getSetDaysAgo(thisSunday, 14), service.getSetDaysAgo(thisSunday, 21), service.getSetDaysAgo(thisSunday, 28) ]\r\n        };\r\n        return endsOfWeek;\r\n    }\r\n\r\n    //get 'daysAgo' days ago from 'thisEnd' date.\r\n    function getSetDaysAgo(thisEnd, daysAgo) {\r\n        var newDate = moment(thisEnd).subtract(daysAgo, 'days');\r\n        return newDate;\r\n    }\r\n\r\n    //get 'this' monday.\r\n    function weekBeginning() {\r\n        var date = new Date(),\r\n            day = date.getDay(),\r\n            diff = date.getDate() - day + (day === 0 ? -6:1),\r\n            temp = new Date(),\r\n            wkBeg = new Date(temp.setDate(diff));\r\n        return moment(wkBeg.toISOString()).startOf('day');\r\n    }\r\n\r\n    //get 'this' sunday.\r\n    function weekEnding() {\r\n        var date = new Date(),\r\n            day = date.getDay(),\r\n            diff = date.getDate() - day + (day === 0 ? 0:7),\r\n            temp = new Date(),\r\n            wkEnd = new Date(temp.setDate(diff));\r\n        return moment(wkEnd.toISOString()).endOf('day');\r\n    }\r\n\r\n    function buildHistoryList(items) {\r\n        var deferred = $q.defer(),\r\n            promise = service.extractHistory(items).then(function(result) {\r\n//                console.log('extract history: ', result);\r\n                result.sort(function (a, b) {\r\n                    var dateA = a.date,\r\n                        dateB = b.date;\r\n                    if(dateA > dateB) return -1;\r\n                    if(dateA < dateB) return 1;\r\n                    if(dateA === dateB) return 0;\r\n                });\r\n                return service.groupItemHistory(result);\r\n            }).then(function(result) {\r\n//                console.log('grouped', result);\r\n                deferred.resolve(result);\r\n            });\r\n        return deferred.promise;\r\n    }\r\n\r\n    function extractHistory(items) {\r\n        var deferred = $q.defer(),\r\n            itemHistory = [], today = moment(new Date()).startOf('day');\r\n        angular.forEach(items, function(item) {\r\n            angular.forEach(item.meta.history, function(history) {\r\n                var cutoff = moment(history.date).startOf('day'),\r\n                    diff = today.diff(cutoff, 'days');\r\n//                console.log(diff);\r\n                if (diff < 29) {\r\n                    itemHistory.push({ date: history.date, value: history.value, title: item.title, id: item._id });\r\n                }\r\n            });\r\n        });\r\n        deferred.resolve(itemHistory);\r\n        return deferred.promise;\r\n    }\r\n\r\n    function groupItemHistory(itemHistory) {\r\n        var deferred = $q.defer(),\r\n            index, prevItem, item, group,\r\n            length = itemHistory.length,\r\n            groupedHistory = [];\r\n        for(var i = 0; i < length; i++) {\r\n            item = itemHistory[i];\r\n            if (i === 0) {\r\n                groupedHistory.push({\r\n                    title: item.title,\r\n                    items: [],\r\n                    count: 1,\r\n                    latest: item.date,\r\n                    oldest: item.date\r\n                });\r\n                groupedHistory[0].items.push(item);\r\n            } else if (i !== 0) {\r\n                prevItem = itemHistory[i - 1];\r\n                index = groupedHistory.length - 1;\r\n                if (prevItem.title === item.title) {\r\n                    groupedHistory[index].items.push(item);\r\n                    groupedHistory[index].count++;\r\n                    groupedHistory[index].oldest = item.date;\r\n                } else if (prevItem.title !== item.title) {\r\n                    group = {\r\n                        title: item.title,\r\n                        items: [],\r\n                        count: 1,\r\n                        latest: item.date,\r\n                        oldest: item.date\r\n                    };\r\n                    group.items.push(item);\r\n                    groupedHistory.push(group);\r\n                }\r\n            }\r\n        }\r\n        deferred.resolve(groupedHistory);\r\n        return deferred.promise;\r\n    }\r\n\r\n    function filterItemHistory(timeframe, itemDate) {\r\n        var diff = service.today.diff(itemDate, 'days');\r\n        switch(timeframe) {\r\n            case 'today':\r\n                return diff === 0;\r\n\r\n            case 'yesterday':\r\n                return diff === 1;\r\n\r\n            case 'this week':\r\n                return mondays[0] <= itemDate && itemDate <= sundays[0];\r\n\r\n            case 'last week':\r\n                return mondays[1] <= itemDate && itemDate <= sundays[1];\r\n\r\n            case 'two weeks ago':\r\n                return mondays[2] <= itemDate && itemDate <= sundays[2];\r\n\r\n            case 'three weeks ago':\r\n                return mondays[3] <= itemDate && itemDate <= sundays[3];\r\n\r\n            case 'four weeks ago':\r\n                return mondays[4] <= itemDate && itemDate <= sundays[4];\r\n        }\r\n    }\r\n\r\n    /** function to display relative time.\r\n     *  Using diff because fromNow will create conflicts between\r\n     *  the item date and the 'group date'.\r\n     */\r\n    function happenedWhen(when) {\r\n//          console.log(latest, updated);\r\n        var today = moment(new Date()).startOf('day'), thisDate = moment(when).startOf('day'),\r\n            diff = today.diff(thisDate, 'days');\r\n\r\n        //for 0 and 1 day(s) ago use the special term.\r\n        if (diff === 0) {\r\n            return 'Today at ' + moment(when).format('HH:mm');\r\n        } else if (diff === 1) {\r\n            return 'Yesterday at ' + moment(when).format('HH:mm');\r\n        } else {\r\n            return diff + ' days ago at ' + moment(when).format('HH:mm');\r\n        }\r\n    }\r\n\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .factory('MangaHistory', MangaHistory);\r\n  MangaHistory.$inject = ['$resource'];\r\n\r\n  function MangaHistory($resource) {\r\n    return $resource('history/manga/:latest', { latest: '@_latest' }, { update: { method: 'PUT' } });\r\n  }\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('mangaitems').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Mangaitems', 'mangaitems', 'dropdown', '/mangaitems(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'mangaitems', 'List Mangaitems', 'mangaitems');\r\n\t\tMenus.addSubMenuItem('topbar', 'mangaitems', 'New Mangaitem', 'mangaitems/create');\r\n\t}\r\n]);\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('mangaitems').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Mangaitems state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listMangaitems', {\r\n\t\t\turl: '/mangaitems',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/list-mangaitems.client.view.html'\r\n\t\t}).\r\n\t\tstate('createMangaitem', {\r\n\t\t\turl: '/mangaitems/create',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/create-mangaitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewMangaitem', {\r\n\t\t\turl: '/mangaitems/:mangaitemId',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/view-mangaitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('editMangaitem', {\r\n\t\t\turl: '/mangaitems/:mangaitemId/edit',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/edit-mangaitem.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\tangular.module('mangaitems').controller('MangaitemsController', MangaitemsController);\r\n\tMangaitemsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Mangaitems', 'Animeitems', 'fileUpload', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'MangaFactory', 'spinnerService', 'TagService', '$uibModal'];\r\n\r\n\tfunction MangaitemsController($scope, $stateParams, $location, Authentication, Mangaitems, Animeitems, fileUpload, $sce, $window, ItemService, ListService, NotificationFactory, MangaFactory, spinnerService, TagService, $uibModal) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.chapters = 0;\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.filterConfig = {\r\n        showingCount: 0,\r\n        sortType: '',\r\n        sortReverse: true,\r\n        ratingLevel: undefined,\r\n        ratingActions: {\r\n            maxRating: 10,\r\n            percent: undefined,\r\n            overStar: null\r\n        },\r\n        searchTags: '',\r\n        tagsForFilter: [],\r\n        taglessItem: false,\r\n        areTagless: false,\r\n        selectListOptions: {},\r\n        statTags: [],\r\n\t\t\t\tviewItem: ''\r\n    };\r\n\t\tctrl.finalNumbers = false; //default show status of final number fields in edit view.\r\n\t\tctrl.find = find;\r\n\t\tctrl.findAnime = findAnime;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.imgPath = ''; //image path\r\n\t\tctrl.itemUpdate = new Date(); // today's date as 'yyyy-MM-dd' for the auto-pop of 'latest' in edit page.\r\n\t\tctrl.latest = ctrl.itemUpdate;\r\n\t\tctrl.latestDate = latestDate;\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 10\r\n    };\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.removeTag = removeTag;\r\n\t\tctrl.start = ctrl.itemUpdate;\r\n\t\tctrl.tagArray = []; // holding tags pre-submit\r\n\t\tctrl.tagArrayRemove = [];\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n\t\tctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.viewItemHistory = viewItemHistory;\r\n\t\tctrl.volumes = 0;\r\n\t\tctrl.whichController = 'mangaitem';\r\n\r\n    //allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n\t\t//For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for animeitem tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.mangaitem.tags, text);\r\n\t\t}\r\n\r\n    // Create new Mangaitem\r\n\t\tfunction create() {\r\n\r\n            var mangaitem = new Mangaitems();\r\n            //Handle situation if objects not selected.\r\n                // Create new Mangaitem object\r\n\t\t\t     mangaitem = new Mangaitems ({\r\n\t\t\t\t    title: ctrl.title,\r\n                    chapters: ctrl.chapters,\r\n                    volumes: ctrl.volumes,\r\n                    start: ctrl.start,\r\n                    latest: ctrl.latest,\r\n                    finalChapter: ctrl.finalChapter,\r\n                    finalVolume: ctrl.finalVolume,\r\n                    hardcopy: ctrl.hardcopy,\r\n                    anime: ctrl.anime!==undefined && ctrl.anime!==null ? ctrl.anime._id : ctrl.anime,\r\n                    tags: ctrl.tagArray,\r\n                    user: ctrl.user\r\n\t\t\t     });\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\tmangaitem.$save(function(response) {\r\n\t\t\t\t$location.path('/mangaitems/' + response._id);\r\n\t\t\t\tNotificationFactory.success('Saved!', 'Manga was saved successfully');\r\n\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Remove existing Mangaitem\r\n\t\tfunction remove(mangaitem) {\r\n            //are you sure option...\r\n            NotificationFactory.confirmation(function() {\r\n                if ( mangaitem ) {\r\n                    mangaitem.$remove();\r\n\r\n                    for (var i in ctrl.mangaitems) {\r\n                        if (ctrl.mangaitems [i] === mangaitem) {\r\n                            ctrl.mangaitems.splice(i, 1);\r\n                        }\r\n                    }\r\n                } else {\r\n                    ctrl.mangaitem.$remove(function() {\r\n                        $location.path('/mangaitems');\r\n                    });\r\n                }\r\n                NotificationFactory.warning('Deleted!', 'Manga was successfully deleted.');\r\n            });\r\n\t\t}\r\n\r\n\t\t// Update existing Mangaitem\r\n\t\tfunction update() {\r\n\t\t\tvar mangaitem = ctrl.mangaitem;\r\n            ctrl.mangaitem = undefined;\r\n            MangaFactory.update(mangaitem, ctrl.tagArray, ctrl.updateHistory, ctrl.imgPath);\r\n\t\t}\r\n\r\n\t\tfunction tickOff(item) {\r\n        item.chapters += 1;\r\n        item.latest = new Date(); //update latest.\r\n        ctrl.updateHistory = true; //add to history.\r\n        ctrl.mangaitem = item;\r\n        ctrl.update();\r\n    }\r\n\r\n\t\t// Find a list of Mangaitems\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n      spinnerService.loading('manga', Mangaitems.query().$promise.then(function(result) {\r\n          ctrl.mangaitems = result;\r\n\t\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\t\tctrl.filterConfig.statTags = ItemService.buildStatTags(result, 0);\r\n      }));\r\n\t\t}\r\n\r\n\t\t// Find existing Mangaitem\r\n\t\tfunction findOne() {\r\n\t    Mangaitems.get({ mangaitemId: $stateParams.mangaitemId }).$promise.then(function(result) {\r\n\t        ctrl.mangaitem = result;\r\n\t        //            console.log(ctrl.mangaitem);\r\n\t    });\r\n\t\t}\r\n\r\n    // Find a list of Animeitems for dropdowns.\r\n\t\tfunction findAnime() {\r\n\t\t\tctrl.animeitems = Animeitems.query();\r\n\t\t}\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/mangaitems/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUpload');\r\n    }\r\n\r\n    //latest date display format.\r\n    function latestDate(latest, updated) {\r\n        return ItemService.latestDate(latest, updated);\r\n    }\r\n\r\n\t\tfunction viewItemHistory() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/history/views/item-history.html',\r\n        controller: 'ViewHistoryController as viewHistory',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { viewItem: ctrl.filterConfig.viewItem, type: 'manga' };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed history: ', result, ctrl.filterConfig.viewItem.meta);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tctrl.mangaitem = ctrl.filterConfig.viewItem;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n      });\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('mangaItemModel', mangaItemModel);\r\n\r\n  function mangaItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/mangaitems/templates/manga-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('mangaitems')\r\n\t.factory('MangaFactory', MangaFactory);\r\n\tMangaFactory.$inject = ['Mangaitems', 'ListService', 'ItemService', 'NotificationFactory', '$location'];\r\n\r\n\tfunction MangaFactory(Mangaitems, ListService, ItemService, NotificationFactory, $location) {\r\n    return {\r\n        update: function(item, tagArray, updateHistory, imgPath) {\r\n            var mangaitem = item;\r\n            console.log(mangaitem);\r\n            //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n            if (item.anime!==null && item.anime!==undefined) {\r\n                mangaitem.anime = item.anime._id;\r\n            }\r\n\r\n            if (tagArray!==undefined) {\r\n                mangaitem.tags = ListService.concatenateTagArrays(mangaitem.tags, tagArray);\r\n            }\r\n\r\n            //update the item history.\r\n            mangaitem = ItemService.itemHistory(mangaitem, updateHistory, 'manga');\r\n\r\n            if (imgPath!==undefined && imgPath!==null && imgPath!=='') {\r\n                mangaitem.image = imgPath;\r\n            }\r\n            //console.log($scope.imgPath);\r\n            //console.log(mangaitem.image);\r\n\r\n            //handle end date\r\n            if (mangaitem.chapters===mangaitem.finalChapter && mangaitem.finalChapter!==0) {\r\n                if (mangaitem.end===undefined || mangaitem.end===null) {\r\n                    mangaitem.volumes = mangaitem.finalVolume;\r\n                    mangaitem.end = mangaitem.latest;\r\n                    //console.log(animeitem.end);\r\n                }\r\n            } else if (mangaitem.reReading === false) {\r\n                mangaitem.end = null;\r\n            }\r\n\r\n            //handle status: completed.\r\n            if(mangaitem.end!==undefined && mangaitem.end!==null) {\r\n                mangaitem.status = true;\r\n            } else {\r\n                mangaitem.status = false;\r\n            }\r\n\r\n            //handle re-reading, re-read count.\r\n            if (mangaitem.reReading===true && mangaitem.chapters===mangaitem.finalChapter) {\r\n                mangaitem.volumes = mangaitem.finalVolume;\r\n                mangaitem.reReadCount += 1;\r\n                mangaitem.reReading = false;\r\n            }\r\n\r\n\t\t\tmangaitem.$update(function() {\r\n\t\t\t\tif (window.location.href.indexOf('tasks') === -1) $location.path('/mangaitems');\r\n\r\n                NotificationFactory.success('Saved!', 'Manga was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tvar error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\r\n\r\n        }\r\n    };\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\t//Mangaitems service used to communicate Mangaitems REST endpoints\r\n\tangular.module('mangaitems')\r\n\t.factory('Mangaitems',  MangaitemsFactory);\r\n\tMangaitemsFactory.$inject = ['$resource'];\r\n\r\n\tfunction MangaitemsFactory($resource) {\r\n\t\treturn $resource('mangaitems/:mangaitemId', { mangaitemId: '@_id'\r\n\t\t}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('orders').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Orders', 'orders', 'dropdown', '/orders(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'orders', 'List Orders', 'orders');\r\n\t\tMenus.addSubMenuItem('topbar', 'orders', 'New Order', 'orders/create');\r\n\t}\r\n]);\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('orders').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Orders state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listOrders', {\r\n\t\t\turl: '/orders',\r\n\t\t\ttemplateUrl: 'modules/orders/views/list-orders.client.view.html'\r\n\t\t}).\r\n\t\tstate('createOrder', {\r\n\t\t\turl: '/orders/create',\r\n\t\t\ttemplateUrl: 'modules/orders/views/create-order.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewOrder', {\r\n\t\t\turl: '/orders/:orderId',\r\n\t\t\ttemplateUrl: 'modules/orders/views/view-order.client.view.html'\r\n\t\t}).\r\n\t\tstate('editOrder', {\r\n\t\t\turl: '/orders/:orderId/edit',\r\n\t\t\ttemplateUrl: 'modules/orders/views/create-order.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n\n'use strict';\r\nvar CompleteOrdersController = (function () {\r\n    function CompleteOrdersController($scope, $uibModalInstance, order) {\r\n        this.$scope = $scope;\r\n        this.$uibModalInstance = $uibModalInstance;\r\n        this.order = order;\r\n        this.newPrice = {\r\n            company: '',\r\n            price: null\r\n        };\r\n    }\r\n    CompleteOrdersController.prototype.editOrder = function (index) {\r\n        var item = this.order.nextVolume.prices[index];\r\n        this.newPrice.company = item.company;\r\n        this.newPrice.price = item.price;\r\n        this.order.nextVolume.prices.splice(index, 1);\r\n    };\r\n    CompleteOrdersController.prototype.completeOrder = function () {\r\n        this.order.nextVolume.prices.push({ company: this.newPrice.company, date: this.newPrice.date, price: this.newPrice.price, rrp: this.order.rrp, paid: true });\r\n        this.$uibModalInstance.close(this.order);\r\n    };\r\n    CompleteOrdersController.prototype.cancel = function () {\r\n        this.$uibModalInstance.dismiss('cancel');\r\n    };\r\n    CompleteOrdersController.controllerId = 'CompleteOrdersController';\r\n    CompleteOrdersController.$inject = ['$scope', '$uibModalInstance', 'order'];\r\n    return CompleteOrdersController;\r\n}());\r\nangular.module('orders').controller(CompleteOrdersController.controllerId, CompleteOrdersController);\r\n\n'use strict';\r\nvar CreateOrdersController = (function () {\r\n    function CreateOrdersController($scope, $stateParams, $location, Authentication, $q, Orders, Mangaitems, $uibModal, NotificationFactory) {\r\n        this.$scope = $scope;\r\n        this.$stateParams = $stateParams;\r\n        this.$location = $location;\r\n        this.Authentication = Authentication;\r\n        this.$q = $q;\r\n        this.Orders = Orders;\r\n        this.Mangaitems = Mangaitems;\r\n        this.$uibModal = $uibModal;\r\n        this.NotificationFactory = NotificationFactory;\r\n        this.isCreateMode = this.$stateParams.orderId === undefined;\r\n        this.order = {};\r\n        this.orderCopy = {\r\n            series: '',\r\n            nextVolume: {\r\n                volume: 1,\r\n                date: Date.now(),\r\n                rrp: 0.00,\r\n                prices: []\r\n            },\r\n            rrp: 0.00,\r\n            orderHistory: []\r\n        };\r\n        this.authentication = this.Authentication;\r\n        this.stepConfig = {\r\n            stepHeaders: [\r\n                { text: 'Set next order' },\r\n                { text: 'Set prices' }\r\n            ],\r\n            currentStep: 1,\r\n            stepCount: 2,\r\n            items: []\r\n        };\r\n        this.init();\r\n    }\r\n    CreateOrdersController.prototype.init = function () {\r\n        var _this = this;\r\n        angular.copy(this.orderCopy, this.order);\r\n        if (this.isCreateMode) {\r\n            console.log('create mode');\r\n            this.Mangaitems.query().$promise.then(function (result) {\r\n                _this.stepConfig.items = result;\r\n                console.log('items: ', result);\r\n            });\r\n        }\r\n        else {\r\n            console.log('edit mode');\r\n            this.findOne();\r\n        }\r\n        console.log('init done: ');\r\n    };\r\n    CreateOrdersController.prototype.takeStep = function (step, direction) {\r\n        console.log('stepping: ', step, direction);\r\n        this.stepConfig.currentStep = (direction) ? step + 1 : step - 1;\r\n    };\r\n    CreateOrdersController.prototype.processOrder = function () {\r\n        if (this.order.nextVolume.volume > 0) {\r\n            var temp = angular.copy(this.order.nextVolume);\r\n            this.order.orderHistory.push(this.order.nextVolume);\r\n            this.order.nextVolume = {\r\n                volume: temp.volume + 1,\r\n                date: null,\r\n                rrp: this.order.rrp,\r\n                prices: []\r\n            };\r\n            this.update();\r\n        }\r\n    };\r\n    CreateOrdersController.prototype.cancel = function () {\r\n        this.$location.path('orders');\r\n    };\r\n    CreateOrdersController.prototype.create = function () {\r\n        var _this = this;\r\n        var order = new this.Orders({\r\n            series: this.order.series._id,\r\n            nextVolume: {\r\n                date: this.order.nextVolume.date,\r\n                volume: this.order.nextVolume.volume,\r\n                rrp: this.order.nextVolume.rrp,\r\n                prices: this.order.nextVolume.prices\r\n            },\r\n            rrp: this.order.rrp,\r\n            orderHistory: this.order.orderHistory\r\n        });\r\n        order.$save(function (response) {\r\n            _this.$location.path('orders/' + response._id);\r\n            _this.NotificationFactory.success('Saved!', 'New Order was successfully saved!');\r\n            angular.copy(_this.orderCopy, _this.order);\r\n        }, function (errorResponse) {\r\n            this.error = errorResponse.data.message;\r\n            this.NotificationFactory.error('Error!', 'Order failed to save!');\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.update = function () {\r\n        var _this = this;\r\n        var order = this.order;\r\n        order.$update(function () {\r\n            _this.$location.path('orders/' + order._id);\r\n            _this.NotificationFactory.success('Saved!', 'Order was successfully saved!');\r\n        }, function (errorResponse) {\r\n            this.error = errorResponse.data.message;\r\n            this.NotificationFactory.error('Error!', 'Order failed to save!');\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.openBoughtDialog = function () {\r\n        var _this = this;\r\n        var modalInstance = this.$uibModal.open({\r\n            animation: true,\r\n            templateUrl: '/modules/orders/views/complete-order.client.view.html',\r\n            controller: 'CompleteOrdersController as modal',\r\n            size: 'md',\r\n            resolve: {\r\n                order: function () {\r\n                    return _this.order;\r\n                }\r\n            }\r\n        });\r\n        modalInstance.result.then(function (result) {\r\n            console.log(result);\r\n            _this.order = result;\r\n            _this.processOrder();\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.findOne = function () {\r\n        this.order = this.Orders.get({ orderId: this.$stateParams.orderId });\r\n        console.log('found one: ', this.order);\r\n    };\r\n    CreateOrdersController.controllerId = 'CreateOrdersController';\r\n    CreateOrdersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', '$q', 'Orders', 'Mangaitems', '$uibModal', 'NotificationFactory'];\r\n    return CreateOrdersController;\r\n}());\r\nangular.module('orders').controller(CreateOrdersController.controllerId, CreateOrdersController);\r\n\n'use strict';\r\nvar OrderHistoryController = (function () {\r\n    function OrderHistoryController($scope, $uibModalInstance, order, $filter) {\r\n        this.$scope = $scope;\r\n        this.$uibModalInstance = $uibModalInstance;\r\n        this.order = order;\r\n        this.$filter = $filter;\r\n        this.processHistory();\r\n    }\r\n    OrderHistoryController.prototype.processHistory = function () {\r\n        var _this = this;\r\n        angular.forEach(this.order.orderHistory, function (item) {\r\n            console.log('order history: ', item);\r\n            var len = item.prices.length;\r\n            for (var i = 0; i < len; i++) {\r\n                if (item.prices[i].paid) {\r\n                    var cost = _this.$filter('number')(item.prices[i].price, 2), rrp = _this.$filter('number')(item.prices[i].rrp, 2);\r\n                    item.purchaseDate = item.prices[i].date;\r\n                    item.paid = cost;\r\n                    item.rrpInstance = rrp;\r\n                    item.saving = ((cost / rrp) * 100).toFixed(2);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    OrderHistoryController.prototype.cancel = function () {\r\n        this.$uibModalInstance.dismiss('cancel');\r\n    };\r\n    OrderHistoryController.controllerId = 'OrderHistoryController';\r\n    OrderHistoryController.$inject = ['$scope', '$uibModalInstance', 'order', '$filter'];\r\n    return OrderHistoryController;\r\n}());\r\nangular.module('orders').controller(OrderHistoryController.controllerId, OrderHistoryController);\r\n\n'use strict';\r\nvar OrdersController = (function () {\r\n    function OrdersController($scope, $stateParams, $location, Authentication, Orders, spinnerService, $uibModal) {\r\n        this.$scope = $scope;\r\n        this.$stateParams = $stateParams;\r\n        this.$location = $location;\r\n        this.Authentication = Authentication;\r\n        this.Orders = Orders;\r\n        this.spinnerService = spinnerService;\r\n        this.$uibModal = $uibModal;\r\n        this.authentication = this.Authentication;\r\n        this.order = undefined;\r\n        this.orders = [];\r\n        this.pageConfig = {\r\n            currentPage: 0,\r\n            pageSize: 10\r\n        };\r\n        this.init();\r\n    }\r\n    OrdersController.prototype.init = function () {\r\n        console.log('init: ', this.$stateParams);\r\n        if (this.$stateParams.orderId) {\r\n            console.log('find one');\r\n            this.findOne();\r\n        }\r\n        else {\r\n            console.log('find all');\r\n            this.find();\r\n        }\r\n    };\r\n    OrdersController.prototype.remove = function (order) {\r\n        if (order) {\r\n            order.$remove();\r\n            for (var i = 0, length = this.order.length; i < length; i++) {\r\n                if (this.orders[i] === order) {\r\n                    this.orders.splice(i, 1);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.order.$remove(function () {\r\n                this.$location.path('orders');\r\n            });\r\n        }\r\n    };\r\n    OrdersController.prototype.find = function () {\r\n        var _this = this;\r\n        this.spinnerService.loading('orders', this.Orders.query().$promise.then(function (result) {\r\n            _this.orders = result;\r\n        }));\r\n    };\r\n    OrdersController.prototype.findOne = function () {\r\n        var _this = this;\r\n        this.spinnerService.loading('orders', this.Orders.get({ orderId: this.$stateParams.orderId }).$promise.then(function (result) {\r\n            _this.order = result;\r\n        }));\r\n    };\r\n    OrdersController.prototype.openOrderHistoryDialog = function () {\r\n        var _this = this;\r\n        var modalInstance = this.$uibModal.open({\r\n            animation: true,\r\n            templateUrl: '/modules/orders/views/order-history.client.view.html',\r\n            controller: 'OrderHistoryController as modal',\r\n            size: 'md',\r\n            resolve: {\r\n                order: function () {\r\n                    return _this.order;\r\n                }\r\n            }\r\n        });\r\n    };\r\n    OrdersController.controllerId = 'OrdersController';\r\n    OrdersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Orders', 'spinnerService', '$uibModal'];\r\n    return OrdersController;\r\n}());\r\nangular.module('orders').controller(OrdersController.controllerId, OrdersController);\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('orders').factory('Orders', OrdersFactory);\r\n\tOrdersFactory.$inject = ['$resource'];\r\n\r\n\tfunction OrdersFactory($resource) {\r\n\t\treturn $resource('orders/:orderId', { orderId: '@_id'\r\n\t\t}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('ratings').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('ratings', {\r\n\t\t\turl: '/ratings',\r\n\t\t\ttemplateUrl: 'modules/ratings/views/ratings.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\tangular.module('ratings')\r\n\t.controller('RatingsController', RatingsController);\r\n\tRatingsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'ListService', 'NotificationFactory', 'StatisticsService', 'spinnerService'];\r\n\tfunction RatingsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, ListService, NotificationFactory, StatisticsService, spinnerService) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.episodeScore = episodeScore;\r\n\t\tctrl.find = find;\r\n\t\tctrl.go = go;\r\n\t\tctrl.hoveringOver = hoveringOver;\r\n\t\tctrl.itemScore = itemScore;\r\n\t\tctrl.maxRating = 10;\r\n\t\tctrl.modelOptions = { debounce: 700 };\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 20\r\n    };\r\n    ctrl.ratingLevel = undefined; //default rating filter\r\n    ctrl.sortReverse = true;\r\n    ctrl.sortType = 'rating';\r\n\t\tctrl.view = 'Anime';\r\n\t\tctrl.viewEpisodeRatings = viewEpisodeRatings;\r\n    ctrl.viewItem = undefined;\r\n\r\n\t\t//rating 'tooltip' function\r\n    function hoveringOver(value) {\r\n        ctrl.overStar = value;\r\n        ctrl.percent = 100 * (value / ctrl.maxRating);\r\n    }\r\n\r\n    function go(id) {\r\n        $location.path('/mangaitems/' + id);\r\n    }\r\n\r\n    function getItems(view) {\r\n        if (view === 'Anime') {\r\n            spinnerService.loading('rating', Animeitems.query().$promise.then(function(result) {\r\n                ctrl.items = result;\r\n            }));\r\n        } else if (view === 'Manga') {\r\n            spinnerService.loading('rating', Mangaitems.query().$promise.then(function(result) {\r\n                ctrl.items = result;\r\n            }));\r\n        }\r\n        ctrl.viewItem = undefined;\r\n    }\r\n\r\n    function find(view) {\r\n\t\t\tif(view === 'Anime' || view === 'Manga') {\r\n\t\t\t\t getItems(view);\r\n\t\t\t } else {\r\n\t\t\t\tctrl.view = 'Anime';\r\n\t\t\t\tgetItems(ctrl.view);\r\n\t\t\t }\r\n    }\r\n\r\n    //apply new score.\r\n    function itemScore(item, score) {\r\n        if (item.rating !== score) {\r\n            item.rating = score;\r\n\r\n            item.$update(function() {\r\n                $location.path('ratings');\r\n                NotificationFactory.success('Saved!', 'New rating was saved successfully');\r\n            }, function(errorResponse) {\r\n                ctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Your change failed!');\r\n            });\r\n//                console.log('update');\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /** Episode rating functions below here.\r\n     */\r\n    function viewEpisodeRatings(item) {\r\n        ctrl.viewItem = (ctrl.viewItem !== item) ? item : undefined;\r\n        ctrl.isEqual = (ctrl.viewItem === item) ? true : false;\r\n        ctrl.search = (ctrl.viewItem === item) ? item.title : '';\r\n        if (ctrl.viewItem !== undefined) {\r\n            spinnerService.loading('summary', StatisticsService.buildSummaryFunctions(ctrl.viewItem.meta.history).then(function(result) {\r\n                ctrl.summaryFunctions = result;\r\n            }));\r\n        }\r\n    }\r\n\r\n    function episodeScore(finished) {\r\n//            console.log('finished: ', finished, ctrl.viewItem.meta.history);\r\n        if (finished) {\r\n            var item = ctrl.viewItem;\r\n            item.$update(function() {\r\n                $location.path('ratings');\r\n                NotificationFactory.success('Saved!', 'New episode rating was saved successfully');\r\n                spinnerService.loading('summary', StatisticsService.buildSummaryFunctions(ctrl.viewItem.meta.history).then(function(result) {\r\n                    ctrl.summaryFunctions = result;\r\n                }));\r\n            }, function(errorResponse) {\r\n                ctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Your change failed!');\r\n            });\r\n        }\r\n    }\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('ratings')\r\n  .directive('focusOnShow', focusOnShow);\r\n\r\n  function focusOnShow($timeout) {\r\n    return function(scope, element, attrs) {\r\n       scope.$watch(attrs.focusOnShow, function (newValue) {\r\n//            console.log('preview changed!')\r\n            $timeout(function() {\r\n                var myValue = newValue && element[0].focus();\r\n                return myValue;\r\n            });\r\n         },true);\r\n      };\r\n    }\r\n})();\r\n\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('statistics').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('statistics', {\r\n\t\t\turl: '/statistics',\r\n\t\t\ttemplateUrl: 'modules/statistics/views/statistics.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('statistics').controller('StatisticsController', StatisticsController);\r\n\tStatisticsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'Characters', 'Toptens', 'ListService', 'ItemService', 'CharacterService', 'StatisticsService', '$filter', 'spinnerService'];\r\n\r\n\t\tfunction StatisticsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, Characters, Toptens, ListService, ItemService, CharacterService, StatisticsService, $filter, spinnerService) {\r\n\t\t\tvar ctrl = this,\r\n\t\t\t\t\tfilter = $filter('filter');\r\n\t\t\tctrl.authentication = Authentication;\r\n\t\t\tctrl.colours = { red: '#c9302c', green: '#449d44', blue: '#31b0d5' }; //'red'; '#d9534f'; ////'green';'#5cb85c'; ////'blue';'#5bc0de'; //\r\n\t\t\tctrl.commonArrays = ListService.getCommonArrays('statistics');\r\n\t\t\tctrl.dataStore = { anime: [], manga: [], character: [], toptens: { anime: {}, manga: {}, character: {} } };\r\n\t\t\tctrl.detail = {\r\n\t\t\t\t\tisVisible: false,\r\n\t\t\t\t\tyear: '',\r\n\t\t\t\t\tdivision: '',\r\n\t\t\t\t\tdivisionText: '',\r\n\t\t\t\t\thistory: 'months',\r\n\t\t\t\t\tsummary: {\r\n\t\t\t\t\t\t\ttype: '',\r\n\t\t\t\t\t\t\tisVisible: false\r\n\t\t\t\t\t},\r\n\t\t\t\t\tisEpisodeRatings: false\r\n\t\t\t};\r\n\t\t\tctrl.filterConfig = {\r\n          show: {\r\n              tag: false,\r\n              series: false,\r\n              voice: false\r\n          },\r\n          sort: {\r\n\t\t\t\t\t\t\tepisodeRating: {\r\n\t\t\t\t\t\t\t\ttype: 'title',\r\n\t\t\t\t\t\t\t\treverse: false\r\n\t\t\t\t\t\t\t},\r\n              tag: {\r\n                  type: 'ratingWeighted',\r\n                  reverse: true\r\n              },\r\n              tagDetail: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n              series: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n              voice: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n\t\t\t\t\t\t\ttopten: {\r\n\t\t\t\t\t\t\t\ttype: 'count',\r\n\t\t\t\t\t\t\t\treverse: true\r\n\t\t\t\t\t\t\t}\r\n          },\r\n          search: {\r\n              tag: '',\r\n              tagDetail: '',\r\n              series: '',\r\n              voice: '',\r\n\t\t\t\t\t\t\ttopten: ''\r\n          },\r\n\t\t\t\t\ttopten: {\r\n\t\t\t\t\t\tisRanked: false,\r\n\t\t\t\t\t\tisFavourite: false\r\n\t\t\t\t\t}\r\n      };\r\n\t\t\tctrl.find = find;\r\n\t\t\tctrl.gender = {}; //holds gender summary details.\r\n\t\t\tctrl.generateSeasons = generateSeasons;\r\n\t\t\tctrl.getFilteredItems = getFilteredItems;\r\n\t\t\tctrl.getToptenItemStatistics = getToptenItemStatistics;\r\n\t\t\tctrl.historyDetail = historyDetail;\r\n      ctrl.historyDetails = {};\r\n      ctrl.overview = {}; //holds summary/overview details.\r\n      ctrl.ratingsDistribution = []; //counts for each rating.\r\n      ctrl.statSeries = []; //for series statistics;\r\n      ctrl.statTags = []; //for tag statistics;\r\n\t\t\tctrl.tableDetail = tableDetail;\r\n\t\t\tctrl.tableDetails = {};\r\n      ctrl.taglessItem = false; //filter variable for showing tagless items.\r\n      ctrl.toptens = {\r\n\t\t\t\ttype: 'anime',\r\n\t\t\t\tanime: { listCount: 0, items: [] }, manga:  { listCount: 0, items: [] }, character:  { listCount: 0, items: [] }, detail: { items: [] }\r\n\t\t\t };\r\n      ctrl.view = 'Anime';\r\n      ctrl.voiceActors = []; //for voice actor list;\r\n\r\n\t\t\tfunction getItemStatistics(view, items) {\r\n\t\t\t\tif(view === 'Anime' || view === 'Manga') {\r\n\t\t\t\t\tctrl.overview = ItemService.buildOverview(items);\r\n\t\t\t\t\tctrl.historyDetails.months = ItemService.completeByMonth(items);\r\n\t\t\t\t\tif (view === 'Anime') ctrl.historyDetails.seasons = ItemService.completeBySeason(items);\r\n\t\t\t\t\tctrl.ratingValues = ItemService.getRatingValues(items);\r\n\t\t\t\t\tctrl.ratingsDistribution = ItemService.buildRatingsDistribution(items);\r\n\t\t\t\t\tctrl.statTags = ItemService.buildStatTags(items, ctrl.ratingValues.averageRating);\r\n\t\t\t\t} else if (view === 'Character') {\r\n\t\t\t\t\tctrl.statTags = CharacterService.buildCharacterTags(items);\r\n\t\t\t\t\tctrl.statSeries = CharacterService.buildSeriesList(items);\r\n\t\t\t\t\tctrl.voiceActors = CharacterService.buildVoiceActors(items);\r\n\t\t\t\t\tCharacterService.buildGenderDistribution(ctrl.statTags, items.length).then(function(result) {\r\n\t\t\t\t\t\t\tctrl.gender = result;\r\n\t\t\t\t\t\t\tctrl.gender[0].colour = ctrl.colours.red;\r\n\t\t\t\t\t\t\tctrl.gender[1].colour = ctrl.colours.green;\r\n\t\t\t\t\t\t\tctrl.gender[2].colour = ctrl.colours.blue;\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (view ==='Topten') {\r\n\t\t\t\t\tStatisticsService.buildToptenModeList(items, ctrl.toptens.type).then(function(result) {\r\n\t\t\t\t\t\tctrl.toptens.detail.items = result.sort(function(a, b) {\r\n\t\t\t\t\t\t\tif(a.count < b.count) return 1;\r\n\t\t\t\t\t\t\tif(a.count > b.count) return -1;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.log('topten stat process: ', items, ctrl.toptens);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//handle getting view items and setting view specific defaults.\r\n      function getItems(view) {\r\n          //reset defaults that are shared between views.\r\n          ctrl.detail.history = 'months';\r\n          ctrl.filterConfig.search.tag = '';\r\n          ctrl.detail.isVisible = false;\r\n          ctrl.detail.isEpisodeRatings = false;\r\n          ctrl.statTags = []; //clear to stop multiple views tags appearing.\r\n          ctrl.ratingsDistribution = [];\r\n          if (view === 'Anime') {\r\n              ctrl.filterConfig.sort.tag.type = 'ratingWeighted'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.anime.length === 0) {\r\n                spinnerService.loading('items', Animeitems.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.anime = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t                getItemStatistics(view, result);\r\n\t\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.anime;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.anime);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - anime');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Manga') {\r\n              ctrl.filterConfig.sort.tag.type = 'ratingWeighted'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.manga.length === 0) {\r\n              \tspinnerService.loading('items',\tMangaitems.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.manga = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t\t\t\t\t\t\t\t\tgetItemStatistics(view, result);\r\n              \t}));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.manga;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.manga);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - anime');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Character') {\r\n              ctrl.filterConfig.sort.tag.type = 'count'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.character.length === 0) {\r\n\t\t\t\t\t\t\t\tspinnerService.loading('character', Characters.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.character = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t\t\t\t\t\t\t\t\tgetItemStatistics(view, result);\r\n                }));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.character;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.character);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - character');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Topten') {\r\n\t\t\t\t\t\tif (ctrl.dataStore.toptens.anime.totalListCount === undefined) {\r\n              spinnerService.loading('topten', Toptens.query().$promise.then(function(result) {\r\n                return ListService.groupItemsByProperties(result, ['type']);\r\n              }).then(function(result) {\r\n\t\t\t\t\t\t\t\tfor(var i = 0, type = ''; i < 3; i++) {\r\n\t\t\t\t\t\t\t\t\ttype = result[i][0].type;\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.toptens[type].items = result[i];\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.toptens[type].totalListCount = result[i].length;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn StatisticsService.buildToptenDataStructure(ctrl.toptens, result);\r\n              }).then(function(result) {\r\n\t\t\t\t\t\t\t\tctrl.toptens = result;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, result[ctrl.toptens.type].items);\r\n\t\t\t\t\t\t\t\tconsole.log('topten arrays: ', ctrl.toptens);\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.toptens[ctrl.toptens.type].items);\r\n\t\t\t\t\t\t\tconsole.log('from cache - topten');\r\n\t\t\t\t\t\t}\r\n          }\r\n\t\t\t\t\tconsole.log('dataStore check: ', ctrl.dataStore);\r\n      }\r\n      function find(view) {\r\n          getItems(view);\r\n      }\r\n\r\n\t\t\tfunction getToptenItemStatistics(view, toptenType) {\r\n\t\t\t\tconsole.log('get topten stats: ', toptenType);\r\n\t\t\t\tvar filteredItems = ctrl.dataStore.toptens[toptenType].items;\r\n\t\t\t\tif(ctrl.filterConfig.topten.isRanked) filteredItems = filter(filteredItems, { isRanked: true });\r\n\t\t\t\tif(ctrl.filterConfig.topten.isFavourite) filteredItems = filter(filteredItems, { isFavourite: true });\r\n\t\t\t\tconsole.log('post filtering: ', filteredItems);\r\n\t\t\t\tif(filteredItems.length > 0) {\r\n\t\t\t\t\tctrl.toptens[toptenType].items = []; //clear items so you won't get repeats.\r\n\t\t\t\t\tStatisticsService.buildToptenDataStructure(ctrl.toptens, [filteredItems]).then(function(result) {\r\n\t\t\t\t\t\tctrl.toptens = result;\r\n\t\t\t\t\t\tconsole.log('topten data structure - result: ', result, ctrl.toptens);\r\n\t\t\t\t\t\tgetItemStatistics(view, result[toptenType].items);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctrl.toptens[toptenType].listCount = 0;\r\n\t\t\t\t\tctrl.toptens.detail.items = filteredItems;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n      //Builds ratings aggregates.\r\n      function getSummaryFunctions(array) {\r\n      \tspinnerService.loading('detail', StatisticsService.buildSummaryFunctions(array).then(function(result) {\r\n        \tctrl.historyDetails.summaryFunctions = result;\r\n\t\t\t\t\tconsole.log('got summary functions: ', ctrl.detail, ctrl.historyDetails);\r\n        }));\r\n        if (ctrl.detail.summary.isVisible === true) {\r\n\t        spinnerService.loading('detail',\r\n\t            StatisticsService.buildYearSummary(array, ctrl.detail.year, ctrl.detail.summary.type).then(function(result) {\r\n\t                ctrl.historyDetails.yearSummary = result;\r\n\t\t\t\t\t\t\t\t\tconsole.log('got year summary: ', ctrl.detail, ctrl.historyDetails);\r\n\t            })\r\n\t        );\r\n        }\r\n\t\t\t\tif(ctrl.detail.isEpisodeRatings && array[0].meta.episodeSummaryFunctions === undefined) { //If the first item has it already, they all do and this is pointless.\r\n          spinnerService.loading('detail', StatisticsService.buildEpisodeSummaries(array).then(function(result) {\r\n                  console.log(array);\r\n          }));\r\n\t\t\t\t}\r\n//            console.log(array, $scope.historyDetails);\r\n      }\r\n\r\n      function historyDetail(year, division, divisionText, summaryType) {\r\n\t      ctrl.detail.isVisible = true;\r\n\t      ctrl.detail.year = year;\r\n\t      ctrl.detail.division = division;\r\n\t      ctrl.detail.divisionText = divisionText;\r\n\t\t\t\tctrl.detail.summary.type = summaryType;\r\n\t      ctrl.detail.summary.isVisible = (summaryType === undefined) ? false : true;\r\n\t\t\t\tctrl.getFilteredItems();\r\n      }\r\n\r\n      function tableDetail(type, name) {\r\n          if (ctrl.tableDetails[type] === name) {\r\n              ctrl.filterConfig.search[type] = '';\r\n              ctrl.filterConfig.show[type] = false;\r\n              ctrl.tableDetails[type] = '';\r\n              if (type === 'tag') ctrl.tableDetails.isEqual = false;\r\n          } else {\r\n              ctrl.filterConfig.search[type] = name;\r\n              ctrl.tableDetails[type] = name;\r\n              ctrl.filterConfig.show[type] = true;\r\n              if (type === 'tag') {\r\n                  ctrl.tagDetailResult = CharacterService.buildRelatedCharacterTags(ctrl.items, name);\r\n                  ctrl.tableDetails.isEqual = true;\r\n              }\r\n          }\r\n      }\r\n\r\n\t\t\tfunction getFilteredItems(historyChange) {\r\n\t\t\t\tif(historyChange) {\r\n\t\t\t\t\tctrl.detail.isVisible = false;\r\n\t\t\t\t\tctrl.detail.summary.isVisible = false;\r\n\t\t\t\t\tif(ctrl.detail.history === 'months') ctrl.detail.isEpisodeRatings = false;\r\n\t\t\t\t}\r\n\t\t\t\tvar filtered = $filter('statisticsDetailFilter')(ctrl.items, ctrl.detail.history, ctrl.detail.year, ctrl.detail.division);\r\n\t\t\t\tgetSummaryFunctions(filtered);\r\n\t\t\t}\r\n\r\n      /** Using the start date of confirmed 'in-season' shows\r\n       *  to populate the new season attrs. that will work with the new\r\n       *  filters in the hopes accuracy and speed will increase.\r\n       */\r\n      function generateSeasons() {\r\n          if (ctrl.view === 'Anime') {\r\n              var array = ItemService.setSeason(ctrl.items, ctrl.detailSeasonYear, ctrl.detailSeason);\r\n              angular.forEach(array, function(item) {\r\n                  item.$update(function() {\r\n                      console.log(item);\r\n                  }, function(errorResponse) {\r\n                      ctrl.error = errorResponse.data.message;\r\n                  });\r\n              });\r\n          }\r\n      }\r\n\t\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('detectFlood', detectFlood);\r\n  detectFlood.$inject = ['$timeout'];\r\n\r\n  function detectFlood($timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function(scope, element, attrs) {\r\n            var el = element[0];\r\n\r\n            function overflowCheck() {\r\n                if (el.scrollWidth > el.offsetWidth) {\r\n                    el.classList.add('flooded');\r\n                } else {\r\n                    el.classList.remove('flooded');\r\n                }\r\n            }\r\n            overflowCheck();\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: el.offsetWidth,\r\n                    };\r\n                }, function () {\r\n//                    console.log('detect flood?');\r\n                        overflowCheck();\r\n                }, true\r\n            );\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('percentageBarContainer', percentageBarContainer);\r\n\r\n  function percentageBarContainer() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        scope: {\r\n          border: '@?'\r\n        },\r\n        transclude: true,\r\n        bindToController: true,\r\n        template: '<div class=\"relative {{percentageBarContainer.border}}\" style=\"height: 20px;\" ng-transclude></div>',\r\n        controllerAs: 'percentageBarContainer',\r\n        controller: function($scope) {\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('percentageBar', percentageBar);\r\n\r\n  function percentageBar() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        scope: {\r\n            type: '@?',\r\n            percentage: '@',\r\n            colour: '@?',\r\n            display: '@?'\r\n        },\r\n        require: '^percentageBarContainer',\r\n        templateUrl: '/modules/statistics/templates/percentage-bar.html',\r\n        link: function(scope, element, attrs, percentageBarContainerCtrl) {\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('tabContainer', tabContainer);\r\n\r\n  function tabContainer() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        scope: {\r\n            model: '=ngModel'\r\n        },\r\n        templateUrl: '/modules/statistics/templates/tab-container.html',\r\n        require: '?ngModel',\r\n        bindToController: true,\r\n        controllerAs: 'tabContainer',\r\n        controller: function($scope) {\r\n            var self = this;\r\n            self.tabs = [];\r\n            self.currentTab = undefined;\r\n            self.listShift = 0;\r\n\r\n            self.addTab = function addTab(tab) {\r\n                self.tabs.push(tab);\r\n\r\n                if(self.tabs.length === 1) {\r\n                    tab.active = true;\r\n                }\r\n            };\r\n\r\n            self.disable = function(disabledTab) {\r\n                if(disabledTab.active) {\r\n                    angular.forEach(self.tabs, function(tab) {\r\n                        if(!tab.disabled) {\r\n                            self.select(tab);\r\n                            return;\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n\r\n            self.select = function(selectedTab) {\r\n                if(!selectedTab.disabled) {\r\n                    angular.forEach(self.tabs, function(tab) {\r\n                        if(tab.active && tab !== selectedTab) {\r\n                          tab.active = false;\r\n                        }\r\n                    });\r\n                    selectedTab.active = true;\r\n                    self.currentTab = ($scope.tabContainer.model === undefined) ? undefined : selectedTab.heading;\r\n                }\r\n            };\r\n\r\n            self.shiftTabs = function(direction) {\r\n                switch(direction) {\r\n                    case 'origin':\r\n//                        console.log(self.listShift, (self.listShift - 100));\r\n                        if ((self.listShift + 100) > 0) {\r\n                            self.listShift = 0;\r\n                        } else {\r\n                            self.listShift += 100;\r\n                        }\r\n                        break;\r\n\r\n                    case 'offset':\r\n                        if ((self.listShift - 100) < ($scope.elWidth - $scope.ulWidth)) {\r\n                            self.listShift = $scope.elWidth - $scope.ulWidth;\r\n                        } else {\r\n                            self.listShift -= 100;\r\n                        }\r\n                        break;\r\n                }\r\n            };\r\n\r\n        },\r\n        link: function(scope, element, attrs, model) {\r\n            var el = element[0],\r\n                ul = el.children[0].children[0];\r\n            scope.elWidth = el.offsetWidth;\r\n            scope.ulWidth = ul.offsetWidth;\r\n\r\n            scope.$watch('tabContainer.currentTab', function(newValue) {\r\n                if (newValue !== undefined && model.$viewValue !== undefined) {\r\n                    model.$setViewValue(newValue);\r\n                }\r\n            });\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: el.offsetWidth,\r\n                    };\r\n                }, function () {\r\n                    scope.elWidth = el.offsetWidth;\r\n                }, true\r\n            );\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: ul.offsetWidth,\r\n                    };\r\n                }, function () {\r\n                    scope.ulWidth = ul.offsetWidth;\r\n                }, true\r\n            );\r\n\r\n            scope.$watch('tabContainer.listShift', function(newValue) {\r\n                if(newValue !== undefined) {\r\n                    var shift = (newValue === 0) ? '' : 'px';\r\n                    ul.style.left = newValue + shift;\r\n                }\r\n            });\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('tabView', tabView);\r\n\r\n  function tabView() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        template: '<div class=\"tab-view\" role=\"tabpanel\" ng-show=\"active\" ng-transclude></div>',\r\n        require: '^tabContainer',\r\n        scope: {\r\n            heading: '@',\r\n            disabled: '='\r\n        },\r\n        link: function (scope, element, attrs, tabContainerCtrl) {\r\n            scope.active = false;\r\n            tabContainerCtrl.addTab(scope);\r\n\r\n            scope.$watch('disabled', function(newValue) {\r\n                if(newValue !== undefined) {\r\n                    if(newValue) {\r\n                        console.log(scope.heading, newValue);\r\n                        tabContainerCtrl.disable(scope);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  //Statistics service\r\n  angular.module('statistics')\r\n  .service('StatisticsService', StatisticsService);\r\n  StatisticsService.$inject = ['$filter', 'ListService', '$q'];\r\n\r\n   function StatisticsService($filter, ListService, $q) {\r\n      var service = {\r\n        buildEpisodeSummaries: buildEpisodeSummaries,\r\n        buildSummaryFunctions: buildSummaryFunctions,\r\n        buildToptenDataStructure: buildToptenDataStructure,\r\n        buildToptenModeList: buildToptenModeList,\r\n        buildYearSummary: buildYearSummary,\r\n        getModeMap: getModeMap,\r\n        occuranceCounter: occuranceCounter\r\n      };\r\n      return service;\r\n\r\n      function buildSummaryFunctions(array) {\r\n          return $q(function(resolve, reject) {\r\n              if (array !== undefined) {\r\n                  var i = array.length, highestRating = 0, lowestRating = 10, averageRating = 0, modeRating = {}, ratings = { count: 0, sum: 0 };\r\n                  while(i--) {\r\n      //                console.log(array[i]);\r\n                      highestRating = array[i].rating > highestRating ? array[i].rating : highestRating;\r\n                      lowestRating = 0 < array[i].rating && array[i].rating < lowestRating ? array[i].rating : lowestRating;\r\n                      ratings.count += array[i].rating > 0 ? 1 : 0;\r\n                      ratings.sum += array[i].rating;\r\n                      averageRating = (ratings.sum / ratings.count).toFixed(2);\r\n                      modeRating = service.getModeMap(array, 'rating', 0);\r\n                  }\r\n                  resolve([\r\n                      { metric: 'Average rating', value: averageRating },\r\n                      { metric: 'Highest rating', value: highestRating },\r\n                      { metric: 'Lowest rating',  value: (lowestRating === 10) ? 0 : lowestRating },\r\n                      { metric: 'Mode rating',    value: (modeRating.value === undefined) ? 0 : modeRating.value }\r\n                  ]);\r\n              }\r\n          });\r\n      }\r\n\r\n      function processYearSummary(summary, array) {\r\n          var i = array.length;\r\n          if (summary.length < 1) {\r\n              while(i--) {\r\n                  summary.push({\r\n                      metric: array[i].metric,\r\n                      values: []\r\n                  });\r\n              }\r\n              summary.reverse();\r\n          }\r\n          i = array.length;\r\n          for(var j = 0; j < i; j++) {\r\n              summary[j].values.push({ value: array[j].value });\r\n          }\r\n          return summary;\r\n      }\r\n\r\n      function buildYearSummary(array, year, type) {\r\n          return $q(function(resolve, reject) {\r\n              var filter = (type === 'months') ? 'endedMonth' : 'season',\r\n                  attr   = (type === 'months') ? 'number'     : 'text'  ,\r\n                  commonArrays = ListService.getCommonArrays(),\r\n                  i = commonArrays[type].length,\r\n                  yearSummary = [], results = [];\r\n\r\n              for(var j = 0; j < i; j++) {\r\n                  var filteredArray = $filter(filter)(array, year, commonArrays[type][j][attr]),\r\n                      promise = service.buildSummaryFunctions(filteredArray);\r\n                  results.push(promise);\r\n              }\r\n              angular.forEach(results, function(promise) {\r\n                  promise.then(function(result) {\r\n                      yearSummary = processYearSummary(yearSummary, result);\r\n                  });\r\n              });\r\n              resolve(yearSummary);\r\n          });\r\n      }\r\n\r\n      function buildEpisodeSummaries(array) {\r\n          return $q(function(resolve, reject) {\r\n              angular.forEach(array, function(item) {\r\n                  service.buildSummaryFunctions(item.meta.history).then(function(result) {\r\n                      item.meta.episodeSummaryFunctions = result;\r\n                  });\r\n              });\r\n              resolve(array);\r\n          });\r\n      }\r\n\r\n      function getModeMap(array, attr, ignore) {\r\n          var modeMap = {},\r\n              max = {\r\n                  count: 0,\r\n                  value: ''\r\n              };\r\n          for(var i = 0; i < array.length; i++) {\r\n              var value = array[i][attr];\r\n              if(modeMap[value] === null || modeMap[value] === undefined) {\r\n                  modeMap[value] = 1;\r\n              } else {\r\n                  modeMap[value]++;\r\n              }\r\n              if(modeMap[value] > max.count) {\r\n                  //Ignore is a value you might not care about e.g. 0;\r\n                  if (ignore !== value) {\r\n                      max.count = modeMap[value];\r\n                      max.value = value;\r\n                  }\r\n              }\r\n          }\r\n  //        console.log(max);\r\n          return max;\r\n      }\r\n\r\n      function occuranceCounter(array, attr) {\r\n        return $q(function(resolve, reject) {\r\n          var occuranceCounter = [];\r\n          ListService.groupItemsByProperties(array, [attr]).then(function(result) {\r\n            for(var i = 0, len = result.length; i < len; i++) {\r\n              occuranceCounter.push({\r\n                value: result[i][0][attr],\r\n                count: result[i].length\r\n              });\r\n            }\r\n          });\r\n          resolve(occuranceCounter);\r\n        });\r\n      }\r\n\r\n      function buildToptenDataStructure(obj, arrayOfArrays) {\r\n        return $q(function(resolve, reject) {\r\n          angular.forEach(arrayOfArrays, function(array) {\r\n            var type = array[0].type, listType = type + 'List', len = array.length;\r\n            obj[type].listCount = len;\r\n            for(var i = 0; i < len; i++) {\r\n              var itemLen = array[i][listType].length;\r\n              for(var j = 0; j < itemLen; j++) {\r\n                obj[type].items.push(array[i][listType][j]);\r\n              }\r\n            }\r\n          });\r\n          resolve(obj);\r\n        });\r\n      }\r\n\r\n      function buildToptenModeList(array, type) {\r\n        var attr = type === 'character' ? 'name' : 'title';\r\n        return service.occuranceCounter(array, attr);\r\n      }\r\n\r\n    }\r\n\r\n  })();\r\n\n'use strict';\r\n\r\n//// Configuring the Articles module\r\n//angular.module('tasks').run(['Menus',\r\n//\tfunction(Menus) {\r\n//\t\t// Set top bar menu items\r\n//\t\tMenus.addMenuItem('topbar', 'Tasks', 'tasks', 'dropdown', '/tasks(/create)?');\r\n//\t\tMenus.addSubMenuItem('topbar', 'tasks', 'List Tasks', 'tasks');\r\n//\t\tMenus.addSubMenuItem('topbar', 'tasks', 'New Task', 'tasks/create');\r\n//\t}\r\n//]);\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('tasks').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Tasks state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listTasks', {\r\n\t\t\turl: '/tasks',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/list-tasks.client.view.html'\r\n\t\t}).\r\n\t\tstate('createTask', {\r\n\t\t\turl: '/tasks/create',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/create-task.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewTask', {\r\n\t\t\turl: '/tasks/:taskId',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/view-task.client.view.html'\r\n\t\t}).\r\n\t\tstate('editTask', {\r\n\t\t\turl: '/tasks/:taskId/edit',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/edit-task.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('tasks').controller('CreateTaskController', CreateTaskController);\r\n  CreateTaskController.$inject =  ['$scope', 'data', '$stateParams', '$location', 'Authentication', 'Tasks', 'ListService', 'NotificationFactory', 'TaskFactory', 'spinnerService', '$uibModalInstance', 'Animeitems', 'Mangaitems'];\r\n\r\nfunction CreateTaskController($scope, data, $stateParams, $location, Authentication, Tasks, ListService, NotificationFactory, TaskFactory, spinnerService, $uibModalInstance, Animeitems, Mangaitems) {\r\n  var ctrl = this,\r\n      newTaskModel = {};\r\n  ctrl.addChecklistItem = addChecklistItem;\r\n  ctrl.backStep = backStep;\r\n  ctrl.cancel = cancel;\r\n  ctrl.commonArrays = data.commonArrays;\r\n  ctrl.create = create;\r\n  ctrl.dropChecklistItem = dropChecklistItem;\r\n  ctrl.stepConfig = {\r\n      currentStep: 1,\r\n      stepCount: 2\r\n  };\r\n  ctrl.submit = submit;\r\n  ctrl.takeStep = takeStep;\r\n\r\n  function setNewTask() {\r\n      ctrl.newTask = {\r\n          description: '',\r\n          link: {\r\n              linked: false,\r\n              type: '',\r\n              anime: undefined,\r\n              manga: undefined\r\n          },\r\n          day: '',\r\n          date: new Date(),\r\n          repeat: 0,\r\n          category: '',\r\n          daily: false,\r\n          checklist: false,\r\n          checklistItems: [],\r\n          isAddTask: false\r\n      };\r\n  }\r\n  setNewTask();\r\n  angular.copy(ctrl.newTask, newTaskModel);\r\n\r\n\r\n  //for adding/removing options.\r\n  function addChecklistItem() {\r\n          if (ctrl.newTask.checklistItem!=='' && ctrl.newTask.checklistItem!==undefined) {\r\n              var i = 0;\r\n              var alreadyAdded = false;\r\n              if (ctrl.newTask.checklistItems.length > 0) {\r\n                  while(i < ctrl.newTask.checklistItems.length) {\r\n                      if (ctrl.newTask.checklistItems[i].text === ctrl.newTask.checklistItem) {\r\n                          alreadyAdded = true;\r\n                      }\r\n                      i++;\r\n                  }\r\n                  //if not in array add it.\r\n                  if (alreadyAdded === false) {\r\n                      ctrl.newTask.checklistItems.push({ text: ctrl.newTask.checklistItem, complete: false });\r\n                  }\r\n              } else {\r\n                  ctrl.newTask.checklistItems.push({ text: ctrl.newTask.checklistItem, complete: false });\r\n              }\r\n          }\r\n          ctrl.newTask.checklistItem = '';\r\n  }\r\n  function dropChecklistItem(text) {\r\n      var deletingItem = ctrl.newTask.checklistItems;\r\n      ctrl.newTask.checklistItems = [];\r\n      //update the task.\r\n      angular.forEach(deletingItem, function(item) {\r\n          if (item.text !== text) {\r\n              ctrl.newTask.checklistItems.push(item);\r\n          }\r\n      });\r\n  }\r\n\r\n  // Create new Task\r\n  function create() {\r\n//            console.log(this.newTask);\r\n    // Create new Task object\r\n    var task = new Tasks ({\r\n        description: ctrl.newTask.description,\r\n        link: {\r\n            linked: ctrl.newTask.link.linked,\r\n            type: (ctrl.newTask.link.linked === false) ? ''      :\r\n                  (ctrl.newTask.category === 'Watch')  ? 'anime' :\r\n                                                         'manga' ,\r\n            anime: (ctrl.newTask.link.anime === undefined) ? undefined : ctrl.newTask.link.anime._id ,\r\n            manga: (ctrl.newTask.link.manga === undefined) ? undefined : ctrl.newTask.link.manga._id\r\n        },\r\n        day: ctrl.newTask.daily === true ? 'Any' : ctrl.newTask.day,\r\n        date: ctrl.newTask.date === '' ? new Date() : ctrl.newTask.date,\r\n        repeat: (ctrl.newTask.link.linked === false) ? ctrl.newTask.repeat                     :\r\n                (ctrl.newTask.category === 'Watch')  ? ctrl.newTask.link.anime.finalEpisode    :\r\n                                                       1    ,\r\n        completeTimes: (ctrl.newTask.link.linked === false) ? 0                                     :\r\n                       (ctrl.newTask.category === 'Watch')  ? ctrl.newTask.link.anime.episodes      :\r\n                                                              0      ,\r\n        updateCheck: new Date().getDay() === 1 ? true : false,\r\n        complete: false,\r\n        category: ctrl.newTask.category === '' ? 'Other' : ctrl.newTask.category,\r\n        daily: ctrl.newTask.daily,\r\n        checklist: ctrl.newTask.checklist,\r\n        checklistItems: ctrl.newTask.checklistItems\r\n    });\r\n//\t\t\t// Redirect after save\r\n    task.$save(function(response) {\r\n      $location.path('tasks');\r\n      NotificationFactory.success('Saved!', 'New Task was successfully saved!');\r\n    }, function(errorResponse) {\r\n      ctrl.error = errorResponse.data.message;\r\n      console.log(errorResponse);\r\n      NotificationFactory.error('Error!', 'New Task failed to save!');\r\n    });\r\n  }\r\n\r\n  function backStep(step) {\r\n      ctrl.stepConfig.currentStep -= 1;\r\n  }\r\n  function takeStep(step) {\r\n      var check = process(step);\r\n      if (check.valid) {\r\n          ctrl.stepConfig.currentStep += 1;\r\n      } else {\r\n          NotificationFactory.popup('Attention!', check.message, 'warning');\r\n      }\r\n  }\r\n  function submit() {\r\n    ctrl.create();\r\n    $uibModalInstance.close();\r\n  }\r\n  function cancel() {\r\n    $uibModalInstance.dismiss();\r\n  }\r\n\r\n  function process(step) {\r\n      switch(step) {\r\n          case 1:\r\n              if (ctrl.newTask.link.linked === true) {\r\n                  var category = ctrl.newTask.category;\r\n                  if (category === 'Watch') {\r\n                      ctrl.linkItems = Animeitems.query({\r\n                          status: 0\r\n                      });\r\n                      ctrl.linkType = 'anime';\r\n                      ctrl.newTask.checklistItems = [];\r\n                      ctrl.newTask.checklist = false;\r\n                  } else if (category === 'Read') {\r\n                      ctrl.linkItems = Mangaitems.query({\r\n                          status: 0\r\n                      });\r\n                      ctrl.linkType = 'manga';\r\n                  } else {\r\n                      return { valid: false, message: 'Category must be either Watch or Read for linked items!' };\r\n                  }\r\n              } else {\r\n                  //Ensure that stuff is cleared when not linked.\r\n                  ctrl.linkType = '';\r\n                  ctrl.newTask.link.anime = undefined;\r\n                  ctrl.newTask.link.manga = undefined;\r\n              }\r\n              return { valid: true };\r\n      }\r\n  }\r\n}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('tasks').controller('ScheduleCalendarTaskController', ScheduleCalendarTaskController);\r\n\tScheduleCalendarTaskController.$inject = ['$scope', '$uibModalInstance', 'moment', 'data', 'ListService', 'TaskFactory'];\r\n\r\n\tfunction ScheduleCalendarTaskController($scope, $uibModalInstance, moment, data, ListService, TaskFactory) {\r\n    var ctrl = this,\r\n\t\t\t\trefresh = false,\r\n\t\t\t\ttimeDiff = Math.abs(new Date(data.date).getTime() - new Date().getTime());\r\n\r\n\t\tctrl.cancel = cancel;\r\n    ctrl.date = new Date(data.date);\r\n\t\tctrl.day = ctrl.date.getDay() > 0 ? ctrl.date.getDay() - 1 : 6;\r\n\t\tctrl.days = data.days;\r\n\t\tctrl.daysFromToday = Math.ceil(timeDiff / (1000 * 3600 * 24));\r\n    ctrl.events = [];\r\n\t\tctrl.init = init;\r\n\t\tctrl.insertChecklistItem = insertChecklistItem;\r\n\t\tctrl.removeTask = removeTask;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.tickOffChecklist = tickOffChecklist;\r\n\t\tctrl.today = new Date();\r\n\t\tctrl.updateTask = updateTask;\r\n\t\tconsole.log('data: ', data, 'days: ', ctrl.days, ctrl.day, ctrl.date);\r\n\r\n\t\tfunction init() {\r\n\t\t\tvar weekEnds = new Date(ListService.weekEndingForDate(ctrl.date));\r\n\t\t\tangular.forEach(data.events, function(event) {\r\n\t\t\t\tif(new Date(event.date) < weekEnds && ((event.day.substring(0, 3) === ctrl.days[ctrl.day].text) || (event.day === 'Any'))) {\r\n\t\t\t\t\t// console.log('daysFromToday: ', ctrl.daysFromToday);\r\n\t\t\t\t\tif(!event.daily) {\r\n\t\t\t\t\t\t//in weeks\r\n\t\t\t\t\t\t// console.log('weeks: ', event.completeTimes, Math.floor(ctrl.daysFromToday / 7), event.repeat);\r\n\t\t\t\t\t\tif((event.completeTimes + Math.floor(ctrl.daysFromToday / 7) <= event.repeat) || event.repeat === 0) {\r\n\t\t\t\t\t\t\tctrl.events.push(event);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if(event.daily) {\r\n\t\t\t\t\t\t//in days\r\n\t\t\t\t\t\t// console.log('days: ', event.completeTimes, ctrl.daysFromToday, event.repeat);\r\n\t\t\t\t\t\tif(((event.completeTimes + ctrl.daysFromToday) <= event.repeat) || event.repeat === 0) {\r\n\t\t\t\t\t\t\tctrl.events.push(event);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tctrl.events.sort(function(a, b) {\r\n\t\t\t\tvar aDate = a.date, bDate = b.date;\r\n\t\t\t\treturn aDate < bDate ? 1 :\r\n\t\t\t\t\t\t\t aDate > bDate ? -1 : 0;\r\n\t\t\t});\r\n\t\t}\r\n\t\tctrl.init();\r\n\r\n\t\tfunction removeTask(task) {\r\n\t\t\tTaskFactory.removeTask(task, ctrl.events, true);\r\n\t\t}\r\n\t\t//Update task.\r\n\t\tfunction updateTask(task) {\r\n\t\t\t\tTaskFactory.updateTask(task);\r\n\t\t}\r\n    //Add new checklist item.\r\n    function insertChecklistItem(task, newChecklistItem) {\r\n        TaskFactory.insertChecklistItem(task, newChecklistItem);\r\n    }\r\n\t\t//Tick off a task.\r\n\t\tfunction tickOff(task) {\r\n\t\t    TaskFactory.tickOff(task).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOff: ', result);\r\n\t\t\t\t\trefresh = result.refresh;\r\n\t\t\t\t});\r\n\t\t}\r\n    //Tick of a checklist item.\r\n    function tickOffChecklist(task, index) {\r\n        TaskFactory.tickOffChecklist(task, index).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOffChecklist: ', result);\r\n\t\t\t\t\trefresh = result.refresh;\r\n\t\t\t\t});\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.close(refresh);\r\n    }\r\n\t}\r\n})();\r\n\n(function() {\r\n'use strict';\r\n\r\n\t// Tasks controller\r\n\tangular.module('tasks').controller('TasksController', TasksController);\r\n\tTasksController.$inject =  ['$scope', '$timeout', '$stateParams', '$location', 'Authentication', 'Tasks', 'ListService', 'NotificationFactory', 'TaskFactory', 'spinnerService', '$uibModal', 'moment'];\r\n\r\n\tfunction TasksController($scope, $timeout, $stateParams, $location, Authentication, Tasks, ListService, NotificationFactory, TaskFactory, spinnerService, $uibModal, moment) {\r\n\t\tvar ctrl = this,\r\n\t\t\t\ttoday = new Date(),\r\n\t\t\t\tday = today.getDay();\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.commonArrays = ListService.getCommonArrays();\r\n\t\tctrl.createTask = createTask;\r\n\t\tctrl.dateOptions = {\r\n\t\t\tdateDisabled: false,\r\n\t\t\tformatYear: 'yy',\r\n\t\t\tmaxDate: new Date(2020, 5, 22),\r\n\t\t\tminDate: new Date(),\r\n\t\t\tstartingDay: 1\r\n\t\t};\r\n\t\tctrl.filterConfig = {\r\n\t\t\tview: 'list',\r\n      showingCount: 0,\r\n      sortType: '',\r\n      sortReverse: true,\r\n      search: {\r\n          description: '',\r\n          day: ''\r\n      },\r\n      datesSelected: false\r\n    };\r\n\t\tctrl.insertChecklistItem = insertChecklistItem;\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 10\r\n    };\r\n\t\tctrl.refreshItems = refreshItems;\r\n\t\tctrl.removeTask = removeTask;\r\n\t\tctrl.setTabFilterDay = setTabFilterDay;\r\n\t\tctrl.tabFilter = tabFilter;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.tickOffChecklist = tickOffChecklist;\r\n\t\tctrl.updateTask = updateTask;\r\n\t\tctrl.weekBeginning = weekBeginning;\r\n\t\tctrl.whichController = 'task';\r\n\r\n    function tabFilter(tabName) {\r\n        ctrl.filterConfig.search.day = tabName;\r\n    }\r\n\r\n    function weekBeginning() {\r\n        return TaskFactory.getWeekBeginning();\r\n    }\r\n\r\n\t\tfunction createTask() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/tasks/views/create-task.client.view.html',\r\n        controller: 'CreateTaskController as taskCreate',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { commonArrays: ctrl.commonArrays };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed create task: ', result);\r\n\t\t\t\tfind();\r\n      });\r\n\t\t}\r\n\r\n\t\t// Remove existing Task\r\n\t\tfunction removeTask(task) {\r\n\t\t\tTaskFactory.removeTask(task, ctrl.tasks, true);\r\n\t\t}\r\n\t\t//Update task.\r\n\t\tfunction updateTask(task) {\r\n\t\t\t\tTaskFactory.updateTask(task);\r\n\t\t}\r\n    //Add new checklist item.\r\n    function insertChecklistItem(task, newChecklistItem) {\r\n        TaskFactory.insertChecklistItem(task, newChecklistItem);\r\n    }\r\n\t\t//Tick off a task.\r\n\t\tfunction tickOff(task) {\r\n\t\t    TaskFactory.tickOff(task).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOff: ', result);\r\n\t\t\t\t\tif(result.refresh) find();\r\n\t\t\t\t});\r\n\t\t}\r\n    //Tick of a checklist item.\r\n\t\tfunction tickOffChecklist(task, index) {\r\n        TaskFactory.tickOffChecklist(task, index).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOffChecklist: ', result);\r\n\t\t\t\t\tif(result.refresh) find();\r\n\t\t\t\t});\r\n    }\r\n\r\n    //Defaults the tab filter to the current day of the week.\r\n    function setTabFilterDay(day) {\r\n        var index = day === 0 ? 7 : day; //Adjust for Sunday.\r\n        ctrl.filterConfig.search.day = ctrl.commonArrays.days[index].name;\r\n        console.log(day, ctrl.filterConfig.search.day);\r\n    }\r\n    ctrl.setTabFilterDay(day);\r\n\r\n    //check things\r\n    function checkStatus() {\r\n        if (day === 1) {\r\n            console.log('monday', day);\r\n            angular.forEach(ctrl.tasks, function (task) {\r\n                //has it been updated today?\r\n                if(task.updateCheck === false) {\r\n                    console.log('updating - ', task.description);\r\n                    var type = task.link.type;\r\n                    if ((task.link.linked === false) || (type === 'manga')) {\r\n                        //has it reached the necessary number of repeats?\r\n                        if(task.completeTimes !== task.repeat) {\r\n                            console.log('not complete', task.description);\r\n                            task.complete = false;\r\n                            task.updateCheck = true;\r\n                            TaskFactory.updateTask(task);\r\n                        } else if (task.completeTimes === task.repeat) {\r\n                            console.log('complete - delete', task.description);\r\n                            TaskFactory.removeTask(task, ctrl.tasks);\r\n                        }\r\n                    } else if (task.link.type === 'anime') {\r\n                        console.log('linked');\r\n                            var parts = { single: 'episodes', all: 'finalEpisode' };\r\n                        if (task.link[type][parts.single] !== task.link[type][parts.all]) {\r\n                            console.log('linked not complete', task.description);\r\n                            task.complete = false;\r\n                            task.updateCheck = true;\r\n                            TaskFactory.updateTask(task);\r\n                        } else if (task.link[type][parts.single] === task.link[type][parts.all]) {\r\n                            console.log('linked complete - delete', task.description);\r\n                            TaskFactory.removeTask(task, ctrl.tasks);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n            console.log('not monday', day);\r\n            angular.forEach(ctrl.tasks, function (task) {\r\n                var change = task.updateCheck === false ? false : true;\r\n                task.updateCheck = false;\r\n                //is it a daily task?\r\n                if (task.daily === true) {\r\n                    console.log('daily', task.description);\r\n                    //has it reached the necessary number of repeats?\r\n                    if(task.completeTimes !== task.repeat) {\r\n                        console.log('not complete', task.description);\r\n                        var refresh = today.toISOString().slice(0,10);\r\n                        //has it been refreshed today?\r\n                        if (task.dailyRefresh.slice(0,10) !== refresh) {\r\n                            console.log('not complete - update', task.description);\r\n                            task.complete = false;\r\n                            task.dailyRefresh = refresh;\r\n                            TaskFactory.updateTask(task);\r\n                        }\r\n                    } else if (task.completeTimes === task.repeat) {\r\n                        console.log('complete - delete', task.description);\r\n                        TaskFactory.removeTask(task, ctrl.tasks);\r\n                    }\r\n                } else if ((task.daily === false) && change) {\r\n                    console.log('weekly update: ', task.description);\r\n                    TaskFactory.updateTask(task);\r\n                }\r\n            });\r\n        }\r\n        find();\r\n    }\r\n\r\n\t\t// Find a list of Tasks\r\n\t\tfunction find(check) {\r\n\t\t\t$timeout(function () {\r\n\t\t    spinnerService.loading('tasks', Tasks.query().$promise.then(function(result) {\r\n\t\t\t\t\tconsole.log('found! : ', result);\r\n\t\t        ctrl.tasks = result;\r\n\t\t        if (check === true) checkStatus();\r\n\t\t    }));\r\n\t\t\t}, 250);\r\n\t\t}\r\n\t\tfind(true);\r\n\r\n\t\tfunction refreshItems() {\r\n\t\t\tfind();\r\n      NotificationFactory.warning('Refreshed!', 'Task list refreshed!');\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('tasks').controller('UpdateAnimeTaskController', UpdateAnimeTaskController);\r\n\tUpdateAnimeTaskController.$inject = ['$scope', '$uibModalInstance', 'data', 'FunctionService'];\r\n\r\n\tfunction UpdateAnimeTaskController($scope, $uibModalInstance, data, FunctionService) {\r\n    var ctrl = this;\r\n\t\tctrl.cancel = cancel;\r\n\t\tctrl.episodeCompleted = data.item.link.anime.episodes + 1;\r\n    ctrl.episodeNumber = FunctionService.pad(ctrl.episodeCompleted, 3);\r\n    ctrl.episodeRating = 0;\r\n    ctrl.item = data.item;\r\n    ctrl.isComplete = ctrl.episodeCompleted === ctrl.item.link.anime.finalEpisode && ctrl.item.link.anime.finalEpisode !== 0;\r\n    ctrl.ratingLimit = 10;\r\n    ctrl.stepConfig = {\r\n        currentStep: 1,\r\n        stepCount: 1\r\n    };\r\n\t\tctrl.submit = submit;\r\n\r\n    function submit() {\r\n      $uibModalInstance.close({ task: ctrl.item, episodeRating: ctrl.episodeRating });\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('tasks').controller('UpdateMangaTaskController', UpdateMangaTaskController);\r\n\tUpdateMangaTaskController.$inject = ['$scope', '$uibModalInstance', 'data'];\r\n\r\n\tfunction UpdateMangaTaskController($scope, $uibModalInstance, data) {\r\n    var ctrl = this;\r\n\t\tctrl.cancel = cancel;\r\n    ctrl.item = data.item;\r\n    ctrl.stepConfig = {\r\n        currentStep: 1,\r\n        stepCount: 1\r\n    };\r\n\t\tctrl.submit = submit;\r\n    console.log('update linked manga item: ', ctrl.item);\r\n\r\n    function submit() {\r\n      $uibModalInstance.close(ctrl.item);\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('loseInterest', loseInterest);\r\n\r\n   function loseInterest($document, $window) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attrs) {\r\n            element.data('interesting', true);\r\n            /** On click, check what you clicked and whether you can ignore it.\r\n             *    Based on checks false the ng-show of the anywhere-but-here element.\r\n             */\r\n            angular.element($document[0].body).on('click', function (e) {\r\n                var interesting = angular.element(e.target).inheritedData('interesting'),\r\n                    elm = angular.element(e.target)[0].tagName,\r\n                    alsoInteresting = (elm === 'A') || (elm === 'I');\r\n                    //console.log(elm);\r\n                if (!interesting && !alsoInteresting) {\r\n                    scope.$apply(function () {\r\n                        scope.collapseFilters();\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('scheduleCalendar', scheduleCalendar);\r\n  scheduleCalendar.$inject = ['$uibModal', 'moment', 'ListService'];\r\n\r\n   function scheduleCalendar($uibModal, moment, ListService) {\r\n\r\n    function _removeTime(date) {\r\n      return date.day(1).hour(12).minute(0).second(0).millisecond(0);\r\n    }\r\n\r\n    function _buildMonth(scope, start, month) {\r\n         scope.weeks = [];\r\n         var done = false, date = moment(start), monthIndex = date.month(), count = 0;\r\n         while (!done) {\r\n           var days = _buildWeek(moment(date), month);\r\n           if(ListService.findWithAttr(days, 'isCurrentMonth', true) > -1) {\r\n             scope.weeks.push({ days: days });\r\n           }\r\n             date.add(1, 'w');\r\n             done = count++ > 2 && monthIndex !== date.month();\r\n             monthIndex = date.month();\r\n         }\r\n     }\r\n\r\n     function _buildWeek(date, month) {\r\n         var days = [];\r\n         for (var i = 0; i < 7; i++) {\r\n             days.push({\r\n                 name: date.format('dd').substring(0, 1),\r\n                 number: date.date(),\r\n                 isCurrentMonth: date.month() === month.month(),\r\n                 isToday: date.isSame(new Date(), 'day'),\r\n                 date: date\r\n             });\r\n             date = moment(date);\r\n             date.add(1, 'd');\r\n         }\r\n         return days;\r\n     }\r\n\r\n     function _displayEvents(events, date, days) {\r\n       var modalInstance = $uibModal.open({\r\n         animation: true,\r\n         templateUrl: '/modules/tasks/views/schedule-calendar-task.client.view.html',\r\n         controller: 'ScheduleCalendarTaskController as ctrl',\r\n         size: 'lg',\r\n         resolve: {\r\n           data: function () {\r\n             return { events: events, date: date, days: days };\r\n           }\r\n         }\r\n       }).result.then(function(result) {\r\n         console.log('closed - require refresh: ', result);\r\n       });\r\n     }\r\n\r\n    return {\r\n         restrict: 'A',\r\n         templateUrl: 'modules/tasks/templates/schedule-calendar.html',\r\n         scope: {\r\n           events: '='\r\n         },\r\n         link: function(scope) {\r\n             scope.days = [{ text: 'Mon' }, { text: 'Tue' }, { text: 'Wed' }, { text: 'Thu' }, { text: 'Fri' }, { text: 'Sat' }, { text: 'Sun' }];\r\n             scope.selected = moment(new Date());\r\n             scope.month = moment(scope.selected);\r\n\r\n             var start = moment(_removeTime(angular.copy(scope.selected)));\r\n             start.date(-6);\r\n             _removeTime(start.day(0));\r\n\r\n             _buildMonth(scope, start, scope.month);\r\n\r\n             scope.select = function(day) {\r\n               if(scope.selected === day.date){\r\n                 _displayEvents(scope.events, day.date, scope.days);\r\n               }\r\n               scope.selected = day.date;\r\n             };\r\n\r\n             scope.next = function() {\r\n                 var next = moment(scope.month);\r\n                 _removeTime(next.month(next.month()+1).date(0));\r\n                 scope.month.month(scope.month.month()+1);\r\n                 _buildMonth(scope, next, scope.month);\r\n             };\r\n\r\n             scope.previous = function() {\r\n                 var previous = moment(scope.month);\r\n                 _removeTime(previous.month(previous.month()-1).date(0));\r\n                 scope.month.month(scope.month.month()-1);\r\n                 _buildMonth(scope, previous, scope.month);\r\n             };\r\n         }\r\n     };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('shadowModel', shadowModel);\r\n\r\n   function shadowModel() {\r\n    return {\r\n      scope: true,\r\n      link: function(scope, el, att) {\r\n        console.log('shadow: ', scope);\r\n        scope[att.shadow] = angular.copy(scope[att.shadow]);\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('taskItemModel', taskItemModel);\r\n\r\n  function taskItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/tasks/templates/task-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('passClick', passClick);\r\n\r\n  function passClick() {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        element.bind('click', function(event) {\r\n          var passTo = document.getElementById(attrs.passClick);\r\n          passTo.focus();\r\n          passTo.click();\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('tasks').factory('TaskFactory', TaskFactory);\r\n  TaskFactory.$inject = ['$q', 'Animeitems', 'Mangaitems', 'AnimeFactory', 'MangaFactory', 'NotificationFactory', 'ListService', '$uibModal'];\r\n\r\n    function TaskFactory($q, Animeitems, Mangaitems, AnimeFactory, MangaFactory, NotificationFactory, ListService, $uibModal) {\r\n      var obj = {\r\n        getWeekBeginning: getWeekBeginning,\r\n        insertChecklistItem: insertChecklistItem,\r\n        removeTask: removeTask,\r\n        updateAnimeitem: updateAnimeitem,\r\n        updateMangaitem: updateMangaitem,\r\n        updateTask: updateTask,\r\n        tickOff: tickOff,\r\n        tickOffChecklist: tickOffChecklist,\r\n      };\r\n      return obj;\r\n\r\n          function getWeekBeginning() {\r\n              var newDate = new Date(),\r\n                  day = newDate.getDay(),\r\n                  diff = newDate.getDate() - day + (day === 0 ? -6:1); // adjust when day is sunday\r\n              var wkBeg = new Date();\r\n              return new Date(wkBeg.setDate(diff));\r\n          }\r\n\r\n          function updateAnimeitem(task, episodeRating) {\r\n            return $q(function(resolve, reject) {\r\n              var query = Animeitems.get({\r\n  \t\t\t\t\t\t\tanimeitemId: task.link.anime._id\r\n  \t\t\t\t\t\t});\r\n              query.$promise.then(function(data) {\r\n                  console.log('update animeitem for ', task, data);\r\n                  data.episodes += 1;\r\n                  data.rating = task.link.anime.rating || data.rating;\r\n                  data.latest = new Date();\r\n                  AnimeFactory.update(data, undefined, true, undefined, episodeRating);\r\n                  resolve(data);\r\n              });\r\n            });\r\n          }\r\n\r\n          function updateMangaitem(task, chapters, volumes) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n              var query = Mangaitems.get({\r\n  \t\t\t\t\t\t\tmangaitemId: task.link.manga._id\r\n  \t\t\t\t\t\t});\r\n              query.$promise.then(function(data) {\r\n                  //console.log(data);\r\n                  data.chapters = chapters;\r\n                  data.volumes = volumes;\r\n                  data.latest = new Date();\r\n                  MangaFactory.update(data, undefined, true, undefined);\r\n  \t\t\t\t\t\t\t\tresolve(data);\r\n              });\r\n  \t\t\t\t\t});\r\n          }\r\n\r\n  \t\t\t\t/** Task Update,Edit,Delete and other functions below here.\r\n  \t\t\t\t */\r\n\r\n  \t\t\t // Update existing Task\r\n  \t\t\t function updateTask(task, refresh) {\r\n  \t\t\t\t return $q(function(resolve, reject) {\r\n  \t\t\t\t\t //console.log('update');\r\n  \t\t\t\t\t if (task.link.anime) {\r\n  \t\t\t\t\t\t task.link.anime = task.link.anime._id;\r\n  \t\t\t\t\t } else if (task.link.manga) {\r\n  \t\t\t\t\t\t task.link.manga = task.link.manga._id;\r\n  \t\t\t\t\t }\r\n\r\n  \t\t\t\t\t\ttask.$update(function() {\r\n  \t\t\t\t\t\t\tNotificationFactory.success('Saved!', 'Task was successfully updated!');\r\n  \t\t\t\t\t\t  //Refresh items if the callee wasn't checkStatus.\r\n  \t\t\t\t\t\t  console.log('update, refresh items ? ', refresh);\r\n  \t\t\t\t\t\t  resolve({ refresh: refresh });\r\n  \t\t\t\t\t\t}, function(errorResponse) {\r\n  \t\t\t\t\t\t\tvar errorMessage = errorResponse.data.message;\r\n  \t\t\t\t\t\t\treject(errorMessage);\r\n  \t\t\t\t\t\t  //console.log(errorResponse);\r\n  \t\t\t\t\t\t  NotificationFactory.error('Error!', 'Task failed to save!');\r\n  \t\t\t\t\t\t});\r\n  \t\t\t\t\t});\r\n  \t\t\t }\r\n\r\n  \t\t\t //Remove a task.\r\n  \t\t\t\tfunction removeTask(task, tasks, userCheck) {\r\n  \t\t\t\t\tif(userCheck) {\r\n  \t\t\t\t\t\t//console.log('launch');\r\n  \t\t\t\t\t\tNotificationFactory.confirmation(function remove() {\r\n  \t\t          removeTaskProcess(task, tasks);\r\n  \t\t\t\t\t\t});\r\n  \t\t\t\t\t} else {\r\n  \t\t\t\t\t\tremoveTaskProcess(task, tasks);\r\n  \t\t\t\t\t}\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\tfunction removeTaskProcess(task, tasks) {\r\n  \t\t\t\t\tif ( task ) {\r\n  \t\t\t\t\t\t\ttask.$remove();\r\n  \t\t\t\t\t\t\tfor (var i in tasks) {\r\n  \t\t\t\t\t\t\t\t\tif (tasks[i] === task) {\r\n  \t\t\t\t\t\t\t\t\t\t\ttasks.splice(i, 1);\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\tNotificationFactory.warning('Deleted!', 'Task was successfully deleted.');\r\n  \t\t\t\t\t}\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Linked manga need special options dialog.\r\n  \t\t\t\tfunction launchMangaUpdateDialog(task, checklistIndex) {\r\n  \t\t\t\t\tvar modalInstance = $uibModal.open({\r\n  \t\t\t\t\t\tanimation: true,\r\n  \t\t      \ttemplateUrl: '/modules/tasks/views/update-manga-task.client.view.html',\r\n  \t\t      \tcontroller: 'UpdateMangaTaskController as ctrl',\r\n  \t\t      \tsize: 'md',\r\n  \t\t      \tresolve: {\r\n  \t\t        \tdata: function () {\r\n  \t\t          \treturn { item: angular.copy(task), itemOriginal: task };\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t\treturn modalInstance;\r\n  \t\t\t\t}\r\n\r\n          //Linked anime need special options dialog.\r\n  \t\t\t\tfunction launchAnimeUpdateDialog(task, checklistIndex) {\r\n  \t\t\t\t\tvar modalInstance = $uibModal.open({\r\n  \t\t\t\t\t\tanimation: true,\r\n  \t\t      \ttemplateUrl: '/modules/tasks/views/update-anime-task.client.view.html',\r\n  \t\t      \tcontroller: 'UpdateAnimeTaskController as ctrl',\r\n  \t\t      \tsize: 'md',\r\n  \t\t      \tresolve: {\r\n  \t\t        \tdata: function () {\r\n  \t\t          \treturn { item: angular.copy(task), itemOriginal: task };\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t\treturn modalInstance;\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Completes a task.\r\n  \t\t\t\tfunction tickOff(task) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n  \t\t\t\t\t\tvar isLinked = task.link.linked;\r\n  \t\t\t\t    //Is it linked?\r\n  \t\t\t\t    if (!isLinked) {\r\n  \t\t\t\t        task.completeTimes += 1;\r\n  \t\t\t\t    } else if (isLinked) {\r\n  \t\t\t\t        /** Anime or manga?\r\n  \t\t\t\t         *   Update the item value AND the complete/repeat values.\r\n  \t\t\t\t         */\r\n  \t\t\t\t        if (task.link.type === 'anime') {\r\n                    task.complete = false;\r\n                      var animeDialog = launchAnimeUpdateDialog(task);\r\n                      animeDialog.result.then(function(result) {\r\n                        console.log('update anime task result: ', result);\r\n                        task = result.task;\r\n                        task.completeTimes = task.link.anime.episodes + 1;\r\n                        task.complete = true;\r\n                        task.repeat = task.link.anime.finalEpisode;\r\n                        obj.updateAnimeitem(task, result.episodeRating).then(function(result) {\r\n                          return obj.updateTask(task, true);\r\n                        }).then(function(result) {\r\n                          console.log('update anime into update task: ', result);\r\n                          resolve(result);\r\n                        });\r\n                      });\r\n  \t\t\t\t        } else if (task.link.type === 'manga') {\r\n  \t\t\t\t\t\t\t\t\t  task.complete = false;\r\n  \t\t\t\t            var dialog = launchMangaUpdateDialog(task);\r\n  \t\t\t\t\t\t\t\t\t\tdialog.result.then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\ttask = result;\r\n  \t\t\t\t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t\t\t\t\t\t\t\t\ttask.complete = true;\r\n  \t\t\t\t\t\t\t\t\t\t\tobj.updateMangaitem(task, task.link.manga.chapters, task.link.manga.volumes).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\t\tconsole.log('updated manga: ', result);\r\n  \t\t\t\t\t\t\t\t\t\t\t\treturn obj.updateTask(task, true);\r\n  \t\t\t\t\t\t\t\t\t\t\t}).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\t\tconsole.log('update manga into update task: ', result);\r\n  \t\t\t\t\t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t        }\r\n  \t\t\t\t    }\r\n  \t\t\t\t\t\tif(!isLinked) {\r\n  \t\t\t\t\t    obj.updateTask(task, isLinked).then(function(result) {\r\n  \t\t\t\t\t\t\t\tconsole.log('update task resolve: ', result);\r\n  \t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Completes a checklist item.\r\n  \t\t\t\tfunction tickOffChecklist(task, index) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n  \t\t\t\t\t\t//update the option for the task.\r\n  \t\t\t\t\t\tvar isLinked = task.link.linked;\r\n  \t\t\t\t\t\tif (isLinked && task.link.type === 'manga') {\r\n  \t\t\t\t\t\t\t\ttask.checklistItems[index].complete = false;\r\n  \t\t\t\t\t\t\t\tvar dialog = launchMangaUpdateDialog(task, index);\r\n  \t\t\t\t\t\t\t\tdialog.result.then(function(result) {\r\n  \t\t\t\t\t\t\t\t\ttask = result;\r\n  \t\t\t\t\t\t\t\t\ttask.checklistItems[index].complete = true;\r\n  \t\t\t\t\t\t\t\t\tif(ListService.findWithAttr(task.checklistItems, 'complete', false) === -1) {\r\n  \t\t\t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t              task.complete = true;\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t\t\tobj.updateMangaitem(task, task.link.manga.chapters, task.link.manga.volumes).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\tconsole.log('updated manga: ', result);\r\n  \t\t\t\t\t\t\t\t\t\treturn obj.updateTask(task, true);\r\n  \t\t\t\t\t\t\t\t\t}).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\tconsole.log('update manga into update task: ', result);\r\n  \t\t\t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t} else if(!isLinked) {\r\n  \t\t\t\t\t\t\tif(ListService.findWithAttr(task.checklistItems, 'complete', false) === -1) {\r\n  \t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t\t\t\t\t\ttask.complete = true;\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t//console.log('tickoff checklist: ', task);\r\n  \t\t\t\t\t    obj.updateTask(task, isLinked).then(function(result) {\r\n  \t\t\t\t\t\t\t\tconsole.log('update task resolve: ', result);\r\n  \t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Add additional items to a checklist.\r\n  \t\t\t\tfunction insertChecklistItem(task, newChecklistItem) {\r\n  \t\t\t\t\tif (newChecklistItem!=='' && newChecklistItem!==undefined) {\r\n  \t\t\t\t\t\t\tvar alreadyAdded = false;\r\n  \t\t\t\t\t\t\t//find the item and insert the option.\r\n  \t\t\t\t\t\t\tangular.forEach(task.checklistItems, function (item) {\r\n  \t\t\t\t\t\t\t\t\tif (item === newChecklistItem) {\r\n  \t\t\t\t\t\t\t\t\t\t\talreadyAdded = true;\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t});\r\n\r\n  \t\t\t\t\t\t\t//if not in array add it.\r\n  \t\t\t\t\t\t\tif (alreadyAdded === false) {\r\n  \t\t\t\t\t\t\t\t\ttask.checklistItems.push({ text: newChecklistItem, complete: false });\r\n  \t\t\t\t\t\t\t} else if (alreadyAdded === true) {\r\n  \t\t\t\t\t\t\t\t\tNotificationFactory.popup('Option already exists.', 'Please re-name and try again.', 'error');\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t}\r\n  \t\t\t\t\tobj.updateTask(task);\r\n  \t\t\t\t}\r\n\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\t//Tasks service used to communicate Tasks REST endpoints\r\n\tangular.module('tasks').factory('Tasks', Tasks);\r\n\tTasks.$inject = ['$resource'];\r\n\r\n\t\tfunction Tasks($resource) {\r\n\t\t\treturn $resource('tasks/:taskId', { taskId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n})();\r\n\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('toptens').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Toptens', 'toptens', 'dropdown', '/toptens(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'toptens', 'List Toptens', 'toptens');\r\n\t\tMenus.addSubMenuItem('topbar', 'toptens', 'New Topten', 'toptens/create');\r\n\t}\r\n]);\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('toptens').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Toptens state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listToptens', {\r\n\t\t\turl: '/toptens',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/list-toptens.client.view.html'\r\n\t\t}).\r\n\t\tstate('createTopten', {\r\n\t\t\turl: '/toptens/create',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/create-topten.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewTopten', {\r\n\t\t\turl: '/toptens/:toptenId',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/view-topten.client.view.html'\r\n\t\t}).\r\n\t\tstate('editTopten', {\r\n\t\t\turl: '/toptens/:toptenId/edit',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/create-topten.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\tangular.module('toptens').controller('CreateToptenController', CreateToptenController);\r\n\tCreateToptenController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Toptens', 'ListService', 'Animeitems', 'Mangaitems', 'Characters', 'NotificationFactory', 'CharacterService', 'ItemService', '$filter'];\r\n\r\n\tfunction CreateToptenController($scope, $stateParams, $location, Authentication, Toptens, ListService, Animeitems, Mangaitems, Characters, NotificationFactory, CharacterService, ItemService, $filter) {\r\n\t\tvar ctrl = this,\r\n\t\t\t\ttoptenCopy = {\r\n\t        name: '',\r\n\t        description: '',\r\n\t        type: '',\r\n\t        isFavourite: false,\r\n\t        isRanked: false,\r\n\t        animeList: [],\r\n\t        mangaList: [],\r\n\t        characterList: [],\r\n\t        conditions: {\r\n\t            limit: null,\r\n\t            series: [],\r\n\t            tags: [],\r\n\t\t\t\t\t\t\tseason: null,\r\n\t\t\t\t\t\t\tyear: null\r\n\t        }\r\n\t\t\t\t};\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.cancel = cancel;\r\n\t\tctrl.create = create;\r\n\t\tctrl.commonArrays = ListService.getCommonArrays();\r\n\t\tctrl.imgSize = {\r\n\t\t\t\theight: '50px',\r\n\t\t\t\twidth: '100px'\r\n\t\t};\r\n\t\tctrl.isCreate = true;\r\n\t\tctrl.pushCondition = pushCondition;\r\n\t\tctrl.pushItem = pushItem;\r\n\t\tctrl.removeCondition = removeCondition;\r\n\t\tctrl.removeItem = removeItem;\r\n    ctrl.stepConfig = {\r\n        steps: [1,2,3,4,5,6,7,8,9,10],\r\n        stepHeaders: [\r\n            { text: 'Select attributes' },\r\n            { text: 'Set conditions' },\r\n            { text: 'Populate list' }\r\n        ],\r\n        currentStep: 1,\r\n        stepCount: 3,\r\n        listGen: {\r\n            itemsCached: [],\r\n            items: [],\r\n            displayList: [],\r\n            seriesList: [],\r\n            typeDisplay: '',\r\n            toptenItem: '',\r\n            seriesLimit: '',\r\n            tagLimit: '',\r\n            series: [],\r\n            tags: []\r\n        },\r\n        limitMin: 0,\r\n\t\t\t\tswapping: {\r\n\t\t\t\t\tone: '',\r\n\t\t\t\t\ttwo: ''\r\n\t\t\t\t}\r\n    };\r\n\t\tctrl.swappingItems = swappingItems;\r\n\t\tctrl.takeStep = takeStep;\r\n    ctrl.topten = {};\r\n    angular.copy(toptenCopy, ctrl.topten);\r\n\t\tctrl.update = update;\r\n\t\tctrl.years = [];\r\n\t\t// Create new Topten\r\n\t\tfunction create() {\r\n            // console.log(ctrl.topten, ctrl.topten);\r\n\t\t\t// Create new Topten object\r\n\t\t\tvar topten = new Toptens();\r\n\t\t\ttopten = new Toptens ({\r\n\t\t\t\tname: ctrl.topten.name,\r\n                description: ctrl.topten.description,\r\n                type: ctrl.topten.type,\r\n                isFavourite: ctrl.topten.isFavourite,\r\n                isRanked: ctrl.topten.isRanked,\r\n                animeList: ctrl.topten.animeList.length > 0 ? ctrl.topten.animeList : null,\r\n                characterList: ctrl.topten.characterList.length > 0 ? ctrl.topten.characterList : null,\r\n                mangaList: ctrl.topten.mangaList.length > 0 ? ctrl.topten.mangaList : null,\r\n                conditions: {\r\n                    limit: ctrl.topten.conditions.limit,\r\n                    series: ctrl.topten.conditions.series,\r\n                    tags: ctrl.topten.conditions.tags,\r\n\t\t\t\t\t\t\t\t\t\tseason: ctrl.topten.conditions.season,\r\n\t\t\t\t\t\t\t\t\t\tyear: ctrl.topten.conditions.year,\r\n                }\r\n\t\t\t});\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\ttopten.$save(function(response) {\r\n\t\t\t\t$location.path('toptens/' + response._id);\r\n\t\t\t\tNotificationFactory.success('Saved!', 'New List was successfully saved!');\r\n\t\t\t\t// Clear form fields\r\n\t\t\t\tangular.copy(toptenCopy, ctrl.topten);\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n\t\t\t\tNotificationFactory.error('Error!', 'Something went wrong!');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Update existing Topten\r\n\t\tfunction update() {\r\n\t\t\tvar topten = ctrl.topten;\r\n\r\n\t\t\ttopten.$update(function() {\r\n\t\t\t\t$location.path('toptens/' + topten._id);\r\n                NotificationFactory.success('Updated!', 'List update was successful!');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Something went wrong!');\r\n\t\t\t});\r\n\t\t}\r\n\r\n    function typeSetItemPopulate() {\r\n        var type = ListService.manipulateString(ctrl.topten.type, 'upper', true);\r\n        switch(type) {\r\n            case 'Anime':\r\n                Animeitems.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'title';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n\t\t\t\t\t\t\t\t\t\tctrl.years = ItemService.endingYears(result);\r\n                });\r\n                break;\r\n            case 'Manga':\r\n                Mangaitems.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'title';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n                });\r\n                break;\r\n            case 'Character':\r\n                Characters.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'name';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n                    ctrl.stepConfig.listGen.series = CharacterService.buildSeriesList(result);\r\n\t\t\t\t\t\t\t\t\t\tvar getYears = [];\r\n\t\t\t\t\t\t\t\t\t\tangular.forEach(result, function (item) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(item.anime) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tgetYears.push(item.anime);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tctrl.years = ItemService.endingYears(getYears);\r\n                });\r\n                break;\r\n        }\r\n        // console.log('type set: ', ctrl.stepConfig.listGen);\r\n\t\t\t}\r\n\r\n    //Processing on step submits.\r\n    function process(number, direction, callback) {\r\n        // console.log(number, direction);\r\n        switch(number) {\r\n            case 1:\r\n                if (ctrl.topten.type !== '' && ctrl.isCreate) {\r\n                    typeSetItemPopulate();\r\n                    callback();\r\n                } else if (ctrl.topten.type !== '' && !ctrl.isCreate) {\r\n                    if (ctrl.stepConfig.listGen.displayList.length < 1) {\r\n                        angular.forEach(ctrl.topten[ctrl.topten.type + 'List'], function(item) {\r\n                            var index = ListService.findWithAttr(ctrl.stepConfig.listGen.items, '_id', item._id);\r\n                            ctrl.stepConfig.listGen.displayList.push(ctrl.stepConfig.listGen.items[index]);\r\n                        });\r\n                        ctrl.stepConfig.limitMin = ctrl.stepConfig.listGen.displayList.length;\r\n                    }\r\n                    callback();\r\n                } else if (ctrl.topten.type === '') {\r\n                    NotificationFactory.popup('Invalid form', 'You MUST select a type to continue.', 'error');\r\n                }\r\n                break;\r\n\r\n            case 2:\r\n\t\t\t\t\t\t\t\tif(direction) {\r\n\t\t\t\t\t\t\t\t\tvar i = 0, j = 0, length;\r\n                  angular.copy(ctrl.stepConfig.listGen.items, ctrl.stepConfig.listGen.itemsCached);\r\n                  // console.log('pre conditions: ', ctrl.stepConfig.listGen.items.length, ctrl.stepConfig.listGen.itemsCached.length);\r\n\r\n\t\t\t\t\t\t\t\t\tif(ctrl.topten.type === 'anime') {\r\n\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.season) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('season')(ctrl.stepConfig.listGen.items, ctrl.topten.conditions.year, ctrl.topten.conditions.season);\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tNotificationFactory.popup('Invalid form', 'A year MUST be selected when selecting a season.', 'error');\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('filter')(ctrl.stepConfig.listGen.items, { season: { year: ctrl.topten.conditions.year } });\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else if(ctrl.topten.type === 'character') {\r\n\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.season) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('seasonForCharacterAnime')(ctrl.stepConfig.listGen.items, ctrl.topten.conditions.year, ctrl.topten.conditions.season);\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tNotificationFactory.popup('Invalid form', 'A year MUST be selected when selecting a season.', 'error');\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('filter')(ctrl.stepConfig.listGen.items, { anime: { season: { year: ctrl.topten.conditions.year } } });\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n                  if(ctrl.topten.conditions.series.length > 0) {\r\n                      i = ctrl.stepConfig.listGen.items.length;\r\n                      while(i--) {\r\n                          var remove = true,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tattr = (ctrl.stepConfig.listGen.items[i].anime !== null) ? 'anime' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t (ctrl.stepConfig.listGen.items[i].anime !== null) ? 'manga' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t null;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlength = ctrl.topten.conditions.series.length;\r\n\t\t\t\t\t\t\t\t\t\t\t\t//  console.log('tag while: ', i, length, attr);\r\n                          if(attr !== null) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag item: ', ctrl.stepConfig.listGen.items[i]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor(j = 0; j < length; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar series = ctrl.topten.conditions.series[j];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log(ctrl.stepConfig.listGen.items[i][attr].title, series.name, ctrl.stepConfig.listGen.items[i][attr].title.indexOf(series.name));\r\n                              if(ctrl.stepConfig.listGen.items[i][attr].title.indexOf(series.name) > -1) {\r\n                                  remove = false;\r\n                              }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                            if(remove) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('remove as remove: ' + remove);\r\n                                ctrl.stepConfig.listGen.items.splice(i, 1);\r\n                            }\r\n                          } else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('straight remove');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n                          }\r\n                      }\r\n                  }\r\n\r\n                  if(ctrl.topten.conditions.tags.length > 0) {\r\n                      i = ctrl.stepConfig.listGen.items.length;\r\n                      while(i--) {\r\n                          var count = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlength = ctrl.topten.conditions.tags.length;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag while: ', i, length);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(ctrl.stepConfig.listGen.items[i].tags.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag item: ', ctrl.stepConfig.listGen.items[i].tags);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor(j = 0; j < length; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar tag = ctrl.topten.conditions.tags[j];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag round: ' + i + '-' + j, ctrl.stepConfig.listGen.items[i].tags, tag.tag, ListService.findWithAttr(ctrl.stepConfig.listGen.items[i].tags, 'text', tag.tag));\r\n\t                                if(ListService.findWithAttr(ctrl.stepConfig.listGen.items[i].tags, 'text', tag.tag) > -1) {\r\n\t                                    count++;\r\n\t                                }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                            if(count !== length) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('remove as count: ' + count + ' > length: ' + length);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n                            }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('straight remove');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                      }\r\n                  }\r\n\t\t\t\t\t\t\t\t\t// console.log('post conditions: ', ctrl.stepConfig.listGen.items.length, ctrl.stepConfig.listGen.itemsCached.length);\r\n\t\t\t\t\t\t\t\t}\r\n                callback();\r\n                break;\r\n\r\n            case 3:\r\n                if(!direction) {\r\n                    ctrl.stepConfig.listGen.items = angular.copy(ctrl.stepConfig.listGen.itemsCached);\r\n                }\r\n                callback();\r\n                break;\r\n        }\r\n    }\r\n\r\n    function pushItem(item) {\r\n        if(ctrl.topten.conditions.limit === null || ctrl.topten.conditions.limit === 0 || ctrl.topten.conditions.limit > ctrl.stepConfig.listGen.displayList.length) {\r\n            var index = ctrl.topten[ctrl.topten.type+'List'].indexOf(item._id);\r\n            if (!ctrl.isCreate && index === -1) {\r\n                index = ListService.findWithAttr(ctrl.topten[ctrl.topten.type+'List'], '_id', item._id);\r\n            }\r\n            if (index === -1) {\r\n                ctrl.topten[ctrl.topten.type + 'List'].push(item._id);\r\n                ctrl.stepConfig.listGen.displayList.push(item);\r\n            } else {\r\n                NotificationFactory.warning('Duplicate!', 'Item has already been added to list.');\r\n            }\r\n        } else {\r\n            NotificationFactory.error('Full!', 'Item list has reached the defined capacity.');\r\n        }\r\n        ctrl.stepConfig.listGen.toptenItem = '';\r\n    }\r\n\r\n    function removeItem(item) {\r\n        //For display array.\r\n        var index = ctrl.stepConfig.listGen.displayList.indexOf(item);\r\n        ctrl.stepConfig.listGen.displayList.splice(index, 1);\r\n\r\n        //For topten list.\r\n        index = ctrl.topten[ctrl.topten.type + 'List'].indexOf(item._id);\r\n        if (!ctrl.isCreate && index === -1) {\r\n            index = ListService.findWithAttr(ctrl.topten[ctrl.topten.type+'List'], '_id', item._id);\r\n        }\r\n        ctrl.topten[ctrl.topten.type + 'List'].splice(index, 1);\r\n        NotificationFactory.warning('Removed!', 'Item has been removed from list.');\r\n    }\r\n\r\n    function pushCondition(type, item) {\r\n        var index, indexTwo;\r\n        switch(type) {\r\n            case 'series':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.series, 'name', item.name);\r\n                if(index === -1) {\r\n                    ctrl.topten.conditions.series.push(item);\r\n                } else {\r\n                    NotificationFactory.warning('Duplicate!', 'Series has already been added to list.');\r\n                }\r\n                ctrl.stepConfig.listGen.seriesLimit = '';\r\n                break;\r\n\r\n            case 'tag':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.tags, 'tag', item.tag);\r\n                if(index === -1) {\r\n                    ctrl.topten.conditions.tags.push(item);\r\n                } else {\r\n                    NotificationFactory.warning('Duplicate!', 'Tag has already been added to list.');\r\n                }\r\n                ctrl.stepConfig.listGen.tagLimit = '';\r\n                break;\r\n        }\r\n    }\r\n\r\n    function removeCondition(type, item) {\r\n        var index, indexTwo;\r\n        switch(type) {\r\n            case 'series':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.series, 'name', item.name);\r\n\t\t\t\t\t\t\t\tctrl.topten.conditions.series.splice(index, 1);\r\n                NotificationFactory.warning('Removed!', 'Series has been removed from list.');\r\n                break;\r\n\r\n            case 'tag':\r\n                index = ctrl.topten.conditions.tags.indexOf(item);\r\n                ctrl.topten.conditions.tags.splice(index, 1);\r\n                NotificationFactory.warning('Removed!', 'Tag has been removed from list.');\r\n                break;\r\n        }\r\n    }\r\n\r\n    //Step related functions:\r\n    function takeStep(number, direction) {\r\n        process(number, direction, function() {\r\n            ctrl.stepConfig.currentStep = (direction) ? number + 1 : number - 1;\r\n        });\r\n        // console.log('step: ', ctrl.stepConfig, ctrl.topten);\r\n    }\r\n    function cancel() {\r\n        $location.path('toptens');\r\n    }\r\n\r\n    function inital() {\r\n        // console.log('state params: ', $stateParams);\r\n        if ($stateParams.toptenId !== undefined) {\r\n            ctrl.isCreate = false;\r\n            Toptens.get({ toptenId: $stateParams.toptenId }).$promise.then(function(result) {\r\n                ctrl.topten = result;\r\n\t\t\t\t\t\t\t\t// console.log('topten: ', result);\r\n                typeSetItemPopulate();\r\n            });\r\n        }\r\n    }\r\n    inital();\r\n\r\n\t\tfunction swappingItems(index) {\r\n\t\t\t// console.log('item selected: ', index);\r\n\t\t\tif(ctrl.stepConfig.swapping.one === '') {\r\n\t\t\t\tctrl.stepConfig.swapping.one = index;\r\n\t\t\t} else if(ctrl.stepConfig.swapping.one === index) {\r\n\t\t\t\tctrl.stepConfig.swapping.one = '';\r\n\t\t\t} else {\r\n\t\t\t\tctrl.stepConfig.swapping.two = index;\r\n\t\t\t\t//Re-order display list.\r\n\t\t\t\tvar temp = ctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.one];\r\n\t\t\t\tctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.one] = ctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.two];\r\n\t\t\t\tctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.two] = temp;\r\n\t\t\t\t//Re-order topten item list.\r\n\t\t\t\ttemp = ctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.one];\r\n\t\t\t\tctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.one] = ctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.two];\r\n\t\t\t\tctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.two] = temp;\r\n\t\t\t\t//Clear.\r\n\t\t\t\tctrl.stepConfig.swapping.one = '';\r\n\t\t\t\tctrl.stepConfig.swapping.two = '';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens').controller('StatisticsTopten', StatisticsTopten);\r\n  StatisticsTopten.$inject = ['$scope','$uibModalInstance','list', 'CharacterService'];\r\n\r\n   function StatisticsTopten($scope, $uibModalInstance, list, CharacterService) {\r\n     var ctrl = this;\r\n\r\n     ctrl.cancel = cancel;\r\n     ctrl.list = list;\r\n     ctrl.toptenInfo = {\r\n       tags: [],\r\n       series: []\r\n     };\r\n\r\n     function process() {\r\n       var listType = ctrl.list.type + 'List';\r\n       ctrl.toptenInfo.tags = CharacterService.buildCharacterTags(ctrl.list[listType]);\r\n       if(ctrl.list.type === 'character') {\r\n         ctrl.toptenInfo.series = CharacterService.buildSeriesList(ctrl.list[listType]);\r\n       }\r\n     }\r\n     process();\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\tangular.module('toptens').controller('ToptensController', ToptensController);\r\n\tToptensController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', '$uibModal', 'Toptens', 'NotificationFactory', 'ListService', 'spinnerService'];\r\n\r\n\tfunction ToptensController($scope, $stateParams, $location, Authentication, $uibModal, Toptens, NotificationFactory, ListService, spinnerService) {\r\n\t\tvar ctrl = this;\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.filterConfig = {\r\n\t\t\t\tshowingCount: 0,\r\n\t\t\t\texpandFilters: false,\r\n\t\t\t\tsortType: '',\r\n\t\t\t\tsortReverse: false,\r\n\t\t\t\tratingLevel: undefined,\r\n\t\t\t\tsearch: {},\r\n\t\t\t\tsearchTags: '',\r\n\t\t\t\ttagsForFilter: [],\r\n\t\t\t\ttaglessItem: false,\r\n\t\t\t\tareTagless: false,\r\n\t\t\t\tselectListOptions: {},\r\n\t\t\t\tcommonArrays: ListService.getCommonArrays()\r\n\t\t};\r\n\t\tctrl.find = find;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.openListStats = openListStats;\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.viewConfig = {\r\n        displayType: '',\r\n        linkSuffix: '',\r\n\t\t\t\ttags: [],\r\n\t\t\t\tseries: []\r\n    };\r\n    ctrl.whichController = 'topten';\r\n\r\n\t\t// Remove existing Topten\r\n\t\tfunction remove(topten) {\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( topten ) {\r\n\t            topten.$remove();\r\n\t            for (var i in ctrl.toptens) {\r\n\t                if (ctrl.toptens [i] === topten) {\r\n\t                    ctrl.toptens.splice(i, 1);\r\n\t                }\r\n\t            }\r\n\t        } else {\r\n\t            ctrl.topten.$remove(function() {\r\n\t                $location.path('toptens');\r\n\t            });\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Anime was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Find a list of Toptens\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t    spinnerService.loading('topten', Toptens.query().$promise.then(function(result) {\r\n\t        ctrl.toptens = result;\r\n\t    }));\r\n\t\t\tconsole.log(ctrl.toptens);\r\n\t\t}\r\n\r\n\t\t// Find existing Topten\r\n\t\tfunction findOne() {\r\n\t    Toptens.get({ toptenId: $stateParams.toptenId }).$promise.then(function(result) {\r\n\t        ctrl.topten = result;\r\n\t        ctrl.viewConfig.displayType = (ctrl.topten.type === 'character') ? 'name' : 'title';\r\n\t        ctrl.viewConfig.linkSuffix = (ctrl.topten.type === 'character') ? 's' : 'items';\r\n\t    });\r\n\t\t}\r\n\r\n\t\tfunction openListStats() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n\t\t\t\tanimation: true,\r\n      \ttemplateUrl: '/modules/toptens/views/statistics-topten.client.view.html',\r\n      \tcontroller: 'StatisticsTopten as ctrl',\r\n      \tsize: 'lg',\r\n      \tresolve: {\r\n        \tlist: function () {\r\n          \treturn ctrl.topten;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('horizontalListItem', horizontalListItem);\r\n\r\n   function horizontalListItem() {\r\n      return {\r\n          restrict: 'A',\r\n          replace: true,\r\n          transclude: true,\r\n          scope: {},\r\n          templateUrl: '/modules/toptens/templates/horizontal-list-item.html',\r\n          require: '^horizontalList',\r\n          link: function(scope, element, attr, horizontalListCtrl) {\r\n              scope.isVisible = false;\r\n              scope.itemWidth = horizontalListCtrl.itemWidth;\r\n              scope.position = element.index();\r\n              horizontalListCtrl.register(scope);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('horizontalList', horizontalList);\r\n\r\n   function horizontalList() {\r\n      return {\r\n          restrict: 'A',\r\n          transclude: true,\r\n          require: 'horizontalList',\r\n          scope: {},\r\n          templateUrl: '/modules/toptens/templates/horizontal-list.html',\r\n          bindToController: true,\r\n          controllerAs: 'horizontalList',\r\n          controller: function($scope) {\r\n              var self = this;\r\n              self.clicks = 0;\r\n              self.items = [];\r\n              self.moveItems = moveItems;\r\n              self.register = register;\r\n              self.shift = 0;\r\n\r\n              function register(item) {\r\n                  self.items.push(item);\r\n                  if([0, 1, 2].indexOf(item.position) > -1) {\r\n                      item.isVisible = true;\r\n                  }\r\n              }\r\n\r\n              function setVisibility() {\r\n                  var values = [],\r\n                      check = self.clicks * 3;\r\n                  for(var i = 0; i < 3; i++) {\r\n                      values.push(check + i);\r\n                  }\r\n                  angular.forEach(self.items, function(item) {\r\n                      item.isVisible = (values.indexOf(item.position) > -1);\r\n                  });\r\n              }\r\n\r\n              function moveItems(direction) {\r\n                  if(direction === 'left') {\r\n                      if((self.clicks - 1) < 0) {\r\n                          self.clicks = 0;\r\n                      } else {\r\n                          self.clicks -= 1;\r\n                      }\r\n                      setVisibility();\r\n                  } else if (direction === 'right') {\r\n                      if ((self.clicks + 1) < Math.ceil(self.items.length / 3)) {\r\n                          self.clicks += 1;\r\n                      }\r\n                      setVisibility();\r\n                  }\r\n              }\r\n\r\n          },\r\n          link: function(scope, element, attr, ctrl) {\r\n              var el = element[0],\r\n                  child = el.children[0];\r\n              scope.settings = {\r\n                  child: child,\r\n                  style: child.style,\r\n                  value: 0\r\n              };\r\n\r\n              function listSettings() {\r\n                  ctrl.shift = -el.offsetWidth;\r\n                  ctrl.itemWidth = el.offsetWidth / 3;\r\n                  angular.forEach(ctrl.items, function(item) {\r\n                      item.itemWidth = ctrl.itemWidth;\r\n                  });\r\n              }\r\n              listSettings();\r\n\r\n              window.addEventListener('resize', function(e) {\r\n                  if(el.offsetWidth !== Math.abs(ctrl.shift)) {\r\n                      listSettings();\r\n                      scope.$apply();\r\n                  }\r\n              });\r\n\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('ngMax', ngMax);\r\n\r\n  function ngMax() {\r\n      return {\r\n          restrict: 'A',\r\n          require: 'ngModel',\r\n          link: function(scope, elem, attr, ctrl) {\r\n\r\n              scope.$watch(attr.ngMax, function(){\r\n                  if (ctrl.$isDirty) ctrl.$setViewValue(ctrl.$viewValue);\r\n              });\r\n\r\n              var isEmpty = function(value) {\r\n                 return angular.isUndefined(value) || value === '' || value === null;\r\n              };\r\n\r\n              var maxValidator = function(value) {\r\n                var max = scope.$eval(attr.ngMax) || Infinity;\r\n                if (!isEmpty(value) && value > max) {\r\n                  ctrl.$setValidity('ngMax', false);\r\n                  return undefined;\r\n                } else {\r\n                  ctrl.$setValidity('ngMax', true);\r\n                  return value;\r\n                }\r\n              };\r\n\r\n              ctrl.$parsers.push(maxValidator);\r\n              ctrl.$formatters.push(maxValidator);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('ngMin', ngMin);\r\n\r\n  function ngMin() {\r\n      return {\r\n          restrict: 'A',\r\n          require: 'ngModel',\r\n          link: function(scope, elem, attr, ctrl) {\r\n              scope.$watch(attr.ngMin, function(){\r\n                  if (ctrl.$isDirty) ctrl.$setViewValue(ctrl.$viewValue);\r\n              });\r\n\r\n              var isEmpty = function(value) {\r\n                 return angular.isUndefined(value) || value === '' || value === null;\r\n              };\r\n\r\n              var minValidator = function(value) {\r\n                var min = scope.$eval(attr.ngMin) || 0;\r\n                if (!isEmpty(value) && value < min) {\r\n                  ctrl.$setValidity('ngMin', false);\r\n                  return undefined;\r\n                } else {\r\n                  ctrl.$setValidity('ngMin', true);\r\n                  return value;\r\n                }\r\n              };\r\n\r\n              ctrl.$parsers.push(minValidator);\r\n              ctrl.$formatters.push(minValidator);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('oneStep', oneStep);\r\n\r\n  function oneStep() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        transclude: true,\r\n        scope: {},\r\n        require: '^steps',\r\n        templateUrl: '/modules/toptens/templates/step.html',\r\n        link: function(scope, elm, attrs, stepsController) {\r\n            scope.active = false;\r\n            scope.stepNumber = elm.index() + 1;\r\n            stepsController.register(scope);\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('stepControls', stepControls);\r\n    function stepControls() {\r\n       return {\r\n           restrict: 'A',\r\n           replace: true,\r\n           transclude: true,\r\n           template: '<div class=\"step-controls step-button-group padding-5\" ng-transclude>' +\r\n                      '</div>'\r\n       };\r\n    }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('steps', steps);\r\n  function steps() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        scope: {\r\n            stepConfig: '='\r\n        },\r\n        template: '<div class=\"steps\" ng-transclude>' +\r\n                  '</div>',\r\n        bindToController: true,\r\n        controllerAs: 'steps',\r\n        controller: function($scope) {\r\n            var self = this;\r\n\r\n            self.register = register;\r\n            self.steps = [];\r\n\r\n            function register(step) {\r\n                self.steps.push(step);\r\n                if(step.stepNumber === 1) {\r\n                    step.active = true;\r\n                }\r\n            }\r\n        },\r\n        link: function(scope, element, attrs, stepsController) {\r\n          scope.$watch('steps.stepConfig.currentStep', function(newValue) {\r\n              if (newValue !== undefined) {\r\n                console.log('steps: ', newValue);\r\n                  angular.forEach(stepsController.steps, function(step) {\r\n                      if(step.stepNumber !== newValue) {\r\n                          step.active = false;\r\n                      } else {\r\n                          step.active = true;\r\n                      }\r\n                  });\r\n              }\r\n          });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('sticky', sticky);\r\n\r\n  function sticky() {\r\n      return {\r\n          restrict: 'A',\r\n          scope: {},\r\n          link: function(scope, element, attrs) {\r\n\r\n              window.addEventListener('scroll', function (evt) {\r\n                  var stickyClass = 'sticky-scroll-top',\r\n                      stickyInnerClass = 'sticky-inner-container',\r\n                      scrollTop = document.body.scrollTop,\r\n                      elm = element[0],\r\n                      inner = elm.children[0],\r\n                      viewportOffset = elm.getBoundingClientRect(),\r\n                      distance_from_top = viewportOffset.top; // This value is your scroll distance from the top\r\n\r\n                  // The element has scrolled to the top of the page. Set appropriate style.\r\n                  if (distance_from_top < 56) {\r\n  //                    console.log('top hit : ', distance_from_top);\r\n                      elm.classList.add(stickyClass);\r\n                      inner.classList.add(stickyInnerClass);\r\n                  }\r\n\r\n                  // The element has not reached the top.\r\n                  if(distance_from_top > 55 || scrollTop < 10) {\r\n  //                    console.log('we are at: ', distance_from_top);\r\n                      elm.classList.remove(stickyClass);\r\n                      inner.classList.remove(stickyInnerClass);\r\n                  }\r\n            });\r\n\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .filter('toptenFilter', toptenFilter);\r\n\r\n  function toptenFilter() {\r\n    return function(array, displayType, value) {\r\n        if(array !== undefined) {\r\n            return array.filter(function(item) {\r\n                if(item[displayType].toLowerCase().indexOf(value.toLowerCase()) > -1) {\r\n                    return item;\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\t//Toptens service used to communicate Toptens REST endpoints\r\n\tangular.module('toptens').factory('Toptens', ToptensFactory);\r\n\tToptensFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction ToptensFactory($resource) {\r\n\t\t\treturn $resource('toptens/:toptenId', { toptenId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n})();\r\n\n'use strict';\r\n\r\n// Config HTTP Error Handling\r\nangular.module('users').config(['$httpProvider',\r\n\tfunction($httpProvider) {\r\n\t\t// Set the httpProvider \"not authorized\" interceptor\r\n\t\t$httpProvider.interceptors.push(['$q', '$location', 'Authentication',\r\n\t\t\tfunction($q, $location, Authentication) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tresponseError: function(rejection) {\r\n\t\t\t\t\t\tswitch (rejection.status) {\r\n\t\t\t\t\t\t\tcase 401:\r\n\t\t\t\t\t\t\t\t// Deauthenticate the global user\r\n\t\t\t\t\t\t\t\tAuthentication.user = null;\r\n\r\n\t\t\t\t\t\t\t\t// Redirect to signin page\r\n\t\t\t\t\t\t\t\t$location.path('signin');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 403:\r\n\t\t\t\t\t\t\t\t// Add unauthorized behaviour \r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn $q.reject(rejection);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t]);\r\n\t}\r\n]);\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('users').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Users state routing\r\n\t\t$stateProvider.\r\n\t\tstate('profile', {\r\n\t\t\turl: '/settings/profile',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/edit-profile.client.view.html'\r\n\t\t}).\r\n\t\tstate('password', {\r\n\t\t\turl: '/settings/password',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/change-password.client.view.html'\r\n\t\t}).\r\n\t\tstate('accounts', {\r\n\t\t\turl: '/settings/accounts',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/social-accounts.client.view.html'\r\n\t\t}).\r\n//\t\tstate('signup', {\r\n//\t\t\turl: '/signup',\r\n//\t\t\ttemplateUrl: 'modules/users/views/authentication/signup.client.view.html'\r\n//\t\t}).\r\n\t\tstate('signin', {\r\n\t\t\turl: '/signin',\r\n\t\t\ttemplateUrl: 'modules/users/views/authentication/signin.client.view.html'\r\n\t\t}).\r\n\t\tstate('forgot', {\r\n\t\t\turl: '/password/forgot',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/forgot-password.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset-invalid', {\r\n\t\t\turl: '/password/reset/invalid',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password-invalid.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset-success', {\r\n\t\t\turl: '/password/reset/success',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password-success.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset', {\r\n\t\t\turl: '/password/reset/:token',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\tangular.module('users').controller('AuthenticationController', AuthenticationController);\r\n\tAuthenticationController.$inject = ['$scope', '$http', '$location', 'Authentication'];\r\n\r\n\tfunction AuthenticationController($scope, $http, $location, Authentication) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.signin = signin;\r\n\t\tctrl.signup = signup;\r\n\r\n\t\tfunction signup() {\r\n\t\t\t$http.post('/auth/signup', ctrl.credentials).success(function(response) {\r\n\t\t\t\t// If successful we assign the response to the global user model\r\n\t\t\t\tctrl.authentication.user = response;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/signin');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\tctrl.error = response.message;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction signin() {\r\n\t\t\tctrl.credentials.username = 'username';\r\n\t\t\t$http.post('/auth/signin', ctrl.credentials).success(function(response) {\r\n\t\t\t\t// If successful we assign the response to the global user model\r\n\t\t\t\tctrl.authentication.user = response;\r\n\t\t\t\tctrl.loginBody = true;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/tasks');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\tctrl.error = response.message;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\n'use strict';\r\n\r\nangular.module('users').controller('PasswordController', ['$scope', '$stateParams', '$http', '$location', 'Authentication',\r\n\tfunction($scope, $stateParams, $http, $location, Authentication) {\r\n\t\t$scope.authentication = Authentication;\r\n\r\n\t\t//If user is signed in then redirect back home\r\n\t\tif ($scope.authentication.user) $location.path('/');\r\n\r\n\t\t// Submit forgotten password account id\r\n\t\t$scope.askForPasswordReset = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/auth/forgot', $scope.credentials).success(function(response) {\r\n\t\t\t\t// Show user success message and clear form\r\n\t\t\t\t$scope.credentials = null;\r\n\t\t\t\t$scope.success = response.message;\r\n\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t// Show user error message and clear form\r\n\t\t\t\t$scope.credentials = null;\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Change user password\r\n\t\t$scope.resetUserPassword = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/auth/reset/' + $stateParams.token, $scope.passwordDetails).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.passwordDetails = null;\r\n\r\n\t\t\t\t// Attach user profile\r\n\t\t\t\tAuthentication.user = response;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/password/reset/success');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n]);\n'use strict';\r\n\r\nangular.module('users').controller('SettingsController', ['$scope', '$http', '$location', 'Users', 'Authentication',\r\n\tfunction($scope, $http, $location, Users, Authentication) {\r\n\t\t$scope.user = Authentication.user;\r\n\r\n\t\t// If user is not signed in then redirect back home\r\n\t\tif (!$scope.user) $location.path('/');\r\n\r\n\t\t// Check if there are additional accounts \r\n\t\t$scope.hasConnectedAdditionalSocialAccounts = function(provider) {\r\n\t\t\tfor (var i in $scope.user.additionalProvidersData) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Check if provider is already in use with current user\r\n\t\t$scope.isConnectedSocialAccount = function(provider) {\r\n\t\t\treturn $scope.user.provider === provider || ($scope.user.additionalProvidersData && $scope.user.additionalProvidersData[provider]);\r\n\t\t};\r\n\r\n\t\t// Remove a user social account\r\n\t\t$scope.removeUserSocialAccount = function(provider) {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.delete('/users/accounts', {\r\n\t\t\t\tparams: {\r\n\t\t\t\t\tprovider: provider\r\n\t\t\t\t}\r\n\t\t\t}).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.success = true;\r\n\t\t\t\t$scope.user = Authentication.user = response;\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Update a user profile\r\n\t\t$scope.updateUserProfile = function(isValid) {\r\n\t\t\tif (isValid) {\r\n\t\t\t\t$scope.success = $scope.error = null;\r\n\t\t\t\tvar user = new Users($scope.user);\r\n\r\n\t\t\t\tuser.$update(function(response) {\r\n\t\t\t\t\t$scope.success = true;\r\n\t\t\t\t\tAuthentication.user = response;\r\n\t\t\t\t}, function(response) {\r\n\t\t\t\t\t$scope.error = response.data.message;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t$scope.submitted = true;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Change user password\r\n\t\t$scope.changeUserPassword = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/users/password', $scope.passwordDetails).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.success = true;\r\n\t\t\t\t$scope.passwordDetails = null;\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n]);\n(function() {\r\n\t'use strict';\r\n\t// Authentication service for user variables\r\n\tangular.module('users').factory('Authentication', AuthenticationFactory);\r\n\r\n\tfunction AuthenticationFactory() {\r\n\t\tvar _this = this;\r\n\r\n\t\t_this._data = {\r\n\t\t\tuser: window.user\r\n\t\t};\r\n\r\n\t\treturn _this._data;\r\n\t}\r\n\r\n})();\r\n\n(function() {\r\n\t'use strict';\r\n\t// Users service used for communicating with the users REST endpoint\r\n\tangular.module('users').factory('Users', UsersFactory);\r\n\tUsersFactory.$inject = ['$resource'];\r\n\r\n\tfunction UsersFactory($resource) {\r\n\t\treturn $resource('users', {}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n"]}