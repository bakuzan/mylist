{"version":3,"sources":["application.js"],"names":["ApplicationConfiguration","applicationModuleName","applicationModuleVendorDependencies","registerModule","moduleName","dependencies","angular","module","requires","push","config","$locationProvider","hashPrefix","run","$rootScope","$state","Authentication","$on","event","toState","name","user","_id","preventDefault","go","element","document","ready","window","location","hash","bootstrap","Menus","addMenuItem","addSubMenuItem","$stateProvider","state","url","templateUrl","controller","AnimeitemsController","$inject","$scope","$stateParams","$location","Animeitems","Mangaitems","fileUpload","$sce","$window","ItemService","ListService","NotificationFactory","AnimeFactory","spinnerService","TagService","$uibModal","ctrl","authentication","filterConfig","ongoingList","showingCount","expandFilters","sortType","sortReverse","ratingLevel","undefined","ratingActions","maxRating","percent","overStar","search","searchTags","tagsForFilter","taglessItem","areTagless","selectListOptions","statTags","commonArrays","getCommonArrays","getItemsAvailable","viewItem","findOne","latestDate","pageConfig","currentPage","pageSize","remove","tickOff","trustAsResourceUrl","update","usedTags","viewItemHistory","whichController","getSelectListOptions","animeitem","confirmation","$remove","i","animeitems","splice","path","warning","item","episodes","latest","Date","updated","modalInstance","open","animation","size","resolve","data","type","result","then","console","log","meta","get","animeitemId","$promise","getAnime","value","loading","query","status","checkForTagless","buildStatTags","onHold","CreateAnimeController","Enums","addedEpisodes","addTag","title","updateHistory","malSearchType","create","dropTag","finalNumbers","find","findManga","imgPath","itemUpdate","init","malSearchOptions","placeholder","required","autocomplete","disabled","removeTag","sections","showAdditional","showCompletion","showItemTags","selectMalEntry","setInSeason","submit","tagArray","tagArrayRemove","uploadFile","isCreate","start","malEntry","finalEpisode","image","season","malStatus","anime","ongoing","mal","id","newTag","text","tags","reWatching","end","year","substring","convertDateToSeason","disc","manga","$save","response","success","errorResponse","error","message","mangaitems","myFile","uploadFileToUrl","WatchAnimeController","$timeout","saved","localStorage","getItem","playVideo","startRewatch","videoFile","processed","file","number","watchedList","JSON","parse","updateWatchedList","setItem","stringify","$watch","nVal","oVal","video","files","findWithAttr","URL","createObjectURL","parseInt","length","WatchListController","WatchAnime","$filter","watchAnime","sortOptions","sortOption","v","directive","animeItemModel","restrict","replace","fileModel","$parse","link","scope","attrs","model","modelSetter","assign","bind","$apply","keycuts","postLink","e","altKey","keyCode","isList","view","listBack","css","listFilters","items","page","elem","passTag","tag","indexOf","split","hoveringOver","itemsAvailable","collapseFilters","swOnplay","el","addEventListener","pageControls","pageCount","Math","ceil","last","first","next","prev","ctrlKey","filter","endedMonth","array","month","substr","endedSeason","moment","num","startMonth","startYear","diff","weeks","pad","slice","ratingFilter","rating","seasonForCharacterAnime","startFrom","input","statisticsDetailFilter","division","filterPart","summaryYear","factory","episodeRating","concatenateTagArrays","itemHistory","itemRevisits","reWatchCount","$update","href","AnimeitemsFactory","$resource","method","service","$http","obj","uploadUrl","fd","FormData","append","post","transformRequest","identity","headers","err","popup","buildOverview","buildRatingsDistribution","completeByMonth","completeBySeason","deleteHistory","endingYears","getRatingValues","maxCompleteMonth","maxTagCount","ratingsWeighted","setSeason","date","getFullYear","getMonth","seasons","Number","history","latestHistory","chapters","reReading","now","temp","forEach","past","count","currentPart","finalPart","repeating","index","revisits","today","displayDate","toISOString","fromNow","format","overview","completed","modeMap","maxCount","tempRating","maxRatedCount","averageRating","values","averageItemRating","add","checkedRating","itemCount","len","ratedCount","ratings","ratingAdded","ratingAvg","ratingWeighted","weights","unratedCount","total","k","isNaN","possibleValues","ratingsDistribution","colour","percentage","toFixed","years","itemYears","monthDetails","completeByMonthItems","months","max","seasonDetails","completeBySeasonItems","maxCompleteSeason","$q","groupItemsByProperties","manipulateString","numberOfPages","stringReverse","weekEndingForDate","string","reverse","join","pagingDetails","attr","groupProperties","reject","groupedArrays","groupBy","getGroupProperties","groups","group","f","o","Object","keys","map","transform","onlyFirst","toLowerCase","charAt","toUpperCase","convertToSunday","day","getDay","getDate","wkEnd","setDate","endOf","n","searchName","media","mediaType","repeatType","itemTags","alreadyAdded","j","itemTypes","categories","days","summaryFunctions","CharactersController","Characters","CharacterService","seriesFilter","voiceActors","series","findAnime","findOneAnime","findOneManga","maxItemCount","mangaitem","character","voice","characters","buildCharacterTags","buildVoiceActors","buildSeriesList","characterId","mangaitemId","characterBack","clearTagValues","characterTags","deleteSearchTag","disableNgAnimate","$animate","enabled","deletingItem","$parent","enterTag","which","$eval","entry_type","slider","slides","interval","bindToController","controllerAs","self","timer","autoSlide","currentIndex","enter","goToSlide","isFullscreen","leave","repeater","toggleFullscreen","slide","filteredSlides","locked","cancel","visible","sliderController","childElementCount","mediaFilter","seriesDetailFilter","detailSeriesName","tagFilter","found","tagsToSearch","buildGenderDistribution","check","gender","buildRelatedCharacterTags","tagDetailCollection","tagDetailResult","bit","statSeries","CharacterFactory","HeaderController","changeTheme","isActive","isCollapsed","isTimedTheme","menu","getMenu","styles","theme","timedTheme","toggleCollapsibleMenu","viewLocation","timeOfDayTheme","time","getHours","storedValue","getElementById","lastIndexOf","anywhereButHere","$compile","showBackdrop","body","backdrop","appendChild","triggerAnywhereButHere","clickPass","stopPropagation","click","formatDate","require","modelCtrl","$formatters","modelValue","loadingSpinner","transclude","active","api","show","hide","toggle","_register","_unregister","malSearch","MalService","selectItem","searchString","options","timeoutPromise","delayInMs","displayActions","displaySelectedItemActions","hasFocus","hasSearchResults","processItem","searchResults","selectedItem","selectedItemActions","displayText","action","displayRawJson","toggleSearchDropdownOnFocus","searchMal","newValue","myProgress","val","html","calendarFilter","datesSelected","currentWkEnd","iDate","itemDate","currentDate","dateSuffix","suffixes","dtfilter","relevantDigits","suffix","dateArray","dayFilter","daySelected","ds","numberFixedLen","complete","FunctionService","width","padChar","Array","malService","params","isArray","xmlToJson","xml","ELEMENT_NODE_TYPE","TEXT_NODE_TYPE","nodeType","attributes","attribute","nodeName","nodeValue","hasChildNodes","childNodes","old","xmlProcessor","searchResult","responseXML","nodes","evaluate","XPathResult","ANY_TYPE","iterateNext","queryType","defaultRoles","menus","shouldRender","roles","userRoleIndex","roleIndex","isPublic","validateMenuExistance","menuId","Error","addMenu","removeMenu","menuItemTitle","menuItemURL","menuItemType","menuItemUIRoute","position","menuItemClass","uiRoute","rootMenuItemURL","itemIndex","removeMenuItem","removeSubMenuItem","submenuItemURL","subitemIndex","toastr","swal","thenDo","showCancelButton","closeOnConfirm","confirmButtonText","confirmButtonColor","SpinnerService","spinners","queue","loads","hasOwnProperty","optionsOrPromise","spinner","always","promise","extend","$urlRouterProvider","otherwise","HistoryController","AnimeHistory","MangaHistory","HistoryService","buildHistory","historyFilter","happenedWhen","historyGroups","buildHistoryList","animeHistory","mangaHistory","when","ViewHistoryController","$uibModalInstance","historyStore","close","dismiss","historySeparator","level","timeframe","startOf","filterItemHistory","extractHistory","getEndsOfWeek","getSetDaysAgo","groupItemHistory","weekBeginning","weekEnding","endsOfWeek","mondays","sundays","thisMonday","thisSunday","thisEnd","daysAgo","newDate","subtract","wkBeg","deferred","defer","sort","a","b","dateA","dateB","cutoff","prevItem","groupedHistory","oldest","thisDate","MangaitemsController","MangaFactory","volumes","finalChapter","finalVolume","hardcopy","mangaItemModel","reReadCount","MangaitemsFactory","CompleteOrdersController","order","newPrice","company","price","prototype","editOrder","nextVolume","prices","completeOrder","rrp","paid","controllerId","CreateOrdersController","Orders","isCreateMode","orderId","orderCopy","volume","orderHistory","stepConfig","stepHeaders","currentStep","stepCount","_this","copy","takeStep","step","direction","processOrder","openBoughtDialog","OrderHistoryController","processHistory","cost","purchaseDate","rrpInstance","saving","OrdersController","orders","openOrderHistoryDialog","OrdersFactory","RatingsController","StatisticsService","episodeScore","itemScore","modelOptions","debounce","viewEpisodeRatings","getItems","score","isEqual","buildSummaryFunctions","finished","focusOnShow","myValue","focus","StatisticsController","Toptens","colours","red","green","blue","dataStore","toptens","detail","isVisible","divisionText","summary","isEpisodeRatings","tagDetail","topten","isRanked","isFavourite","generateSeasons","getFilteredItems","getToptenItemStatistics","historyDetail","historyDetails","tableDetail","tableDetails","listCount","getItemStatistics","ratingValues","buildToptenModeList","totalListCount","buildToptenDataStructure","toptenType","filteredItems","getSummaryFunctions","buildYearSummary","yearSummary","episodeSummaryFunctions","buildEpisodeSummaries","summaryType","historyChange","filtered","detailSeasonYear","detailSeason","detectFlood","overflowCheck","scrollWidth","offsetWidth","classList","percentageBarContainer","border","template","percentageBar","display","percentageBarContainerCtrl","tabContainer","tabs","currentTab","listShift","addTab","tab","disable","disabledTab","select","selectedTab","heading","shiftTabs","elWidth","ulWidth","ul","children","$viewValue","$setViewValue","shift","style","left","tabView","tabContainerCtrl","getModeMap","occuranceCounter","highestRating","lowestRating","modeRating","sum","metric","processYearSummary","results","filteredArray","ignore","arrayOfArrays","listType","itemLen","CreateTaskController","Tasks","TaskFactory","newTaskModel","addChecklistItem","backStep","dropChecklistItem","setNewTask","newTask","description","linked","repeat","category","daily","checklist","checklistItems","isAddTask","checklistItem","task","completeTimes","updateCheck","process","valid","linkItems","linkType","ScheduleCalendarTaskController","refresh","timeDiff","abs","getTime","daysFromToday","events","insertChecklistItem","removeTask","tickOffChecklist","updateTask","weekEnds","floor","aDate","bDate","newChecklistItem","TasksController","createTask","dateOptions","dateDisabled","formatYear","maxDate","minDate","startingDay","refreshItems","setTabFilterDay","tabFilter","tabName","getWeekBeginning","tasks","checkStatus","parts","single","all","change","dailyRefresh","UpdateAnimeTaskController","episodeCompleted","episodeNumber","isComplete","ratingLimit","UpdateMangaTaskController","loseInterest","$document","on","interesting","target","inheritedData","elm","tagName","alsoInteresting","scheduleCalendar","_removeTime","hour","minute","second","millisecond","_buildMonth","done","monthIndex","_buildWeek","isCurrentMonth","isToday","isSame","_displayEvents","selected","previous","shadowModel","att","shadow","taskItemModel","passClick","passTo","updateAnimeitem","updateMangaitem","errorMessage","userCheck","removeTaskProcess","launchMangaUpdateDialog","checklistIndex","itemOriginal","launchAnimeUpdateDialog","isLinked","animeDialog","dialog","taskId","CreateToptenController","toptenCopy","animeList","mangaList","characterList","conditions","limit","imgSize","height","pushCondition","pushItem","removeCondition","removeItem","steps","listGen","itemsCached","displayList","seriesList","typeDisplay","toptenItem","seriesLimit","tagLimit","limitMin","swapping","one","two","swappingItems","typeSetItemPopulate","getYears","callback","indexTwo","inital","toptenId","StatisticsTopten","list","toptenInfo","ToptensController","openListStats","viewConfig","displayType","linkSuffix","horizontalListItem","horizontalListCtrl","itemWidth","register","horizontalList","clicks","moveItems","setVisibility","child","settings","listSettings","ngMax","$isDirty","isEmpty","isUndefined","maxValidator","Infinity","$setValidity","$parsers","ngMin","minValidator","min","oneStep","stepsController","stepNumber","stepControls","sticky","evt","stickyClass","stickyInnerClass","scrollTop","inner","viewportOffset","getBoundingClientRect","distance_from_top","top","toptenFilter","ToptensFactory","$httpProvider","interceptors","responseError","rejection","AuthenticationController","signin","signup","credentials","username","loginBody","askForPasswordReset","resetUserPassword","token","passwordDetails","Users","hasConnectedAdditionalSocialAccounts","provider","additionalProvidersData","isConnectedSocialAccount","removeUserSocialAccount","delete","updateUserProfile","isValid","submitted","changeUserPassword","AuthenticationFactory","_data","UsersFactory"],"mappings":"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","file":"application.js","sourcesContent":["'use strict';\r\n\r\n// Init the application configuration module for AngularJS application\r\nvar ApplicationConfiguration = (function() {\r\n\t// Init module configuration options\r\n\tvar applicationModuleName = 'mylist';\r\n\tvar applicationModuleVendorDependencies = ['ngResource', 'ngCookies',  'ngAnimate',  'ngTouch',  'ngSanitize',  'ui.router', 'ui.bootstrap', 'ui.utils', 'angularFileUpload', 'angularMoment'];\r\n\r\n\t// Add a new vertical module\r\n\tvar registerModule = function(moduleName, dependencies) {\r\n\t\t// Create angular module\r\n\t\tangular.module(moduleName, dependencies || []);\r\n\r\n\t\t// Add the module to the AngularJS configuration file\r\n\t\tangular.module(applicationModuleName).requires.push(moduleName);\r\n\t};\r\n\r\n\treturn {\r\n\t\tapplicationModuleName: applicationModuleName,\r\n\t\tapplicationModuleVendorDependencies: applicationModuleVendorDependencies,\r\n\t\tregisterModule: registerModule\r\n\t};\r\n})();\r\n'use strict';\r\n\r\n//Start by defining the main module and adding the module dependencies\r\nangular.module(ApplicationConfiguration.applicationModuleName, ApplicationConfiguration.applicationModuleVendorDependencies);\r\n\r\n// Setting HTML5 Location Mode\r\nangular.module(ApplicationConfiguration.applicationModuleName).config(['$locationProvider',\r\n\tfunction($locationProvider) {\r\n\t\t$locationProvider.hashPrefix('!');\r\n\t}\r\n]);\r\n\r\nangular.module(ApplicationConfiguration.applicationModuleName)\r\n     .run(['$rootScope', '$state', 'Authentication', function ($rootScope, $state, Authentication) {\r\n        $rootScope.$on('$stateChangeStart', function (event, toState) {\r\n\t\t\t\t\tif(toState.name === 'signin') {\r\n\t\t\t\t\t\tif(Authentication.user._id) {\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\t$state.go('listTasks');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t        if (!Authentication.user) {\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t$state.go('signin');\r\n\t        }\r\n\t\t\t\t});\r\n}]);\r\n\r\n//Then define the init function for starting up the application\r\nangular.element(document).ready(function() {\r\n\t//Fixing facebook bug with redirect\r\n\tif (window.location.hash === '#_=_') window.location.hash = '#!';\r\n\r\n\t//Then init the app\r\n\tangular.bootstrap(document, [ApplicationConfiguration.applicationModuleName]);\r\n});\r\n\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('animeitems');\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('characters');\r\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('core');\r\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('history');\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('mangaitems');\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('orders');\r\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('ratings');\r\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('statistics');\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('tasks');\r\n'use strict';\r\n\r\n// Use applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('toptens');\r\n'use strict';\r\n\r\n// Use Applicaion configuration module to register a new module\r\nApplicationConfiguration.registerModule('users');\r\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('animeitems').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Animeitems', 'animeitems', 'dropdown');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'List Animeitems', 'animeitems');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'Watch Animeitems', 'animeitems/watch-list');\r\n\t\tMenus.addSubMenuItem('topbar', 'animeitems', 'New Animeitem', 'animeitems/create');\r\n\t}\r\n]);\r\n\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('animeitems').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Animeitems state routing\r\n\t\t$stateProvider.\r\n        state('listAnimeitems', {\r\n\t\t\turl: '/animeitems',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/list-animeitems.client.view.html',\r\n\t\t\tcontroller: 'AnimeitemsController as ctrl'\r\n\t\t}).\r\n\t\tstate('watchListAnimeitems', {\r\n\t\t\turl: '/animeitems/watch-list',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/list-animeitems.client.view.html',\r\n\t\t\tcontroller: 'WatchListController as ctrl'\r\n\t\t}).\r\n\t\tstate('createAnimeitem', {\r\n\t\t\turl: '/animeitems/create',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/create-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewAnimeitem', {\r\n\t\t\turl: '/animeitems/:animeitemId',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/view-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('editAnimeitem', {\r\n\t\t\turl: '/animeitems/:animeitemId/edit',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/create-animeitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('watchAnimeitem', {\r\n\t\t\turl: '/animeitems/watch/:animeitemId',\r\n\t\t\ttemplateUrl: 'modules/animeitems/views/watch-animeitem.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('AnimeitemsController', AnimeitemsController);\r\n\tAnimeitemsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'AnimeFactory', 'spinnerService', 'TagService', '$uibModal'];\r\n\r\n\tfunction AnimeitemsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, fileUpload, $sce, $window, ItemService, ListService, NotificationFactory, AnimeFactory, spinnerService, TagService, $uibModal) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n    ctrl.filterConfig = {\r\n        ongoingList: true,\r\n        showingCount: 0,\r\n        expandFilters: false,\r\n        sortType: '',\r\n        sortReverse: true,\r\n        ratingLevel: undefined,\r\n        ratingActions: {\r\n            maxRating: 10,\r\n            percent: undefined,\r\n            overStar: null\r\n        },\r\n        search: {},\r\n        searchTags: '',\r\n        tagsForFilter: [],\r\n        taglessItem: false,\r\n        areTagless: false,\r\n        selectListOptions: {},\r\n        statTags: [],\r\n        commonArrays: ListService.getCommonArrays(),\r\n\t\t\t\tgetItemsAvailable: getItemsAvailable,\r\n\t\t\t\tviewItem: ''\r\n    };\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.latestDate = latestDate;\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.viewItemHistory = viewItemHistory;\r\n\t\tctrl.whichController = 'animeitem';\r\n\r\n\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\r\n    //allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n\r\n\t\t// Remove existing Animeitem\r\n\t\tfunction remove(animeitem) {\r\n\t     //are you sure option...\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( animeitem ) {\r\n\t          animeitem.$remove();\r\n\r\n\t          for (var i in ctrl.animeitems) {\r\n\t            if (ctrl.animeitems [i] === animeitem) {\r\n\t            \tctrl.animeitems.splice(i, 1);\r\n\t            }\r\n\t          }\r\n\t        } else {\r\n\t\t\t\t\t\tctrl.animeitem.$remove(function() {\r\n\t          \t$location.path('animeitems');\r\n\t\t\t\t\t\t});\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Anime was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Update existing Animeitem\r\n\t\tfunction update() {\r\n\t\t\tvar animeitem = ctrl.animeitem;\r\n\t\t\tctrl.animeitem = undefined;\r\n      AnimeFactory.update(animeitem, undefined, true, undefined);\r\n\t\t}\r\n\r\n    function tickOff(item) {\r\n        item.episodes += 1;\r\n        item.latest = new Date(); //update latest.\r\n        ctrl.animeitem = item;\r\n        ctrl.update();\r\n    }\r\n\r\n    //latest date display format.\r\n    function latestDate(latest, updated) {\r\n        return ItemService.latestDate(latest, updated);\r\n    }\r\n\r\n\t\tfunction viewItemHistory() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/history/views/item-history.html',\r\n        controller: 'ViewHistoryController as viewHistory',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { viewItem: ctrl.filterConfig.viewItem, type: 'anime' };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed history: ', result, ctrl.filterConfig.viewItem.meta);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tctrl.animeitem = ctrl.filterConfig.viewItem;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n      });\r\n\t\t}\r\n\r\n\t\t// Find existing Animeitem\r\n\t\tfunction findOne() {\r\n\t    Animeitems.get({ animeitemId: $stateParams.animeitemId }).$promise.then(function(result) {\r\n\t        ctrl.animeitem = result;\r\n\t   \t\t\tconsole.log(ctrl.animeitem);\r\n\t    });\r\n\t\t}\r\n\r\n\t\t/** Find a list of Animeitems for values:\r\n         *  (0) returns only ongoing series. (1) returns all series.\r\n         */\r\n\t\tfunction getAnime(value) {\r\n\t    spinnerService.loading('anime', Animeitems.query({ status: value }).$promise.then(function(result) {\r\n\t        ctrl.animeitems = result;\r\n\t\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\t\tctrl.filterConfig.statTags = ItemService.buildStatTags(result, 0);\r\n\t    }));\r\n\t\t}\r\n\r\n    //Set defaults on requery and \"neutralise\" the other search variable.\r\n    function getItemsAvailable() {\r\n        ctrl.animeitems = undefined;\r\n        if (ctrl.filterConfig.ongoingList === true) {\r\n            ctrl.filterConfig.search.onHold = false;\r\n            ctrl.filterConfig.search.status = '';\r\n            getAnime(0);\r\n        } else {\r\n            ctrl.filterConfig.search.onHold = '';\r\n            ctrl.filterConfig.search.status = false;\r\n            getAnime(1);\r\n        }\r\n    }\r\n\t\tctrl.filterConfig.getItemsAvailable();\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('CreateAnimeController', CreateAnimeController);\r\n\tCreateAnimeController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'AnimeFactory', 'spinnerService', 'TagService', 'Enums'];\r\n\r\n\tfunction CreateAnimeController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, fileUpload, $sce, $window, ItemService, ListService, NotificationFactory, AnimeFactory, spinnerService, TagService, Enums) {\r\n\t\tvar ctrl = this,\r\n        animeitemId = $stateParams.animeitemId;\r\n\r\n\t\tctrl.addedEpisodes = addedEpisodes;\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.animeitem = {};\r\n\t\tctrl.authentication = Authentication;\r\n    ctrl.config = {\r\n      title: 'Create',\r\n\t\t\tupdateHistory: false,\r\n      ratingActions: {\r\n          maxRating: 10,\r\n          percent: undefined,\r\n          overStar: null\r\n      },\r\n      statTags: [],\r\n      commonArrays: ListService.getCommonArrays(),\r\n\t\t\tmalSearchType: 'anime'\r\n    };\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.finalNumbers = false; //default show status of final number fields in edit view.\r\n\t\tctrl.find = find;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.findManga = findManga;\r\n    ctrl.imgPath = ''; //image path\r\n\t\tctrl.itemUpdate = new Date(); // today's date as 'yyyy-MM-dd' for the auto-pop of 'latest' in edit page.\r\n    ctrl.init = init;\r\n\t\tctrl.malSearchOptions = {\r\n\t\t\tplaceholder: 'Title',\r\n\t\t\tname: 'title',\r\n\t\t\trequired: true,\r\n\t\t\tautocomplete: 'off',\r\n\t\t\tdisabled: true\r\n\t\t};\r\n\t\tctrl.removeTag = removeTag;\r\n\t\tctrl.sections = {\r\n\t\t\tshowAdditional: false,\r\n\t\t\tshowCompletion: false,\r\n\t\t\tshowItemTags: false\r\n\t\t};\r\n\t\tctrl.selectMalEntry = selectMalEntry;\r\n\t\tctrl.setInSeason = setInSeason;\r\n\t\tctrl.submit = submit;\r\n    ctrl.tagArray = []; // holding tags pre-submit\r\n    ctrl.tagArrayRemove = [];\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\r\n    function init() {\r\n      ctrl.config.isCreate = animeitemId === undefined;\r\n      if(ctrl.config.isCreate) {\r\n\t\t\t\tctrl.animeitem.episodes = 0;\r\n\t\t\t\tctrl.animeitem.start = ctrl.itemUpdate;\r\n\t\t\t\tctrl.animeitem.latest = ctrl.itemUpdate;\r\n\t\t\t\tctrl.malSearchOptions.disabled = false;\r\n\t\t\t} else if(!ctrl.config.isCreate) {\r\n        ctrl.config.title = 'Edit';\r\n        ctrl.findOne();\r\n      }\r\n      ctrl.find();\r\n      ctrl.findManga();\r\n    }\r\n    ctrl.init();\r\n\r\n\t\tfunction selectMalEntry(malEntry) {\r\n\t\t\tif(malEntry) {\r\n\t\t\t\tctrl.animeitem.title = malEntry.title;\r\n\t\t\t\tctrl.animeitem.finalEpisode = malEntry.episodes;\r\n\t\t\t\tctrl.imgPath = malEntry.image;\r\n\t\t\t\tctrl.season = malEntry.status === Enums.malStatus.anime.ongoing;\r\n\t\t\t\tctrl.animeitem.mal = {\r\n\t\t\t\t\tid: malEntry.id\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tctrl.animeitem.finalEpisode = 0;\r\n\t\t\t\tctrl.animeitem.mal = undefined;\r\n\t\t\t\tctrl.season = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n    //For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for animeitem tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.animeitem.tags, text);\r\n\t\t}\r\n\r\n\t\tfunction addedEpisodes() {\r\n\t\t\tctrl.animeitem.latest = ctrl.itemUpdate;\r\n\t\t\tctrl.config.updateHistory = true;\r\n\t\t\tif(ctrl.animeitem.episodes === ctrl.animeitem.finalEpisode && ctrl.animeitem.finalEpisode !== 0 && ctrl.animeitem.reWatching === false) {\r\n\t\t\t\tctrl.animeitem.end = ctrl.itemUpdate;\r\n\t\t\t}\r\n\t\t\tif(ctrl.animeitem.episodes > ctrl.animeitem.finalEpisode && ctrl.animeitem.finalEpisode !== 0) {\r\n\t\t\t\tctrl.animeitem.episodes = ctrl.animeitem.finalEpisode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction setInSeason() {\r\n\t\t\tif(ctrl.animeitem.season.season === null) {\r\n\t\t\t\t ctrl.animeitem.season.year = null;\r\n\t\t\t } else {\r\n\t\t\t\t ctrl.animeitem.season.year = ctrl.animeitem.start.substring(0,4);\r\n\t\t\t }\r\n\t\t}\r\n\r\n\t\t// Create new Animeitem\r\n\t\tfunction create() {\r\n\t\t\t// Create new Animeitem object\r\n      var animeitem = new Animeitems();\r\n      animeitem = new Animeitems ({\r\n          title: ctrl.animeitem.title,\r\n          episodes: ctrl.animeitem.episodes,\r\n          start: ctrl.animeitem.start,\r\n          latest: ctrl.animeitem.latest,\r\n          finalEpisode: ctrl.animeitem.finalEpisode,\r\n\t\t\t\t\timage: ctrl.imgPath,\r\n          season: ctrl.season === true ? ItemService.convertDateToSeason(new Date(ctrl.animeitem.start)) : '',\r\n          disc: ctrl.animeitem.disc,\r\n          manga: ctrl.animeitem.manga!==undefined && ctrl.animeitem.manga!==null ? ctrl.animeitem.manga._id : ctrl.animeitem.manga,\r\n          tags: ctrl.tagArray,\r\n\t\t\t\t\tmal: ctrl.animeitem.mal,\r\n          user: ctrl.user\r\n       });\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\tanimeitem.$save(function(response) {\r\n\t\t\t\t$location.path('/animeitems/' + response._id);\r\n\t\t\t\tNotificationFactory.success('Saved!', 'Anime was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n        NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Update existing Animeitem\r\n\t\tfunction update() {\r\n\t\t\tvar animeitem = ctrl.animeitem;\r\n\t\t\tctrl.animeitem = undefined;\r\n      AnimeFactory.update(animeitem, ctrl.tagArray, ctrl.config.updateHistory, ctrl.imgPath);\r\n\t\t}\r\n\r\n\t\tfunction submit() {\r\n\t\t\tif(ctrl.config.isCreate) ctrl.create();\r\n\t\t\tif(!ctrl.config.isCreate) ctrl.update();\r\n\t\t}\r\n\r\n    // Find a list of Animeitems\r\n    function find() {\r\n        Animeitems.query().$promise.then(function(result) {\r\n\t\t\t\t\tctrl.animeitems = result;\r\n\t\t\t\t\t\tctrl.config.statTags = ItemService.buildStatTags(result, 0);\r\n\t\t\t\t});\r\n    }\r\n\r\n\t\t// Find existing Animeitem\r\n\t\tfunction findOne() {\r\n\t    spinnerService.loading('editAnime', Animeitems.get({ animeitemId: animeitemId }).$promise.then(function(result) {\r\n\t        ctrl.animeitem = result;\r\n\t\t\t\t\tctrl.malSearchOptions.disabled = (ctrl.animeitem.mal && ctrl.animeitem.mal.id > 0) || false;\r\n\t    }));\r\n\t\t}\r\n\r\n    // Find list of mangaitems for dropdown.\r\n    function findManga() {\r\n        ctrl.mangaitems = Mangaitems.query();\r\n    }\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/animeitems/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUploadAnime');\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('WatchAnimeController', WatchAnimeController);\r\n\tWatchAnimeController.$inject = ['$scope', 'Authentication', '$stateParams', '$timeout', 'Animeitems', '$sce', 'ListService', 'AnimeFactory'];\r\n\r\n\tfunction WatchAnimeController($scope, Authentication, $stateParams, $timeout, Animeitems, $sce, ListService, AnimeFactory) {\r\n\t\t\t\tvar ctrl = this,\r\n\t\t\t\t\t\tsaved = localStorage.getItem('watched');\r\n\r\n        ctrl.authentication = Authentication;\r\n\t\t\t\tctrl.findOne = findOne;\r\n\t\t\t\tctrl.playVideo = playVideo;\r\n\t\t\t\tctrl.startRewatch = startRewatch;\r\n\t\t\t\tctrl.update = update;\r\n        ctrl.videoFile = {\r\n  \t\t\t\tprocessed: '',\r\n  \t\t\t\tfile: '',\r\n\t\t\t\t\tnumber: '',\r\n  \t\t\t\tmessage: 'Please select an episode.'\r\n        };\r\n\t\t\t\tctrl.watchedList = (localStorage.getItem('watched') !== null) ? JSON.parse(saved) : {};\r\n\r\n\t\t\t\tfunction updateWatchedList() {\r\n\t\t\t\t\tlocalStorage.setItem('watched', JSON.stringify(ctrl.watchedList));\r\n\t\t\t\t\tctrl.watchedList = JSON.parse(localStorage.getItem('watched'));\r\n\t\t\t\t}\r\n\r\n        $scope.$watch('fileGrab', function(nVal, oVal) {\r\n          if(nVal) {\r\n\t\t\t\t\t\tctrl.videoFile.message = ''; //clear any error.\r\n            ctrl.videoFile.file = nVal.name;\r\n\t\t\t\t\t\tctrl.videoFile.number = ctrl.animeitem.video.files[ListService.findWithAttr(ctrl.animeitem.video.files, 'file', nVal.name)].number;\r\n            ctrl.videoFile.processed = $sce.trustAsResourceUrl(window.URL.createObjectURL(nVal));\r\n          }\r\n        });\r\n\r\n\t\t\t\tfunction playVideo() {\r\n\t\t\t\t\tctrl.watchedList[ctrl.videoFile.file] = true;\r\n\t\t\t\t\tupdateWatchedList();\r\n\t\t\t\t\tif(ctrl.animeitem.reWatching && (ListService.findWithAttr(ctrl.animeitem.video.files, 'file', ctrl.videoFile.file) > -1)) {\r\n\t\t\t\t\t\tctrl.animeitem.episodes = parseInt(ctrl.videoFile.number, 10);\r\n\t\t\t\t\t\tctrl.update();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction startRewatch() {\r\n\t\t\t\t\tconsole.log('startRewatch: ');\r\n\t\t\t\t\tvar i = ctrl.animeitem.video.files.length;\r\n\t\t\t\t\twhile(i--) {\r\n\t\t\t\t\t\tctrl.watchedList[ctrl.animeitem.video.files[i].file] = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdateWatchedList();\r\n\t\t\t\t\tctrl.animeitem.episodes = 0;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Update existing Animeitem\r\n\t\t\t\tfunction update() {\r\n\t\t\t\t\tctrl.animeitem.latest = new Date();\r\n\t\t      AnimeFactory.update(ctrl.animeitem, undefined, false, '');\r\n\t\t\t\t}\r\n\r\n        // Find existing Animeitem\r\n    \t\tfunction findOne() {\r\n    \t    Animeitems.get({ animeitemId: $stateParams.animeitemId }).$promise.then(function(result) {\r\n    \t        ctrl.animeitem = result;\r\n    \t   \t\t\tconsole.log(ctrl.animeitem);\r\n    \t    });\r\n    \t\t}\r\n        ctrl.findOne();\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.controller('WatchListController', WatchListController);\r\n\tWatchListController.$inject = ['$scope', 'Authentication', '$state', '$sce', 'spinnerService', 'ItemService', 'ListService', 'WatchAnime', '$filter'];\r\n\r\n\tfunction WatchListController($scope, Authentication, $state, $sce, spinnerService, ItemService, ListService, WatchAnime, $filter) {\r\n\t\t\t\tvar ctrl = this;\r\n\r\n        ctrl.authentication = Authentication;\r\n\t\t\t\tctrl.filterConfig = {\r\n\t\t        ongoingList: true,\r\n\t\t        showingCount: 0,\r\n\t\t        expandFilters: false,\r\n\t\t        sortType: '',\r\n\t\t        sortReverse: true,\r\n\t\t        ratingLevel: undefined,\r\n\t\t        ratingActions: {\r\n\t\t            maxRating: 10,\r\n\t\t            percent: undefined,\r\n\t\t            overStar: null\r\n\t\t        },\r\n\t\t        search: {},\r\n\t\t        searchTags: '',\r\n\t\t        tagsForFilter: [],\r\n\t\t        taglessItem: false,\r\n\t\t        areTagless: false,\r\n\t\t        selectListOptions: {},\r\n\t\t        statTags: [],\r\n\t\t        commonArrays: ListService.getCommonArrays()\r\n\t\t    };\r\n\t\t\t\tctrl.find = find;\r\n\t\t\t\tctrl.latestDate = latestDate;\r\n\t\t\t\tctrl.pageConfig = {\r\n\t\t\t\t\t\tcurrentPage: 0,\r\n\t\t\t\t\t\tpageSize: 10\r\n\t\t\t\t};\r\n\t\t\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\t\t\tctrl.watchAnime = watchAnime;\r\n\t\t\t\tctrl.whichController = 'watch';\r\n\r\n\t\t\t\tfunction watchAnime(id) {\r\n\t\t\t\t\t$state.go('watchAnimeitem', { animeitemId: id });\r\n\t\t\t\t}\r\n\r\n        // Find a list of Animeitems\r\n        function find() {\r\n\t\t\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t\t\t\t\tctrl.filterConfig.sortType = ctrl.filterConfig.selectListOptions.sortOptions[ctrl.filterConfig.selectListOptions.sortOption].v; //Set sort order.\r\n          spinnerService.loading('watch', WatchAnime.query().$promise.then(function(result) {\r\n  \t\t\t\t\tctrl.animeitems = result;\r\n\t\t\t\t\t\tconsole.log('watch list: ', result, 'filterConfig: ', ctrl.filterConfig);\r\n  \t\t\t\t}));\r\n        }\r\n        ctrl.find();\r\n\r\n\t\t\t\t//allow retreival of local resource\r\n\t\t    function trustAsResourceUrl(url) {\r\n\t\t        return $sce.trustAsResourceUrl(url);\r\n\t\t    }\r\n\r\n\t\t\t\t//latest date display format.\r\n\t\t    function latestDate(latest, updated) {\r\n\t\t        return ItemService.latestDate(latest, updated);\r\n\t\t    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('animeItemModel', animeItemModel);\r\n\r\n  function animeItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/animeitems/templates/anime-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('fileModel', fileModel);\r\n  fileModel.$inject = ['$parse'];\r\n\r\n  function fileModel($parse) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function(scope, element, attrs) {\r\n            var model = $parse(attrs.fileModel);\r\n            var modelSetter = model.assign;\r\n\r\n            element.bind('change', function(){\r\n                scope.$apply(function(){\r\n                    modelSetter(scope, element[0].files[0]);\r\n                });\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('keycuts', keycuts);\r\n\r\n  function keycuts() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function postLink(scope, element, attrs) {\r\n              //keydown catch - alt+v for view\r\n              scope.$on('my:keydown', function(event, e) {\r\n  //                console.log(event, e);\r\n                  if (e.altKey && e.keyCode===86) {\r\n                      if (scope.isList==='list') {\r\n                          scope.isList = 'slider';\r\n                      } else if (scope.isList==='slider') {\r\n                          scope.isList = 'list';\r\n                      } else if (scope.view === 'Anime') {\r\n                          scope.view = 'Manga';\r\n                      } else if (scope.view === 'Manga') {\r\n                          scope.view = 'Character';\r\n                      } else if (scope.view === 'Character') {\r\n                          scope.view = 'Anime';\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('listBack', listBack);\r\n   function listBack() {\r\n      return function(scope, element, attrs){\r\n          var url = attrs.listBack;\r\n          element.css({\r\n              'background-image': 'url(' + url +')',\r\n              'background-size' : '50%',\r\n              'background-repeat': 'no-repeat',\r\n              'background-position': 'right'\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('listFilters', listFilters);\r\n\r\n  function listFilters() {\r\n      return {\r\n          restrict: 'EA',\r\n          replace: true,\r\n          scope: {\r\n              filterConfig: '=',\r\n              items: '=',\r\n              page: '='\r\n          },\r\n          templateUrl: '/modules/animeitems/templates/list-filters.html',\r\n          link: function(scope, elem, attrs) {\r\n              scope.filterConfig.searchTags = '';\r\n              scope.passTag = function(tag) {\r\n                if (scope.filterConfig.searchTags.indexOf(tag) === -1) {\r\n                    scope.filterConfig.searchTags += tag + ',';\r\n                    scope.filterConfig.tagsForFilter = scope.filterConfig.searchTags.substring(0, scope.filterConfig.searchTags.length - 1).split(',');\r\n                }\r\n              };\r\n              //rating 'tooltip' function\r\n              scope.hoveringOver = function(value) {\r\n                scope.filterConfig.ratingActions.overStar = value;\r\n                scope.filterConfig.ratingActions.percent = 100 * (value / scope.filterConfig.ratingActions.maxRating);\r\n              };\r\n\r\n              scope.itemsAvailable = function() {\r\n                scope.filterConfig.getItemsAvailable();\r\n              };\r\n\r\n              scope.collapseFilters = function() {\r\n                scope.filterConfig.expandFilters = false;\r\n              };\r\n\r\n          }\r\n\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('swOnplay', swOnplay);\r\n\r\n  function swOnplay() {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        var el = element[0];\r\n        el.addEventListener('play', function() {\r\n          scope.$apply(attrs.swOnplay);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .directive('pageControls', pageControls);\r\n\r\n  function pageControls() {\r\n    return {\r\n        restrict: 'EA',\r\n        replace: true,\r\n        scope: {\r\n            pageConfig: '=',\r\n            showingCount: '='\r\n        },\r\n        templateUrl: '/modules/animeitems/templates/page-controls.html',\r\n        link: function(scope, elem, attrs) {\r\n            /** Calculate page count.\r\n             *    If showingCount isn't caluclated in time...\r\n             *    If the pageSize is altered...\r\n             */\r\n                scope.$watch('showingCount', function() {\r\n                    scope.pageCount = Math.ceil(scope.showingCount / scope.pageConfig.pageSize);\r\n                    if (scope.pageConfig.currentPage > scope.pageCount - 1) {\r\n                        scope.last(); //in the event changing page size would put you above the last page.\r\n                    } else if (scope.pageConfig.currentPage < 0) {\r\n                        scope.first();\r\n                    }\r\n                });\r\n\r\n            /** Button Functions\r\n             *    go to next/prev pages. skip to first/last page.\r\n             */\r\n            scope.first = function() {\r\n  //              console.log('first');\r\n                scope.pageConfig.currentPage = 0;\r\n            };\r\n            scope.last = function() {\r\n  //              console.log('last');\r\n                scope.pageConfig.currentPage = scope.pageCount - 1;\r\n            };\r\n            scope.next = function() {\r\n  //              console.log('next');\r\n                scope.pageConfig.currentPage += 1;\r\n            };\r\n            scope.prev = function() {\r\n  //              console.log('prev');\r\n                scope.pageConfig.currentPage -= 1;\r\n            };\r\n\r\n            //Catches ctrl+left/right keypresses to change pages.\r\n            scope.$on('my:keydown', function(event, e) {\r\n  //              console.log(event, e);\r\n              if (e.ctrlKey && e.keyCode===39 && scope.pageConfig.currentPage < scope.pageCount - 1) {\r\n                  scope.next();\r\n              } else if (e.ctrlKey && e.keyCode===37 && scope.pageConfig.currentPage > 0) {\r\n                  scope.prev();\r\n              }\r\n            });\r\n\r\n        }\r\n    };\r\n\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('endedMonth', endedMonth);\r\n\r\n  function endedMonth() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n          //ended stat month filter\r\n                  if (item.end!==undefined && item.end!==null) {\r\n                      if (item.end.substring(0,4)===year) {\r\n                          if (item.end.substr(5,2)===month) {\r\n                              return item;\r\n                          }\r\n                      }\r\n                  }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('endedSeason', endedSeason);\r\n  endedSeason.$inject = ['moment'];\r\n\r\n  function endedSeason(moment) {\r\n      //ended stat season filter\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n                  var start = moment(item.start), end = moment(item.end), num, startMonth, startYear, diff, weeks, pad = '00';\r\n                  if (item.end!==undefined && item.end!==null) {\r\n                      /**\r\n                       *  Can currently handle shows of 1 or 2 seasons with 'standard' lengths (10-13) / (22-26) that\r\n                       *  start and finish in the 'normal' season months (J-M,A-J,J-S,O-D) / (J-J,A-S,J-D,O-M).\r\n                       */\r\n                      if (9 < item.finalEpisode && item.finalEpisode < 14) {\r\n                          startMonth = (pad + (month - 2)).slice(-pad.length);\r\n                          if ((item.end.substring(0,4) === year && item.end.substr(5,2) === month) || (item.start.substring(0,4) === year && item.start.substr(5,2) === startMonth)) {\r\n                              diff = end.diff(start, 'days');\r\n                              weeks = Math.ceil(diff / 7) + 1; //add one to correct for the first ep. counting as week 0 in an equation.\r\n                              if (weeks >= item.episodes) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      } else if (13 < item.finalEpisode && item.finalEpisode < 26) {\r\n                          num = (month - 5) > 0 ? (month - 5) : 10;\r\n                          startYear = (month - 5) > 0 ? year : year - 1;\r\n                          startMonth = (pad + num).slice(-pad.length);\r\n                          if ((item.end.substring(0,4) === year && item.end.substr(5,2) === month) || (item.start.substring(0,4) === startYear && item.start.substr(5,2) === startMonth)) {\r\n                              diff = end.diff(start, 'days');\r\n                              weeks = Math.ceil(diff / 7) + 1; //add one to correct for the first ep. counting as week 0 in an equation.\r\n                              if (weeks >= item.episodes) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('ratingFilter', ratingFilter);\r\n\r\n  function ratingFilter() {\r\n      return function(array, rating) {\r\n          if (array !== undefined) {\r\n              //filter for rating stars\r\n              return array.filter(function(item) {\r\n      //            console.log(item);\r\n                  if (item.rating===rating) {\r\n                      return item;\r\n                  } else if (rating===undefined) {\r\n                      return item;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('seasonForCharacterAnime', seasonForCharacterAnime);\r\n\r\n  function seasonForCharacterAnime() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n              if (item.anime && item.anime.season !== undefined && item.anime.season !== null) {\r\n                  if (item.anime.season.year === year && item.anime.season.season === month) {\r\n                      return item;\r\n                  }\r\n              }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('season', season);\r\n\r\n  function season() {\r\n      return function(array, year, month) {\r\n          return array.filter(function(item) {\r\n              if (item.season !== undefined && item.season !== null) {\r\n                  if (item.season.year === year && item.season.season === month) {\r\n                      return item;\r\n                  }\r\n              }\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('startFrom', startFrom);\r\n\r\n   function startFrom() {\r\n      return function(input, start) {\r\n          if (input !== undefined) {\r\n              start = +start; //parse to int\r\n              return input.slice(start);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('statisticsDetailFilter',statisticsDetailFilter);\r\n   statisticsDetailFilter.$inject = ['$filter'];\r\n\r\n   function statisticsDetailFilter($filter) {\r\n      return function(array, type, year, division) {\r\n          var filter = (division === '')   ? 'summaryYear' :\r\n                       (type === 'months') ? 'endedMonth'  :\r\n                                             'season'      ,\r\n              filterPart = (division === '') ? type : division;\r\n          return $filter(filter)(array, year, filterPart);\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('animeitems')\r\n  .filter('summaryYear', summaryYear);\r\n\r\n  function summaryYear() {\r\n      return function(array, year, type) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                if (type === 'months' && item.end !== undefined && item.end !== null) {\r\n                    if (item.end.substring(0,4) === year) {\r\n                        return item;\r\n                    }\r\n                } else if (type === 'seasons') {\r\n                    if (item.season.year === year) {\r\n                        return item;\r\n                    }\r\n                }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('AnimeFactory', AnimeFactory);\r\n\tAnimeFactory.$inject = ['Animeitems', 'ListService', 'ItemService', 'NotificationFactory', '$location'];\r\n\r\n\tfunction AnimeFactory(Animeitems, ListService, ItemService, NotificationFactory, $location) {\r\n\t    return {\r\n\t        update: function(item, tagArray, updateHistory, imgPath, episodeRating) {\r\n\t            var animeitem = item;\r\n\t            console.log(animeitem);\r\n\t            //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n\t            if (item.manga!==null && item.manga!==undefined) {\r\n\t                animeitem.manga = item.manga._id;\r\n\t            }\r\n\r\n\t            if (tagArray!==undefined) {\r\n\t                animeitem.tags = ListService.concatenateTagArrays(animeitem.tags, tagArray);\r\n\t            }\r\n\r\n\t            //update the item history.\r\n\t            animeitem = ItemService.itemHistory(animeitem, updateHistory, 'anime', episodeRating);\r\n\r\n\t            if (imgPath!==undefined && imgPath!==null && imgPath!=='') {\r\n\t                animeitem.image = imgPath;\r\n\t            }\r\n\t            //console.log($scope.imgPath);\r\n\t            //console.log(animeitem.image);\r\n\r\n\t            //handle end date\r\n\t            if (animeitem.episodes === animeitem.finalEpisode && animeitem.finalEpisode!==0) {\r\n\t                if (animeitem.end===undefined || animeitem.end === null) {\r\n\t                    animeitem.end = animeitem.latest;\r\n\t//                    console.log(animeitem.end);\r\n\t                }\r\n\t            } else if (animeitem.reWatching === false) {\r\n\t                //in the event the 'complete-ness' of an entry needs to be undone.\r\n\t                //this will undo the end date.\r\n\t                animeitem.end = null;\r\n\t//                console.log(animeitem.end);\r\n\t            }\r\n\r\n\t            //handle status: completed.\r\n\t            if(animeitem.end!==undefined && animeitem.end!==null) {\r\n\t                animeitem.status = true;\r\n\t                animeitem.onHold = false;\r\n\t            } else {\r\n\t                //if no end date, not complete.\r\n\t                animeitem.status = false;\r\n\t            }\r\n\r\n\t            //handle re-reading, re-read count.\r\n\t            if (animeitem.reWatching===true) {\r\n\t\t\t\t\t\t\t\tanimeitem = ItemService.itemRevisits(animeitem, 'anime');\r\n\t\t\t\t\t\t\t\tif(animeitem.episodes===animeitem.finalEpisode) {\r\n\t                animeitem.reWatchCount += 1;\r\n\t                animeitem.reWatching = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t            }\r\n\r\n\t\t\t\tanimeitem.$update(function() {\r\n\t\t\t\t\tif (window.location.href.indexOf('tasks') === -1 && window.location.href.indexOf('watch') === -1 ) $location.path('animeitems');\r\n\r\n\t\t\t\t    NotificationFactory.success('Saved!', 'Anime was saved successfully');\r\n\t\t\t\t}, function(errorResponse) {\r\n\t\t\t\t\tvar error = errorResponse.data.message;\r\n\t                NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t\t});\r\n\t        }\r\n\t    };\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('Animeitems', AnimeitemsFactory);\r\n\tAnimeitemsFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction AnimeitemsFactory($resource) {\r\n\t\t\treturn $resource('animeitems/:animeitemId', { animeitemId: '@_id' }, { update: { method: 'PUT' } });\r\n\t\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('fileUpload', fileUpload);\r\n\tfileUpload.$inject = ['$http', 'NotificationFactory'];\r\n\r\n\tfunction fileUpload($http, NotificationFactory) {\r\n\t\tvar obj = {\r\n\t\t\tuploadFileToUrl: uploadFileToUrl\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n    function uploadFileToUrl(file, uploadUrl){\r\n        var fd = new FormData();\r\n        fd.append('file', file);\r\n        $http.post(uploadUrl, fd, {\r\n            transformRequest: angular.identity,\r\n            headers: {'Content-Type': undefined}\r\n        })\r\n        .success(function(response){\r\n            NotificationFactory.success('Uploaded!', 'Image was saved successfully');\r\n        })\r\n        .error(function(err){\r\n            NotificationFactory.popup('Woops!', 'Something went wrong! \\n' + err, 'error');\r\n        });\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('ItemService', ItemService);\r\n\tItemService.$inject = ['moment', '$filter', 'ListService'];\r\n\r\n\tfunction ItemService(moment, $filter, ListService) {\r\n\t\tvar obj = {\r\n\t\t\tbuildOverview: buildOverview,\r\n\t\t\tbuildRatingsDistribution: buildRatingsDistribution,\r\n\t\t\tbuildStatTags: buildStatTags,\r\n\t\t\tcompleteByMonth: completeByMonth,\r\n\t\t\tcompleteBySeason: completeBySeason,\r\n\t\t\tconvertDateToSeason: convertDateToSeason,\r\n\t\t\tdeleteHistory: deleteHistory,\r\n\t\t\tendingYears: endingYears,\r\n\t\t\tgetRatingValues: getRatingValues,\r\n\t\t\titemHistory: itemHistory,\r\n\t\t\titemRevisits: itemRevisits,\r\n\t\t\tlatestDate: latestDate,\r\n\t\t\tmaxCompleteMonth: maxCompleteMonth,\r\n\t\t\tmaxTagCount: maxTagCount,\r\n\t\t\tratingsWeighted: ratingsWeighted,\r\n\t\t\tsetSeason: setSeason\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n\t        //Using the date, returns the season.\r\n\t        function convertDateToSeason(date) {\r\n\t            var season = '', year = date.getFullYear(), month = date.getMonth() + 1, commonArrays = ListService.getCommonArrays(),\r\n\t                i = commonArrays.seasons.length;\r\n\t//            console.log('convert: ', year, month);\r\n\t            while(i--) {\r\n\t                if (month > Number(commonArrays.seasons[i].number) && season === '') {\r\n\t                    season = { season: commonArrays.seasons[i+1].text, year: year };\r\n\t                }\r\n\t                //catch winter.\r\n\t                if (i === 0 && season === '') {\r\n\t                    season = { season: commonArrays.seasons[i].text, year: year };\r\n\t                }\r\n\t            }\r\n\t//            console.log('to: ', season);\r\n\t            return season;\r\n\t        }\r\n\r\n\t        //add history entry to item.\r\n\t        function itemHistory(item, updateHistory, type, episodeRating) {\r\n\t            console.log('item history: ', item, item.meta, episodeRating);\r\n\t            //populate the history of when each part was 'checked' off.\r\n\t            if (item.meta.history.length !== 0) {\r\n\t                var latestHistory = item.meta.history[item.meta.history.length - 1].value,\r\n\t                    length = type === 'anime' ? item.episodes - latestHistory : item.chapters - latestHistory;\r\n\t                if (length > 0 && (type === 'anime' ? item.reWatching === false : item.reReading === false)) {\r\n\t                    for(var i = 1; i <= length; i++) {\r\n\t                        item.meta.history.push({\r\n\t                            date: Date.now(),\r\n\t                            value: latestHistory + i,\r\n\t                            rating: episodeRating || 0,\r\n\t                            title: item.title,\r\n\t                            id: item._id\r\n\t                        });\r\n\t                    }\r\n\t                }\r\n\t            } else {\r\n\t                if (updateHistory && (type === 'anime' ? item.reWatching === false : item.reReading === false)) {\r\n\t                    item.meta.history.push({\r\n\t                        date: Date.now(),\r\n\t                        value: (type === 'anime' ? item.episodes : item.chapters),\r\n\t                        rating: episodeRating || 0,\r\n\t                        title: item.title,\r\n\t                        id: item._id\r\n\t                    });\r\n\t                }\r\n\t            }\r\n\t            return item;\r\n\t        }\r\n\r\n\t        //remove an entry from an items history.\r\n\t        function deleteHistory(item, history) {\r\n\t            var temp = [];\r\n\t            angular.forEach(item.meta.history, function(past) {\r\n\t                if (past.value !== history.value) {\r\n\t                    temp.push(past);\r\n\t                }\r\n\t            });\r\n\t            item.meta.history = temp;\r\n\t            return item;\r\n\t        }\r\n\r\n\t\t\t\t\tfunction itemRevisits(item, type) {\r\n\t\t\t\t\t\tvar anime = { count: 'reWatchCount', currentPart: 'episodes', finalPart: 'finalEpisode' },\r\n\t\t\t\t\t\t\t\tmanga = { count: 'reReadCount',  currentPart: 'chapters', finalPart: 'finalChapter' },\r\n\t\t\t\t\t\t\t\trepeating = type === 'anime' ? anime : manga,\r\n\t\t\t\t\t\t\t\tindex = ListService.findWithAttr(item.meta.revisits, 'value', item[repeating.count] + 1);\r\n\t\t\t\t\t\tif(index === -1) {\r\n\t\t\t\t\t\t\titem.meta.revisits.push({\r\n\t\t\t\t\t\t\t\tid: item.id,\r\n\t\t\t\t\t\t\t\ttitle: item.title,\r\n\t\t\t\t\t\t\t\tvalue: item[repeating.count] + 1,\r\n\t\t\t\t\t\t\t\trating: 0,\r\n\t\t\t\t\t\t\t\tstart: item.latest,\r\n\t\t\t\t\t\t\t\tend: item[repeating.currentPart] === item[repeating.finalPart] ? item.latest : null\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else if(index > -1 && item[repeating.currentPart] === item[repeating.finalPart]) {\r\n\t\t\t\t\t\t\titem.meta.revisits[index].end = item.latest;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\r\n\t        //function to display relative time - using latest or updated date.\r\n\t        function latestDate(latest, updated) {\r\n\t            //latest date display format.\r\n\t//          console.log(latest, updated);\r\n\t            var today = moment(new Date()), displayDate, diff;\r\n\r\n\t            if (moment(latest).toISOString().substring(0,10)===moment(updated).toISOString().substring(0,10)) {\r\n\t                 displayDate = moment(updated);\r\n\t                 diff = displayDate.fromNow();\r\n\r\n\t                if (diff==='a day ago') {\r\n\t                    return 'Yesterday at ' + displayDate.format('HH:mm');\r\n\t                } else if (diff.indexOf('days') > -1) {\r\n\t                    return diff + ' at ' + displayDate.format('HH:mm');\r\n\t                } else {\r\n\t                    return diff + '.';\r\n\t                }\r\n\t            } else {\r\n\t                 displayDate = moment(latest);\r\n\t                 diff = today.diff(displayDate, 'days');\r\n\r\n\t                //for 0 and 1 day(s) ago use the special term.\r\n\t                if (diff===0) {\r\n\t                    return 'Today';\r\n\t                } else if (diff===1) {\r\n\t                    return 'Yesterday';\r\n\t                } else {\r\n\t                    return diff + ' days ago.';\r\n\t                }\r\n\t            }\r\n\t        }\r\n\r\n\t        //build statistics item overview details.\r\n\t        function buildOverview(items) {\r\n\t            var overview = {\r\n\t                ongoing: $filter('filter')(items, {status: false }).length,\r\n\t                completed: $filter('filter')(items, {status: true }).length\r\n\t            };\r\n\t//            console.log('overview ' , overview);\r\n\t            return overview;\r\n\t        }\r\n\r\n\t        //calculate which month has the most anime completed in it.\r\n\t        function maxCompleteMonth(items) {\r\n\t            var modeMap = {}, maxCount = 0;\r\n\t            for(var i = 0; i < items.length; i++) {\r\n\t                if (items[i].end!==undefined && items[i].end!==null) {\r\n\t                    var end = items[i].end.substring(0,7);\r\n\t                    if(modeMap[end] === null || modeMap[end] === undefined) {\r\n\t                        modeMap[end] = 1;\r\n\t                    } else {\r\n\t                        modeMap[end]++;\r\n\t                    }\r\n\t                    if(modeMap[end] > maxCount) {\r\n\t                        maxCount = modeMap[end];\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            return maxCount;\r\n\t        }\r\n\r\n\t        //calculate the rating values - max rated count and average rating.\r\n\t        function getRatingValues(items) {\r\n\t            var tempRating = 0,\r\n\t                maxRatedCount = 0,\r\n\t                averageRating = 0;\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.rating !== 0) {\r\n\t                    tempRating += item.rating;\r\n\t                    maxRatedCount++;\r\n\t                }\r\n\t            });\r\n\t            averageRating = tempRating / maxRatedCount;\r\n\t            var values = {\r\n\t                maxRatedCount: maxRatedCount,\r\n\t                averageRating: averageRating\r\n\t            };\r\n\t//            console.log('values', values);\r\n\t            return values;\r\n\t        }\r\n\r\n\t        //calculate which month has the most anime completed in it.\r\n\t        function maxTagCount(items) {\r\n\t            var modeMap = {}, maxCount = 0;\r\n\t            angular.forEach(items, function(item) {\r\n\t                angular.forEach(item.tags, function(tag) {\r\n\t                    var text = tag.text;\r\n\t                    if(modeMap[text] === null || modeMap[text] === undefined) {\r\n\t                        modeMap[text] = 1;\r\n\t                    } else {\r\n\t                        modeMap[text]++;\r\n\t                    }\r\n\t                    if(modeMap[text] > maxCount) {\r\n\t                        maxCount = modeMap[text];\r\n\t                    }\r\n\t                });\r\n\t            });\r\n\t            return maxCount;\r\n\t        }\r\n\r\n\t        //build stat tags including counts, averages etc.\r\n\t        function buildStatTags(items, averageItemRating) {\r\n\t            var add = true, statTags = [], checkedRating, maxTagCount = obj.maxTagCount(items), itemCount = items.length;\r\n\t            //is tag in array?\r\n\t            angular.forEach(items, function(item) {\r\n\t                angular.forEach(item.tags, function(tag) {\r\n\t                    for(var i=0, len = statTags.length; i < len; i++) {\r\n\t                        if (statTags[i].tag===tag.text) {\r\n\t                            add = false;\r\n\t                            statTags[i].count += 1;\r\n\t                            statTags[i].ratedCount += item.rating === 0 ? 0 : 1;\r\n\t                            statTags[i].ratings.push(item.rating);\r\n\t                            statTags[i].ratingAdded += item.rating;\r\n\t                            statTags[i].ratingAvg = statTags[i].ratingAdded === 0 ? 0 : statTags[i].ratingAdded / statTags[i].ratedCount;\r\n\t                            statTags[i].ratingWeighted = obj.ratingsWeighted(statTags[i].ratings);\r\n\t                        }\r\n\t                    }\r\n\t                    // add if not in\r\n\t                    if (add===true) {\r\n\t                        checkedRating = item.rating === 0 ? 0 : 1;\r\n\t                        statTags.push({ tag: tag.text, count: 1, ratedCount: checkedRating, ratings: [item.rating], ratingAdded: item.rating, ratingAvg: item.rating, ratingWeighted: 0 });\r\n\t                    }\r\n\t                    add = true; //reset add status.\r\n\t                });\r\n\t//                    console.log(statTags);\r\n\t            });\r\n\t            return statTags;\r\n\t        }\r\n\r\n\t        //function to calculate the weighted mean ratings for the genre tags.\r\n\t        function ratingsWeighted(ratings) {\r\n\t            var values = [], weights = [], unratedCount = 0, total = 0, count = 0;\r\n\t            /**\r\n\t             *  create array (weights) with key(rating).\r\n\t             */\r\n\t            for (var i=0, len = ratings.length; i < len; i++) {\r\n\t                if (ratings[i] in values) {\r\n\t                    weights[ratings[i]]++;\r\n\t                } else {\r\n\t                    values.push(ratings[i]);\r\n\t                    weights[ratings[i]] = 1;\r\n\t                }\r\n\t            }\r\n\t            /**\r\n\t             *  using the key(rating) multiply by the value(weight).\r\n\t             *  calculated weighted total and count.\r\n\t             */\r\n\t            for (var k in weights){\r\n\t                if (typeof weights[k] !== 'function') {\r\n\t                    if (!isNaN(weights[k])) {\r\n\t                        total += k * weights[k];\r\n\t                        count += weights[k];\r\n\t                    }\r\n\t                }\r\n\t                if (k === 0) {\r\n\t                    unratedCount = weights[k];\r\n\t                }\r\n\t            }\r\n\t\t\t\t\t\t\t/* Weighted average.\r\n\t\t\t\t\t\t\t * total = (nth_rating_value * number_of_that_value + ...)\r\n\t\t\t\t\t\t\t * count = number of ratings.\r\n\t\t\t\t\t\t\t */\r\n\t            return total / count;\r\n\t        }\r\n\r\n\t        //builds counts for number of items given for each rating.\r\n\t        function buildRatingsDistribution(items) {\r\n\t            var maxCount = items.length, possibleValues = [10,9,8,7,6,5,4,3,2,1,0], ratingsDistribution = [], i = possibleValues.length;\r\n\t            while(i--) {\r\n\t                var count = $filter('filter')(items, { rating: i }, true).length;\r\n\t                ratingsDistribution.push({ number: i === 0 ? '-' : i,\r\n\t                                           text: i === 0 ? count + ' entries unrated.' : count + ' entries rated ' + i,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t colour: i > 6 \t\t ? '#449d44' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t 7 > i && i > 3 ? '#31b0d5' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t i !== 0 ? '#c9302c' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t\t '#000000',\r\n\t                                           count: count,\r\n\t                                           percentage: ((count / maxCount) * 100).toFixed(2)\r\n\t                                         });\r\n\t            }\r\n\t//            console.log('RD: ', ratingsDistribution);\r\n\t            return ratingsDistribution;\r\n\t        }\r\n\r\n\t        // 'sub-function' of the completeBy... functions.\r\n\t        function endingYears(items) {\r\n\t            var years = [],\r\n\t\t\t\t\t\t\t\t\titemYears = $filter('unique')(items, 'end.substring(0,4)'); //get unqiue years as items.\r\n\t            \t\titemYears = $filter('orderBy')(itemYears, '-end.substring(0,4)'); //order desc.\r\n\t\t\t\t\t\t\tangular.forEach(itemYears, function(item) {\r\n\t\t\t\t\t\t\t\tif(item.end !== undefined && item.end !== null) {\r\n\t\t\t\t\t\t\t\t\tyears.push({ year: item.end.substring(0,4) });\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t            return years;\r\n\t        }\r\n\r\n\t        //complete by month stats\r\n\t        function completeByMonth(items) {\r\n\t            var monthDetails = {}, completeByMonthItems = [], maxCompleteMonth = 0, itemYears = obj.endingYears(items), i = itemYears.length;\r\n\t            //build comlpeteByMonths object.\r\n\t            while(i--) {\r\n\t                //chuck the null end date. push the year part of the other end dates with months array.\r\n\t                if (itemYears[i].year !== undefined && itemYears[i].year !== null) {\r\n\t                    completeByMonthItems.push({ year: itemYears[i].year,\r\n\t                                          months: [\r\n\t                                                    { number: '01', text: 'January', count: $filter('endedMonth')(items, itemYears[i].year, '01').length  },\r\n\t                                                    { number: '02', text: 'February', count: $filter('endedMonth')(items, itemYears[i].year, '02').length },\r\n\t                                                    { number: '03', text: 'March', count: $filter('endedMonth')(items, itemYears[i].year, '03').length },\r\n\t                                                    { number: '04', text: 'April', count: $filter('endedMonth')(items, itemYears[i].year, '04').length },\r\n\t                                                    { number: '05', text: 'May', count: $filter('endedMonth')(items, itemYears[i].year, '05').length },\r\n\t                                                    { number: '06', text: 'June', count: $filter('endedMonth')(items, itemYears[i].year, '06').length },\r\n\t                                                    { number: '07', text: 'July', count: $filter('endedMonth')(items, itemYears[i].year, '07').length },\r\n\t                                                    { number: '08', text: 'August', count: $filter('endedMonth')(items, itemYears[i].year, '08').length },\r\n\t                                                    { number: '09', text: 'September', count: $filter('endedMonth')(items, itemYears[i].year, '09').length },\r\n\t                                                    { number: '10', text: 'October', count: $filter('endedMonth')(items, itemYears[i].year, '10').length },\r\n\t                                                    { number: '11', text: 'November', count: $filter('endedMonth')(items, itemYears[i].year, '11').length },\r\n\t                                                    { number: '12', text: 'December', count: $filter('endedMonth')(items, itemYears[i].year, '12').length }\r\n\t                                          ]\r\n\t                                         });\r\n\t                }\r\n\t            }\r\n\t            maxCompleteMonth = obj.maxCompleteMonth(items);\r\n\t            monthDetails = { months: completeByMonthItems, max: maxCompleteMonth };\r\n\r\n\t//            console.log('completeByMonthItems', completeByMonthItems);\r\n\t            return monthDetails;\r\n\t        }\r\n\r\n\t        //complete by season stats.\r\n\t        function completeBySeason(items) {\r\n\t            var seasonDetails = {}, completeBySeasonItems = [], maxCompleteSeason = 0, itemYears = obj.endingYears(items), i = itemYears.length;\r\n\t            //build completeBySeasonItems object.\r\n\t            while(i--) {\r\n\t                //chuck the null end date. push the year part of the other end dates with seasons array.\r\n\t                if (itemYears[i].year !== undefined && itemYears[i].year !== null) {\r\n\t                    completeBySeasonItems.push({ year: itemYears[i].year,\r\n\t                                            seasons: [\r\n\t                                                        { number: '03', text: 'Winter', count: $filter('season')(items, itemYears[i].year, 'Winter').length },\r\n\t                                                        { number: '06', text: 'Spring', count: $filter('season')(items, itemYears[i].year, 'Spring').length },\r\n\t                                                        { number: '09', text: 'Summer', count: $filter('season')(items, itemYears[i].year, 'Summer').length },\r\n\t                                                        { number: '12', text: 'Fall', count: $filter('season')(items, itemYears[i].year, 'Fall').length }\r\n\t                                            ]\r\n\t                                          });\r\n\t                }\r\n\t            }\r\n\t            //find maximum complete in a season.\r\n\t            angular.forEach(completeBySeasonItems, function(item) {\r\n\t                var i = item.seasons.length;\r\n\t                while(i--) {\r\n\t                    if (item.seasons[i].count > maxCompleteSeason) {\r\n\t                        maxCompleteSeason = item.seasons[i].count;\r\n\t                    }\r\n\t                }\r\n\t            });\r\n\t            seasonDetails = { seasons: completeBySeasonItems, max: maxCompleteSeason };\r\n\t//            console.log('completeBySeasonItems', seasonDetails);\r\n\t            return seasonDetails;\r\n\t        }\r\n\r\n\t        //Temporary function to generate the season data for pre-exisiting items in db.\r\n\t        function setSeason(items, year, season) {\r\n\t            var array = $filter('endedSeason')(items, year, season);\r\n\t            angular.forEach(array, function(item) {\r\n\t                console.log(item.title);\r\n\t                item.season = obj.convertDateToSeason(new Date(item.start));\r\n\t            });\r\n\t            return array;\r\n\t        }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.service('ListService', ListService);\r\n\tListService.$inject = ['moment', '$q'];\r\n\r\n\tfunction ListService(moment, $q) {\r\n\t\tvar service = {\r\n\t\t\tcheckForTagless: checkForTagless,\r\n\t\t\tconcatenateTagArrays: concatenateTagArrays,\r\n\t\t\tfindWithAttr: findWithAttr,\r\n\t\t\tgetCommonArrays: getCommonArrays,\r\n\t\t\tgetSelectListOptions: getSelectListOptions,\r\n\t\t\tgroupItemsByProperties: groupItemsByProperties,\r\n\t\t\tmanipulateString: manipulateString,\r\n\t\t\tnumberOfPages: numberOfPages,\r\n\t\t\tstringReverse: stringReverse,\r\n\t\t\tweekEndingForDate: weekEndingForDate\r\n\t\t};\r\n\t\treturn service;\r\n\r\n\t        function stringReverse(string) {\r\n\t            return string.split('').reverse().join('');\r\n\t        }\r\n\r\n\t        //get number of pages for list.\r\n\t        function numberOfPages(showingCount, pageSize, currentPage) {\r\n\t            var pageCount = Math.ceil(showingCount/pageSize);\r\n\t            //reset number of pages to be the final page if the number of pages\r\n\t            //becomes less than the one you are on.\r\n\t            if (currentPage + 1 >= pageCount && pageCount !== 0) {\r\n\t                currentPage = pageCount-1;\r\n\t            }\r\n\t            if (pageCount!==0 && currentPage < 0) {\r\n\t                currentPage = 0;\r\n\t            }\r\n\t            var pagingDetails = { currentPage: currentPage, pageCount: pageCount };\r\n\t            return pagingDetails;\r\n\t        }\r\n\r\n\t        //find index of object with given attr.\r\n\t        function findWithAttr(array, attr, value) {\r\n\t            if (array !== undefined) {\r\n\t                for(var i = 0; i < array.length; i += 1) {\r\n\t                    if(array[i][attr] === value) {\r\n\t                        return i;\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            return -1;\r\n\t        }\r\n\r\n\t\t\t\t\t/** Splitting array into multiple arrays by grouping by attributes.\r\n\t\t\t\t\t */\r\n\t\t\t\t\t function groupItemsByProperties(array, groupProperties) {\r\n\t\t\t\t\t\t return $q(function (resolve, reject) {\r\n\t\t\t\t\t\t\t\t var groupedArrays = groupBy(array, function (item) {\r\n\t\t\t\t\t\t\t\t\t\t return getGroupProperties(item, groupProperties);\r\n\t\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t\t resolve(groupedArrays);\r\n\t\t\t\t\t\t });\r\n\t\t\t\t\t }\r\n\t\t\t\t\t //Retrieve the item values for grouping by\r\n\t\t\t\t\t function getGroupProperties(item, groups) {\r\n\t\t\t\t\t\t\t var array = [];\r\n\t\t\t\t\t\t\t angular.forEach(groups, function (group) {\r\n\t\t\t\t\t\t\t\t\t array.push(item[group]);\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t return array;\r\n\t\t\t\t\t }\r\n\t\t\t\t\t //Group the items into arrays using the values.\r\n\t\t\t\t\t function groupBy(array, f) {\r\n\t\t\t\t\t\t\t var groups = {};\r\n\t\t\t\t\t\t\t array.forEach(function (o) {\r\n\t\t\t\t\t\t\t\t\t var group = JSON.stringify(f(o));\r\n\t\t\t\t\t\t\t\t\t groups[group] = groups[group] || [];\r\n\t\t\t\t\t\t\t\t\t groups[group].push(o);\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t return Object.keys(groups).map(function (group) {\r\n\t\t\t\t\t\t\t\t\t return groups[group];\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t }\r\n\r\n\t        function manipulateString(string, transform, onlyFirst) {\r\n\t            switch(transform.toLowerCase()) {\r\n\t                case 'lower':\r\n\t                    if (onlyFirst)  return string.charAt(0).toLowerCase() + string.slice(1);\r\n\t                    if (!onlyFirst) return string.toLowerCase();\r\n\t                    break;\r\n\t                case 'upper':\r\n\t                    if (onlyFirst) return string.charAt(0).toUpperCase() + string.slice(1);\r\n\t                    if (!onlyFirst) return string.toUpperCase();\r\n\t                    break;\r\n\t                default:\r\n\t                    return string.toLowerCase();\r\n\t            }\r\n\t        }\r\n\r\n\t\t\t\t\tfunction weekEndingForDate(convertToSunday) {\r\n\t\t\t        var date = new Date(convertToSunday),\r\n\t\t\t            day = date.getDay(),\r\n\t\t\t            diff = date.getDate() - day + (day === 0 ? 0:7),\r\n\t\t\t            temp = new Date(convertToSunday),\r\n\t\t\t            wkEnd = new Date(temp.setDate(diff));\r\n\t\t\t        return moment(wkEnd.toISOString()).endOf('day');\r\n\t\t\t    }\r\n\r\n\t        //returns the options for the various filters in list pages.\r\n\t        function getSelectListOptions(controller) {\r\n\t            var selectListOptions = {};\r\n\t            if (controller !== 'character' && controller !== 'topten') {\r\n\t                selectListOptions.status = [ { v: '', n: 'All' }, { v: false, n: 'Ongoing' }, { v: true, n: 'Completed' } ];\r\n\t                selectListOptions.searchName = 'title';\r\n\t                if (controller === 'animeitem' || controller === 'watch') {\r\n\t                    selectListOptions.onHold = [ { v: '', n: 'All' }, { v: false, n: 'Ongoing' }, { v: true, n: 'On Hold' } ];\r\n\t                    selectListOptions.sortOptions = [ { v: 'title', n: 'Title' },{ v: 'episodes', n: 'Episodes' },{ v: 'start', n: 'Start date' },\r\n\t                                                      { v: 'end', n: 'End date' },{ v: ['latest', 'meta.updated'], n: 'Latest' },{ v: 'rating', n: 'Rating' }\r\n\t                                                    ];\r\n\t                    selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Latest');\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: false, n: 'Online' }, { v: true, n: 'Disc' } ];\r\n\t                    selectListOptions.mediaType = 'disc';\r\n\t                    selectListOptions.repeating = [ { v: '', n: 'All' }, { v: false, n: 'Not Re-watching' }, { v: true, n: 'Re-watching' } ];\r\n\t                    selectListOptions.repeatType = 'reWatching';\r\n\t                } else if (controller === 'mangaitem') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'title', n: 'Title' },{ v: 'chapters', n: 'Chapters' },{ v: 'volumes', n: 'Volumes' },{ v: 'start', n: 'Start date' },\r\n\t                                                      { v: 'end', n: 'End date' },{ v: ['latest', 'meta.updated'], n: 'Latest' },{ v: 'rating', n: 'Rating' }\r\n\t                                                    ];\r\n\t                    selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Latest');\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: false, n: 'Online' }, { v: true, n: 'Hardcopy' } ];\r\n\t                    selectListOptions.mediaType = 'hardcopy';\r\n\t                    selectListOptions.repeating = [ { v: '', n: 'All' }, { v: false, n: 'Not Re-reading' }, { v: true, n: 'Re-reading' } ];\r\n\t                    selectListOptions.repeatType = 'reReading';\r\n\t                }\r\n\t            } else {\r\n\t                if (controller === 'character') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'name', n: 'Name' }, { v: 'anime.title', n: 'Anime' }, { v: 'manga.title', n: 'Manga' }, { v: 'voice', n: 'Voice' }  ];\r\n\t                    selectListOptions.media = [\r\n\t                        { v: '', n: '-- choose media type --' }, { v: 'none', n: 'None' }, { v: 'anime', n: 'Anime-only' }, { v: 'manga', n: 'Manga-only' }, { v: 'both', n: 'Both' }\r\n\t                    ];\r\n\t                } else if (controller === 'topten') {\r\n\t                    selectListOptions.sortOptions = [ { v: 'name', n: 'Name' } ];\r\n\t                    selectListOptions.media = [ { v: '', n: 'All' }, { v: 'anime', n: 'Anime' }, { v: 'manga', n: 'Manga' }, { v: 'character', n: 'Character' } ];\r\n\t                    selectListOptions.mediaType = 'type';\r\n\t                }\r\n\t                selectListOptions.searchName = 'name';\r\n\t                selectListOptions.sortOption = service.findWithAttr(selectListOptions.sortOptions, 'n', 'Name');\r\n\t            }\r\n\t//            console.log(selectListOptions);\r\n\t            return selectListOptions;\r\n\t        }\r\n\r\n\t        function concatenateTagArrays(itemTags, tagArray) {\r\n\t            if (itemTags.length > 0) {\r\n\t                var i = 0, alreadyAdded = false;\r\n\t                while(i < tagArray.length) {\r\n\t                    for(var j = 0; j < itemTags.length; j++) {\r\n\t                        if (itemTags[j].text === tagArray[i].text) {\r\n\t                            alreadyAdded = true;\r\n\t                        }\r\n\t                    }\r\n\t                    //add if isn't already in the array.\r\n\t                    if (alreadyAdded === false) {\r\n\t                        itemTags.push(tagArray[i]);\r\n\t                    }\r\n\t                    i++;\r\n\t                    alreadyAdded = false;\r\n\t                }\r\n\t//                console.log(itemTags);\r\n\t                return itemTags;\r\n\t            } else {\r\n\t                //if there are no tags for item, then just return the new tags.\r\n\t                return tagArray;\r\n\t            }\r\n\t        }\r\n\r\n\t        //check to see if there are items with no tags.\r\n\t        function checkForTagless(items) {\r\n\t            var areTagless = false;\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.tags.length === 0) {\r\n\t                    areTagless = true;\r\n\t                }\r\n\t            });\r\n\t            return areTagless;\r\n\t        }\r\n\r\n\t        function getCommonArrays(controller) {\r\n\t            var commonArrays = {},\r\n\t                itemTypes = [\r\n\t                    { name: 'anime' },\r\n\t                    { name: 'manga' },\r\n\t                    { name: 'character' }\r\n\t                ],\r\n\t                seasons = [\r\n\t                    { number: '03', text: 'Winter' },\r\n\t                    { number: '06', text: 'Spring' },\r\n\t                    { number: '09', text: 'Summer' },\r\n\t                    { number: '12', text: 'Fall' }\r\n\t                ],\r\n\t                months = [\r\n\t                    { number: '01', text: 'January' },\r\n\t                    { number: '02', text: 'February' },\r\n\t                    { number: '03', text: 'March' },\r\n\t                    { number: '04', text: 'April' },\r\n\t                    { number: '05', text: 'May' },\r\n\t                    { number: '06', text: 'June' },\r\n\t                    { number: '07', text: 'July' },\r\n\t                    { number: '08', text: 'August' },\r\n\t                    { number: '09', text: 'September' },\r\n\t                    { number: '10', text: 'October' },\r\n\t                    { number: '11', text: 'November' },\r\n\t                    { number: '12', text: 'December' }\r\n\t                ],\r\n\t                categories = [\r\n\t                    {name: 'Watch'},\r\n\t                    {name: 'Read'},\r\n\t                    {name: 'Play'},\r\n\t                    {name: 'Other'}\r\n\t                ],\r\n\t                days = [\r\n\t                    {name: 'Any'},\r\n\t                    {name: 'Monday'},\r\n\t                    {name: 'Tuesday'},\r\n\t                    {name: 'Wednesday'},\r\n\t                    {name: 'Thursday'},\r\n\t                    {name: 'Friday'},\r\n\t                    {name: 'Saturday'},\r\n\t                    {name: 'Sunday'}\r\n\t                ],\r\n\t                summaryFunctions = [\r\n\t                    { name: 'Average' },\r\n\t                    { name: 'Highest' },\r\n\t                    { name: 'Lowest' },\r\n\t                    { name: 'Mode' }\r\n\t                ];\r\n\t            commonArrays = { months: months, seasons: seasons, categories: categories, days: days, summaryFunctions: summaryFunctions, itemTypes: itemTypes };\r\n\t            return commonArrays;\r\n\t        }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('animeitems')\r\n\t.factory('WatchAnime', WatchAnime);\r\n\tWatchAnime.$inject = ['$resource'];\r\n\r\n\t\tfunction WatchAnime($resource) {\r\n\t\t\treturn $resource('animeitems/watch-list', { }, { update: { method: 'PUT' } });\r\n\t\t}\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('characters').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Characters', 'characters', 'dropdown', '/characters(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'characters', 'List Characters', 'characters');\r\n\t\tMenus.addSubMenuItem('topbar', 'characters', 'New Character', 'characters/create');\r\n\t}\r\n]);\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('characters').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Characters state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listCharacters', {\r\n\t\t\turl: '/characters',\r\n\t\t\ttemplateUrl: 'modules/characters/views/list-characters.client.view.html'\r\n\t\t}).\r\n\t\tstate('createCharacter', {\r\n\t\t\turl: '/characters/create',\r\n\t\t\ttemplateUrl: 'modules/characters/views/create-character.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewCharacter', {\r\n\t\t\turl: '/characters/:characterId',\r\n\t\t\ttemplateUrl: 'modules/characters/views/view-character.client.view.html'\r\n\t\t}).\r\n\t\tstate('editCharacter', {\r\n\t\t\turl: '/characters/:characterId/edit',\r\n\t\t\ttemplateUrl: 'modules/characters/views/edit-character.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.controller('CharactersController', CharactersController);\r\n\tCharactersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Characters', 'Animeitems', 'Mangaitems', 'fileUpload', '$sce', '$window', 'ListService', 'CharacterService', 'NotificationFactory', 'spinnerService', 'TagService'];\r\n\r\n\tfunction CharactersController($scope, $stateParams, $location, Authentication, Characters, Animeitems, Mangaitems, fileUpload, $sce, $window, ListService, CharacterService, NotificationFactory, spinnerService, TagService) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.filterConfig = {\r\n\t\t\tisList: 'list', //show list? or slider.\r\n      showingCount: 0,\r\n      sortType: '',\r\n      sortReverse: false,\r\n      searchTags: '',\r\n      media: '',\r\n      seriesFilter: '',\r\n      tagsForFilter: [],\r\n      taglessItem: false,\r\n      areTagless: false,\r\n      selectListOptions: {},\r\n      statTags: [],\r\n      voiceActors: [],\r\n      series: []\r\n    };\r\n\t\tctrl.find = find;\r\n\t\tctrl.findAnime = findAnime;\r\n\t\tctrl.findManga = findManga;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.findOneAnime = findOneAnime;\r\n\t\tctrl.findOneManga = findOneManga;\r\n    ctrl.imgPath = ''; //image path\r\n\t\tctrl.maxItemCount = 0; //number of characters.\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.removeTag = removeTag;\r\n    ctrl.tagArray = []; // holding tags pre-submit\r\n    ctrl.tagArrayRemove = [];\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n    ctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.whichController = 'character';\r\n\r\n\r\n\t\t//allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n    //For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for animeitem tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.mangaitem.tags, text);\r\n\t\t}\r\n\r\n\t\t// Create new Character\r\n\t\tfunction create() {\r\n\t    //console.log(ctrl.tagArray);\r\n\t    var character = new Characters();\r\n\t\t\t// Create new Character object\r\n\t\t\tcharacter = new Characters ({\r\n\t\t\t\tname: ctrl.name,\r\n      \timage: ctrl.imgPath,\r\n        anime: ctrl.anime!==undefined && ctrl.anime!==null ? ctrl.anime._id : ctrl.anime,\r\n        manga: ctrl.manga!==undefined && ctrl.manga!==null ? ctrl.manga._id : ctrl.manga,\r\n        voice: ctrl.voice,\r\n        tags: ctrl.tagArray,\r\n        user: ctrl.user\r\n\t\t\t});\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\tcharacter.$save(function(response) {\r\n\t\t\t\t$location.path('characters/' + response._id);\r\n        NotificationFactory.success('Saved!', 'Character was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n\t\t\t\tNotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Remove existing Character\r\n\t\tfunction remove(character) {\r\n      //are you sure option...\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( character ) {\r\n\t          character.$remove();\r\n\t          for (var i in ctrl.characters) {\r\n\t            if (ctrl.characters [i] === character) {\r\n\t                ctrl.characters.splice(i, 1);\r\n\t            }\r\n\t          }\r\n\t        } else {\r\n\t          ctrl.character.$remove(function() {\r\n\t\t\t\t\t\t\t$location.path('characters');\r\n\t          });\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Character was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Update existing Character\r\n\t\tfunction update() {\r\n\t\t\tvar character = ctrl.character;\r\n      //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n      if (ctrl.character.manga!==null && ctrl.character.manga!==undefined) {\r\n          character.manga = ctrl.character.manga._id;\r\n      }\r\n//            console.log(ctrl.character.anime);\r\n      if (ctrl.character.anime!==null && ctrl.character.anime!==undefined) {\r\n          character.anime = ctrl.character.anime._id;\r\n      }\r\n\r\n      if (ctrl.tagArray!==undefined) {\r\n          character.tags = ListService.concatenateTagArrays(character.tags, ctrl.tagArray);\r\n      }\r\n\r\n      if (ctrl.imgPath!==undefined && ctrl.imgPath!==null && ctrl.imgPath!=='') {\r\n          character.image = ctrl.imgPath;\r\n      }\r\n\r\n\t\t\tcharacter.$update(function() {\r\n\t\t\t\t$location.path('characters');\r\n\t\t\t\tNotificationFactory.success('Saved!', 'Character was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n        NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Find a list of Characters\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t\t\tspinnerService.loading('characters', Characters.query().$promise.then(function(result) {\r\n\t\t\t\tctrl.characters = result;\r\n\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\tctrl.filterConfig.statTags = CharacterService.buildCharacterTags(result);\r\n\t\t\t\tctrl.filterConfig.voiceActors = CharacterService.buildVoiceActors(result);\r\n\t\t\t\tctrl.filterConfig.series = CharacterService.buildSeriesList(result);\r\n\t\t\t\tconsole.log('find characters: ', ctrl.characters, ctrl.filterConfig);\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\t// Find existing Character\r\n\t\tfunction findOne() {\r\n\t\t\tctrl.character = Characters.get({\r\n\t\t\t\tcharacterId: $stateParams.characterId\r\n\t\t\t});\r\n\t\t}\r\n\r\n    // Find a list of Animeitems\r\n\t\tfunction findAnime() {\r\n\t\t\tctrl.animeitems = Animeitems.query();\r\n\t\t}\r\n\r\n    // Find existing Animeitem\r\n\t\tfunction findOneAnime(anime) {\r\n\t\t\tctrl.animeitem = Animeitems.get({\r\n\t\t\t\tanimeitemId: anime\r\n\t\t\t});\r\n\t\t}\r\n\r\n    // Find a list of Mangaitems\r\n\t\tfunction findManga() {\r\n\t\t\tctrl.mangaitems = Mangaitems.query();\r\n\t\t}\r\n\r\n    // Find existing Animeitem\r\n\t\tfunction findOneManga(manga) {\r\n\t\t\tctrl.mangaitem = Mangaitems.get({\r\n\t\t\t\tmangaitemId: manga\r\n\t\t\t});\r\n\t\t}\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/characters/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUploadCharacter');\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('characterBack', characterBack);\r\n\r\n   function characterBack(){\r\n      return function(scope, element, attrs){\r\n          var url = attrs.characterBack;\r\n          element.css({\r\n              'background-image': 'url(' + url +')',\r\n              'background-size' : 'cover',\r\n              'background-repeat': 'no-repeat',\r\n              'background-position': 'center'\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('clearTagValues', clearTagValues);\r\n\r\n  function clearTagValues() {\r\n      return function (scope, element, attrs) {\r\n          element.bind('click', function(event) {\r\n  //            console.log('clear tags');\r\n              scope.$apply(function() {\r\n                  scope.filterConfig.searchTags = '';\r\n                  scope.filterConfig.characterTags = '';\r\n                  scope.filterConfig.tagsForFilter = [];\r\n              });\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('deleteSearchTag', deleteSearchTag);\r\n\r\n  function deleteSearchTag() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function(scope, element, attrs) {\r\n              element.bind('click', function(event) {\r\n                  scope.$apply(function() {\r\n                      var tag = attrs.deleteSearchTag;\r\n                      var index = scope.filterConfig.tagsForFilter.indexOf(tag);\r\n  //                    console.log(tag, index);\r\n                      scope.filterConfig.searchTags = scope.filterConfig.searchTags.replace(tag + ',', '');\r\n                      scope.filterConfig.tagsForFilter.splice(index, 1);\r\n  //                    console.log(scope.searchTags, scope.tagsForFilter);\r\n                  });\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('disableNgAnimate', disableNgAnimate);\r\n  disableNgAnimate.$inject = ['$animate'];\r\n\r\n  function disableNgAnimate($animate) {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element) {\r\n        $animate.enabled(false, element);\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('dropTag', dropTag);\r\n  dropTag.$inject = ['NotificationFactory'];\r\n\r\n   function dropTag(NotificationFactory) {\r\n      return function(scope, element, attrs) {\r\n          element.bind('click', function(event) {\r\n              var text = attrs.dropTag;\r\n               //are you sure option...\r\n              NotificationFactory.confirmation(function() {\r\n                  scope.$apply(function() {\r\n                      var deletingItem = scope.tagArray;\r\n                      scope.$parent.tagArray = [];\r\n  //                    console.log('dropping tag - ', text);\r\n                      //update the complete task.\r\n                      angular.forEach(deletingItem, function(tag) {\r\n                          if (tag.text !== text) {\r\n                              scope.$parent.tagArray.push(tag);\r\n                          }\r\n                      });\r\n                  });\r\n                  NotificationFactory.warning('Dropped!', 'Tag was successfully dropped');\r\n              });\r\n          });\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('enterTag', enterTag);\r\n  function enterTag() {\r\n      return {\r\n          restrict: 'A',\r\n          link: function (scope, element, attrs) {\r\n              element.bind('keydown keypress', function (event) {\r\n                  if(event.which === 13) {\r\n                      scope.$apply(function (){\r\n                          scope.$eval(attrs.enterTag);\r\n                      });\r\n                      event.preventDefault();\r\n                   }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('removeTag', removeTag);\r\n  removeTag.$inject = ['NotificationFactory'];\r\n\r\n   function removeTag(NotificationFactory) {\r\n      return {\r\n          restrict: 'A',\r\n          link: function(scope, element, attrs) {\r\n              element.bind('click', function(event) {\r\n                  var tag = attrs.removeTag,\r\n                      i,\r\n                      entry_type = scope.whichController;\r\n                  //are you sure option...\r\n                NotificationFactory.confirmation(function() {\r\n                      scope.$apply(function () {\r\n                          var index;\r\n                          if (entry_type === 'character') {\r\n                              for(i=0; i < scope.character.tags.length; i++) {\r\n                                  if (scope.character.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.character.tags.splice(index, 1);\r\n                          } else if (entry_type === 'animeitem') {\r\n                              for(i=0; i < scope.animeitem.tags.length; i++) {\r\n                                  if (scope.animeitem.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.animeitem.tags.splice(index, 1);\r\n                          } else if (entry_type === 'mangaitem') {\r\n                              for(i=0; i < scope.mangaitem.tags.length; i++) {\r\n                                  if (scope.mangaitem.tags[i].text === tag) {\r\n                                      index = i;\r\n                                  }\r\n  //                                console.log(index);\r\n                              }\r\n                              scope.$parent.mangaitem.tags.splice(index, 1);\r\n                          }\r\n  //                        console.log(index, tag);\r\n                      });\r\n                      NotificationFactory.warning('Deleted!', 'Tag was successfully deleted');\r\n                  });\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .directive('slider', slider);\r\n  slider.$inject = ['$timeout', '$sce'];\r\n\r\n  function slider($timeout, $sce) {\r\n    return {\r\n        restrict: 'AE',\r\n        replace: true,\r\n        scope: {\r\n            slides: '=?',\r\n            interval: '=?',\r\n            filterConfig: '=?'\r\n        },\r\n        bindToController: true,\r\n        controllerAs: 'sliderController',\r\n        templateUrl: '/modules/characters/templates/slider.html',\r\n        controller: function($scope) {\r\n          var self = this,\r\n              timer,\r\n              autoSlide;\r\n          self.currentIndex = -1; //pre-first slide to stop 'cannot assign to undefined' error.\r\n          self.enter = enter;\r\n          self.goToSlide = goToSlide;\r\n          self.interval = self.interval === undefined ? 3000 : self.interval; //is there a custom interval?\r\n          self.isFullscreen = false;\r\n          self.leave = leave;\r\n          self.next = next;\r\n          self.prev = prev;\r\n          self.repeater = self.slides === undefined ? false : true; //is there a collection to iterate through?\r\n          self.toggleFullscreen = toggleFullscreen;\r\n          self.trustAsResourceUrl = trustAsResourceUrl;\r\n\r\n          //allow retreival of local resource\r\n          function trustAsResourceUrl(url) {\r\n              return $sce.trustAsResourceUrl(url);\r\n          }\r\n\r\n          //if no collection, make a dummy collection to cycle throught the children.\r\n          if (!self.repeater) {\r\n            self.slides = []; //used to allow cycling.\r\n            for(var i = 0; i < length; i++) {\r\n                self.slides.push({ index: i });\r\n            }\r\n          }\r\n          function goToSlide(slide) {\r\n  //              console.log('go to', slide);\r\n              if (self.currentIndex !== slide) {\r\n                  //reached end of slides?\r\n                  if (slide !== $scope.filteredSlides.length) {\r\n                    self.currentIndex = slide;\r\n                  } else {\r\n                    self.currentIndex = 0;\r\n                  }\r\n              } else {\r\n                  if ($scope.filteredSlides[self.currentIndex].locked) {\r\n                    //unlock, i.e start timer.\r\n                    $scope.filteredSlides[self.currentIndex].locked = false;\r\n                      autoSlide();\r\n                  } else {\r\n                    //lock, i.e. cancel timer.\r\n                    $scope.filteredSlides[self.currentIndex].locked = true;\r\n                    $timeout.cancel(timer);\r\n                  }\r\n              }\r\n          }\r\n\r\n          function next() {\r\n              if (self.currentIndex < $scope.filteredSlides.length - 1) {\r\n                  self.currentIndex += 1;\r\n\r\n              } else {\r\n                  self.currentIndex = 0;\r\n              }\r\n          }\r\n\r\n          function prev() {\r\n              if (self.currentIndex > 0) {\r\n                  self.currentIndex -= 1;\r\n              } else {\r\n                  self.currentIndex = $scope.filteredSlides.length - 1;\r\n              }\r\n          }\r\n\r\n          $scope.$watch('sliderController.currentIndex', function() {\r\n              //  console.log('index', self.currentIndex, 'filtered slides ', $scope.filteredSlides);\r\n              if (self.currentIndex > -1 && $scope.filteredSlides.length > 0) {\r\n                    $scope.filteredSlides.forEach(function(slide) {\r\n                        slide.visible = false; // make every slide invisible\r\n                        slide.locked = false; // make every slide unlocked\r\n                    });\r\n                    $scope.filteredSlides[self.currentIndex].visible = true; // make the current slide visible\r\n              }\r\n          });\r\n\r\n          autoSlide = function() {\r\n              timer = $timeout(function() {\r\n                  self.next();\r\n                  timer = $timeout(autoSlide, self.interval);\r\n              }, self.interval);\r\n          };\r\n          autoSlide();\r\n          $scope.$on('$destroy', function() {\r\n              $timeout.cancel(timer); // when the scope is destroyed, cancel the timer\r\n          });\r\n\r\n          //Stop timer on enter.\r\n          function enter() {\r\n  //              console.log('entered');\r\n              if ($scope.filteredSlides[self.currentIndex].locked !== true) {\r\n                $timeout.cancel(timer);\r\n  //                  console.log('cancelled');\r\n              }\r\n          }\r\n          //Restart timer on leave.\r\n          function leave() {\r\n  //              console.log('left');\r\n              if ($scope.filteredSlides[self.currentIndex].locked !== true) {\r\n                timer = $timeout(autoSlide, self.interval);\r\n  //                  console.log('restarted');\r\n              }\r\n          }\r\n\r\n          //Fullscreen capability\r\n          function toggleFullscreen() {\r\n              self.isFullscreen = !self.isFullscreen;\r\n          }\r\n\r\n        },\r\n        link: function(scope, elem, attrs, sliderController) {\r\n            scope.childElementCount = elem[0].childElementCount - 1;\r\n        }\r\n    };\r\n\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('mediaFilter', mediaFilter);\r\n\r\n  function mediaFilter() {\r\n      return function(array, media) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  if (media==='anime') {\r\n                      if (item.anime!==null && item.manga===null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='manga') {\r\n                      if (item.manga!==null && item.anime===null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='both') {\r\n                      if (item.anime!==null && item.manga!==null) {\r\n                          return true;\r\n                      }\r\n                      return false;\r\n                  } else if (media==='none') {\r\n                      if (item.anime===null && item.manga===null) {\r\n                          return true;\r\n                      }\r\n                  } else {\r\n                      return true;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('seriesDetailFilter', seriesDetailFilter);\r\n\r\n  function seriesDetailFilter() {\r\n    return function(array, detailSeriesName) {\r\n        if (array !== undefined) {\r\n            return array.filter(function(item) {\r\n                if (detailSeriesName !== '') {\r\n                    //filter stat series detail.\r\n                    if (item.anime!==null && item.anime!==undefined) {\r\n                        if (item.anime.title===detailSeriesName) {\r\n                            return item;\r\n                        }\r\n                    } else if (item.manga!==null && item.manga!==undefined) {\r\n                        if (item.manga.title===detailSeriesName) {\r\n                            return item;\r\n                        }\r\n                    }\r\n                } else {\r\n                    return item;\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('seriesFilter', seriesFilter);\r\n\r\n  function seriesFilter() {\r\n      return function(array, series) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  if (series !== '' && series !== undefined) {\r\n                      //filter stat series detail.\r\n                      if (item.anime!==null && item.anime!==undefined) {\r\n                          return item.anime.title.toLowerCase().indexOf(series.toLowerCase()) > -1;\r\n                      } else if (item.manga!==null && item.manga!==undefined) {\r\n                          return item.manga.title.toLowerCase().indexOf(series.toLowerCase()) > -1;\r\n                      }\r\n                  } else {\r\n                      return item;\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('characters')\r\n  .filter('tagFilter', tagFilter);\r\n\r\n  function tagFilter() {\r\n      return function(array, searchTags, taglessItem) {\r\n          if (array !== undefined) {\r\n              return array.filter(function(item) {\r\n                  //special tag filter\r\n                  var found = false;\r\n                  var i = 0;\r\n                  var tagsToSearch = [];\r\n                  var tagsForFilter;\r\n\r\n                  //if tagless is checked return tagless and nothing else.\r\n                  if (taglessItem===true) {\r\n                      if (item.tags.length===0) {\r\n                          return item;\r\n                      }\r\n                  } else {\r\n                      if (searchTags===undefined || searchTags==='') {\r\n                          return true;\r\n                      } else {\r\n                          //get tags that are being looked for\r\n                          tagsForFilter = searchTags.substring(0, searchTags.length - 1).split(',');\r\n                          //console.log(tagsForFilter);\r\n\r\n                          //get tags of items to filter\r\n                          angular.forEach(item.tags, function(tag) {\r\n                              tagsToSearch.push(tag.text);\r\n                          });\r\n\r\n                          //filter: check in 'query' is in tags.\r\n                          for(i = 0; i < tagsForFilter.length; i++) {\r\n                              if (tagsToSearch.indexOf(tagsForFilter[i]) !== -1) {\r\n                                  found = true;\r\n                              } else {\r\n                                  return false;\r\n                              }\r\n                          }\r\n                          return found;\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.service('CharacterService', CharacterService);\r\n\tCharacterService.$inject = ['$q'];\r\n\r\n\tfunction CharacterService($q) {\r\n\r\n\t    //build the character gender distribution.\r\n\t    this.buildGenderDistribution = function(items, maxCount) {\r\n\t        return $q(function(resolve, reject) {\r\n\t            var check, gender = [];\r\n\t            angular.forEach(items, function(item) {\r\n\t                if (item.tag === 'male') {\r\n\t                    gender.push({\r\n\t                        type: 'male',\r\n\t                        count: item.count,\r\n\t                        percentage: Number(((item.count / maxCount) * 100).toFixed(2)),\r\n\t                        text: '% male.'\r\n\t                    });\r\n\t                } else if (item.tag === 'female') {\r\n\t                    gender.push({\r\n\t                        type: 'female',\r\n\t                        count: item.count,\r\n\t                        percentage: Number(((item.count / maxCount) * 100).toFixed(2)),\r\n\t                        text: '% female.'\r\n\t                    });\r\n\t                }\r\n\t            });\r\n\t            gender.push({\r\n\t                type: 'unassigned',\r\n\t                count: maxCount - gender[0].count - gender[1].count,\r\n\t                percentage: Number(((maxCount - gender[0].count - gender[1].count / maxCount) * 100).toFixed(2)),\r\n\t                text: '% unassigned.'\r\n\t            });\r\n\r\n\t            //Fudge any rounding errors.\r\n\t            check = gender[0].percentage + gender[1].percentage + gender[2].percentage;\r\n\t            if (check > 100) {\r\n\t                gender[2].percentage -= (check - 100).toFixed(2);\r\n\t            } else if (check < 100) {\r\n\t                gender[2].percentage += (100 - check).toFixed(2);\r\n\t            }\r\n\t            resolve(gender);\r\n\t        });\r\n\t    };\r\n\r\n\t    this.buildCharacterTags = function(items) {\r\n\t        var add = true, statTags = [];\r\n\t        //is tag in array?\r\n\t        angular.forEach(items, function(item) {\r\n\t            angular.forEach(item.tags, function(tag) {\r\n\t                for(var i=0; i < statTags.length; i++) {\r\n\t                    if (statTags[i].tag === tag.text) {\r\n\t                        add = false;\r\n\t                        statTags[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t                // add if not in\r\n\t                if (add===true) {\r\n\t                    statTags.push({ tag: tag.text, count: 1 });\r\n\t                }\r\n\t                add = true; //reset add status.\r\n\t            });\r\n\t//          console.log($scope.statTags);\r\n\t        });\r\n\r\n\t        return statTags;\r\n\t    };\r\n\r\n\t    this.buildRelatedCharacterTags = function(items, name) {\r\n\t        var add = true, tagDetailCollection = [], tagDetailResult = [];\r\n\t        //get all character tag arrays that contain the chosen tag into a collection.\r\n\t        angular.forEach(items, function(item){\r\n\t            for(var i=0; i < item.tags.length; i++) {\r\n\t                if (item.tags[i].text === name) {\r\n\t                    tagDetailCollection.push(item.tags);\r\n\t                }\r\n\t            }\r\n\t        });\r\n\t//        console.log(tagDetailCollection);\r\n\t        angular.forEach(tagDetailCollection, function(item) {\r\n\t            angular.forEach(item, function(bit) {\r\n\t//              console.log(bit);\r\n\t                for(var i=0; i < tagDetailResult.length; i++) {\r\n\t                    //if exists and not the search value - increment the count.\r\n\t                    if (tagDetailResult[i].name===bit.text && bit.text!==name) {\r\n\t                        add = false;\r\n\t                        tagDetailResult[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t                //add if true and not the tag we searched on.\r\n\t                if (add===true && bit.text!==name) {\r\n\t                    tagDetailResult.push({ name: bit.text, count: 1 });\r\n\t                }\r\n\t                add = true;\r\n\t            });\r\n\t        });\r\n\t//        console.log(tagDetailResult);\r\n\t        return tagDetailResult;\r\n\t    };\r\n\r\n\t    this.buildVoiceActors = function(items) {\r\n\t        var add = true, voiceActors = [];\r\n\t        //is voice actor in array?\r\n\t        angular.forEach(items, function(item) {\r\n\t            for(var i=0; i < voiceActors.length; i++) {\r\n\t                if (voiceActors[i].name === item.voice) {\r\n\t                    add = false;\r\n\t                    voiceActors[i].count += 1;\r\n\t                }\r\n\t            }\r\n\t            // add if not in\r\n\t            if (add===true) {\r\n\t                voiceActors.push({ name: item.voice, count: 1 });\r\n\t            }\r\n\t            add = true; //reset add status.\r\n\t        });\r\n\r\n\t        return voiceActors;\r\n\t    };\r\n\r\n\t    this.buildSeriesList = function(items) {\r\n\t        var add = true, statSeries = [];\r\n\t        //get series counts.\r\n\t        angular.forEach(items, function(item) {\r\n\t            for(var i=0; i < statSeries.length; i++) {\r\n\t                if (item.anime) {\r\n\t                    if (statSeries[i].name === item.anime.title) {\r\n\t                        add = false;\r\n\t                        statSeries[i].count += 1;\r\n\t                    }\r\n\t                } else if (item.manga) {\r\n\t                    if (statSeries[i].name === item.manga.title) {\r\n\t                        add = false;\r\n\t                        statSeries[i].count += 1;\r\n\t                    }\r\n\t                }\r\n\t            }\r\n\t            // add if not in\r\n\t            if (add === true) {\r\n\t                if (typeof(item.anime) === 'object' && item.anime !== null) {\r\n\t                    statSeries.push({ _id: item.anime._id, name: item.anime.title, count: 1 });\r\n\t                } else if (typeof(item.manga) === 'object' && item.manga !== null) {\r\n\t                    statSeries.push({ _id: item.manga._id, name: item.manga.title, count: 1 });\r\n\t                }\r\n\t            }\r\n\t            add = true; //reset add status.\r\n\t        });\r\n\r\n\t        return statSeries;\r\n\t    };\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.factory('Characters', CharacterFactory);\r\n\t CharacterFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction CharacterFactory($resource) {\r\n\t\t\treturn $resource('characters/:characterId', { characterId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('characters')\r\n\t.service('TagService', TagService);\r\n\tTagService.$inject = ['$rootScope', 'NotificationFactory'];\r\n\r\n\t function TagService($rootScope, NotificationFactory) {\r\n\t\t\tvar service = {};\r\n\r\n\t\t\t//Add newTag to tagArray\r\n\t\t\tservice.addTag = function(tagArray, newTag) {\r\n\t\t\t    if (newTag!=='' && newTag!==undefined) {\r\n\t\t\t        var i = 0, alreadyAdded = false;\r\n\t\t\t        if (tagArray.length > 0) {\r\n\t\t\t            while(i < tagArray.length) {\r\n\t\t\t                if (tagArray[i].text === newTag) {\r\n\t\t\t                    alreadyAdded = true;\r\n\t\t\t                }\r\n\t\t\t                i++;\r\n\t\t\t            }\r\n\t\t\t            //if not in array add it.\r\n\t\t\t            if (alreadyAdded === false) {\r\n\t\t\t                tagArray.push({ text: newTag });\r\n\t\t\t            }\r\n\t\t\t        } else {\r\n\t\t\t            tagArray.push({ text: newTag });\r\n\t\t\t        }\r\n\t\t\t    }\r\n\t\t\t};\r\n\r\n\t\t\t//Drop tag with text = text, from tagArray\r\n\t\t\tservice.dropTag = function(tagArray, text) {\r\n\t\t\t\t //are you sure option...\r\n\t\t\t\tNotificationFactory.confirmation(function() {\r\n\t\t\t\t\t$rootScope.$apply(function() {\r\n\t\t\t\t\t\tvar i = tagArray.length;\r\n\t\t\t\t\t\twhile(i--) {\r\n\t\t\t\t\t\t\tif(tagArray[i].text === text) {\r\n\t\t\t\t\t\t\t\ttagArray.splice(i, 1);\r\n\t\t\t\t\t\t\t\tNotificationFactory.warning('Dropped!', 'Tag was successfully dropped');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\treturn service;\r\n\t}\r\n\r\n})();\r\n\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('core').controller('HeaderController', HeaderController);\r\n\tHeaderController.$inject = ['$scope', 'Authentication', 'Menus', '$location'];\r\n\r\n\tfunction HeaderController($scope, Authentication, Menus, $location) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.changeTheme = changeTheme;\r\n\t\tctrl.isActive = isActive;\r\n\t\tctrl.isCollapsed = false;\r\n\t\tctrl.isTimedTheme = localStorage.getItem('timedTheme');\r\n\t\tctrl.menu = Menus.getMenu('topbar');\r\n\t\tctrl.saved = localStorage.getItem('theme');\r\n\t\tctrl.styles = [\r\n        { name: 'Day', url: 'dist/main-day.css' },\r\n        { name: 'Night', url: 'dist/main-night.css' }\r\n    ];\r\n\t\tctrl.theme = (localStorage.getItem('theme')!==null) ? JSON.parse(ctrl.saved) : ctrl.styles[1].url;\r\n\t\tctrl.timedTheme = (localStorage.getItem('timedTheme')!==null) ? JSON.parse(ctrl.isTimedTheme) : false;\r\n\t\tctrl.toggleCollapsibleMenu = toggleCollapsibleMenu;\r\n\r\n\t\tlocalStorage.setItem('theme', JSON.stringify(ctrl.theme));\r\n  \tlocalStorage.setItem('timedTheme', JSON.stringify(ctrl.timedTheme));\r\n\r\n\t\tfunction toggleCollapsibleMenu() {\r\n\t\t\tctrl.isCollapsed = !ctrl.isCollapsed;\r\n\t\t}\r\n\r\n\t\t// Collapsing the menu after navigation\r\n\t\t$scope.$on('$stateChangeSuccess', function() {\r\n\t\t\tctrl.isCollapsed = false;\r\n\t\t});\r\n\r\n    function isActive(viewLocation) {\r\n        return viewLocation === $location.path();\r\n    }\r\n\r\n    function changeTheme() {\r\n        localStorage.setItem('timedTheme', JSON.stringify(ctrl.timedTheme));\r\n        var timeOfDayTheme = localStorage.getItem('timedTheme');\r\n        if (timeOfDayTheme === 'false') {\r\n            localStorage.setItem('theme', JSON.stringify(ctrl.theme));\r\n        } else {\r\n            var time = new Date().getHours();\r\n            if (time > 20 || time < 8) {\r\n                localStorage.setItem('theme', JSON.stringify(ctrl.styles[1].url));\r\n            } else if (time > 8) {\r\n                localStorage.setItem('theme', JSON.stringify(ctrl.styles[0].url));\r\n            }\r\n        }\r\n        var storedValue = localStorage.getItem('theme'),\r\n        link = document.getElementById('app-theme');\r\n        link.href = storedValue.substr(1, storedValue.lastIndexOf('\\\"') - 1); //remove quotes for whatever reason.\r\n        ctrl.theme = storedValue.substr(1, storedValue.lastIndexOf('\\\"') - 1); //remove quotes for whatever reason. //set the dropdown to the correct value;\r\n    }\r\n\r\n\t}\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('anywhereButHere', anywhereButHere);\r\n  anywhereButHere.$inject = ['$compile'];\r\n\r\n  function anywhereButHere($compile) {\r\n      return {\r\n          restrict: 'A',\r\n          scope: {\r\n            showBackdrop: '=ngShow'\r\n          },\r\n          link: function (scope, element, attrs) {\r\n            var body = document.body,\r\n                backdrop = angular.element('<div id=\"anywhere-but-here-backdrop\" ng-show=\"showBackdrop\" ng-click=\"triggerAnywhereButHere()\"></div>')[0];\r\n            body.appendChild(backdrop);\r\n            $compile(backdrop)(scope);\r\n\r\n            scope.triggerAnywhereButHere = function() {\r\n              scope.showBackdrop = false;\r\n            };\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('clickPass', clickPass);\r\n  clickPass.$inject = ['$timeout'];\r\n\r\n   function clickPass($timeout) {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        element.bind('click', function(event) {\r\n          $timeout(function() {\r\n            event.stopPropagation();\r\n            document.getElementById(attrs.clickPass).click();\r\n          }, 0);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('formatDate', formatDate);\r\n   function formatDate(){\r\n    return {\r\n     require: 'ngModel',\r\n      link: function(scope, elem, attr, modelCtrl) {\r\n        modelCtrl.$formatters.push(function(modelValue){\r\n          return (modelValue === null) ? null : new Date(modelValue);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('loadingSpinner', loadingSpinner);\r\n  loadingSpinner.$inject = ['$http', 'spinnerService'];\r\n\r\n   function loadingSpinner($http, spinnerService) {\r\n      return {\r\n          restrict: 'A',\r\n          transclude: true,\r\n          replace: true,\r\n          templateUrl: '/modules/core/templates/loading-spinner.html',\r\n          scope: {\r\n              name: '@',\r\n              size: '@?'\r\n          },\r\n          bindToController: 'loadingSpinner',\r\n          controller: function ($scope) {\r\n              $scope.active = false;\r\n  //            $scope.isLoading = function () {\r\n  //                return $http.pendingRequests.length > 0;\r\n  //            };\r\n\r\n  //            $scope.$watch($scope.isLoading, function (v) {\r\n  //                if ($scope.size === 'fullscreen') {\r\n  //                    if(v) {\r\n  //                        $scope.active = true;\r\n  //                    } else {\r\n  //                        $scope.active = false;\r\n  //                    }\r\n  //                }\r\n  //            });\r\n\r\n              var api = {\r\n                  name: $scope.name,\r\n                  show: function () {\r\n                      $scope.active = true;\r\n                  },\r\n                  hide: function () {\r\n                      $scope.active = false;\r\n                  },\r\n                  toggle: function () {\r\n                      $scope.active = !$scope.active;\r\n                  }\r\n              };\r\n\r\n              spinnerService._register(api);\r\n              $scope.$on('$destroy', function () {\r\n                  spinnerService._unregister($scope.name);\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('malSearch', malSearch);\r\n  malSearch.$inject = ['MalService', '$timeout'];\r\n\r\n  function malSearch(MalService, $timeout) {\r\n      return {\r\n          restrict: 'A',\r\n          replace: true,\r\n          scope: {\r\n            type: '=malSearch',\r\n            selectItem: '=malSearchSelect',\r\n            searchString: '=malSearchModel',\r\n            options: '=malSearchOptions'\r\n          },\r\n          controllerAs: 'malSearchCtrl',\r\n          bindToController: true,\r\n          templateUrl: '/modules/core/templates/mal-search.html',\r\n          controller: function ($scope) {\r\n            var self = this,\r\n                timeoutPromise,\r\n                delayInMs = 2000;\r\n\r\n            self.displayActions = false;\r\n            self.displaySelectedItemActions = displaySelectedItemActions;\r\n            self.hasFocus = false;\r\n            self.hasSearchResults = false;\r\n            self.processItem = processItem;\r\n            self.searchResults = [];\r\n            self.selectedItem = null;\r\n            self.selectedItemActions = [\r\n              {\r\n                displayText: 'Remove selected',\r\n                action: function() {\r\n                  self.processItem(null);\r\n                  self.searchString = undefined;\r\n                  self.displayActions = false;\r\n                }\r\n              },\r\n              {\r\n                displayText: 'Display raw json',\r\n                action: function() {\r\n                  self.displayRawJson = true;\r\n                }\r\n              }\r\n            ];\r\n            self.toggleSearchDropdownOnFocus = toggleSearchDropdownOnFocus;\r\n\r\n            function processItem(item) {\r\n              self.selectItem(item);\r\n              self.selectedItem = item;\r\n            }\r\n\r\n            function displaySelectedItemActions() {\r\n              self.displayActions = true;\r\n            }\r\n\r\n            function searchMal(type, searchString) {\r\n              MalService.search(type, searchString).then(function (result) {\r\n                self.searchResults = result;\r\n                self.hasSearchResults = true;\r\n              });\r\n            }\r\n\r\n            function toggleSearchDropdownOnFocus(event) {\r\n              $timeout(function() {\r\n                self.hasFocus = event.type === 'focus';\r\n              }, 500);\r\n            }\r\n\r\n            $scope.$watch('malSearchCtrl.searchString', function(newValue) {\r\n              self.hasFocus = true;\r\n              if(newValue !== undefined && newValue.length > 2 && self.selectedItem === null && !self.options.disabled) {\r\n                $timeout.cancel(timeoutPromise);\r\n                timeoutPromise = $timeout(function() {\r\n                     searchMal(self.type, newValue);\r\n                }, delayInMs);\r\n              }\r\n            });\r\n\r\n            $scope.$watch('malSearchCtrl.displayActions', function(newValue) {\r\n              if(newValue !== undefined && !newValue) {\r\n                self.displayRawJson = newValue;\r\n              }\r\n            });\r\n\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .directive('myProgress', myProgress);\r\n\r\n   function myProgress() {\r\n      return function(scope, element, attrs) {\r\n          scope.$watch(attrs.myProgress, function(val) {\r\n              var type = 'checklist-progress';\r\n              element.html('<div class=\"' + type + '\" style=\"width: ' + val + '%;height: 100%\"></div>');\r\n          });\r\n        };\r\n    }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('calendarFilter', calendarFilter);\r\n\r\n   function calendarFilter() {\r\n      return function(array, datesSelected) {\r\n          if (array) {\r\n              return array.filter(function(item) {\r\n                  //date filter\r\n                  if (item.date === null || item.date === undefined) {\r\n                      if (datesSelected === false) {\r\n                          return item;\r\n                      }\r\n                      return false;\r\n                  }\r\n\r\n                  var day = new Date().getDay(),\r\n                      diff = new Date().getDate() - day + (day === 0 ? 0:7),\r\n                      temp = new Date(),\r\n                      wkEnd = new Date(temp.setDate(diff)),\r\n                      currentWkEnd = wkEnd.toISOString().substring(0,10),\r\n                      iDate = new Date(item.date).toISOString(),\r\n                      itemDate = { year: iDate.substr(0,4), month: iDate.substr(5,2), day: iDate.substr(8,2) },\r\n                      currentDate = { year: currentWkEnd.substr(0,4), month: currentWkEnd.substr(5,2), day: currentWkEnd.substr(8,2) };\r\n\r\n                  if (datesSelected === false) {\r\n                      if (itemDate.year < currentDate.year) {\r\n                          return item;\r\n                      } else if (itemDate.year === currentDate.year) {\r\n                          if (itemDate.month < currentDate.month) {\r\n                              return item;\r\n                          } else if (itemDate.month === currentDate.month) {\r\n                              if (itemDate.day <= currentDate.day) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  } else if (datesSelected === true) {\r\n                      if (itemDate.year > currentDate.year) {\r\n                          return item;\r\n                      } else if (itemDate.year === currentDate.year) {\r\n                          if (itemDate.month > currentDate.month) {\r\n                              return item;\r\n                          } else if (itemDate.month === currentDate.month) {\r\n                              if (itemDate.day > currentDate.day) {\r\n                                  return item;\r\n                              }\r\n                          }\r\n                      }\r\n                  }\r\n              });\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('dateSuffix', dateSuffix);\r\n\r\n   function dateSuffix($filter) {\r\n    var suffixes = ['th', 'st', 'nd', 'rd'];\r\n    return function(input) {\r\n      if(input !== undefined){\r\n          var dtfilter = $filter('date')(input, 'MMMM d'),\r\n              day = parseInt(dtfilter.slice(-2)),\r\n              relevantDigits = (day < 30) ? day % 20 : day % 30,\r\n              suffix = (relevantDigits <= 3) ? suffixes[relevantDigits] : suffixes[0],\r\n              dateArray = dtfilter.split(' '),\r\n              month = dateArray[0];\r\n          return dateArray[1] + suffix + ' ' + month + ' ' + $filter('date')(input, 'yyyy');\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('dayFilter', dayFilter);\r\n\r\n   function dayFilter() {\r\n    return function(array, daySelected) {\r\n        return array.filter(function(item) {\r\n            //special day filter\r\n//            console.log(item);\r\n            var ds = daySelected;\r\n            if (ds==='1' && item.day==='Monday') {\r\n                return item;\r\n            } else if (ds==='2' && item.day==='Tuesday') {\r\n                return item;\r\n            } else if (ds==='3' && item.day==='Wednesday') {\r\n                return item;\r\n            } else if (ds==='4' && item.day==='Thursday') {\r\n                return item;\r\n            } else if (ds==='5' && item.day==='Friday') {\r\n                return item;\r\n            } else if (ds==='6' && item.day==='Saturday') {\r\n                return item;\r\n            } else if (ds==='0' && item.day==='Sunday') {\r\n                return item;\r\n            } else if (ds==='' || ds===null || ds===undefined) {\r\n                return item;\r\n            } else if (ds==='Any' && item.day==='Any') {\r\n                return item;\r\n            }\r\n        });\r\n    };\r\n}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .filter('numberFixedLen', numberFixedLen);\r\n\r\n   function numberFixedLen() {\r\n    return function (n, len) {\r\n        var num = parseInt(n, 10);\r\n        len = parseInt(len, 10);\r\n        if (isNaN(num) || isNaN(len)) {\r\n            return n;\r\n        }\r\n        num = ''+num;\r\n        while (num.length < len) {\r\n            num = '0'+num;\r\n        }\r\n        return num;\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('core')\r\n\t.service('Enums', Enums);\r\n\r\n\tfunction Enums() {\r\n\t\tvar obj = {\r\n\t\t\tmalStatus: {\r\n        anime: {\r\n          ongoing: 'Currently Airing',\r\n          complete: 'Finished Airing'\r\n        },\r\n        manga: {\r\n          ongoing: 'Publishing',\r\n          complete: 'Finished'\r\n        }\r\n      }\r\n\t\t};\r\n\t\treturn obj;\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('core')\r\n\t.service('FunctionService', FunctionService);\r\n\tFunctionService.$inject = ['moment'];\r\n\r\n\tfunction FunctionService(moment) {\r\n\t\tvar obj = {\r\n\t\t\tpad: pad\r\n\t\t};\r\n\t\treturn obj;\r\n\r\n    function pad(number, width, padChar) {\r\n      padChar = padChar || '0';\r\n      number = number + '';\r\n      return number.length >= width ? number : new Array(width - number.length + 1).join(padChar) + number;\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('core')\r\n\t.factory('MalService', MalService);\r\n\tMalService.$inject = ['$http', '$resource'];\r\n\r\n\tfunction MalService($http, $resource) {\r\n\t\tvar malService = $resource('', {},\r\n\t\t\t {\r\n\t\t\t\tsearch: {\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\turl: 'malSearch/:type',\r\n\t\t\t\t\tparams: { type: '@_type', searchString: '@_searchString' },\r\n\t\t\t\t\tisArray: true\r\n\t\t\t\t}\r\n\t\t\t });\r\n\r\n\t\tfunction xmlToJson(xml) {\r\n\t\t\tvar ELEMENT_NODE_TYPE = 1,\r\n\t\t\t\tTEXT_NODE_TYPE = 3,\r\n\t\t\t\tobj = {};\r\n\r\n\t\t\tif (xml.nodeType === ELEMENT_NODE_TYPE) {\r\n\t\t\t\tif (xml.attributes.length > 0) {\r\n\t\t\t\tobj['@attributes'] = {};\r\n\t\t\t\t\tfor (var j = 0; j < xml.attributes.length; j++) {\r\n\t\t\t\t\t\tvar attribute = xml.attributes.item(j);\r\n\t\t\t\t\t\tobj['@attributes'][attribute.nodeName] = attribute.nodeValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (xml.nodeType === TEXT_NODE_TYPE) {\r\n\t\t\t\tobj = xml.nodeValue;\r\n\t\t\t}\r\n\r\n\t\t\tif (xml.hasChildNodes() && xml.childNodes.length === 1 && xml.childNodes[0].nodeType === TEXT_NODE_TYPE) {\r\n\t\t\t\tobj = xml.childNodes[0].nodeValue;\r\n\t\t\t}\r\n\t\t\telse if (xml.hasChildNodes()) {\r\n\t\t\t\tfor(var i = 0; i < xml.childNodes.length; i++) {\r\n\t\t\t\t\tvar item = xml.childNodes.item(i),\r\n\t\t\t\t\t\tnodeName = item.nodeName;\r\n\t\t\t\t\tif (typeof(obj[nodeName]) === 'undefined') {\r\n\t\t\t\t\t\tobj[nodeName] = xmlToJson(item);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (typeof(obj[nodeName].push) === 'undefined') {\r\n\t\t\t\t\t\t\tvar old = obj[nodeName];\r\n\t\t\t\t\t\t\tobj[nodeName] = [];\r\n\t\t\t\t\t\t\tobj[nodeName].push(old);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobj[nodeName].push(xmlToJson(item));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn obj;\r\n\t\t}\r\n\r\n\t\tfunction xmlProcessor(type, data) {\r\n\t\t\tvar searchResult = [],\r\n\t\t\t\txml = data.responseXML,\r\n\t\t\t\tnodes = xml.evaluate('//' + type + '/entry', xml, null, XPathResult.ANY_TYPE, null),\r\n\t\t\t\tresult = nodes.iterateNext();\r\n\t\t\twhile (result) {\r\n\t\t\t\tsearchResult.push(xmlToJson(result));\r\n\t\t\t\tresult = nodes.iterateNext();\r\n\t\t\t}\r\n\t\t\treturn searchResult;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tsearch: function (queryType, searchString) {\r\n\t\t\t\treturn malService.search({ type: queryType, searchString: searchString }).$promise;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n})();\r\n\r\n'use strict';\r\n\r\n//Menu service used for managing  menus\r\nangular.module('core').service('Menus', [\r\n\r\n\tfunction() {\r\n\t\t// Define a set of default roles\r\n\t\tthis.defaultRoles = ['*'];\r\n\r\n\t\t// Define the menus object\r\n\t\tthis.menus = {};\r\n\r\n\t\t// A private function for rendering decision \r\n\t\tvar shouldRender = function(user) {\r\n\t\t\tif (user) {\r\n\t\t\t\tif (!!~this.roles.indexOf('*')) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (var userRoleIndex in user.roles) {\r\n\t\t\t\t\t\tfor (var roleIndex in this.roles) {\r\n\t\t\t\t\t\t\tif (this.roles[roleIndex] === user.roles[userRoleIndex]) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn this.isPublic;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Validate menu existance\r\n\t\tthis.validateMenuExistance = function(menuId) {\r\n\t\t\tif (menuId && menuId.length) {\r\n\t\t\t\tif (this.menus[menuId]) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('Menu does not exists');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('MenuId was not provided');\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Get the menu object by menu id\r\n\t\tthis.getMenu = function(menuId) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add new menu object by menu id\r\n\t\tthis.addMenu = function(menuId, isPublic, roles) {\r\n\t\t\t// Create the new menu\r\n\t\t\tthis.menus[menuId] = {\r\n\t\t\t\tisPublic: isPublic || false,\r\n\t\t\t\troles: roles || this.defaultRoles,\r\n\t\t\t\titems: [],\r\n\t\t\t\tshouldRender: shouldRender\r\n\t\t\t};\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeMenu = function(menuId) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\tdelete this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add menu item object\r\n\t\tthis.addMenuItem = function(menuId, menuItemTitle, menuItemURL, menuItemType, menuItemUIRoute, isPublic, roles, position) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Push new menu item\r\n\t\t\tthis.menus[menuId].items.push({\r\n\t\t\t\ttitle: menuItemTitle,\r\n\t\t\t\tlink: menuItemURL,\r\n\t\t\t\tmenuItemType: menuItemType || 'item',\r\n\t\t\t\tmenuItemClass: menuItemType,\r\n\t\t\t\tuiRoute: menuItemUIRoute || ('/' + menuItemURL),\r\n\t\t\t\tisPublic: ((isPublic === null || typeof isPublic === 'undefined') ? this.menus[menuId].isPublic : isPublic),\r\n\t\t\t\troles: ((roles === null || typeof roles === 'undefined') ? this.menus[menuId].roles : roles),\r\n\t\t\t\tposition: position || 0,\r\n\t\t\t\titems: [],\r\n\t\t\t\tshouldRender: shouldRender\r\n\t\t\t});\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Add submenu item object\r\n\t\tthis.addSubMenuItem = function(menuId, rootMenuItemURL, menuItemTitle, menuItemURL, menuItemUIRoute, isPublic, roles, position) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tif (this.menus[menuId].items[itemIndex].link === rootMenuItemURL) {\r\n\t\t\t\t\t// Push new submenu item\r\n\t\t\t\t\tthis.menus[menuId].items[itemIndex].items.push({\r\n\t\t\t\t\t\ttitle: menuItemTitle,\r\n\t\t\t\t\t\tlink: menuItemURL,\r\n\t\t\t\t\t\tuiRoute: menuItemUIRoute || ('/' + menuItemURL),\r\n\t\t\t\t\t\tisPublic: ((isPublic === null || typeof isPublic === 'undefined') ? this.menus[menuId].items[itemIndex].isPublic : isPublic),\r\n\t\t\t\t\t\troles: ((roles === null || typeof roles === 'undefined') ? this.menus[menuId].items[itemIndex].roles : roles),\r\n\t\t\t\t\t\tposition: position || 0,\r\n\t\t\t\t\t\tshouldRender: shouldRender\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeMenuItem = function(menuId, menuItemURL) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item to remove\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tif (this.menus[menuId].items[itemIndex].link === menuItemURL) {\r\n\t\t\t\t\tthis.menus[menuId].items.splice(itemIndex, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t// Remove existing menu object by menu id\r\n\t\tthis.removeSubMenuItem = function(menuId, submenuItemURL) {\r\n\t\t\t// Validate that the menu exists\r\n\t\t\tthis.validateMenuExistance(menuId);\r\n\r\n\t\t\t// Search for menu item to remove\r\n\t\t\tfor (var itemIndex in this.menus[menuId].items) {\r\n\t\t\t\tfor (var subitemIndex in this.menus[menuId].items[itemIndex].items) {\r\n\t\t\t\t\tif (this.menus[menuId].items[itemIndex].items[subitemIndex].link === submenuItemURL) {\r\n\t\t\t\t\t\tthis.menus[menuId].items[itemIndex].items.splice(subitemIndex, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Return the menu object\r\n\t\t\treturn this.menus[menuId];\r\n\t\t};\r\n\r\n\t\t//Adding the topbar menu\r\n\t\tthis.addMenu('topbar');\r\n\t}\r\n]);\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .factory('NotificationFactory', NotificationFactory);\r\n\r\n   function NotificationFactory() {\r\n    var self = this;\r\n    /*global swal */\r\n    /*global toastr */\r\n        toastr.options = {\r\n                'closeButton': false,\r\n                'debug': false,\r\n                'newestOnTop': false,\r\n                'progressBar': false,\r\n                'positionClass': 'toast-bottom-right',\r\n                'preventDuplicates': false,\r\n                'onclick': null,\r\n                'showDuration': '300',\r\n                'hideDuration': '1000',\r\n                'timeOut': '5000',\r\n                'extendedTimeOut': '1000',\r\n                'showEasing': 'swing',\r\n                'hideEasing': 'linear',\r\n                'showMethod': 'fadeIn',\r\n                'hideMethod': 'fadeOut'\r\n            };\r\n    return {\r\n        success: function (title, text) {\r\n            toastr.success(text, title, 'Success');\r\n        },\r\n        warning: function (title, text) {\r\n            toastr.warning(text, title, 'Warning');\r\n        },\r\n        error: function (title, text) {\r\n            toastr.error(text, title, 'Error');\r\n        },\r\n        popup: function (title, text, type) {\r\n            swal({\r\n                title: title,\r\n                text: text,\r\n                type: type\r\n            });\r\n        },\r\n        confirmation: function (thenDo) {\r\n              //are you sure option...\r\n            swal({\r\n                title: 'Are you sure?',\r\n                text: 'Are you sure that you want to delete this?',\r\n                type: 'warning',\r\n                showCancelButton: true,\r\n                closeOnConfirm: true,\r\n                confirmButtonText: 'Yes, delete it!',\r\n                confirmButtonColor: '#ec6c62'\r\n            }, thenDo);\r\n        }\r\n    };\r\n}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('core')\r\n  .factory('spinnerService', SpinnerService);\r\n  SpinnerService.$inject = ['$q'];\r\n   function SpinnerService($q) {\r\n    var spinners = {},\r\n        queue = {},\r\n        loads = {};\r\n\r\n      return {\r\n          spinners: spinners,\r\n        // private method for spinner registration.\r\n        _register: function (data) {\r\n            if (!data.hasOwnProperty('name')) {\r\n                throw new Error('Spinner must specify a name when registering with the spinner service.');\r\n            }\r\n            if (spinners.hasOwnProperty(data.name)) {\r\n                throw new Error('A spinner with the name \\'' + data.name + '\\' has already been registered.');\r\n            }\r\n            spinners[data.name] = data;\r\n            // Increase the spinner count.\r\n            this.count++;\r\n\r\n            // Check if spinnerId was in the queue, if so then fire the\r\n            // queued function.\r\n            if (queue[data.name]) {\r\n    //            console.log(queue, loads);\r\n                if(loads[data.name]) {\r\n    //                console.log(loads[data.name]);\r\n                    this[queue[data.name]](data.name, loads[data.name]);\r\n                    delete loads[data.name];\r\n                    delete queue[data.name];\r\n                } else {\r\n    //                console.log('queued', queue);\r\n                    this[queue[data.name]](data.name);\r\n                    delete queue[data.name];\r\n                }\r\n            }\r\n    //        console.log(spinners);\r\n        },\r\n        _unregister: function (name) {\r\n          if (spinners.hasOwnProperty(name)) {\r\n            delete spinners[name];\r\n          }\r\n        },\r\n        loading: function (name, optionsOrPromise) {\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'loading';\r\n                loads[name] = optionsOrPromise;\r\n    //            console.log('defer', loads[name]);\r\n                return;\r\n            }\r\n            var spinner = spinners[name];\r\n            spinner.show(name);\r\n            optionsOrPromise = optionsOrPromise || {};\r\n\r\n            //Check if it's promise\r\n            if (optionsOrPromise.always || optionsOrPromise['finally']) {\r\n                optionsOrPromise = {\r\n                    promise: optionsOrPromise\r\n                };\r\n            }\r\n\r\n            var options = angular.extend({}, optionsOrPromise);\r\n\r\n            if (options.promise) {\r\n                if (options.promise.always) {\r\n                    options.promise.always(function () {\r\n                        spinner.hide(name);\r\n                    });\r\n                } else if (options.promise['finally']) {\r\n                    options.promise['finally'](function () {\r\n                        spinner.hide(name);\r\n                    });\r\n                }\r\n            }\r\n        },\r\n        show: function (name) {\r\n    //        console.log('show');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'show';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.show();\r\n        },\r\n        hide: function (name) {\r\n    //        console.log('hide');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'hide';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.hide();\r\n        },\r\n        toggle: function (name) {\r\n    //        console.log('toggle');\r\n            if (!this.spinners[name]) {\r\n                queue[name] = 'toggle';\r\n                return;\r\n            }\r\n          var spinner = spinners[name];\r\n          if (!spinner) {\r\n            throw new Error('No spinner named \\'' + name + '\\' is registered.');\r\n          }\r\n          spinner.toggle();\r\n        },\r\n        count: 0\r\n      };\r\n\r\n  }\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('history').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('history', {\r\n\t\t\turl: '/history',\r\n\t\t\ttemplateUrl: 'modules/history/views/history.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n  'use strict';\r\n  angular.module('history').controller('HistoryController', HistoryController);\r\n  HistoryController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'AnimeHistory', 'MangaHistory', 'HistoryService', 'ListService', 'spinnerService'];\r\n\r\n  function HistoryController($scope, $stateParams, $location, Authentication, AnimeHistory, MangaHistory, HistoryService, ListService, spinnerService) {\r\n\t\tvar ctrl = this,\r\n\t\t    latestDate = new Date().setDate(new Date().getDate() - 29);\r\n\r\n    ctrl.authentication = Authentication;\r\n    ctrl.buildHistory = buildHistory;\r\n    ctrl.filterConfig = {\r\n\t\t\thistoryFilter: 'Today'\r\n    };\r\n    ctrl.happenedWhen = happenedWhen;\r\n    ctrl.historyGroups = [\r\n      { name: 'Today' },\r\n      { name: 'Yesterday' },\r\n      { name: 'This week' },\r\n      { name: 'Last week' },\r\n      { name: 'Two weeks ago' },\r\n      { name: 'Three weeks ago' },\r\n      { name: 'Four weeks ago' },\r\n    ];\r\n    ctrl.view = 'Anime';\r\n\r\n\r\n    function buildHistory() {\r\n\t    spinnerService.loading('history', AnimeHistory.query({ latest: latestDate }).$promise.then(function(result) {\r\n\t\t\t\t\treturn HistoryService.buildHistoryList(result);\r\n\t\t\t}).then(function(result) {\r\n\t      //  console.log('build anime history: ', result);\r\n\t\t\t\tctrl.animeHistory = result;\r\n\t      return MangaHistory.query({ latest: latestDate }).$promise;\r\n\t    }).then(function(result) {\r\n\t\t\t\t//    console.log('manga', result);\r\n\t\t\t\treturn HistoryService.buildHistoryList(result);\r\n\t    }).then(function(result) {\r\n\t\t\t\t//                    console.log('build manga history: ', result);\r\n\t\t\t\tctrl.mangaHistory = result;\r\n\t\t\t})\r\n\t\t  );\r\n    }\r\n\r\n    //Needed to catch 'Character' setting and skip it.\r\n    $scope.$watch('view', function(newValue) {\r\n      if (ctrl.view !== undefined) {\r\n          if (newValue !== 'Anime' && newValue !== 'Manga') {\r\n              ctrl.view = 'Anime';\r\n          }\r\n      }\r\n    });\r\n\r\n    function happenedWhen(when) {\r\n        return HistoryService.happenedWhen(when);\r\n    }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('tasks').controller('ViewHistoryController', ViewHistoryController);\r\n  ViewHistoryController.$inject =  ['$scope', 'data', '$stateParams', 'Authentication', 'ItemService', 'NotificationFactory', 'spinnerService', '$uibModalInstance'];\r\n\r\nfunction ViewHistoryController($scope, data, $stateParams, Authentication, ItemService, NotificationFactory, spinnerService, $uibModalInstance) {\r\n  var ctrl = this,\r\n      historyStore = [];\r\n\r\n  ctrl.cancel = cancel;\r\n  ctrl.deleteHistory = deleteHistory;\r\n  ctrl.submit = submit;\r\n  ctrl.type = data.type;\r\n  ctrl.updated = false;\r\n  ctrl.viewItem = data.viewItem;\r\n\r\n  function deleteHistory(item, history) {\r\n      //are you sure option...\r\n      NotificationFactory.confirmation(function() {\r\n        if(historyStore.length === 0) {\r\n          historyStore = ctrl.viewItem.meta.history;\r\n        }\r\n        ctrl.viewItem = ItemService.deleteHistory(item, history);\r\n        ctrl.updated = true;\r\n      });\r\n  }\r\n\r\n  function submit() {\r\n    $uibModalInstance.close(ctrl.updated);\r\n  }\r\n\r\n  function cancel() {\r\n    if(ctrl.updated) {\r\n      ctrl.viewItem.meta.history = historyStore;\r\n    }\r\n    $uibModalInstance.dismiss();\r\n  }\r\n\r\n}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .filter('historySeparator', historySeparator);\r\n  historySeparator.$inject = ['HistoryService', 'moment'];\r\n\r\n  function historySeparator(HistoryService, moment) {\r\n    return function(array, level, timeframe) {\r\n        var itemDate,\r\n            attr = (level === 'group') ? 'latest' : 'date';\r\n        if (array !== undefined) {\r\n            return array.filter(function(item) {\r\n                itemDate = moment(item[attr]).startOf('day');\r\n                return HistoryService.filterItemHistory(timeframe.toLowerCase(), itemDate) ? item : false;\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  //History service used to communicate Animeitems REST endpoints\r\n  angular.module('history')\r\n  .factory('AnimeHistory', AnimeHistory);\r\n  AnimeHistory.$inject = ['$resource'];\r\n\r\n    function AnimeHistory($resource) {\r\n      return $resource('history/anime/:latest', { latest: '@_latest' }, { update: { method: 'PUT' } });\r\n    }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .service('HistoryService', HistoryService);\r\n  HistoryService.$inject = ['moment', '$q'];\r\n\r\n   function HistoryService(moment, $q) {\r\n     var service = {\r\n           buildHistoryList: buildHistoryList,\r\n           extractHistory: extractHistory,\r\n           filterItemHistory: filterItemHistory,\r\n           getEndsOfWeek: getEndsOfWeek,\r\n           getSetDaysAgo: getSetDaysAgo,\r\n           groupItemHistory: groupItemHistory,\r\n           happenedWhen: happenedWhen,\r\n           today: moment(new Date()).startOf('day'),\r\n           weekBeginning: weekBeginning,\r\n           weekEnding: weekEnding\r\n         },\r\n         endsOfWeek = getEndsOfWeek(),\r\n         mondays = endsOfWeek.mondays,\r\n         sundays = endsOfWeek.sundays;\r\n         return service;\r\n\r\n    // getting mondays and sundays for this, last, two and three weeks ago.\r\n    function getEndsOfWeek() {\r\n        var endsOfWeek = [], thisMonday = service.weekBeginning(), thisSunday = service.weekEnding();\r\n        endsOfWeek = {\r\n            mondays: [ thisMonday, service.getSetDaysAgo(thisMonday, 7), service.getSetDaysAgo(thisMonday, 14), service.getSetDaysAgo(thisMonday, 21), service.getSetDaysAgo(thisMonday, 28) ],\r\n            sundays: [ thisSunday, service.getSetDaysAgo(thisSunday, 7), service.getSetDaysAgo(thisSunday, 14), service.getSetDaysAgo(thisSunday, 21), service.getSetDaysAgo(thisSunday, 28) ]\r\n        };\r\n        return endsOfWeek;\r\n    }\r\n\r\n    //get 'daysAgo' days ago from 'thisEnd' date.\r\n    function getSetDaysAgo(thisEnd, daysAgo) {\r\n        var newDate = moment(thisEnd).subtract(daysAgo, 'days');\r\n        return newDate;\r\n    }\r\n\r\n    //get 'this' monday.\r\n    function weekBeginning() {\r\n        var date = new Date(),\r\n            day = date.getDay(),\r\n            diff = date.getDate() - day + (day === 0 ? -6:1),\r\n            temp = new Date(),\r\n            wkBeg = new Date(temp.setDate(diff));\r\n        return moment(wkBeg.toISOString()).startOf('day');\r\n    }\r\n\r\n    //get 'this' sunday.\r\n    function weekEnding() {\r\n        var date = new Date(),\r\n            day = date.getDay(),\r\n            diff = date.getDate() - day + (day === 0 ? 0:7),\r\n            temp = new Date(),\r\n            wkEnd = new Date(temp.setDate(diff));\r\n        return moment(wkEnd.toISOString()).endOf('day');\r\n    }\r\n\r\n    function buildHistoryList(items) {\r\n        var deferred = $q.defer(),\r\n            promise = service.extractHistory(items).then(function(result) {\r\n//                console.log('extract history: ', result);\r\n                result.sort(function (a, b) {\r\n                    var dateA = a.date,\r\n                        dateB = b.date;\r\n                    if(dateA > dateB) return -1;\r\n                    if(dateA < dateB) return 1;\r\n                    if(dateA === dateB) return 0;\r\n                });\r\n                return service.groupItemHistory(result);\r\n            }).then(function(result) {\r\n//                console.log('grouped', result);\r\n                deferred.resolve(result);\r\n            });\r\n        return deferred.promise;\r\n    }\r\n\r\n    function extractHistory(items) {\r\n        var deferred = $q.defer(),\r\n            itemHistory = [], today = moment(new Date()).startOf('day');\r\n        angular.forEach(items, function(item) {\r\n            angular.forEach(item.meta.history, function(history) {\r\n                var cutoff = moment(history.date).startOf('day'),\r\n                    diff = today.diff(cutoff, 'days');\r\n//                console.log(diff);\r\n                if (diff < 29) {\r\n                    itemHistory.push({ date: history.date, value: history.value, title: item.title, id: item._id });\r\n                }\r\n            });\r\n        });\r\n        deferred.resolve(itemHistory);\r\n        return deferred.promise;\r\n    }\r\n\r\n    function groupItemHistory(itemHistory) {\r\n        var deferred = $q.defer(),\r\n            index, prevItem, item, group,\r\n            length = itemHistory.length,\r\n            groupedHistory = [];\r\n        for(var i = 0; i < length; i++) {\r\n            item = itemHistory[i];\r\n            if (i === 0) {\r\n                groupedHistory.push({\r\n                    title: item.title,\r\n                    items: [],\r\n                    count: 1,\r\n                    latest: item.date,\r\n                    oldest: item.date\r\n                });\r\n                groupedHistory[0].items.push(item);\r\n            } else if (i !== 0) {\r\n                prevItem = itemHistory[i - 1];\r\n                index = groupedHistory.length - 1;\r\n                if (prevItem.title === item.title) {\r\n                    groupedHistory[index].items.push(item);\r\n                    groupedHistory[index].count++;\r\n                    groupedHistory[index].oldest = item.date;\r\n                } else if (prevItem.title !== item.title) {\r\n                    group = {\r\n                        title: item.title,\r\n                        items: [],\r\n                        count: 1,\r\n                        latest: item.date,\r\n                        oldest: item.date\r\n                    };\r\n                    group.items.push(item);\r\n                    groupedHistory.push(group);\r\n                }\r\n            }\r\n        }\r\n        deferred.resolve(groupedHistory);\r\n        return deferred.promise;\r\n    }\r\n\r\n    function filterItemHistory(timeframe, itemDate) {\r\n        var diff = service.today.diff(itemDate, 'days');\r\n        switch(timeframe) {\r\n            case 'today':\r\n                return diff === 0;\r\n\r\n            case 'yesterday':\r\n                return diff === 1;\r\n\r\n            case 'this week':\r\n                return mondays[0] <= itemDate && itemDate <= sundays[0];\r\n\r\n            case 'last week':\r\n                return mondays[1] <= itemDate && itemDate <= sundays[1];\r\n\r\n            case 'two weeks ago':\r\n                return mondays[2] <= itemDate && itemDate <= sundays[2];\r\n\r\n            case 'three weeks ago':\r\n                return mondays[3] <= itemDate && itemDate <= sundays[3];\r\n\r\n            case 'four weeks ago':\r\n                return mondays[4] <= itemDate && itemDate <= sundays[4];\r\n        }\r\n    }\r\n\r\n    /** function to display relative time.\r\n     *  Using diff because fromNow will create conflicts between\r\n     *  the item date and the 'group date'.\r\n     */\r\n    function happenedWhen(when) {\r\n//          console.log(latest, updated);\r\n        var today = moment(new Date()).startOf('day'), thisDate = moment(when).startOf('day'),\r\n            diff = today.diff(thisDate, 'days');\r\n\r\n        //for 0 and 1 day(s) ago use the special term.\r\n        if (diff === 0) {\r\n            return 'Today at ' + moment(when).format('HH:mm');\r\n        } else if (diff === 1) {\r\n            return 'Yesterday at ' + moment(when).format('HH:mm');\r\n        } else {\r\n            return diff + ' days ago at ' + moment(when).format('HH:mm');\r\n        }\r\n    }\r\n\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('history')\r\n  .factory('MangaHistory', MangaHistory);\r\n  MangaHistory.$inject = ['$resource'];\r\n\r\n  function MangaHistory($resource) {\r\n    return $resource('history/manga/:latest', { latest: '@_latest' }, { update: { method: 'PUT' } });\r\n  }\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('mangaitems').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Mangaitems', 'mangaitems', 'dropdown', '/mangaitems(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'mangaitems', 'List Mangaitems', 'mangaitems');\r\n\t\tMenus.addSubMenuItem('topbar', 'mangaitems', 'New Mangaitem', 'mangaitems/create');\r\n\t}\r\n]);\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('mangaitems').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Mangaitems state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listMangaitems', {\r\n\t\t\turl: '/mangaitems',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/list-mangaitems.client.view.html'\r\n\t\t}).\r\n\t\tstate('createMangaitem', {\r\n\t\t\turl: '/mangaitems/create',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/create-mangaitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewMangaitem', {\r\n\t\t\turl: '/mangaitems/:mangaitemId',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/view-mangaitem.client.view.html'\r\n\t\t}).\r\n\t\tstate('editMangaitem', {\r\n\t\t\turl: '/mangaitems/:mangaitemId/edit',\r\n\t\t\ttemplateUrl: 'modules/mangaitems/views/edit-mangaitem.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('mangaitems').controller('MangaitemsController', MangaitemsController);\r\n\tMangaitemsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Mangaitems', 'Animeitems', 'fileUpload', '$sce', '$window', 'ItemService', 'ListService', 'NotificationFactory', 'MangaFactory', 'spinnerService', 'TagService', '$uibModal'];\r\n\r\n\tfunction MangaitemsController($scope, $stateParams, $location, Authentication, Mangaitems, Animeitems, fileUpload, $sce, $window, ItemService, ListService, NotificationFactory, MangaFactory, spinnerService, TagService, $uibModal) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.addTag = addTag;\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.chapters = 0;\r\n\t\tctrl.create = create;\r\n\t\tctrl.dropTag = dropTag;\r\n    ctrl.filterConfig = {\r\n        showingCount: 0,\r\n        sortType: '',\r\n        sortReverse: true,\r\n        ratingLevel: undefined,\r\n        ratingActions: {\r\n            maxRating: 10,\r\n            percent: undefined,\r\n            overStar: null\r\n        },\r\n        searchTags: '',\r\n        tagsForFilter: [],\r\n        taglessItem: false,\r\n        areTagless: false,\r\n        selectListOptions: {},\r\n        statTags: [],\r\n\t\t\t\tviewItem: ''\r\n    };\r\n\t\tctrl.finalNumbers = false; //default show status of final number fields in edit view.\r\n\t\tctrl.find = find;\r\n\t\tctrl.findAnime = findAnime;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.imgPath = ''; //image path\r\n\t\tctrl.itemUpdate = new Date(); // today's date as 'yyyy-MM-dd' for the auto-pop of 'latest' in edit page.\r\n\t\tctrl.latest = ctrl.itemUpdate;\r\n\t\tctrl.latestDate = latestDate;\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 10\r\n    };\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.removeTag = removeTag;\r\n\t\tctrl.start = ctrl.itemUpdate;\r\n\t\tctrl.tagArray = []; // holding tags pre-submit\r\n\t\tctrl.tagArrayRemove = [];\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.trustAsResourceUrl = trustAsResourceUrl;\r\n\t\tctrl.update = update;\r\n\t\tctrl.uploadFile = uploadFile;\r\n\t\tctrl.usedTags = []; //for typeahead array.\r\n\t\tctrl.viewItemHistory = viewItemHistory;\r\n\t\tctrl.volumes = 0;\r\n\t\tctrl.whichController = 'mangaitem';\r\n\r\n    //allow retreival of local resource\r\n    function trustAsResourceUrl(url) {\r\n        return $sce.trustAsResourceUrl(url);\r\n    }\r\n\t\t//For adding new tags.\r\n    function addTag() {\r\n\t\t\tTagService.addTag(ctrl.tagArray, ctrl.newTag);\r\n      ctrl.newTag = '';\r\n    }\r\n\t\t//Drop tag for new tags.\r\n\t\tfunction dropTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.tagArray, text);\r\n\t\t}\r\n\t\t//Drop tag for animeitem tags.\r\n\t\tfunction removeTag(text) {\r\n\t\t\tTagService.dropTag(ctrl.mangaitem.tags, text);\r\n\t\t}\r\n\r\n    // Create new Mangaitem\r\n\t\tfunction create() {\r\n\r\n            var mangaitem = new Mangaitems();\r\n            //Handle situation if objects not selected.\r\n                // Create new Mangaitem object\r\n\t\t\t     mangaitem = new Mangaitems ({\r\n\t\t\t\t    title: ctrl.title,\r\n                    chapters: ctrl.chapters,\r\n                    volumes: ctrl.volumes,\r\n                    start: ctrl.start,\r\n                    latest: ctrl.latest,\r\n                    finalChapter: ctrl.finalChapter,\r\n                    finalVolume: ctrl.finalVolume,\r\n                    hardcopy: ctrl.hardcopy,\r\n                    anime: ctrl.anime!==undefined && ctrl.anime!==null ? ctrl.anime._id : ctrl.anime,\r\n                    tags: ctrl.tagArray,\r\n                    user: ctrl.user\r\n\t\t\t     });\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\tmangaitem.$save(function(response) {\r\n\t\t\t\t$location.path('/mangaitems/' + response._id);\r\n\t\t\t\tNotificationFactory.success('Saved!', 'Manga was saved successfully');\r\n\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Remove existing Mangaitem\r\n\t\tfunction remove(mangaitem) {\r\n            //are you sure option...\r\n            NotificationFactory.confirmation(function() {\r\n                if ( mangaitem ) {\r\n                    mangaitem.$remove();\r\n\r\n                    for (var i in ctrl.mangaitems) {\r\n                        if (ctrl.mangaitems [i] === mangaitem) {\r\n                            ctrl.mangaitems.splice(i, 1);\r\n                        }\r\n                    }\r\n                } else {\r\n                    ctrl.mangaitem.$remove(function() {\r\n                        $location.path('/mangaitems');\r\n                    });\r\n                }\r\n                NotificationFactory.warning('Deleted!', 'Manga was successfully deleted.');\r\n            });\r\n\t\t}\r\n\r\n\t\t// Update existing Mangaitem\r\n\t\tfunction update() {\r\n\t\t\tvar mangaitem = ctrl.mangaitem;\r\n            ctrl.mangaitem = undefined;\r\n            MangaFactory.update(mangaitem, ctrl.tagArray, ctrl.updateHistory, ctrl.imgPath);\r\n\t\t}\r\n\r\n\t\tfunction tickOff(item) {\r\n        item.chapters += 1;\r\n        item.latest = new Date(); //update latest.\r\n        ctrl.updateHistory = true; //add to history.\r\n        ctrl.mangaitem = item;\r\n        ctrl.update();\r\n    }\r\n\r\n\t\t// Find a list of Mangaitems\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n      spinnerService.loading('manga', Mangaitems.query().$promise.then(function(result) {\r\n          ctrl.mangaitems = result;\r\n\t\t\t\t\tctrl.filterConfig.areTagless = ListService.checkForTagless(result);\r\n\t\t\t\t\tctrl.filterConfig.statTags = ItemService.buildStatTags(result, 0);\r\n      }));\r\n\t\t}\r\n\r\n\t\t// Find existing Mangaitem\r\n\t\tfunction findOne() {\r\n\t    Mangaitems.get({ mangaitemId: $stateParams.mangaitemId }).$promise.then(function(result) {\r\n\t        ctrl.mangaitem = result;\r\n\t        //            console.log(ctrl.mangaitem);\r\n\t    });\r\n\t\t}\r\n\r\n    // Find a list of Animeitems for dropdowns.\r\n\t\tfunction findAnime() {\r\n\t\t\tctrl.animeitems = Animeitems.query();\r\n\t\t}\r\n\r\n    //image upload\r\n    function uploadFile(){\r\n        ctrl.imgPath = '/modules/mangaitems/img/' + ctrl.myFile.name;\r\n        fileUpload.uploadFileToUrl(ctrl.myFile, '/fileUpload');\r\n    }\r\n\r\n    //latest date display format.\r\n    function latestDate(latest, updated) {\r\n        return ItemService.latestDate(latest, updated);\r\n    }\r\n\r\n\t\tfunction viewItemHistory() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/history/views/item-history.html',\r\n        controller: 'ViewHistoryController as viewHistory',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { viewItem: ctrl.filterConfig.viewItem, type: 'manga' };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed history: ', result, ctrl.filterConfig.viewItem.meta);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tctrl.mangaitem = ctrl.filterConfig.viewItem;\r\n\t\t\t\t\tctrl.update();\r\n\t\t\t\t}\r\n      });\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('mangaItemModel', mangaItemModel);\r\n\r\n  function mangaItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/mangaitems/templates/manga-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('mangaitems')\r\n\t.factory('MangaFactory', MangaFactory);\r\n\tMangaFactory.$inject = ['Mangaitems', 'ListService', 'ItemService', 'NotificationFactory', '$location'];\r\n\r\n\tfunction MangaFactory(Mangaitems, ListService, ItemService, NotificationFactory, $location) {\r\n    return {\r\n        update: function(item, tagArray, updateHistory, imgPath) {\r\n            var mangaitem = item;\r\n            console.log(mangaitem);\r\n            //dropdown passes whole object, if-statements for lazy fix - setting them to _id.\r\n            if (item.anime!==null && item.anime!==undefined) {\r\n                mangaitem.anime = item.anime._id;\r\n            }\r\n\r\n            if (tagArray!==undefined) {\r\n                mangaitem.tags = ListService.concatenateTagArrays(mangaitem.tags, tagArray);\r\n            }\r\n\r\n            //update the item history.\r\n            mangaitem = ItemService.itemHistory(mangaitem, updateHistory, 'manga');\r\n\r\n            if (imgPath!==undefined && imgPath!==null && imgPath!=='') {\r\n                mangaitem.image = imgPath;\r\n            }\r\n            //console.log($scope.imgPath);\r\n            //console.log(mangaitem.image);\r\n\r\n            //handle end date\r\n            if (mangaitem.chapters===mangaitem.finalChapter && mangaitem.finalChapter!==0) {\r\n                if (mangaitem.end===undefined || mangaitem.end===null) {\r\n                    mangaitem.volumes = mangaitem.finalVolume;\r\n                    mangaitem.end = mangaitem.latest;\r\n                    //console.log(animeitem.end);\r\n                }\r\n            } else if (mangaitem.reReading === false) {\r\n                mangaitem.end = null;\r\n            }\r\n\r\n            //handle status: completed.\r\n            if(mangaitem.end!==undefined && mangaitem.end!==null) {\r\n                mangaitem.status = true;\r\n            } else {\r\n                mangaitem.status = false;\r\n            }\r\n\r\n            //handle re-reading, re-read count.\r\n            if (mangaitem.reReading===true && mangaitem.chapters===mangaitem.finalChapter) {\r\n                mangaitem.volumes = mangaitem.finalVolume;\r\n                mangaitem.reReadCount += 1;\r\n                mangaitem.reReading = false;\r\n            }\r\n\r\n\t\t\tmangaitem.$update(function() {\r\n\t\t\t\tif (window.location.href.indexOf('tasks') === -1) $location.path('/mangaitems');\r\n\r\n                NotificationFactory.success('Saved!', 'Manga was saved successfully');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tvar error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', errorResponse.data.message);\r\n\t\t\t});\r\n\r\n\r\n        }\r\n    };\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\t//Mangaitems service used to communicate Mangaitems REST endpoints\r\n\tangular.module('mangaitems')\r\n\t.factory('Mangaitems',  MangaitemsFactory);\r\n\tMangaitemsFactory.$inject = ['$resource'];\r\n\r\n\tfunction MangaitemsFactory($resource) {\r\n\t\treturn $resource('mangaitems/:mangaitemId', { mangaitemId: '@_id'\r\n\t\t}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('orders').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Orders', 'orders', 'dropdown', '/orders(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'orders', 'List Orders', 'orders');\r\n\t\tMenus.addSubMenuItem('topbar', 'orders', 'New Order', 'orders/create');\r\n\t}\r\n]);\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('orders').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Orders state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listOrders', {\r\n\t\t\turl: '/orders',\r\n\t\t\ttemplateUrl: 'modules/orders/views/list-orders.client.view.html'\r\n\t\t}).\r\n\t\tstate('createOrder', {\r\n\t\t\turl: '/orders/create',\r\n\t\t\ttemplateUrl: 'modules/orders/views/create-order.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewOrder', {\r\n\t\t\turl: '/orders/:orderId',\r\n\t\t\ttemplateUrl: 'modules/orders/views/view-order.client.view.html'\r\n\t\t}).\r\n\t\tstate('editOrder', {\r\n\t\t\turl: '/orders/:orderId/edit',\r\n\t\t\ttemplateUrl: 'modules/orders/views/create-order.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n\r\n'use strict';\r\nvar CompleteOrdersController = (function () {\r\n    function CompleteOrdersController($scope, $uibModalInstance, order) {\r\n        this.$scope = $scope;\r\n        this.$uibModalInstance = $uibModalInstance;\r\n        this.order = order;\r\n        this.newPrice = {\r\n            company: '',\r\n            price: null\r\n        };\r\n    }\r\n    CompleteOrdersController.prototype.editOrder = function (index) {\r\n        var item = this.order.nextVolume.prices[index];\r\n        this.newPrice.company = item.company;\r\n        this.newPrice.price = item.price;\r\n        this.order.nextVolume.prices.splice(index, 1);\r\n    };\r\n    CompleteOrdersController.prototype.completeOrder = function () {\r\n        this.order.nextVolume.prices.push({ company: this.newPrice.company, date: this.newPrice.date, price: this.newPrice.price, rrp: this.order.rrp, paid: true });\r\n        this.$uibModalInstance.close(this.order);\r\n    };\r\n    CompleteOrdersController.prototype.cancel = function () {\r\n        this.$uibModalInstance.dismiss('cancel');\r\n    };\r\n    CompleteOrdersController.controllerId = 'CompleteOrdersController';\r\n    CompleteOrdersController.$inject = ['$scope', '$uibModalInstance', 'order'];\r\n    return CompleteOrdersController;\r\n}());\r\nangular.module('orders').controller(CompleteOrdersController.controllerId, CompleteOrdersController);\r\n\r\n'use strict';\r\nvar CreateOrdersController = (function () {\r\n    function CreateOrdersController($scope, $stateParams, $location, Authentication, $q, Orders, Mangaitems, $uibModal, NotificationFactory) {\r\n        this.$scope = $scope;\r\n        this.$stateParams = $stateParams;\r\n        this.$location = $location;\r\n        this.Authentication = Authentication;\r\n        this.$q = $q;\r\n        this.Orders = Orders;\r\n        this.Mangaitems = Mangaitems;\r\n        this.$uibModal = $uibModal;\r\n        this.NotificationFactory = NotificationFactory;\r\n        this.isCreateMode = this.$stateParams.orderId === undefined;\r\n        this.order = {};\r\n        this.orderCopy = {\r\n            series: '',\r\n            nextVolume: {\r\n                volume: 1,\r\n                date: Date.now(),\r\n                rrp: 0.00,\r\n                prices: []\r\n            },\r\n            rrp: 0.00,\r\n            orderHistory: []\r\n        };\r\n        this.authentication = this.Authentication;\r\n        this.stepConfig = {\r\n            stepHeaders: [\r\n                { text: 'Set next order' },\r\n                { text: 'Set prices' }\r\n            ],\r\n            currentStep: 1,\r\n            stepCount: 2,\r\n            items: []\r\n        };\r\n        this.init();\r\n    }\r\n    CreateOrdersController.prototype.init = function () {\r\n        var _this = this;\r\n        angular.copy(this.orderCopy, this.order);\r\n        if (this.isCreateMode) {\r\n            console.log('create mode');\r\n            this.Mangaitems.query().$promise.then(function (result) {\r\n                _this.stepConfig.items = result;\r\n                console.log('items: ', result);\r\n            });\r\n        }\r\n        else {\r\n            console.log('edit mode');\r\n            this.findOne();\r\n        }\r\n        console.log('init done: ');\r\n    };\r\n    CreateOrdersController.prototype.takeStep = function (step, direction) {\r\n        console.log('stepping: ', step, direction);\r\n        this.stepConfig.currentStep = (direction) ? step + 1 : step - 1;\r\n    };\r\n    CreateOrdersController.prototype.processOrder = function () {\r\n        if (this.order.nextVolume.volume > 0) {\r\n            var temp = angular.copy(this.order.nextVolume);\r\n            this.order.orderHistory.push(this.order.nextVolume);\r\n            this.order.nextVolume = {\r\n                volume: temp.volume + 1,\r\n                date: null,\r\n                rrp: this.order.rrp,\r\n                prices: []\r\n            };\r\n            this.update();\r\n        }\r\n    };\r\n    CreateOrdersController.prototype.cancel = function () {\r\n        this.$location.path('orders');\r\n    };\r\n    CreateOrdersController.prototype.create = function () {\r\n        var _this = this;\r\n        var order = new this.Orders({\r\n            series: this.order.series._id,\r\n            nextVolume: {\r\n                date: this.order.nextVolume.date,\r\n                volume: this.order.nextVolume.volume,\r\n                rrp: this.order.nextVolume.rrp,\r\n                prices: this.order.nextVolume.prices\r\n            },\r\n            rrp: this.order.rrp,\r\n            orderHistory: this.order.orderHistory\r\n        });\r\n        order.$save(function (response) {\r\n            _this.$location.path('orders/' + response._id);\r\n            _this.NotificationFactory.success('Saved!', 'New Order was successfully saved!');\r\n            angular.copy(_this.orderCopy, _this.order);\r\n        }, function (errorResponse) {\r\n            this.error = errorResponse.data.message;\r\n            this.NotificationFactory.error('Error!', 'Order failed to save!');\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.update = function () {\r\n        var _this = this;\r\n        var order = this.order;\r\n        order.$update(function () {\r\n            _this.$location.path('orders/' + order._id);\r\n            _this.NotificationFactory.success('Saved!', 'Order was successfully saved!');\r\n        }, function (errorResponse) {\r\n            this.error = errorResponse.data.message;\r\n            this.NotificationFactory.error('Error!', 'Order failed to save!');\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.openBoughtDialog = function () {\r\n        var _this = this;\r\n        var modalInstance = this.$uibModal.open({\r\n            animation: true,\r\n            templateUrl: '/modules/orders/views/complete-order.client.view.html',\r\n            controller: 'CompleteOrdersController as modal',\r\n            size: 'md',\r\n            resolve: {\r\n                order: function () {\r\n                    return _this.order;\r\n                }\r\n            }\r\n        });\r\n        modalInstance.result.then(function (result) {\r\n            console.log(result);\r\n            _this.order = result;\r\n            _this.processOrder();\r\n        });\r\n    };\r\n    CreateOrdersController.prototype.findOne = function () {\r\n        this.order = this.Orders.get({ orderId: this.$stateParams.orderId });\r\n        console.log('found one: ', this.order);\r\n    };\r\n    CreateOrdersController.controllerId = 'CreateOrdersController';\r\n    CreateOrdersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', '$q', 'Orders', 'Mangaitems', '$uibModal', 'NotificationFactory'];\r\n    return CreateOrdersController;\r\n}());\r\nangular.module('orders').controller(CreateOrdersController.controllerId, CreateOrdersController);\r\n\r\n'use strict';\r\nvar OrderHistoryController = (function () {\r\n    function OrderHistoryController($scope, $uibModalInstance, order, $filter) {\r\n        this.$scope = $scope;\r\n        this.$uibModalInstance = $uibModalInstance;\r\n        this.order = order;\r\n        this.$filter = $filter;\r\n        this.processHistory();\r\n    }\r\n    OrderHistoryController.prototype.processHistory = function () {\r\n        var _this = this;\r\n        angular.forEach(this.order.orderHistory, function (item) {\r\n            console.log('order history: ', item);\r\n            var len = item.prices.length;\r\n            for (var i = 0; i < len; i++) {\r\n                if (item.prices[i].paid) {\r\n                    var cost = _this.$filter('number')(item.prices[i].price, 2), rrp = _this.$filter('number')(item.prices[i].rrp, 2);\r\n                    item.purchaseDate = item.prices[i].date;\r\n                    item.paid = cost;\r\n                    item.rrpInstance = rrp;\r\n                    item.saving = ((cost / rrp) * 100).toFixed(2);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    OrderHistoryController.prototype.cancel = function () {\r\n        this.$uibModalInstance.dismiss('cancel');\r\n    };\r\n    OrderHistoryController.controllerId = 'OrderHistoryController';\r\n    OrderHistoryController.$inject = ['$scope', '$uibModalInstance', 'order', '$filter'];\r\n    return OrderHistoryController;\r\n}());\r\nangular.module('orders').controller(OrderHistoryController.controllerId, OrderHistoryController);\r\n\r\n'use strict';\r\nvar OrdersController = (function () {\r\n    function OrdersController($scope, $stateParams, $location, Authentication, Orders, spinnerService, $uibModal) {\r\n        this.$scope = $scope;\r\n        this.$stateParams = $stateParams;\r\n        this.$location = $location;\r\n        this.Authentication = Authentication;\r\n        this.Orders = Orders;\r\n        this.spinnerService = spinnerService;\r\n        this.$uibModal = $uibModal;\r\n        this.authentication = this.Authentication;\r\n        this.order = undefined;\r\n        this.orders = [];\r\n        this.pageConfig = {\r\n            currentPage: 0,\r\n            pageSize: 10\r\n        };\r\n        this.init();\r\n    }\r\n    OrdersController.prototype.init = function () {\r\n        console.log('init: ', this.$stateParams);\r\n        if (this.$stateParams.orderId) {\r\n            console.log('find one');\r\n            this.findOne();\r\n        }\r\n        else {\r\n            console.log('find all');\r\n            this.find();\r\n        }\r\n    };\r\n    OrdersController.prototype.remove = function (order) {\r\n        if (order) {\r\n            order.$remove();\r\n            for (var i = 0, length = this.order.length; i < length; i++) {\r\n                if (this.orders[i] === order) {\r\n                    this.orders.splice(i, 1);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.order.$remove(function () {\r\n                this.$location.path('orders');\r\n            });\r\n        }\r\n    };\r\n    OrdersController.prototype.find = function () {\r\n        var _this = this;\r\n        this.spinnerService.loading('orders', this.Orders.query().$promise.then(function (result) {\r\n            _this.orders = result;\r\n        }));\r\n    };\r\n    OrdersController.prototype.findOne = function () {\r\n        var _this = this;\r\n        this.spinnerService.loading('orders', this.Orders.get({ orderId: this.$stateParams.orderId }).$promise.then(function (result) {\r\n            _this.order = result;\r\n        }));\r\n    };\r\n    OrdersController.prototype.openOrderHistoryDialog = function () {\r\n        var _this = this;\r\n        var modalInstance = this.$uibModal.open({\r\n            animation: true,\r\n            templateUrl: '/modules/orders/views/order-history.client.view.html',\r\n            controller: 'OrderHistoryController as modal',\r\n            size: 'md',\r\n            resolve: {\r\n                order: function () {\r\n                    return _this.order;\r\n                }\r\n            }\r\n        });\r\n    };\r\n    OrdersController.controllerId = 'OrdersController';\r\n    OrdersController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Orders', 'spinnerService', '$uibModal'];\r\n    return OrdersController;\r\n}());\r\nangular.module('orders').controller(OrdersController.controllerId, OrdersController);\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('orders').factory('Orders', OrdersFactory);\r\n\tOrdersFactory.$inject = ['$resource'];\r\n\r\n\tfunction OrdersFactory($resource) {\r\n\t\treturn $resource('orders/:orderId', { orderId: '@_id'\r\n\t\t}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('ratings').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('ratings', {\r\n\t\t\turl: '/ratings',\r\n\t\t\ttemplateUrl: 'modules/ratings/views/ratings.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('ratings')\r\n\t.controller('RatingsController', RatingsController);\r\n\tRatingsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'ListService', 'NotificationFactory', 'StatisticsService', 'spinnerService'];\r\n\tfunction RatingsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, ListService, NotificationFactory, StatisticsService, spinnerService) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.episodeScore = episodeScore;\r\n\t\tctrl.find = find;\r\n\t\tctrl.go = go;\r\n\t\tctrl.hoveringOver = hoveringOver;\r\n\t\tctrl.itemScore = itemScore;\r\n\t\tctrl.maxRating = 10;\r\n\t\tctrl.modelOptions = { debounce: 700 };\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 20\r\n    };\r\n    ctrl.ratingLevel = undefined; //default rating filter\r\n    ctrl.sortReverse = true;\r\n    ctrl.sortType = 'rating';\r\n\t\tctrl.view = 'Anime';\r\n\t\tctrl.viewEpisodeRatings = viewEpisodeRatings;\r\n    ctrl.viewItem = undefined;\r\n\r\n\t\t//rating 'tooltip' function\r\n    function hoveringOver(value) {\r\n        ctrl.overStar = value;\r\n        ctrl.percent = 100 * (value / ctrl.maxRating);\r\n    }\r\n\r\n    function go(id) {\r\n        $location.path('/mangaitems/' + id);\r\n    }\r\n\r\n    function getItems(view) {\r\n        if (view === 'Anime') {\r\n            spinnerService.loading('rating', Animeitems.query().$promise.then(function(result) {\r\n                ctrl.items = result;\r\n            }));\r\n        } else if (view === 'Manga') {\r\n            spinnerService.loading('rating', Mangaitems.query().$promise.then(function(result) {\r\n                ctrl.items = result;\r\n            }));\r\n        }\r\n        ctrl.viewItem = undefined;\r\n    }\r\n\r\n    function find(view) {\r\n\t\t\tif(view === 'Anime' || view === 'Manga') {\r\n\t\t\t\t getItems(view);\r\n\t\t\t } else {\r\n\t\t\t\tctrl.view = 'Anime';\r\n\t\t\t\tgetItems(ctrl.view);\r\n\t\t\t }\r\n    }\r\n\r\n    //apply new score.\r\n    function itemScore(item, score) {\r\n        if (item.rating !== score) {\r\n            item.rating = score;\r\n\r\n            item.$update(function() {\r\n                $location.path('ratings');\r\n                NotificationFactory.success('Saved!', 'New rating was saved successfully');\r\n            }, function(errorResponse) {\r\n                ctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Your change failed!');\r\n            });\r\n//                console.log('update');\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /** Episode rating functions below here.\r\n     */\r\n    function viewEpisodeRatings(item) {\r\n        ctrl.viewItem = (ctrl.viewItem !== item) ? item : undefined;\r\n        ctrl.isEqual = (ctrl.viewItem === item) ? true : false;\r\n        ctrl.search = (ctrl.viewItem === item) ? item.title : '';\r\n        if (ctrl.viewItem !== undefined) {\r\n            spinnerService.loading('summary', StatisticsService.buildSummaryFunctions(ctrl.viewItem.meta.history).then(function(result) {\r\n                ctrl.summaryFunctions = result;\r\n            }));\r\n        }\r\n    }\r\n\r\n    function episodeScore(finished) {\r\n//            console.log('finished: ', finished, ctrl.viewItem.meta.history);\r\n        if (finished) {\r\n            var item = ctrl.viewItem;\r\n            item.$update(function() {\r\n                $location.path('ratings');\r\n                NotificationFactory.success('Saved!', 'New episode rating was saved successfully');\r\n                spinnerService.loading('summary', StatisticsService.buildSummaryFunctions(ctrl.viewItem.meta.history).then(function(result) {\r\n                    ctrl.summaryFunctions = result;\r\n                }));\r\n            }, function(errorResponse) {\r\n                ctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Your change failed!');\r\n            });\r\n        }\r\n    }\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('ratings')\r\n  .directive('focusOnShow', focusOnShow);\r\n\r\n  function focusOnShow($timeout) {\r\n    return function(scope, element, attrs) {\r\n       scope.$watch(attrs.focusOnShow, function (newValue) {\r\n//            console.log('preview changed!')\r\n            $timeout(function() {\r\n                var myValue = newValue && element[0].focus();\r\n                return myValue;\r\n            });\r\n         },true);\r\n      };\r\n    }\r\n})();\r\n\r\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('statistics').config(['$stateProvider', '$urlRouterProvider',\r\n\tfunction($stateProvider, $urlRouterProvider) {\r\n\t\t// Redirect to home view when route not found\r\n\t\t$urlRouterProvider.otherwise('/signin');\r\n\r\n\t\t// Home state routing\r\n\t\t$stateProvider\r\n        .state('statistics', {\r\n\t\t\turl: '/statistics',\r\n\t\t\ttemplateUrl: 'modules/statistics/views/statistics.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('statistics').controller('StatisticsController', StatisticsController);\r\n\tStatisticsController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Animeitems', 'Mangaitems', 'Characters', 'Toptens', 'ListService', 'ItemService', 'CharacterService', 'StatisticsService', '$filter', 'spinnerService'];\r\n\r\n\t\tfunction StatisticsController($scope, $stateParams, $location, Authentication, Animeitems, Mangaitems, Characters, Toptens, ListService, ItemService, CharacterService, StatisticsService, $filter, spinnerService) {\r\n\t\t\tvar ctrl = this,\r\n\t\t\t\t\tfilter = $filter('filter');\r\n\t\t\tctrl.authentication = Authentication;\r\n\t\t\tctrl.colours = { red: '#c9302c', green: '#449d44', blue: '#31b0d5' }; //'red'; '#d9534f'; ////'green';'#5cb85c'; ////'blue';'#5bc0de'; //\r\n\t\t\tctrl.commonArrays = ListService.getCommonArrays('statistics');\r\n\t\t\tctrl.dataStore = { anime: [], manga: [], character: [], toptens: { anime: {}, manga: {}, character: {} } };\r\n\t\t\tctrl.detail = {\r\n\t\t\t\t\tisVisible: false,\r\n\t\t\t\t\tyear: '',\r\n\t\t\t\t\tdivision: '',\r\n\t\t\t\t\tdivisionText: '',\r\n\t\t\t\t\thistory: 'months',\r\n\t\t\t\t\tsummary: {\r\n\t\t\t\t\t\t\ttype: '',\r\n\t\t\t\t\t\t\tisVisible: false\r\n\t\t\t\t\t},\r\n\t\t\t\t\tisEpisodeRatings: false\r\n\t\t\t};\r\n\t\t\tctrl.filterConfig = {\r\n          show: {\r\n              tag: false,\r\n              series: false,\r\n              voice: false\r\n          },\r\n          sort: {\r\n\t\t\t\t\t\t\tepisodeRating: {\r\n\t\t\t\t\t\t\t\ttype: 'title',\r\n\t\t\t\t\t\t\t\treverse: false\r\n\t\t\t\t\t\t\t},\r\n              tag: {\r\n                  type: 'ratingWeighted',\r\n                  reverse: true\r\n              },\r\n              tagDetail: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n              series: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n              voice: {\r\n                  type: 'count',\r\n                  reverse: true\r\n              },\r\n\t\t\t\t\t\t\ttopten: {\r\n\t\t\t\t\t\t\t\ttype: 'count',\r\n\t\t\t\t\t\t\t\treverse: true\r\n\t\t\t\t\t\t\t}\r\n          },\r\n          search: {\r\n              tag: '',\r\n              tagDetail: '',\r\n              series: '',\r\n              voice: '',\r\n\t\t\t\t\t\t\ttopten: ''\r\n          },\r\n\t\t\t\t\ttopten: {\r\n\t\t\t\t\t\tisRanked: false,\r\n\t\t\t\t\t\tisFavourite: false\r\n\t\t\t\t\t}\r\n      };\r\n\t\t\tctrl.find = find;\r\n\t\t\tctrl.gender = {}; //holds gender summary details.\r\n\t\t\tctrl.generateSeasons = generateSeasons;\r\n\t\t\tctrl.getFilteredItems = getFilteredItems;\r\n\t\t\tctrl.getToptenItemStatistics = getToptenItemStatistics;\r\n\t\t\tctrl.historyDetail = historyDetail;\r\n      ctrl.historyDetails = {};\r\n      ctrl.overview = {}; //holds summary/overview details.\r\n      ctrl.ratingsDistribution = []; //counts for each rating.\r\n      ctrl.statSeries = []; //for series statistics;\r\n      ctrl.statTags = []; //for tag statistics;\r\n\t\t\tctrl.tableDetail = tableDetail;\r\n\t\t\tctrl.tableDetails = {};\r\n      ctrl.taglessItem = false; //filter variable for showing tagless items.\r\n      ctrl.toptens = {\r\n\t\t\t\ttype: 'anime',\r\n\t\t\t\tanime: { listCount: 0, items: [] }, manga:  { listCount: 0, items: [] }, character:  { listCount: 0, items: [] }, detail: { items: [] }\r\n\t\t\t };\r\n      ctrl.view = 'Anime';\r\n      ctrl.voiceActors = []; //for voice actor list;\r\n\r\n\t\t\tfunction getItemStatistics(view, items) {\r\n\t\t\t\tif(view === 'Anime' || view === 'Manga') {\r\n\t\t\t\t\tctrl.overview = ItemService.buildOverview(items);\r\n\t\t\t\t\tctrl.historyDetails.months = ItemService.completeByMonth(items);\r\n\t\t\t\t\tif (view === 'Anime') ctrl.historyDetails.seasons = ItemService.completeBySeason(items);\r\n\t\t\t\t\tctrl.ratingValues = ItemService.getRatingValues(items);\r\n\t\t\t\t\tctrl.ratingsDistribution = ItemService.buildRatingsDistribution(items);\r\n\t\t\t\t\tctrl.statTags = ItemService.buildStatTags(items, ctrl.ratingValues.averageRating);\r\n\t\t\t\t} else if (view === 'Character') {\r\n\t\t\t\t\tctrl.statTags = CharacterService.buildCharacterTags(items);\r\n\t\t\t\t\tctrl.statSeries = CharacterService.buildSeriesList(items);\r\n\t\t\t\t\tctrl.voiceActors = CharacterService.buildVoiceActors(items);\r\n\t\t\t\t\tCharacterService.buildGenderDistribution(ctrl.statTags, items.length).then(function(result) {\r\n\t\t\t\t\t\t\tctrl.gender = result;\r\n\t\t\t\t\t\t\tctrl.gender[0].colour = ctrl.colours.red;\r\n\t\t\t\t\t\t\tctrl.gender[1].colour = ctrl.colours.green;\r\n\t\t\t\t\t\t\tctrl.gender[2].colour = ctrl.colours.blue;\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (view ==='Topten') {\r\n\t\t\t\t\tStatisticsService.buildToptenModeList(items, ctrl.toptens.type).then(function(result) {\r\n\t\t\t\t\t\tctrl.toptens.detail.items = result.sort(function(a, b) {\r\n\t\t\t\t\t\t\tif(a.count < b.count) return 1;\r\n\t\t\t\t\t\t\tif(a.count > b.count) return -1;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.log('topten stat process: ', items, ctrl.toptens);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//handle getting view items and setting view specific defaults.\r\n      function getItems(view) {\r\n          //reset defaults that are shared between views.\r\n          ctrl.detail.history = 'months';\r\n          ctrl.filterConfig.search.tag = '';\r\n          ctrl.detail.isVisible = false;\r\n          ctrl.detail.isEpisodeRatings = false;\r\n          ctrl.statTags = []; //clear to stop multiple views tags appearing.\r\n          ctrl.ratingsDistribution = [];\r\n          if (view === 'Anime') {\r\n              ctrl.filterConfig.sort.tag.type = 'ratingWeighted'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.anime.length === 0) {\r\n                spinnerService.loading('items', Animeitems.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.anime = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t                getItemStatistics(view, result);\r\n\t\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.anime;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.anime);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - anime');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Manga') {\r\n              ctrl.filterConfig.sort.tag.type = 'ratingWeighted'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.manga.length === 0) {\r\n              \tspinnerService.loading('items',\tMangaitems.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.manga = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t\t\t\t\t\t\t\t\tgetItemStatistics(view, result);\r\n              \t}));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.manga;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.manga);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - anime');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Character') {\r\n              ctrl.filterConfig.sort.tag.type = 'count'; //stat tag sort\r\n\t\t\t\t\t\t\tif (ctrl.dataStore.character.length === 0) {\r\n\t\t\t\t\t\t\t\tspinnerService.loading('character', Characters.query().$promise.then(function(result) {\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.character = result;\r\n\t\t\t\t\t\t\t\t\tctrl.items = result;\r\n\t\t\t\t\t\t\t\t\tgetItemStatistics(view, result);\r\n                }));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tctrl.items = ctrl.dataStore.character;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.dataStore.character);\r\n\t\t\t\t\t\t\t\tconsole.log('from cache - character');\r\n\t\t\t\t\t\t\t}\r\n          } else if (view === 'Topten') {\r\n\t\t\t\t\t\tif (ctrl.dataStore.toptens.anime.totalListCount === undefined) {\r\n              spinnerService.loading('topten', Toptens.query().$promise.then(function(result) {\r\n                return ListService.groupItemsByProperties(result, ['type']);\r\n              }).then(function(result) {\r\n\t\t\t\t\t\t\t\tfor(var i = 0, type = ''; i < 3; i++) {\r\n\t\t\t\t\t\t\t\t\ttype = result[i][0].type;\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.toptens[type].items = result[i];\r\n\t\t\t\t\t\t\t\t\tctrl.dataStore.toptens[type].totalListCount = result[i].length;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn StatisticsService.buildToptenDataStructure(ctrl.toptens, result);\r\n              }).then(function(result) {\r\n\t\t\t\t\t\t\t\tctrl.toptens = result;\r\n\t\t\t\t\t\t\t\tgetItemStatistics(view, result[ctrl.toptens.type].items);\r\n\t\t\t\t\t\t\t\tconsole.log('topten arrays: ', ctrl.toptens);\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tgetItemStatistics(view, ctrl.toptens[ctrl.toptens.type].items);\r\n\t\t\t\t\t\t\tconsole.log('from cache - topten');\r\n\t\t\t\t\t\t}\r\n          }\r\n\t\t\t\t\tconsole.log('dataStore check: ', ctrl.dataStore);\r\n      }\r\n      function find(view) {\r\n          getItems(view);\r\n      }\r\n\r\n\t\t\tfunction getToptenItemStatistics(view, toptenType) {\r\n\t\t\t\tconsole.log('get topten stats: ', toptenType);\r\n\t\t\t\tvar filteredItems = ctrl.dataStore.toptens[toptenType].items;\r\n\t\t\t\tif(ctrl.filterConfig.topten.isRanked) filteredItems = filter(filteredItems, { isRanked: true });\r\n\t\t\t\tif(ctrl.filterConfig.topten.isFavourite) filteredItems = filter(filteredItems, { isFavourite: true });\r\n\t\t\t\tconsole.log('post filtering: ', filteredItems);\r\n\t\t\t\tif(filteredItems.length > 0) {\r\n\t\t\t\t\tctrl.toptens[toptenType].items = []; //clear items so you won't get repeats.\r\n\t\t\t\t\tStatisticsService.buildToptenDataStructure(ctrl.toptens, [filteredItems]).then(function(result) {\r\n\t\t\t\t\t\tctrl.toptens = result;\r\n\t\t\t\t\t\tconsole.log('topten data structure - result: ', result, ctrl.toptens);\r\n\t\t\t\t\t\tgetItemStatistics(view, result[toptenType].items);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctrl.toptens[toptenType].listCount = 0;\r\n\t\t\t\t\tctrl.toptens.detail.items = filteredItems;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n      //Builds ratings aggregates.\r\n      function getSummaryFunctions(array) {\r\n      \tspinnerService.loading('detail', StatisticsService.buildSummaryFunctions(array).then(function(result) {\r\n        \tctrl.historyDetails.summaryFunctions = result;\r\n\t\t\t\t\tconsole.log('got summary functions: ', ctrl.detail, ctrl.historyDetails);\r\n        }));\r\n        if (ctrl.detail.summary.isVisible === true) {\r\n\t        spinnerService.loading('detail',\r\n\t            StatisticsService.buildYearSummary(array, ctrl.detail.year, ctrl.detail.summary.type).then(function(result) {\r\n\t                ctrl.historyDetails.yearSummary = result;\r\n\t\t\t\t\t\t\t\t\tconsole.log('got year summary: ', ctrl.detail, ctrl.historyDetails);\r\n\t            })\r\n\t        );\r\n        }\r\n\t\t\t\tif(ctrl.detail.isEpisodeRatings && array[0].meta.episodeSummaryFunctions === undefined) { //If the first item has it already, they all do and this is pointless.\r\n          spinnerService.loading('detail', StatisticsService.buildEpisodeSummaries(array).then(function(result) {\r\n                  console.log(array);\r\n          }));\r\n\t\t\t\t}\r\n//            console.log(array, $scope.historyDetails);\r\n      }\r\n\r\n      function historyDetail(year, division, divisionText, summaryType) {\r\n\t      ctrl.detail.isVisible = true;\r\n\t      ctrl.detail.year = year;\r\n\t      ctrl.detail.division = division;\r\n\t      ctrl.detail.divisionText = divisionText;\r\n\t\t\t\tctrl.detail.summary.type = summaryType;\r\n\t      ctrl.detail.summary.isVisible = (summaryType === undefined) ? false : true;\r\n\t\t\t\tctrl.getFilteredItems();\r\n      }\r\n\r\n      function tableDetail(type, name) {\r\n          if (ctrl.tableDetails[type] === name) {\r\n              ctrl.filterConfig.search[type] = '';\r\n              ctrl.filterConfig.show[type] = false;\r\n              ctrl.tableDetails[type] = '';\r\n              if (type === 'tag') ctrl.tableDetails.isEqual = false;\r\n          } else {\r\n              ctrl.filterConfig.search[type] = name;\r\n              ctrl.tableDetails[type] = name;\r\n              ctrl.filterConfig.show[type] = true;\r\n              if (type === 'tag') {\r\n                  ctrl.tagDetailResult = CharacterService.buildRelatedCharacterTags(ctrl.items, name);\r\n                  ctrl.tableDetails.isEqual = true;\r\n              }\r\n          }\r\n      }\r\n\r\n\t\t\tfunction getFilteredItems(historyChange) {\r\n\t\t\t\tif(historyChange) {\r\n\t\t\t\t\tctrl.detail.isVisible = false;\r\n\t\t\t\t\tctrl.detail.summary.isVisible = false;\r\n\t\t\t\t\tif(ctrl.detail.history === 'months') ctrl.detail.isEpisodeRatings = false;\r\n\t\t\t\t}\r\n\t\t\t\tvar filtered = $filter('statisticsDetailFilter')(ctrl.items, ctrl.detail.history, ctrl.detail.year, ctrl.detail.division);\r\n\t\t\t\tgetSummaryFunctions(filtered);\r\n\t\t\t}\r\n\r\n      /** Using the start date of confirmed 'in-season' shows\r\n       *  to populate the new season attrs. that will work with the new\r\n       *  filters in the hopes accuracy and speed will increase.\r\n       */\r\n      function generateSeasons() {\r\n          if (ctrl.view === 'Anime') {\r\n              var array = ItemService.setSeason(ctrl.items, ctrl.detailSeasonYear, ctrl.detailSeason);\r\n              angular.forEach(array, function(item) {\r\n                  item.$update(function() {\r\n                      console.log(item);\r\n                  }, function(errorResponse) {\r\n                      ctrl.error = errorResponse.data.message;\r\n                  });\r\n              });\r\n          }\r\n      }\r\n\t\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('detectFlood', detectFlood);\r\n  detectFlood.$inject = ['$timeout'];\r\n\r\n  function detectFlood($timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function(scope, element, attrs) {\r\n            var el = element[0];\r\n\r\n            function overflowCheck() {\r\n                if (el.scrollWidth > el.offsetWidth) {\r\n                    el.classList.add('flooded');\r\n                } else {\r\n                    el.classList.remove('flooded');\r\n                }\r\n            }\r\n            overflowCheck();\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: el.offsetWidth,\r\n                    };\r\n                }, function () {\r\n//                    console.log('detect flood?');\r\n                        overflowCheck();\r\n                }, true\r\n            );\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('percentageBarContainer', percentageBarContainer);\r\n\r\n  function percentageBarContainer() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        scope: {\r\n          border: '@?'\r\n        },\r\n        transclude: true,\r\n        bindToController: true,\r\n        template: '<div class=\"relative {{percentageBarContainer.border}}\" style=\"height: 20px;\" ng-transclude></div>',\r\n        controllerAs: 'percentageBarContainer',\r\n        controller: function($scope) {\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('percentageBar', percentageBar);\r\n\r\n  function percentageBar() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        scope: {\r\n            type: '@?',\r\n            percentage: '@',\r\n            colour: '@?',\r\n            display: '@?'\r\n        },\r\n        require: '^percentageBarContainer',\r\n        templateUrl: '/modules/statistics/templates/percentage-bar.html',\r\n        link: function(scope, element, attrs, percentageBarContainerCtrl) {\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('tabContainer', tabContainer);\r\n\r\n  function tabContainer() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        scope: {\r\n            model: '=ngModel'\r\n        },\r\n        templateUrl: '/modules/statistics/templates/tab-container.html',\r\n        require: '?ngModel',\r\n        bindToController: true,\r\n        controllerAs: 'tabContainer',\r\n        controller: function($scope) {\r\n            var self = this;\r\n            self.tabs = [];\r\n            self.currentTab = undefined;\r\n            self.listShift = 0;\r\n\r\n            self.addTab = function addTab(tab) {\r\n                self.tabs.push(tab);\r\n\r\n                if(self.tabs.length === 1) {\r\n                    tab.active = true;\r\n                }\r\n            };\r\n\r\n            self.disable = function(disabledTab) {\r\n                if(disabledTab.active) {\r\n                    angular.forEach(self.tabs, function(tab) {\r\n                        if(!tab.disabled) {\r\n                            self.select(tab);\r\n                            return;\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n\r\n            self.select = function(selectedTab) {\r\n                if(!selectedTab.disabled) {\r\n                    angular.forEach(self.tabs, function(tab) {\r\n                        if(tab.active && tab !== selectedTab) {\r\n                          tab.active = false;\r\n                        }\r\n                    });\r\n                    selectedTab.active = true;\r\n                    self.currentTab = ($scope.tabContainer.model === undefined) ? undefined : selectedTab.heading;\r\n                }\r\n            };\r\n\r\n            self.shiftTabs = function(direction) {\r\n                switch(direction) {\r\n                    case 'origin':\r\n//                        console.log(self.listShift, (self.listShift - 100));\r\n                        if ((self.listShift + 100) > 0) {\r\n                            self.listShift = 0;\r\n                        } else {\r\n                            self.listShift += 100;\r\n                        }\r\n                        break;\r\n\r\n                    case 'offset':\r\n                        if ((self.listShift - 100) < ($scope.elWidth - $scope.ulWidth)) {\r\n                            self.listShift = $scope.elWidth - $scope.ulWidth;\r\n                        } else {\r\n                            self.listShift -= 100;\r\n                        }\r\n                        break;\r\n                }\r\n            };\r\n\r\n        },\r\n        link: function(scope, element, attrs, model) {\r\n            var el = element[0],\r\n                ul = el.children[0].children[0];\r\n            scope.elWidth = el.offsetWidth;\r\n            scope.ulWidth = ul.offsetWidth;\r\n\r\n            scope.$watch('tabContainer.currentTab', function(newValue) {\r\n                if (newValue !== undefined && model.$viewValue !== undefined) {\r\n                    model.$setViewValue(newValue);\r\n                }\r\n            });\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: el.offsetWidth,\r\n                    };\r\n                }, function () {\r\n                    scope.elWidth = el.offsetWidth;\r\n                }, true\r\n            );\r\n\r\n            scope.$watch(\r\n                function () {\r\n                    return {\r\n                        width: ul.offsetWidth,\r\n                    };\r\n                }, function () {\r\n                    scope.ulWidth = ul.offsetWidth;\r\n                }, true\r\n            );\r\n\r\n            scope.$watch('tabContainer.listShift', function(newValue) {\r\n                if(newValue !== undefined) {\r\n                    var shift = (newValue === 0) ? '' : 'px';\r\n                    ul.style.left = newValue + shift;\r\n                }\r\n            });\r\n\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('statistics')\r\n  .directive('tabView', tabView);\r\n\r\n  function tabView() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        template: '<div class=\"tab-view\" role=\"tabpanel\" ng-show=\"active\" ng-transclude></div>',\r\n        require: '^tabContainer',\r\n        scope: {\r\n            heading: '@',\r\n            disabled: '='\r\n        },\r\n        link: function (scope, element, attrs, tabContainerCtrl) {\r\n            scope.active = false;\r\n            tabContainerCtrl.addTab(scope);\r\n\r\n            scope.$watch('disabled', function(newValue) {\r\n                if(newValue !== undefined) {\r\n                    if(newValue) {\r\n                        console.log(scope.heading, newValue);\r\n                        tabContainerCtrl.disable(scope);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  //Statistics service\r\n  angular.module('statistics')\r\n  .service('StatisticsService', StatisticsService);\r\n  StatisticsService.$inject = ['$filter', 'ListService', '$q'];\r\n\r\n   function StatisticsService($filter, ListService, $q) {\r\n      var service = {\r\n        buildEpisodeSummaries: buildEpisodeSummaries,\r\n        buildSummaryFunctions: buildSummaryFunctions,\r\n        buildToptenDataStructure: buildToptenDataStructure,\r\n        buildToptenModeList: buildToptenModeList,\r\n        buildYearSummary: buildYearSummary,\r\n        getModeMap: getModeMap,\r\n        occuranceCounter: occuranceCounter\r\n      };\r\n      return service;\r\n\r\n      function buildSummaryFunctions(array) {\r\n          return $q(function(resolve, reject) {\r\n              if (array !== undefined) {\r\n                  var i = array.length, highestRating = 0, lowestRating = 10, averageRating = 0, modeRating = {}, ratings = { count: 0, sum: 0 };\r\n                  while(i--) {\r\n      //                console.log(array[i]);\r\n                      highestRating = array[i].rating > highestRating ? array[i].rating : highestRating;\r\n                      lowestRating = 0 < array[i].rating && array[i].rating < lowestRating ? array[i].rating : lowestRating;\r\n                      ratings.count += array[i].rating > 0 ? 1 : 0;\r\n                      ratings.sum += array[i].rating;\r\n                      averageRating = (ratings.sum / ratings.count).toFixed(2);\r\n                      modeRating = service.getModeMap(array, 'rating', 0);\r\n                  }\r\n                  resolve([\r\n                      { metric: 'Average rating', value: averageRating },\r\n                      { metric: 'Highest rating', value: highestRating },\r\n                      { metric: 'Lowest rating',  value: (lowestRating === 10) ? 0 : lowestRating },\r\n                      { metric: 'Mode rating',    value: (modeRating.value === undefined) ? 0 : modeRating.value }\r\n                  ]);\r\n              }\r\n          });\r\n      }\r\n\r\n      function processYearSummary(summary, array) {\r\n          var i = array.length;\r\n          if (summary.length < 1) {\r\n              while(i--) {\r\n                  summary.push({\r\n                      metric: array[i].metric,\r\n                      values: []\r\n                  });\r\n              }\r\n              summary.reverse();\r\n          }\r\n          i = array.length;\r\n          for(var j = 0; j < i; j++) {\r\n              summary[j].values.push({ value: array[j].value });\r\n          }\r\n          return summary;\r\n      }\r\n\r\n      function buildYearSummary(array, year, type) {\r\n          return $q(function(resolve, reject) {\r\n              var filter = (type === 'months') ? 'endedMonth' : 'season',\r\n                  attr   = (type === 'months') ? 'number'     : 'text'  ,\r\n                  commonArrays = ListService.getCommonArrays(),\r\n                  i = commonArrays[type].length,\r\n                  yearSummary = [], results = [];\r\n\r\n              for(var j = 0; j < i; j++) {\r\n                  var filteredArray = $filter(filter)(array, year, commonArrays[type][j][attr]),\r\n                      promise = service.buildSummaryFunctions(filteredArray);\r\n                  results.push(promise);\r\n              }\r\n              angular.forEach(results, function(promise) {\r\n                  promise.then(function(result) {\r\n                      yearSummary = processYearSummary(yearSummary, result);\r\n                  });\r\n              });\r\n              resolve(yearSummary);\r\n          });\r\n      }\r\n\r\n      function buildEpisodeSummaries(array) {\r\n          return $q(function(resolve, reject) {\r\n              angular.forEach(array, function(item) {\r\n                  service.buildSummaryFunctions(item.meta.history).then(function(result) {\r\n                      item.meta.episodeSummaryFunctions = result;\r\n                  });\r\n              });\r\n              resolve(array);\r\n          });\r\n      }\r\n\r\n      function getModeMap(array, attr, ignore) {\r\n          var modeMap = {},\r\n              max = {\r\n                  count: 0,\r\n                  value: ''\r\n              };\r\n          for(var i = 0; i < array.length; i++) {\r\n              var value = array[i][attr];\r\n              if(modeMap[value] === null || modeMap[value] === undefined) {\r\n                  modeMap[value] = 1;\r\n              } else {\r\n                  modeMap[value]++;\r\n              }\r\n              if(modeMap[value] > max.count) {\r\n                  //Ignore is a value you might not care about e.g. 0;\r\n                  if (ignore !== value) {\r\n                      max.count = modeMap[value];\r\n                      max.value = value;\r\n                  }\r\n              }\r\n          }\r\n  //        console.log(max);\r\n          return max;\r\n      }\r\n\r\n      function occuranceCounter(array, attr) {\r\n        return $q(function(resolve, reject) {\r\n          var occuranceCounter = [];\r\n          ListService.groupItemsByProperties(array, [attr]).then(function(result) {\r\n            for(var i = 0, len = result.length; i < len; i++) {\r\n              occuranceCounter.push({\r\n                value: result[i][0][attr],\r\n                count: result[i].length\r\n              });\r\n            }\r\n          });\r\n          resolve(occuranceCounter);\r\n        });\r\n      }\r\n\r\n      function buildToptenDataStructure(obj, arrayOfArrays) {\r\n        return $q(function(resolve, reject) {\r\n          angular.forEach(arrayOfArrays, function(array) {\r\n            var type = array[0].type, listType = type + 'List', len = array.length;\r\n            obj[type].listCount = len;\r\n            for(var i = 0; i < len; i++) {\r\n              var itemLen = array[i][listType].length;\r\n              for(var j = 0; j < itemLen; j++) {\r\n                obj[type].items.push(array[i][listType][j]);\r\n              }\r\n            }\r\n          });\r\n          resolve(obj);\r\n        });\r\n      }\r\n\r\n      function buildToptenModeList(array, type) {\r\n        var attr = type === 'character' ? 'name' : 'title';\r\n        return service.occuranceCounter(array, attr);\r\n      }\r\n\r\n    }\r\n\r\n  })();\r\n\r\n'use strict';\r\n\r\n//// Configuring the Articles module\r\n//angular.module('tasks').run(['Menus',\r\n//\tfunction(Menus) {\r\n//\t\t// Set top bar menu items\r\n//\t\tMenus.addMenuItem('topbar', 'Tasks', 'tasks', 'dropdown', '/tasks(/create)?');\r\n//\t\tMenus.addSubMenuItem('topbar', 'tasks', 'List Tasks', 'tasks');\r\n//\t\tMenus.addSubMenuItem('topbar', 'tasks', 'New Task', 'tasks/create');\r\n//\t}\r\n//]);\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('tasks').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Tasks state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listTasks', {\r\n\t\t\turl: '/tasks',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/list-tasks.client.view.html'\r\n\t\t}).\r\n\t\tstate('createTask', {\r\n\t\t\turl: '/tasks/create',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/create-task.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewTask', {\r\n\t\t\turl: '/tasks/:taskId',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/view-task.client.view.html'\r\n\t\t}).\r\n\t\tstate('editTask', {\r\n\t\t\turl: '/tasks/:taskId/edit',\r\n\t\t\ttemplateUrl: 'modules/tasks/views/edit-task.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('tasks').controller('CreateTaskController', CreateTaskController);\r\n  CreateTaskController.$inject =  ['$scope', 'data', '$stateParams', '$location', 'Authentication', 'Tasks', 'ListService', 'NotificationFactory', 'TaskFactory', 'spinnerService', '$uibModalInstance', 'Animeitems', 'Mangaitems'];\r\n\r\nfunction CreateTaskController($scope, data, $stateParams, $location, Authentication, Tasks, ListService, NotificationFactory, TaskFactory, spinnerService, $uibModalInstance, Animeitems, Mangaitems) {\r\n  var ctrl = this,\r\n      newTaskModel = {};\r\n  ctrl.addChecklistItem = addChecklistItem;\r\n  ctrl.backStep = backStep;\r\n  ctrl.cancel = cancel;\r\n  ctrl.commonArrays = data.commonArrays;\r\n  ctrl.create = create;\r\n  ctrl.dropChecklistItem = dropChecklistItem;\r\n  ctrl.stepConfig = {\r\n      currentStep: 1,\r\n      stepCount: 2\r\n  };\r\n  ctrl.submit = submit;\r\n  ctrl.takeStep = takeStep;\r\n\r\n  function setNewTask() {\r\n      ctrl.newTask = {\r\n          description: '',\r\n          link: {\r\n              linked: false,\r\n              type: '',\r\n              anime: undefined,\r\n              manga: undefined\r\n          },\r\n          day: '',\r\n          date: new Date(),\r\n          repeat: 0,\r\n          category: '',\r\n          daily: false,\r\n          checklist: false,\r\n          checklistItems: [],\r\n          isAddTask: false\r\n      };\r\n  }\r\n  setNewTask();\r\n  angular.copy(ctrl.newTask, newTaskModel);\r\n\r\n\r\n  //for adding/removing options.\r\n  function addChecklistItem() {\r\n          if (ctrl.newTask.checklistItem!=='' && ctrl.newTask.checklistItem!==undefined) {\r\n              var i = 0;\r\n              var alreadyAdded = false;\r\n              if (ctrl.newTask.checklistItems.length > 0) {\r\n                  while(i < ctrl.newTask.checklistItems.length) {\r\n                      if (ctrl.newTask.checklistItems[i].text === ctrl.newTask.checklistItem) {\r\n                          alreadyAdded = true;\r\n                      }\r\n                      i++;\r\n                  }\r\n                  //if not in array add it.\r\n                  if (alreadyAdded === false) {\r\n                      ctrl.newTask.checklistItems.push({ text: ctrl.newTask.checklistItem, complete: false });\r\n                  }\r\n              } else {\r\n                  ctrl.newTask.checklistItems.push({ text: ctrl.newTask.checklistItem, complete: false });\r\n              }\r\n          }\r\n          ctrl.newTask.checklistItem = '';\r\n  }\r\n  function dropChecklistItem(text) {\r\n      var deletingItem = ctrl.newTask.checklistItems;\r\n      ctrl.newTask.checklistItems = [];\r\n      //update the task.\r\n      angular.forEach(deletingItem, function(item) {\r\n          if (item.text !== text) {\r\n              ctrl.newTask.checklistItems.push(item);\r\n          }\r\n      });\r\n  }\r\n\r\n  // Create new Task\r\n  function create() {\r\n//            console.log(this.newTask);\r\n    // Create new Task object\r\n    var task = new Tasks ({\r\n        description: ctrl.newTask.description,\r\n        link: {\r\n            linked: ctrl.newTask.link.linked,\r\n            type: (ctrl.newTask.link.linked === false) ? ''      :\r\n                  (ctrl.newTask.category === 'Watch')  ? 'anime' :\r\n                                                         'manga' ,\r\n            anime: (ctrl.newTask.link.anime === undefined) ? undefined : ctrl.newTask.link.anime._id ,\r\n            manga: (ctrl.newTask.link.manga === undefined) ? undefined : ctrl.newTask.link.manga._id\r\n        },\r\n        day: ctrl.newTask.daily === true ? 'Any' : ctrl.newTask.day,\r\n        date: ctrl.newTask.date === '' ? new Date() : ctrl.newTask.date,\r\n        repeat: (ctrl.newTask.link.linked === false) ? ctrl.newTask.repeat                     :\r\n                (ctrl.newTask.category === 'Watch')  ? ctrl.newTask.link.anime.finalEpisode    :\r\n                                                       1    ,\r\n        completeTimes: (ctrl.newTask.link.linked === false) ? 0                                     :\r\n                       (ctrl.newTask.category === 'Watch')  ? ctrl.newTask.link.anime.episodes      :\r\n                                                              0      ,\r\n        updateCheck: new Date().getDay() === 1 ? true : false,\r\n        complete: false,\r\n        category: ctrl.newTask.category === '' ? 'Other' : ctrl.newTask.category,\r\n        daily: ctrl.newTask.daily,\r\n        checklist: ctrl.newTask.checklist,\r\n        checklistItems: ctrl.newTask.checklistItems\r\n    });\r\n//\t\t\t// Redirect after save\r\n    task.$save(function(response) {\r\n      $location.path('tasks');\r\n      NotificationFactory.success('Saved!', 'New Task was successfully saved!');\r\n    }, function(errorResponse) {\r\n      ctrl.error = errorResponse.data.message;\r\n      console.log(errorResponse);\r\n      NotificationFactory.error('Error!', 'New Task failed to save!');\r\n    });\r\n  }\r\n\r\n  function backStep(step) {\r\n      ctrl.stepConfig.currentStep -= 1;\r\n  }\r\n  function takeStep(step) {\r\n      var check = process(step);\r\n      if (check.valid) {\r\n          ctrl.stepConfig.currentStep += 1;\r\n      } else {\r\n          NotificationFactory.popup('Attention!', check.message, 'warning');\r\n      }\r\n  }\r\n  function submit() {\r\n    ctrl.create();\r\n    $uibModalInstance.close();\r\n  }\r\n  function cancel() {\r\n    $uibModalInstance.dismiss();\r\n  }\r\n\r\n  function process(step) {\r\n      switch(step) {\r\n          case 1:\r\n              if (ctrl.newTask.link.linked === true) {\r\n                  var category = ctrl.newTask.category;\r\n                  if (category === 'Watch') {\r\n                      ctrl.linkItems = Animeitems.query({\r\n                          status: 0\r\n                      });\r\n                      ctrl.linkType = 'anime';\r\n                      ctrl.newTask.checklistItems = [];\r\n                      ctrl.newTask.checklist = false;\r\n                  } else if (category === 'Read') {\r\n                      ctrl.linkItems = Mangaitems.query({\r\n                          status: 0\r\n                      });\r\n                      ctrl.linkType = 'manga';\r\n                  } else {\r\n                      return { valid: false, message: 'Category must be either Watch or Read for linked items!' };\r\n                  }\r\n              } else {\r\n                  //Ensure that stuff is cleared when not linked.\r\n                  ctrl.linkType = '';\r\n                  ctrl.newTask.link.anime = undefined;\r\n                  ctrl.newTask.link.manga = undefined;\r\n              }\r\n              return { valid: true };\r\n      }\r\n  }\r\n}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('tasks').controller('ScheduleCalendarTaskController', ScheduleCalendarTaskController);\r\n\tScheduleCalendarTaskController.$inject = ['$scope', '$uibModalInstance', 'moment', 'data', 'ListService', 'TaskFactory'];\r\n\r\n\tfunction ScheduleCalendarTaskController($scope, $uibModalInstance, moment, data, ListService, TaskFactory) {\r\n    var ctrl = this,\r\n\t\t\t\trefresh = false,\r\n\t\t\t\ttimeDiff = Math.abs(new Date(data.date).getTime() - new Date().getTime());\r\n\r\n\t\tctrl.cancel = cancel;\r\n    ctrl.date = new Date(data.date);\r\n\t\tctrl.day = ctrl.date.getDay() > 0 ? ctrl.date.getDay() - 1 : 6;\r\n\t\tctrl.days = data.days;\r\n\t\tctrl.daysFromToday = Math.ceil(timeDiff / (1000 * 3600 * 24));\r\n    ctrl.events = [];\r\n\t\tctrl.init = init;\r\n\t\tctrl.insertChecklistItem = insertChecklistItem;\r\n\t\tctrl.removeTask = removeTask;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.tickOffChecklist = tickOffChecklist;\r\n\t\tctrl.today = new Date();\r\n\t\tctrl.updateTask = updateTask;\r\n\t\tconsole.log('data: ', data, 'days: ', ctrl.days, ctrl.day, ctrl.date);\r\n\r\n\t\tfunction init() {\r\n\t\t\tvar weekEnds = new Date(ListService.weekEndingForDate(ctrl.date));\r\n\t\t\tangular.forEach(data.events, function(event) {\r\n\t\t\t\tif(new Date(event.date) < weekEnds && ((event.day.substring(0, 3) === ctrl.days[ctrl.day].text) || (event.day === 'Any'))) {\r\n\t\t\t\t\t// console.log('daysFromToday: ', ctrl.daysFromToday);\r\n\t\t\t\t\tif(!event.daily) {\r\n\t\t\t\t\t\t//in weeks\r\n\t\t\t\t\t\t// console.log('weeks: ', event.completeTimes, Math.floor(ctrl.daysFromToday / 7), event.repeat);\r\n\t\t\t\t\t\tif((event.completeTimes + Math.floor(ctrl.daysFromToday / 7) <= event.repeat) || event.repeat === 0) {\r\n\t\t\t\t\t\t\tctrl.events.push(event);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if(event.daily) {\r\n\t\t\t\t\t\t//in days\r\n\t\t\t\t\t\t// console.log('days: ', event.completeTimes, ctrl.daysFromToday, event.repeat);\r\n\t\t\t\t\t\tif(((event.completeTimes + ctrl.daysFromToday) <= event.repeat) || event.repeat === 0) {\r\n\t\t\t\t\t\t\tctrl.events.push(event);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tctrl.events.sort(function(a, b) {\r\n\t\t\t\tvar aDate = a.date, bDate = b.date;\r\n\t\t\t\treturn aDate < bDate ? 1 :\r\n\t\t\t\t\t\t\t aDate > bDate ? -1 : 0;\r\n\t\t\t});\r\n\t\t}\r\n\t\tctrl.init();\r\n\r\n\t\tfunction removeTask(task) {\r\n\t\t\tTaskFactory.removeTask(task, ctrl.events, true);\r\n\t\t}\r\n\t\t//Update task.\r\n\t\tfunction updateTask(task) {\r\n\t\t\t\tTaskFactory.updateTask(task);\r\n\t\t}\r\n    //Add new checklist item.\r\n    function insertChecklistItem(task, newChecklistItem) {\r\n        TaskFactory.insertChecklistItem(task, newChecklistItem);\r\n    }\r\n\t\t//Tick off a task.\r\n\t\tfunction tickOff(task) {\r\n\t\t    TaskFactory.tickOff(task).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOff: ', result);\r\n\t\t\t\t\trefresh = result.refresh;\r\n\t\t\t\t});\r\n\t\t}\r\n    //Tick of a checklist item.\r\n    function tickOffChecklist(task, index) {\r\n        TaskFactory.tickOffChecklist(task, index).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOffChecklist: ', result);\r\n\t\t\t\t\trefresh = result.refresh;\r\n\t\t\t\t});\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.close(refresh);\r\n    }\r\n\t}\r\n})();\r\n\r\n(function() {\r\n'use strict';\r\n\r\n\t// Tasks controller\r\n\tangular.module('tasks').controller('TasksController', TasksController);\r\n\tTasksController.$inject =  ['$scope', '$timeout', '$stateParams', '$location', 'Authentication', 'Tasks', 'ListService', 'NotificationFactory', 'TaskFactory', 'spinnerService', '$uibModal', 'moment'];\r\n\r\n\tfunction TasksController($scope, $timeout, $stateParams, $location, Authentication, Tasks, ListService, NotificationFactory, TaskFactory, spinnerService, $uibModal, moment) {\r\n\t\tvar ctrl = this,\r\n\t\t\t\ttoday = new Date(),\r\n\t\t\t\tday = today.getDay();\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.commonArrays = ListService.getCommonArrays();\r\n\t\tctrl.createTask = createTask;\r\n\t\tctrl.dateOptions = {\r\n\t\t\tdateDisabled: false,\r\n\t\t\tformatYear: 'yy',\r\n\t\t\tmaxDate: new Date(2020, 5, 22),\r\n\t\t\tminDate: new Date(),\r\n\t\t\tstartingDay: 1\r\n\t\t};\r\n\t\tctrl.filterConfig = {\r\n\t\t\tview: 'list',\r\n      showingCount: 0,\r\n      sortType: '',\r\n      sortReverse: true,\r\n      search: {\r\n          description: '',\r\n          day: ''\r\n      },\r\n      datesSelected: false\r\n    };\r\n\t\tctrl.insertChecklistItem = insertChecklistItem;\r\n    ctrl.pageConfig = {\r\n        currentPage: 0,\r\n        pageSize: 10\r\n    };\r\n\t\tctrl.refreshItems = refreshItems;\r\n\t\tctrl.removeTask = removeTask;\r\n\t\tctrl.setTabFilterDay = setTabFilterDay;\r\n\t\tctrl.tabFilter = tabFilter;\r\n\t\tctrl.tickOff = tickOff;\r\n\t\tctrl.tickOffChecklist = tickOffChecklist;\r\n\t\tctrl.updateTask = updateTask;\r\n\t\tctrl.weekBeginning = weekBeginning;\r\n\t\tctrl.whichController = 'task';\r\n\r\n    function tabFilter(tabName) {\r\n        ctrl.filterConfig.search.day = tabName;\r\n    }\r\n\r\n    function weekBeginning() {\r\n        return TaskFactory.getWeekBeginning();\r\n    }\r\n\r\n\t\tfunction createTask() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: '/modules/tasks/views/create-task.client.view.html',\r\n        controller: 'CreateTaskController as taskCreate',\r\n        size: 'lg',\r\n\t\t\t\tresolve: {\r\n\t\t\t\t\tdata: function () {\r\n\t\t\t\t\t\treturn { commonArrays: ctrl.commonArrays };\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      }).result.then(function(result) {\r\n        console.log('closed create task: ', result);\r\n\t\t\t\tfind();\r\n      });\r\n\t\t}\r\n\r\n\t\t// Remove existing Task\r\n\t\tfunction removeTask(task) {\r\n\t\t\tTaskFactory.removeTask(task, ctrl.tasks, true);\r\n\t\t}\r\n\t\t//Update task.\r\n\t\tfunction updateTask(task) {\r\n\t\t\t\tTaskFactory.updateTask(task);\r\n\t\t}\r\n    //Add new checklist item.\r\n    function insertChecklistItem(task, newChecklistItem) {\r\n        TaskFactory.insertChecklistItem(task, newChecklistItem);\r\n    }\r\n\t\t//Tick off a task.\r\n\t\tfunction tickOff(task) {\r\n\t\t    TaskFactory.tickOff(task).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOff: ', result);\r\n\t\t\t\t\tif(result.refresh) find();\r\n\t\t\t\t});\r\n\t\t}\r\n    //Tick of a checklist item.\r\n\t\tfunction tickOffChecklist(task, index) {\r\n        TaskFactory.tickOffChecklist(task, index).then(function(result) {\r\n\t\t\t\t\t// console.log('update task res - tickOffChecklist: ', result);\r\n\t\t\t\t\tif(result.refresh) find();\r\n\t\t\t\t});\r\n    }\r\n\r\n    //Defaults the tab filter to the current day of the week.\r\n    function setTabFilterDay(day) {\r\n        var index = day === 0 ? 7 : day; //Adjust for Sunday.\r\n        ctrl.filterConfig.search.day = ctrl.commonArrays.days[index].name;\r\n        console.log(day, ctrl.filterConfig.search.day);\r\n    }\r\n    ctrl.setTabFilterDay(day);\r\n\r\n    //check things\r\n    function checkStatus() {\r\n        if (day === 1) {\r\n            console.log('monday', day);\r\n            angular.forEach(ctrl.tasks, function (task) {\r\n                //has it been updated today?\r\n                if(task.updateCheck === false) {\r\n                    console.log('updating - ', task.description);\r\n                    var type = task.link.type;\r\n                    if ((task.link.linked === false) || (type === 'manga')) {\r\n                        //has it reached the necessary number of repeats?\r\n                        if(task.completeTimes !== task.repeat) {\r\n                            console.log('not complete', task.description);\r\n                            task.complete = false;\r\n                            task.updateCheck = true;\r\n                            TaskFactory.updateTask(task);\r\n                        } else if (task.completeTimes === task.repeat) {\r\n                            console.log('complete - delete', task.description);\r\n                            TaskFactory.removeTask(task, ctrl.tasks);\r\n                        }\r\n                    } else if (task.link.type === 'anime') {\r\n                        console.log('linked');\r\n                            var parts = { single: 'episodes', all: 'finalEpisode' };\r\n                        if (task.link[type][parts.single] !== task.link[type][parts.all]) {\r\n                            console.log('linked not complete', task.description);\r\n                            task.complete = false;\r\n                            task.updateCheck = true;\r\n                            TaskFactory.updateTask(task);\r\n                        } else if (task.link[type][parts.single] === task.link[type][parts.all]) {\r\n                            console.log('linked complete - delete', task.description);\r\n                            TaskFactory.removeTask(task, ctrl.tasks);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n            console.log('not monday', day);\r\n            angular.forEach(ctrl.tasks, function (task) {\r\n                var change = task.updateCheck === false ? false : true;\r\n                task.updateCheck = false;\r\n                //is it a daily task?\r\n                if (task.daily === true) {\r\n                    console.log('daily', task.description);\r\n                    //has it reached the necessary number of repeats?\r\n                    if(task.completeTimes !== task.repeat) {\r\n                        console.log('not complete', task.description);\r\n                        var refresh = today.toISOString().slice(0,10);\r\n                        //has it been refreshed today?\r\n                        if (task.dailyRefresh.slice(0,10) !== refresh) {\r\n                            console.log('not complete - update', task.description);\r\n                            task.complete = false;\r\n                            task.dailyRefresh = refresh;\r\n                            TaskFactory.updateTask(task);\r\n                        }\r\n                    } else if (task.completeTimes === task.repeat) {\r\n                        console.log('complete - delete', task.description);\r\n                        TaskFactory.removeTask(task, ctrl.tasks);\r\n                    }\r\n                } else if ((task.daily === false) && change) {\r\n                    console.log('weekly update: ', task.description);\r\n                    TaskFactory.updateTask(task);\r\n                }\r\n            });\r\n        }\r\n        find();\r\n    }\r\n\r\n\t\t// Find a list of Tasks\r\n\t\tfunction find(check) {\r\n\t\t\t$timeout(function () {\r\n\t\t    spinnerService.loading('tasks', Tasks.query().$promise.then(function(result) {\r\n\t\t\t\t\tconsole.log('found! : ', result);\r\n\t\t        ctrl.tasks = result;\r\n\t\t        if (check === true) checkStatus();\r\n\t\t    }));\r\n\t\t\t}, 250);\r\n\t\t}\r\n\t\tfind(true);\r\n\r\n\t\tfunction refreshItems() {\r\n\t\t\tfind();\r\n      NotificationFactory.warning('Refreshed!', 'Task list refreshed!');\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('tasks').controller('UpdateAnimeTaskController', UpdateAnimeTaskController);\r\n\tUpdateAnimeTaskController.$inject = ['$scope', '$uibModalInstance', 'data', 'FunctionService'];\r\n\r\n\tfunction UpdateAnimeTaskController($scope, $uibModalInstance, data, FunctionService) {\r\n    var ctrl = this;\r\n\t\tctrl.cancel = cancel;\r\n\t\tctrl.episodeCompleted = data.item.link.anime.episodes + 1;\r\n    ctrl.episodeNumber = FunctionService.pad(ctrl.episodeCompleted, 3);\r\n    ctrl.episodeRating = 0;\r\n    ctrl.item = data.item;\r\n    ctrl.isComplete = ctrl.episodeCompleted === ctrl.item.link.anime.finalEpisode && ctrl.item.link.anime.finalEpisode !== 0;\r\n    ctrl.ratingLimit = 10;\r\n    ctrl.stepConfig = {\r\n        currentStep: 1,\r\n        stepCount: 1\r\n    };\r\n\t\tctrl.submit = submit;\r\n\r\n    function submit() {\r\n      $uibModalInstance.close({ task: ctrl.item, episodeRating: ctrl.episodeRating });\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular.module('tasks').controller('UpdateMangaTaskController', UpdateMangaTaskController);\r\n\tUpdateMangaTaskController.$inject = ['$scope', '$uibModalInstance', 'data'];\r\n\r\n\tfunction UpdateMangaTaskController($scope, $uibModalInstance, data) {\r\n    var ctrl = this;\r\n\t\tctrl.cancel = cancel;\r\n    ctrl.item = data.item;\r\n    ctrl.stepConfig = {\r\n        currentStep: 1,\r\n        stepCount: 1\r\n    };\r\n\t\tctrl.submit = submit;\r\n    console.log('update linked manga item: ', ctrl.item);\r\n\r\n    function submit() {\r\n      $uibModalInstance.close(ctrl.item);\r\n    }\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('loseInterest', loseInterest);\r\n\r\n   function loseInterest($document, $window) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attrs) {\r\n            element.data('interesting', true);\r\n            /** On click, check what you clicked and whether you can ignore it.\r\n             *    Based on checks false the ng-show of the anywhere-but-here element.\r\n             */\r\n            angular.element($document[0].body).on('click', function (e) {\r\n                var interesting = angular.element(e.target).inheritedData('interesting'),\r\n                    elm = angular.element(e.target)[0].tagName,\r\n                    alsoInteresting = (elm === 'A') || (elm === 'I');\r\n                    //console.log(elm);\r\n                if (!interesting && !alsoInteresting) {\r\n                    scope.$apply(function () {\r\n                        scope.collapseFilters();\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('scheduleCalendar', scheduleCalendar);\r\n  scheduleCalendar.$inject = ['$uibModal', 'moment', 'ListService'];\r\n\r\n   function scheduleCalendar($uibModal, moment, ListService) {\r\n\r\n    function _removeTime(date) {\r\n      return date.day(1).hour(12).minute(0).second(0).millisecond(0);\r\n    }\r\n\r\n    function _buildMonth(scope, start, month) {\r\n         scope.weeks = [];\r\n         var done = false, date = moment(start), monthIndex = date.month(), count = 0;\r\n         while (!done) {\r\n           var days = _buildWeek(moment(date), month);\r\n           if(ListService.findWithAttr(days, 'isCurrentMonth', true) > -1) {\r\n             scope.weeks.push({ days: days });\r\n           }\r\n             date.add(1, 'w');\r\n             done = count++ > 2 && monthIndex !== date.month();\r\n             monthIndex = date.month();\r\n         }\r\n     }\r\n\r\n     function _buildWeek(date, month) {\r\n         var days = [];\r\n         for (var i = 0; i < 7; i++) {\r\n             days.push({\r\n                 name: date.format('dd').substring(0, 1),\r\n                 number: date.date(),\r\n                 isCurrentMonth: date.month() === month.month(),\r\n                 isToday: date.isSame(new Date(), 'day'),\r\n                 date: date\r\n             });\r\n             date = moment(date);\r\n             date.add(1, 'd');\r\n         }\r\n         return days;\r\n     }\r\n\r\n     function _displayEvents(events, date, days) {\r\n       var modalInstance = $uibModal.open({\r\n         animation: true,\r\n         templateUrl: '/modules/tasks/views/schedule-calendar-task.client.view.html',\r\n         controller: 'ScheduleCalendarTaskController as ctrl',\r\n         size: 'lg',\r\n         resolve: {\r\n           data: function () {\r\n             return { events: events, date: date, days: days };\r\n           }\r\n         }\r\n       }).result.then(function(result) {\r\n         console.log('closed - require refresh: ', result);\r\n       });\r\n     }\r\n\r\n    return {\r\n         restrict: 'A',\r\n         templateUrl: 'modules/tasks/templates/schedule-calendar.html',\r\n         scope: {\r\n           events: '='\r\n         },\r\n         link: function(scope) {\r\n             scope.days = [{ text: 'Mon' }, { text: 'Tue' }, { text: 'Wed' }, { text: 'Thu' }, { text: 'Fri' }, { text: 'Sat' }, { text: 'Sun' }];\r\n             scope.selected = moment(new Date());\r\n             scope.month = moment(scope.selected);\r\n\r\n             var start = moment(_removeTime(angular.copy(scope.selected)));\r\n             start.date(-6);\r\n             _removeTime(start.day(0));\r\n\r\n             _buildMonth(scope, start, scope.month);\r\n\r\n             scope.select = function(day) {\r\n               if(scope.selected === day.date){\r\n                 _displayEvents(scope.events, day.date, scope.days);\r\n               }\r\n               scope.selected = day.date;\r\n             };\r\n\r\n             scope.next = function() {\r\n                 var next = moment(scope.month);\r\n                 _removeTime(next.month(next.month()+1).date(0));\r\n                 scope.month.month(scope.month.month()+1);\r\n                 _buildMonth(scope, next, scope.month);\r\n             };\r\n\r\n             scope.previous = function() {\r\n                 var previous = moment(scope.month);\r\n                 _removeTime(previous.month(previous.month()-1).date(0));\r\n                 scope.month.month(scope.month.month()-1);\r\n                 _buildMonth(scope, previous, scope.month);\r\n             };\r\n         }\r\n     };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('shadowModel', shadowModel);\r\n\r\n   function shadowModel() {\r\n    return {\r\n      scope: true,\r\n      link: function(scope, el, att) {\r\n        console.log('shadow: ', scope);\r\n        scope[att.shadow] = angular.copy(scope[att.shadow]);\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('taskItemModel', taskItemModel);\r\n\r\n  function taskItemModel() {\r\n    return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      templateUrl: 'modules/tasks/templates/task-item.html'\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks')\r\n  .directive('passClick', passClick);\r\n\r\n  function passClick() {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        element.bind('click', function(event) {\r\n          var passTo = document.getElementById(attrs.passClick);\r\n          passTo.focus();\r\n          passTo.click();\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('tasks').factory('TaskFactory', TaskFactory);\r\n  TaskFactory.$inject = ['$q', 'Animeitems', 'Mangaitems', 'AnimeFactory', 'MangaFactory', 'NotificationFactory', 'ListService', '$uibModal'];\r\n\r\n    function TaskFactory($q, Animeitems, Mangaitems, AnimeFactory, MangaFactory, NotificationFactory, ListService, $uibModal) {\r\n      var obj = {\r\n        getWeekBeginning: getWeekBeginning,\r\n        insertChecklistItem: insertChecklistItem,\r\n        removeTask: removeTask,\r\n        updateAnimeitem: updateAnimeitem,\r\n        updateMangaitem: updateMangaitem,\r\n        updateTask: updateTask,\r\n        tickOff: tickOff,\r\n        tickOffChecklist: tickOffChecklist,\r\n      };\r\n      return obj;\r\n\r\n          function getWeekBeginning() {\r\n              var newDate = new Date(),\r\n                  day = newDate.getDay(),\r\n                  diff = newDate.getDate() - day + (day === 0 ? -6:1); // adjust when day is sunday\r\n              var wkBeg = new Date();\r\n              return new Date(wkBeg.setDate(diff));\r\n          }\r\n\r\n          function updateAnimeitem(task, episodeRating) {\r\n            return $q(function(resolve, reject) {\r\n              var query = Animeitems.get({\r\n  \t\t\t\t\t\t\tanimeitemId: task.link.anime._id\r\n  \t\t\t\t\t\t});\r\n              query.$promise.then(function(data) {\r\n                  console.log('update animeitem for ', task, data);\r\n                  data.episodes += 1;\r\n                  data.rating = task.link.anime.rating || data.rating;\r\n                  data.latest = new Date();\r\n                  AnimeFactory.update(data, undefined, true, undefined, episodeRating);\r\n                  resolve(data);\r\n              });\r\n            });\r\n          }\r\n\r\n          function updateMangaitem(task, chapters, volumes) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n              var query = Mangaitems.get({\r\n  \t\t\t\t\t\t\tmangaitemId: task.link.manga._id\r\n  \t\t\t\t\t\t});\r\n              query.$promise.then(function(data) {\r\n                  //console.log(data);\r\n                  data.chapters = chapters;\r\n                  data.volumes = volumes;\r\n                  data.latest = new Date();\r\n                  MangaFactory.update(data, undefined, true, undefined);\r\n  \t\t\t\t\t\t\t\tresolve(data);\r\n              });\r\n  \t\t\t\t\t});\r\n          }\r\n\r\n  \t\t\t\t/** Task Update,Edit,Delete and other functions below here.\r\n  \t\t\t\t */\r\n\r\n  \t\t\t // Update existing Task\r\n  \t\t\t function updateTask(task, refresh) {\r\n  \t\t\t\t return $q(function(resolve, reject) {\r\n  \t\t\t\t\t //console.log('update');\r\n  \t\t\t\t\t if (task.link.anime) {\r\n  \t\t\t\t\t\t task.link.anime = task.link.anime._id;\r\n  \t\t\t\t\t } else if (task.link.manga) {\r\n  \t\t\t\t\t\t task.link.manga = task.link.manga._id;\r\n  \t\t\t\t\t }\r\n\r\n  \t\t\t\t\t\ttask.$update(function() {\r\n  \t\t\t\t\t\t\tNotificationFactory.success('Saved!', 'Task was successfully updated!');\r\n  \t\t\t\t\t\t  //Refresh items if the callee wasn't checkStatus.\r\n  \t\t\t\t\t\t  console.log('update, refresh items ? ', refresh);\r\n  \t\t\t\t\t\t  resolve({ refresh: refresh });\r\n  \t\t\t\t\t\t}, function(errorResponse) {\r\n  \t\t\t\t\t\t\tvar errorMessage = errorResponse.data.message;\r\n  \t\t\t\t\t\t\treject(errorMessage);\r\n  \t\t\t\t\t\t  //console.log(errorResponse);\r\n  \t\t\t\t\t\t  NotificationFactory.error('Error!', 'Task failed to save!');\r\n  \t\t\t\t\t\t});\r\n  \t\t\t\t\t});\r\n  \t\t\t }\r\n\r\n  \t\t\t //Remove a task.\r\n  \t\t\t\tfunction removeTask(task, tasks, userCheck) {\r\n  \t\t\t\t\tif(userCheck) {\r\n  \t\t\t\t\t\t//console.log('launch');\r\n  \t\t\t\t\t\tNotificationFactory.confirmation(function remove() {\r\n  \t\t          removeTaskProcess(task, tasks);\r\n  \t\t\t\t\t\t});\r\n  \t\t\t\t\t} else {\r\n  \t\t\t\t\t\tremoveTaskProcess(task, tasks);\r\n  \t\t\t\t\t}\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\tfunction removeTaskProcess(task, tasks) {\r\n  \t\t\t\t\tif ( task ) {\r\n  \t\t\t\t\t\t\ttask.$remove();\r\n  \t\t\t\t\t\t\tfor (var i in tasks) {\r\n  \t\t\t\t\t\t\t\t\tif (tasks[i] === task) {\r\n  \t\t\t\t\t\t\t\t\t\t\ttasks.splice(i, 1);\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\tNotificationFactory.warning('Deleted!', 'Task was successfully deleted.');\r\n  \t\t\t\t\t}\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Linked manga need special options dialog.\r\n  \t\t\t\tfunction launchMangaUpdateDialog(task, checklistIndex) {\r\n  \t\t\t\t\tvar modalInstance = $uibModal.open({\r\n  \t\t\t\t\t\tanimation: true,\r\n  \t\t      \ttemplateUrl: '/modules/tasks/views/update-manga-task.client.view.html',\r\n  \t\t      \tcontroller: 'UpdateMangaTaskController as ctrl',\r\n  \t\t      \tsize: 'md',\r\n  \t\t      \tresolve: {\r\n  \t\t        \tdata: function () {\r\n  \t\t          \treturn { item: angular.copy(task), itemOriginal: task };\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t\treturn modalInstance;\r\n  \t\t\t\t}\r\n\r\n          //Linked anime need special options dialog.\r\n  \t\t\t\tfunction launchAnimeUpdateDialog(task, checklistIndex) {\r\n  \t\t\t\t\tvar modalInstance = $uibModal.open({\r\n  \t\t\t\t\t\tanimation: true,\r\n  \t\t      \ttemplateUrl: '/modules/tasks/views/update-anime-task.client.view.html',\r\n  \t\t      \tcontroller: 'UpdateAnimeTaskController as ctrl',\r\n  \t\t      \tsize: 'md',\r\n  \t\t      \tresolve: {\r\n  \t\t        \tdata: function () {\r\n  \t\t          \treturn { item: angular.copy(task), itemOriginal: task };\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t\treturn modalInstance;\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Completes a task.\r\n  \t\t\t\tfunction tickOff(task) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n  \t\t\t\t\t\tvar isLinked = task.link.linked;\r\n  \t\t\t\t    //Is it linked?\r\n  \t\t\t\t    if (!isLinked) {\r\n  \t\t\t\t        task.completeTimes += 1;\r\n  \t\t\t\t    } else if (isLinked) {\r\n  \t\t\t\t        /** Anime or manga?\r\n  \t\t\t\t         *   Update the item value AND the complete/repeat values.\r\n  \t\t\t\t         */\r\n  \t\t\t\t        if (task.link.type === 'anime') {\r\n                    task.complete = false;\r\n                      var animeDialog = launchAnimeUpdateDialog(task);\r\n                      animeDialog.result.then(function(result) {\r\n                        console.log('update anime task result: ', result);\r\n                        task = result.task;\r\n                        task.completeTimes = task.link.anime.episodes + 1;\r\n                        task.complete = true;\r\n                        task.repeat = task.link.anime.finalEpisode;\r\n                        obj.updateAnimeitem(task, result.episodeRating).then(function(result) {\r\n                          return obj.updateTask(task, true);\r\n                        }).then(function(result) {\r\n                          console.log('update anime into update task: ', result);\r\n                          resolve(result);\r\n                        });\r\n                      });\r\n  \t\t\t\t        } else if (task.link.type === 'manga') {\r\n  \t\t\t\t\t\t\t\t\t  task.complete = false;\r\n  \t\t\t\t            var dialog = launchMangaUpdateDialog(task);\r\n  \t\t\t\t\t\t\t\t\t\tdialog.result.then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\ttask = result;\r\n  \t\t\t\t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t\t\t\t\t\t\t\t\ttask.complete = true;\r\n  \t\t\t\t\t\t\t\t\t\t\tobj.updateMangaitem(task, task.link.manga.chapters, task.link.manga.volumes).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\t\tconsole.log('updated manga: ', result);\r\n  \t\t\t\t\t\t\t\t\t\t\t\treturn obj.updateTask(task, true);\r\n  \t\t\t\t\t\t\t\t\t\t\t}).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\t\t\tconsole.log('update manga into update task: ', result);\r\n  \t\t\t\t\t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t        }\r\n  \t\t\t\t    }\r\n  \t\t\t\t\t\tif(!isLinked) {\r\n  \t\t\t\t\t    obj.updateTask(task, isLinked).then(function(result) {\r\n  \t\t\t\t\t\t\t\tconsole.log('update task resolve: ', result);\r\n  \t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Completes a checklist item.\r\n  \t\t\t\tfunction tickOffChecklist(task, index) {\r\n  \t\t\t\t\treturn $q(function(resolve, reject) {\r\n  \t\t\t\t\t\t//update the option for the task.\r\n  \t\t\t\t\t\tvar isLinked = task.link.linked;\r\n  \t\t\t\t\t\tif (isLinked && task.link.type === 'manga') {\r\n  \t\t\t\t\t\t\t\ttask.checklistItems[index].complete = false;\r\n  \t\t\t\t\t\t\t\tvar dialog = launchMangaUpdateDialog(task, index);\r\n  \t\t\t\t\t\t\t\tdialog.result.then(function(result) {\r\n  \t\t\t\t\t\t\t\t\ttask = result;\r\n  \t\t\t\t\t\t\t\t\ttask.checklistItems[index].complete = true;\r\n  \t\t\t\t\t\t\t\t\tif(ListService.findWithAttr(task.checklistItems, 'complete', false) === -1) {\r\n  \t\t\t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t              task.complete = true;\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t\t\tobj.updateMangaitem(task, task.link.manga.chapters, task.link.manga.volumes).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\tconsole.log('updated manga: ', result);\r\n  \t\t\t\t\t\t\t\t\t\treturn obj.updateTask(task, true);\r\n  \t\t\t\t\t\t\t\t\t}).then(function(result) {\r\n  \t\t\t\t\t\t\t\t\t\tconsole.log('update manga into update task: ', result);\r\n  \t\t\t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t} else if(!isLinked) {\r\n  \t\t\t\t\t\t\tif(ListService.findWithAttr(task.checklistItems, 'complete', false) === -1) {\r\n  \t\t\t\t\t\t\t\ttask.completeTimes += 1;\r\n  \t\t\t\t\t\t\t\ttask.complete = true;\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t//console.log('tickoff checklist: ', task);\r\n  \t\t\t\t\t    obj.updateTask(task, isLinked).then(function(result) {\r\n  \t\t\t\t\t\t\t\tconsole.log('update task resolve: ', result);\r\n  \t\t\t\t\t\t\t\tresolve(result);\r\n  \t\t\t\t\t\t\t});\r\n  \t\t\t\t\t\t}\r\n  \t\t\t\t\t});\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\t//Add additional items to a checklist.\r\n  \t\t\t\tfunction insertChecklistItem(task, newChecklistItem) {\r\n  \t\t\t\t\tif (newChecklistItem!=='' && newChecklistItem!==undefined) {\r\n  \t\t\t\t\t\t\tvar alreadyAdded = false;\r\n  \t\t\t\t\t\t\t//find the item and insert the option.\r\n  \t\t\t\t\t\t\tangular.forEach(task.checklistItems, function (item) {\r\n  \t\t\t\t\t\t\t\t\tif (item === newChecklistItem) {\r\n  \t\t\t\t\t\t\t\t\t\t\talreadyAdded = true;\r\n  \t\t\t\t\t\t\t\t\t}\r\n  \t\t\t\t\t\t\t});\r\n\r\n  \t\t\t\t\t\t\t//if not in array add it.\r\n  \t\t\t\t\t\t\tif (alreadyAdded === false) {\r\n  \t\t\t\t\t\t\t\t\ttask.checklistItems.push({ text: newChecklistItem, complete: false });\r\n  \t\t\t\t\t\t\t} else if (alreadyAdded === true) {\r\n  \t\t\t\t\t\t\t\t\tNotificationFactory.popup('Option already exists.', 'Please re-name and try again.', 'error');\r\n  \t\t\t\t\t\t\t}\r\n  \t\t\t\t\t}\r\n  \t\t\t\t\tobj.updateTask(task);\r\n  \t\t\t\t}\r\n\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\t//Tasks service used to communicate Tasks REST endpoints\r\n\tangular.module('tasks').factory('Tasks', Tasks);\r\n\tTasks.$inject = ['$resource'];\r\n\r\n\t\tfunction Tasks($resource) {\r\n\t\t\treturn $resource('tasks/:taskId', { taskId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n})();\r\n\r\n'use strict';\r\n\r\n// Configuring the Articles module\r\nangular.module('toptens').run(['Menus',\r\n\tfunction(Menus) {\r\n\t\t// Set top bar menu items\r\n\t\tMenus.addMenuItem('topbar', 'Toptens', 'toptens', 'dropdown', '/toptens(/create)?');\r\n\t\tMenus.addSubMenuItem('topbar', 'toptens', 'List Toptens', 'toptens');\r\n\t\tMenus.addSubMenuItem('topbar', 'toptens', 'New Topten', 'toptens/create');\r\n\t}\r\n]);\r\n'use strict';\r\n\r\n//Setting up route\r\nangular.module('toptens').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Toptens state routing\r\n\t\t$stateProvider.\r\n\t\tstate('listToptens', {\r\n\t\t\turl: '/toptens',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/list-toptens.client.view.html'\r\n\t\t}).\r\n\t\tstate('createTopten', {\r\n\t\t\turl: '/toptens/create',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/create-topten.client.view.html'\r\n\t\t}).\r\n\t\tstate('viewTopten', {\r\n\t\t\turl: '/toptens/:toptenId',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/view-topten.client.view.html'\r\n\t\t}).\r\n\t\tstate('editTopten', {\r\n\t\t\turl: '/toptens/:toptenId/edit',\r\n\t\t\ttemplateUrl: 'modules/toptens/views/create-topten.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('toptens').controller('CreateToptenController', CreateToptenController);\r\n\tCreateToptenController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', 'Toptens', 'ListService', 'Animeitems', 'Mangaitems', 'Characters', 'NotificationFactory', 'CharacterService', 'ItemService', '$filter'];\r\n\r\n\tfunction CreateToptenController($scope, $stateParams, $location, Authentication, Toptens, ListService, Animeitems, Mangaitems, Characters, NotificationFactory, CharacterService, ItemService, $filter) {\r\n\t\tvar ctrl = this,\r\n\t\t\t\ttoptenCopy = {\r\n\t        name: '',\r\n\t        description: '',\r\n\t        type: '',\r\n\t        isFavourite: false,\r\n\t        isRanked: false,\r\n\t        animeList: [],\r\n\t        mangaList: [],\r\n\t        characterList: [],\r\n\t        conditions: {\r\n\t            limit: null,\r\n\t            series: [],\r\n\t            tags: [],\r\n\t\t\t\t\t\t\tseason: null,\r\n\t\t\t\t\t\t\tyear: null\r\n\t        }\r\n\t\t\t\t};\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.cancel = cancel;\r\n\t\tctrl.create = create;\r\n\t\tctrl.commonArrays = ListService.getCommonArrays();\r\n\t\tctrl.imgSize = {\r\n\t\t\t\theight: '50px',\r\n\t\t\t\twidth: '100px'\r\n\t\t};\r\n\t\tctrl.isCreate = true;\r\n\t\tctrl.pushCondition = pushCondition;\r\n\t\tctrl.pushItem = pushItem;\r\n\t\tctrl.removeCondition = removeCondition;\r\n\t\tctrl.removeItem = removeItem;\r\n    ctrl.stepConfig = {\r\n        steps: [1,2,3,4,5,6,7,8,9,10],\r\n        stepHeaders: [\r\n            { text: 'Select attributes' },\r\n            { text: 'Set conditions' },\r\n            { text: 'Populate list' }\r\n        ],\r\n        currentStep: 1,\r\n        stepCount: 3,\r\n        listGen: {\r\n            itemsCached: [],\r\n            items: [],\r\n            displayList: [],\r\n            seriesList: [],\r\n            typeDisplay: '',\r\n            toptenItem: '',\r\n            seriesLimit: '',\r\n            tagLimit: '',\r\n            series: [],\r\n            tags: []\r\n        },\r\n        limitMin: 0,\r\n\t\t\t\tswapping: {\r\n\t\t\t\t\tone: '',\r\n\t\t\t\t\ttwo: ''\r\n\t\t\t\t}\r\n    };\r\n\t\tctrl.swappingItems = swappingItems;\r\n\t\tctrl.takeStep = takeStep;\r\n    ctrl.topten = {};\r\n    angular.copy(toptenCopy, ctrl.topten);\r\n\t\tctrl.update = update;\r\n\t\tctrl.years = [];\r\n\t\t// Create new Topten\r\n\t\tfunction create() {\r\n            // console.log(ctrl.topten, ctrl.topten);\r\n\t\t\t// Create new Topten object\r\n\t\t\tvar topten = new Toptens();\r\n\t\t\ttopten = new Toptens ({\r\n\t\t\t\tname: ctrl.topten.name,\r\n                description: ctrl.topten.description,\r\n                type: ctrl.topten.type,\r\n                isFavourite: ctrl.topten.isFavourite,\r\n                isRanked: ctrl.topten.isRanked,\r\n                animeList: ctrl.topten.animeList.length > 0 ? ctrl.topten.animeList : null,\r\n                characterList: ctrl.topten.characterList.length > 0 ? ctrl.topten.characterList : null,\r\n                mangaList: ctrl.topten.mangaList.length > 0 ? ctrl.topten.mangaList : null,\r\n                conditions: {\r\n                    limit: ctrl.topten.conditions.limit,\r\n                    series: ctrl.topten.conditions.series,\r\n                    tags: ctrl.topten.conditions.tags,\r\n\t\t\t\t\t\t\t\t\t\tseason: ctrl.topten.conditions.season,\r\n\t\t\t\t\t\t\t\t\t\tyear: ctrl.topten.conditions.year,\r\n                }\r\n\t\t\t});\r\n\r\n\t\t\t// Redirect after save\r\n\t\t\ttopten.$save(function(response) {\r\n\t\t\t\t$location.path('toptens/' + response._id);\r\n\t\t\t\tNotificationFactory.success('Saved!', 'New List was successfully saved!');\r\n\t\t\t\t// Clear form fields\r\n\t\t\t\tangular.copy(toptenCopy, ctrl.topten);\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n\t\t\t\tNotificationFactory.error('Error!', 'Something went wrong!');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Update existing Topten\r\n\t\tfunction update() {\r\n\t\t\tvar topten = ctrl.topten;\r\n\r\n\t\t\ttopten.$update(function() {\r\n\t\t\t\t$location.path('toptens/' + topten._id);\r\n                NotificationFactory.success('Updated!', 'List update was successful!');\r\n\t\t\t}, function(errorResponse) {\r\n\t\t\t\tctrl.error = errorResponse.data.message;\r\n                NotificationFactory.error('Error!', 'Something went wrong!');\r\n\t\t\t});\r\n\t\t}\r\n\r\n    function typeSetItemPopulate() {\r\n        var type = ListService.manipulateString(ctrl.topten.type, 'upper', true);\r\n        switch(type) {\r\n            case 'Anime':\r\n                Animeitems.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'title';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n\t\t\t\t\t\t\t\t\t\tctrl.years = ItemService.endingYears(result);\r\n                });\r\n                break;\r\n            case 'Manga':\r\n                Mangaitems.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'title';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n                });\r\n                break;\r\n            case 'Character':\r\n                Characters.query().$promise.then(function(result) {\r\n                    ctrl.stepConfig.listGen.items = result;\r\n                    ctrl.stepConfig.listGen.typeDisplay = 'name';\r\n                    ctrl.stepConfig.listGen.tags = CharacterService.buildCharacterTags(result);\r\n                    ctrl.stepConfig.listGen.series = CharacterService.buildSeriesList(result);\r\n\t\t\t\t\t\t\t\t\t\tvar getYears = [];\r\n\t\t\t\t\t\t\t\t\t\tangular.forEach(result, function (item) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(item.anime) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tgetYears.push(item.anime);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tctrl.years = ItemService.endingYears(getYears);\r\n                });\r\n                break;\r\n        }\r\n        // console.log('type set: ', ctrl.stepConfig.listGen);\r\n\t\t\t}\r\n\r\n    //Processing on step submits.\r\n    function process(number, direction, callback) {\r\n        // console.log(number, direction);\r\n        switch(number) {\r\n            case 1:\r\n                if (ctrl.topten.type !== '' && ctrl.isCreate) {\r\n                    typeSetItemPopulate();\r\n                    callback();\r\n                } else if (ctrl.topten.type !== '' && !ctrl.isCreate) {\r\n                    if (ctrl.stepConfig.listGen.displayList.length < 1) {\r\n                        angular.forEach(ctrl.topten[ctrl.topten.type + 'List'], function(item) {\r\n                            var index = ListService.findWithAttr(ctrl.stepConfig.listGen.items, '_id', item._id);\r\n                            ctrl.stepConfig.listGen.displayList.push(ctrl.stepConfig.listGen.items[index]);\r\n                        });\r\n                        ctrl.stepConfig.limitMin = ctrl.stepConfig.listGen.displayList.length;\r\n                    }\r\n                    callback();\r\n                } else if (ctrl.topten.type === '') {\r\n                    NotificationFactory.popup('Invalid form', 'You MUST select a type to continue.', 'error');\r\n                }\r\n                break;\r\n\r\n            case 2:\r\n\t\t\t\t\t\t\t\tif(direction) {\r\n\t\t\t\t\t\t\t\t\tvar i = 0, j = 0, length;\r\n                  angular.copy(ctrl.stepConfig.listGen.items, ctrl.stepConfig.listGen.itemsCached);\r\n                  // console.log('pre conditions: ', ctrl.stepConfig.listGen.items.length, ctrl.stepConfig.listGen.itemsCached.length);\r\n\r\n\t\t\t\t\t\t\t\t\tif(ctrl.topten.type === 'anime') {\r\n\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.season) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('season')(ctrl.stepConfig.listGen.items, ctrl.topten.conditions.year, ctrl.topten.conditions.season);\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tNotificationFactory.popup('Invalid form', 'A year MUST be selected when selecting a season.', 'error');\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('filter')(ctrl.stepConfig.listGen.items, { season: { year: ctrl.topten.conditions.year } });\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else if(ctrl.topten.type === 'character') {\r\n\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.season) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('seasonForCharacterAnime')(ctrl.stepConfig.listGen.items, ctrl.topten.conditions.year, ctrl.topten.conditions.season);\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tNotificationFactory.popup('Invalid form', 'A year MUST be selected when selecting a season.', 'error');\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tif(ctrl.topten.conditions.year) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items = $filter('filter')(ctrl.stepConfig.listGen.items, { anime: { season: { year: ctrl.topten.conditions.year } } });\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n                  if(ctrl.topten.conditions.series.length > 0) {\r\n                      i = ctrl.stepConfig.listGen.items.length;\r\n                      while(i--) {\r\n                          var remove = true,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tattr = (ctrl.stepConfig.listGen.items[i].anime !== null) ? 'anime' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t (ctrl.stepConfig.listGen.items[i].anime !== null) ? 'manga' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t null;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlength = ctrl.topten.conditions.series.length;\r\n\t\t\t\t\t\t\t\t\t\t\t\t//  console.log('tag while: ', i, length, attr);\r\n                          if(attr !== null) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag item: ', ctrl.stepConfig.listGen.items[i]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor(j = 0; j < length; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar series = ctrl.topten.conditions.series[j];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log(ctrl.stepConfig.listGen.items[i][attr].title, series.name, ctrl.stepConfig.listGen.items[i][attr].title.indexOf(series.name));\r\n                              if(ctrl.stepConfig.listGen.items[i][attr].title.indexOf(series.name) > -1) {\r\n                                  remove = false;\r\n                              }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                            if(remove) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('remove as remove: ' + remove);\r\n                                ctrl.stepConfig.listGen.items.splice(i, 1);\r\n                            }\r\n                          } else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('straight remove');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n                          }\r\n                      }\r\n                  }\r\n\r\n                  if(ctrl.topten.conditions.tags.length > 0) {\r\n                      i = ctrl.stepConfig.listGen.items.length;\r\n                      while(i--) {\r\n                          var count = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlength = ctrl.topten.conditions.tags.length;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag while: ', i, length);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(ctrl.stepConfig.listGen.items[i].tags.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag item: ', ctrl.stepConfig.listGen.items[i].tags);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor(j = 0; j < length; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar tag = ctrl.topten.conditions.tags[j];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('tag round: ' + i + '-' + j, ctrl.stepConfig.listGen.items[i].tags, tag.tag, ListService.findWithAttr(ctrl.stepConfig.listGen.items[i].tags, 'text', tag.tag));\r\n\t                                if(ListService.findWithAttr(ctrl.stepConfig.listGen.items[i].tags, 'text', tag.tag) > -1) {\r\n\t                                    count++;\r\n\t                                }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                            if(count !== length) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('remove as count: ' + count + ' > length: ' + length);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n                            }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log('straight remove');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tctrl.stepConfig.listGen.items.splice(i, 1);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                      }\r\n                  }\r\n\t\t\t\t\t\t\t\t\t// console.log('post conditions: ', ctrl.stepConfig.listGen.items.length, ctrl.stepConfig.listGen.itemsCached.length);\r\n\t\t\t\t\t\t\t\t}\r\n                callback();\r\n                break;\r\n\r\n            case 3:\r\n                if(!direction) {\r\n                    ctrl.stepConfig.listGen.items = angular.copy(ctrl.stepConfig.listGen.itemsCached);\r\n                }\r\n                callback();\r\n                break;\r\n        }\r\n    }\r\n\r\n    function pushItem(item) {\r\n        if(ctrl.topten.conditions.limit === null || ctrl.topten.conditions.limit === 0 || ctrl.topten.conditions.limit > ctrl.stepConfig.listGen.displayList.length) {\r\n            var index = ctrl.topten[ctrl.topten.type+'List'].indexOf(item._id);\r\n            if (!ctrl.isCreate && index === -1) {\r\n                index = ListService.findWithAttr(ctrl.topten[ctrl.topten.type+'List'], '_id', item._id);\r\n            }\r\n            if (index === -1) {\r\n                ctrl.topten[ctrl.topten.type + 'List'].push(item._id);\r\n                ctrl.stepConfig.listGen.displayList.push(item);\r\n            } else {\r\n                NotificationFactory.warning('Duplicate!', 'Item has already been added to list.');\r\n            }\r\n        } else {\r\n            NotificationFactory.error('Full!', 'Item list has reached the defined capacity.');\r\n        }\r\n        ctrl.stepConfig.listGen.toptenItem = '';\r\n    }\r\n\r\n    function removeItem(item) {\r\n        //For display array.\r\n        var index = ctrl.stepConfig.listGen.displayList.indexOf(item);\r\n        ctrl.stepConfig.listGen.displayList.splice(index, 1);\r\n\r\n        //For topten list.\r\n        index = ctrl.topten[ctrl.topten.type + 'List'].indexOf(item._id);\r\n        if (!ctrl.isCreate && index === -1) {\r\n            index = ListService.findWithAttr(ctrl.topten[ctrl.topten.type+'List'], '_id', item._id);\r\n        }\r\n        ctrl.topten[ctrl.topten.type + 'List'].splice(index, 1);\r\n        NotificationFactory.warning('Removed!', 'Item has been removed from list.');\r\n    }\r\n\r\n    function pushCondition(type, item) {\r\n        var index, indexTwo;\r\n        switch(type) {\r\n            case 'series':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.series, 'name', item.name);\r\n                if(index === -1) {\r\n                    ctrl.topten.conditions.series.push(item);\r\n                } else {\r\n                    NotificationFactory.warning('Duplicate!', 'Series has already been added to list.');\r\n                }\r\n                ctrl.stepConfig.listGen.seriesLimit = '';\r\n                break;\r\n\r\n            case 'tag':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.tags, 'tag', item.tag);\r\n                if(index === -1) {\r\n                    ctrl.topten.conditions.tags.push(item);\r\n                } else {\r\n                    NotificationFactory.warning('Duplicate!', 'Tag has already been added to list.');\r\n                }\r\n                ctrl.stepConfig.listGen.tagLimit = '';\r\n                break;\r\n        }\r\n    }\r\n\r\n    function removeCondition(type, item) {\r\n        var index, indexTwo;\r\n        switch(type) {\r\n            case 'series':\r\n                index = ListService.findWithAttr(ctrl.topten.conditions.series, 'name', item.name);\r\n\t\t\t\t\t\t\t\tctrl.topten.conditions.series.splice(index, 1);\r\n                NotificationFactory.warning('Removed!', 'Series has been removed from list.');\r\n                break;\r\n\r\n            case 'tag':\r\n                index = ctrl.topten.conditions.tags.indexOf(item);\r\n                ctrl.topten.conditions.tags.splice(index, 1);\r\n                NotificationFactory.warning('Removed!', 'Tag has been removed from list.');\r\n                break;\r\n        }\r\n    }\r\n\r\n    //Step related functions:\r\n    function takeStep(number, direction) {\r\n        process(number, direction, function() {\r\n            ctrl.stepConfig.currentStep = (direction) ? number + 1 : number - 1;\r\n        });\r\n        // console.log('step: ', ctrl.stepConfig, ctrl.topten);\r\n    }\r\n    function cancel() {\r\n        $location.path('toptens');\r\n    }\r\n\r\n    function inital() {\r\n        // console.log('state params: ', $stateParams);\r\n        if ($stateParams.toptenId !== undefined) {\r\n            ctrl.isCreate = false;\r\n            Toptens.get({ toptenId: $stateParams.toptenId }).$promise.then(function(result) {\r\n                ctrl.topten = result;\r\n\t\t\t\t\t\t\t\t// console.log('topten: ', result);\r\n                typeSetItemPopulate();\r\n            });\r\n        }\r\n    }\r\n    inital();\r\n\r\n\t\tfunction swappingItems(index) {\r\n\t\t\t// console.log('item selected: ', index);\r\n\t\t\tif(ctrl.stepConfig.swapping.one === '') {\r\n\t\t\t\tctrl.stepConfig.swapping.one = index;\r\n\t\t\t} else if(ctrl.stepConfig.swapping.one === index) {\r\n\t\t\t\tctrl.stepConfig.swapping.one = '';\r\n\t\t\t} else {\r\n\t\t\t\tctrl.stepConfig.swapping.two = index;\r\n\t\t\t\t//Re-order display list.\r\n\t\t\t\tvar temp = ctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.one];\r\n\t\t\t\tctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.one] = ctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.two];\r\n\t\t\t\tctrl.stepConfig.listGen.displayList[ctrl.stepConfig.swapping.two] = temp;\r\n\t\t\t\t//Re-order topten item list.\r\n\t\t\t\ttemp = ctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.one];\r\n\t\t\t\tctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.one] = ctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.two];\r\n\t\t\t\tctrl.topten[ctrl.topten.type + 'List'][ctrl.stepConfig.swapping.two] = temp;\r\n\t\t\t\t//Clear.\r\n\t\t\t\tctrl.stepConfig.swapping.one = '';\r\n\t\t\t\tctrl.stepConfig.swapping.two = '';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens').controller('StatisticsTopten', StatisticsTopten);\r\n  StatisticsTopten.$inject = ['$scope','$uibModalInstance','list', 'CharacterService'];\r\n\r\n   function StatisticsTopten($scope, $uibModalInstance, list, CharacterService) {\r\n     var ctrl = this;\r\n\r\n     ctrl.cancel = cancel;\r\n     ctrl.list = list;\r\n     ctrl.toptenInfo = {\r\n       tags: [],\r\n       series: []\r\n     };\r\n\r\n     function process() {\r\n       var listType = ctrl.list.type + 'List';\r\n       ctrl.toptenInfo.tags = CharacterService.buildCharacterTags(ctrl.list[listType]);\r\n       if(ctrl.list.type === 'character') {\r\n         ctrl.toptenInfo.series = CharacterService.buildSeriesList(ctrl.list[listType]);\r\n       }\r\n     }\r\n     process();\r\n\r\n    function cancel() {\r\n      $uibModalInstance.dismiss('cancel');\r\n    }\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('toptens').controller('ToptensController', ToptensController);\r\n\tToptensController.$inject = ['$scope', '$stateParams', '$location', 'Authentication', '$uibModal', 'Toptens', 'NotificationFactory', 'ListService', 'spinnerService'];\r\n\r\n\tfunction ToptensController($scope, $stateParams, $location, Authentication, $uibModal, Toptens, NotificationFactory, ListService, spinnerService) {\r\n\t\tvar ctrl = this;\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.filterConfig = {\r\n\t\t\t\tshowingCount: 0,\r\n\t\t\t\texpandFilters: false,\r\n\t\t\t\tsortType: '',\r\n\t\t\t\tsortReverse: false,\r\n\t\t\t\tratingLevel: undefined,\r\n\t\t\t\tsearch: {},\r\n\t\t\t\tsearchTags: '',\r\n\t\t\t\ttagsForFilter: [],\r\n\t\t\t\ttaglessItem: false,\r\n\t\t\t\tareTagless: false,\r\n\t\t\t\tselectListOptions: {},\r\n\t\t\t\tcommonArrays: ListService.getCommonArrays()\r\n\t\t};\r\n\t\tctrl.find = find;\r\n\t\tctrl.findOne = findOne;\r\n\t\tctrl.openListStats = openListStats;\r\n\t\tctrl.pageConfig = {\r\n\t\t\t\tcurrentPage: 0,\r\n\t\t\t\tpageSize: 10\r\n\t\t};\r\n\t\tctrl.remove = remove;\r\n\t\tctrl.viewConfig = {\r\n        displayType: '',\r\n        linkSuffix: '',\r\n\t\t\t\ttags: [],\r\n\t\t\t\tseries: []\r\n    };\r\n    ctrl.whichController = 'topten';\r\n\r\n\t\t// Remove existing Topten\r\n\t\tfunction remove(topten) {\r\n\t    NotificationFactory.confirmation(function() {\r\n\t        if ( topten ) {\r\n\t            topten.$remove();\r\n\t            for (var i in ctrl.toptens) {\r\n\t                if (ctrl.toptens [i] === topten) {\r\n\t                    ctrl.toptens.splice(i, 1);\r\n\t                }\r\n\t            }\r\n\t        } else {\r\n\t            ctrl.topten.$remove(function() {\r\n\t                $location.path('toptens');\r\n\t            });\r\n\t        }\r\n\t        NotificationFactory.warning('Deleted!', 'Anime was successfully deleted.');\r\n\t    });\r\n\t\t}\r\n\r\n\t\t// Find a list of Toptens\r\n\t\tfunction find() {\r\n\t\t\tctrl.filterConfig.selectListOptions = ListService.getSelectListOptions(ctrl.whichController);\r\n\t    spinnerService.loading('topten', Toptens.query().$promise.then(function(result) {\r\n\t        ctrl.toptens = result;\r\n\t    }));\r\n\t\t\tconsole.log(ctrl.toptens);\r\n\t\t}\r\n\r\n\t\t// Find existing Topten\r\n\t\tfunction findOne() {\r\n\t    Toptens.get({ toptenId: $stateParams.toptenId }).$promise.then(function(result) {\r\n\t        ctrl.topten = result;\r\n\t        ctrl.viewConfig.displayType = (ctrl.topten.type === 'character') ? 'name' : 'title';\r\n\t        ctrl.viewConfig.linkSuffix = (ctrl.topten.type === 'character') ? 's' : 'items';\r\n\t    });\r\n\t\t}\r\n\r\n\t\tfunction openListStats() {\r\n\t\t\tvar modalInstance = $uibModal.open({\r\n\t\t\t\tanimation: true,\r\n      \ttemplateUrl: '/modules/toptens/views/statistics-topten.client.view.html',\r\n      \tcontroller: 'StatisticsTopten as ctrl',\r\n      \tsize: 'lg',\r\n      \tresolve: {\r\n        \tlist: function () {\r\n          \treturn ctrl.topten;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('horizontalListItem', horizontalListItem);\r\n\r\n   function horizontalListItem() {\r\n      return {\r\n          restrict: 'A',\r\n          replace: true,\r\n          transclude: true,\r\n          scope: {},\r\n          templateUrl: '/modules/toptens/templates/horizontal-list-item.html',\r\n          require: '^horizontalList',\r\n          link: function(scope, element, attr, horizontalListCtrl) {\r\n              scope.isVisible = false;\r\n              scope.itemWidth = horizontalListCtrl.itemWidth;\r\n              scope.position = element.index();\r\n              horizontalListCtrl.register(scope);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('horizontalList', horizontalList);\r\n\r\n   function horizontalList() {\r\n      return {\r\n          restrict: 'A',\r\n          transclude: true,\r\n          require: 'horizontalList',\r\n          scope: {},\r\n          templateUrl: '/modules/toptens/templates/horizontal-list.html',\r\n          bindToController: true,\r\n          controllerAs: 'horizontalList',\r\n          controller: function($scope) {\r\n              var self = this;\r\n              self.clicks = 0;\r\n              self.items = [];\r\n              self.moveItems = moveItems;\r\n              self.register = register;\r\n              self.shift = 0;\r\n\r\n              function register(item) {\r\n                  self.items.push(item);\r\n                  if([0, 1, 2].indexOf(item.position) > -1) {\r\n                      item.isVisible = true;\r\n                  }\r\n              }\r\n\r\n              function setVisibility() {\r\n                  var values = [],\r\n                      check = self.clicks * 3;\r\n                  for(var i = 0; i < 3; i++) {\r\n                      values.push(check + i);\r\n                  }\r\n                  angular.forEach(self.items, function(item) {\r\n                      item.isVisible = (values.indexOf(item.position) > -1);\r\n                  });\r\n              }\r\n\r\n              function moveItems(direction) {\r\n                  if(direction === 'left') {\r\n                      if((self.clicks - 1) < 0) {\r\n                          self.clicks = 0;\r\n                      } else {\r\n                          self.clicks -= 1;\r\n                      }\r\n                      setVisibility();\r\n                  } else if (direction === 'right') {\r\n                      if ((self.clicks + 1) < Math.ceil(self.items.length / 3)) {\r\n                          self.clicks += 1;\r\n                      }\r\n                      setVisibility();\r\n                  }\r\n              }\r\n\r\n          },\r\n          link: function(scope, element, attr, ctrl) {\r\n              var el = element[0],\r\n                  child = el.children[0];\r\n              scope.settings = {\r\n                  child: child,\r\n                  style: child.style,\r\n                  value: 0\r\n              };\r\n\r\n              function listSettings() {\r\n                  ctrl.shift = -el.offsetWidth;\r\n                  ctrl.itemWidth = el.offsetWidth / 3;\r\n                  angular.forEach(ctrl.items, function(item) {\r\n                      item.itemWidth = ctrl.itemWidth;\r\n                  });\r\n              }\r\n              listSettings();\r\n\r\n              window.addEventListener('resize', function(e) {\r\n                  if(el.offsetWidth !== Math.abs(ctrl.shift)) {\r\n                      listSettings();\r\n                      scope.$apply();\r\n                  }\r\n              });\r\n\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('ngMax', ngMax);\r\n\r\n  function ngMax() {\r\n      return {\r\n          restrict: 'A',\r\n          require: 'ngModel',\r\n          link: function(scope, elem, attr, ctrl) {\r\n\r\n              scope.$watch(attr.ngMax, function(){\r\n                  if (ctrl.$isDirty) ctrl.$setViewValue(ctrl.$viewValue);\r\n              });\r\n\r\n              var isEmpty = function(value) {\r\n                 return angular.isUndefined(value) || value === '' || value === null;\r\n              };\r\n\r\n              var maxValidator = function(value) {\r\n                var max = scope.$eval(attr.ngMax) || Infinity;\r\n                if (!isEmpty(value) && value > max) {\r\n                  ctrl.$setValidity('ngMax', false);\r\n                  return undefined;\r\n                } else {\r\n                  ctrl.$setValidity('ngMax', true);\r\n                  return value;\r\n                }\r\n              };\r\n\r\n              ctrl.$parsers.push(maxValidator);\r\n              ctrl.$formatters.push(maxValidator);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('ngMin', ngMin);\r\n\r\n  function ngMin() {\r\n      return {\r\n          restrict: 'A',\r\n          require: 'ngModel',\r\n          link: function(scope, elem, attr, ctrl) {\r\n              scope.$watch(attr.ngMin, function(){\r\n                  if (ctrl.$isDirty) ctrl.$setViewValue(ctrl.$viewValue);\r\n              });\r\n\r\n              var isEmpty = function(value) {\r\n                 return angular.isUndefined(value) || value === '' || value === null;\r\n              };\r\n\r\n              var minValidator = function(value) {\r\n                var min = scope.$eval(attr.ngMin) || 0;\r\n                if (!isEmpty(value) && value < min) {\r\n                  ctrl.$setValidity('ngMin', false);\r\n                  return undefined;\r\n                } else {\r\n                  ctrl.$setValidity('ngMin', true);\r\n                  return value;\r\n                }\r\n              };\r\n\r\n              ctrl.$parsers.push(minValidator);\r\n              ctrl.$formatters.push(minValidator);\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('oneStep', oneStep);\r\n\r\n  function oneStep() {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        transclude: true,\r\n        scope: {},\r\n        require: '^steps',\r\n        templateUrl: '/modules/toptens/templates/step.html',\r\n        link: function(scope, elm, attrs, stepsController) {\r\n            scope.active = false;\r\n            scope.stepNumber = elm.index() + 1;\r\n            stepsController.register(scope);\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('stepControls', stepControls);\r\n    function stepControls() {\r\n       return {\r\n           restrict: 'A',\r\n           replace: true,\r\n           transclude: true,\r\n           template: '<div class=\"step-controls step-button-group padding-5\" ng-transclude>' +\r\n                      '</div>'\r\n       };\r\n    }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('steps', steps);\r\n  function steps() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        scope: {\r\n            stepConfig: '='\r\n        },\r\n        template: '<div class=\"steps\" ng-transclude>' +\r\n                  '</div>',\r\n        bindToController: true,\r\n        controllerAs: 'steps',\r\n        controller: function($scope) {\r\n            var self = this;\r\n\r\n            self.register = register;\r\n            self.steps = [];\r\n\r\n            function register(step) {\r\n                self.steps.push(step);\r\n                if(step.stepNumber === 1) {\r\n                    step.active = true;\r\n                }\r\n            }\r\n        },\r\n        link: function(scope, element, attrs, stepsController) {\r\n          scope.$watch('steps.stepConfig.currentStep', function(newValue) {\r\n              if (newValue !== undefined) {\r\n                console.log('steps: ', newValue);\r\n                  angular.forEach(stepsController.steps, function(step) {\r\n                      if(step.stepNumber !== newValue) {\r\n                          step.active = false;\r\n                      } else {\r\n                          step.active = true;\r\n                      }\r\n                  });\r\n              }\r\n          });\r\n        }\r\n    };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .directive('sticky', sticky);\r\n\r\n  function sticky() {\r\n      return {\r\n          restrict: 'A',\r\n          scope: {},\r\n          link: function(scope, element, attrs) {\r\n\r\n              window.addEventListener('scroll', function (evt) {\r\n                  var stickyClass = 'sticky-scroll-top',\r\n                      stickyInnerClass = 'sticky-inner-container',\r\n                      scrollTop = document.body.scrollTop,\r\n                      elm = element[0],\r\n                      inner = elm.children[0],\r\n                      viewportOffset = elm.getBoundingClientRect(),\r\n                      distance_from_top = viewportOffset.top; // This value is your scroll distance from the top\r\n\r\n                  // The element has scrolled to the top of the page. Set appropriate style.\r\n                  if (distance_from_top < 56) {\r\n  //                    console.log('top hit : ', distance_from_top);\r\n                      elm.classList.add(stickyClass);\r\n                      inner.classList.add(stickyInnerClass);\r\n                  }\r\n\r\n                  // The element has not reached the top.\r\n                  if(distance_from_top > 55 || scrollTop < 10) {\r\n  //                    console.log('we are at: ', distance_from_top);\r\n                      elm.classList.remove(stickyClass);\r\n                      inner.classList.remove(stickyInnerClass);\r\n                  }\r\n            });\r\n\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  angular.module('toptens')\r\n  .filter('toptenFilter', toptenFilter);\r\n\r\n  function toptenFilter() {\r\n    return function(array, displayType, value) {\r\n        if(array !== undefined) {\r\n            return array.filter(function(item) {\r\n                if(item[displayType].toLowerCase().indexOf(value.toLowerCase()) > -1) {\r\n                    return item;\r\n                }\r\n            });\r\n        }\r\n    };\r\n  }\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\t//Toptens service used to communicate Toptens REST endpoints\r\n\tangular.module('toptens').factory('Toptens', ToptensFactory);\r\n\tToptensFactory.$inject = ['$resource'];\r\n\r\n\t\tfunction ToptensFactory($resource) {\r\n\t\t\treturn $resource('toptens/:toptenId', { toptenId: '@_id'\r\n\t\t\t}, {\r\n\t\t\t\tupdate: {\r\n\t\t\t\t\tmethod: 'PUT'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n})();\r\n\r\n'use strict';\r\n\r\n// Config HTTP Error Handling\r\nangular.module('users').config(['$httpProvider',\r\n\tfunction($httpProvider) {\r\n\t\t// Set the httpProvider \"not authorized\" interceptor\r\n\t\t$httpProvider.interceptors.push(['$q', '$location', 'Authentication',\r\n\t\t\tfunction($q, $location, Authentication) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tresponseError: function(rejection) {\r\n\t\t\t\t\t\tswitch (rejection.status) {\r\n\t\t\t\t\t\t\tcase 401:\r\n\t\t\t\t\t\t\t\t// Deauthenticate the global user\r\n\t\t\t\t\t\t\t\tAuthentication.user = null;\r\n\r\n\t\t\t\t\t\t\t\t// Redirect to signin page\r\n\t\t\t\t\t\t\t\t$location.path('signin');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 403:\r\n\t\t\t\t\t\t\t\t// Add unauthorized behaviour \r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn $q.reject(rejection);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t]);\r\n\t}\r\n]);\r\n'use strict';\r\n\r\n// Setting up route\r\nangular.module('users').config(['$stateProvider',\r\n\tfunction($stateProvider) {\r\n\t\t// Users state routing\r\n\t\t$stateProvider.\r\n\t\tstate('profile', {\r\n\t\t\turl: '/settings/profile',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/edit-profile.client.view.html'\r\n\t\t}).\r\n\t\tstate('password', {\r\n\t\t\turl: '/settings/password',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/change-password.client.view.html'\r\n\t\t}).\r\n\t\tstate('accounts', {\r\n\t\t\turl: '/settings/accounts',\r\n\t\t\ttemplateUrl: 'modules/users/views/settings/social-accounts.client.view.html'\r\n\t\t}).\r\n//\t\tstate('signup', {\r\n//\t\t\turl: '/signup',\r\n//\t\t\ttemplateUrl: 'modules/users/views/authentication/signup.client.view.html'\r\n//\t\t}).\r\n\t\tstate('signin', {\r\n\t\t\turl: '/signin',\r\n\t\t\ttemplateUrl: 'modules/users/views/authentication/signin.client.view.html'\r\n\t\t}).\r\n\t\tstate('forgot', {\r\n\t\t\turl: '/password/forgot',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/forgot-password.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset-invalid', {\r\n\t\t\turl: '/password/reset/invalid',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password-invalid.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset-success', {\r\n\t\t\turl: '/password/reset/success',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password-success.client.view.html'\r\n\t\t}).\r\n\t\tstate('reset', {\r\n\t\t\turl: '/password/reset/:token',\r\n\t\t\ttemplateUrl: 'modules/users/views/password/reset-password.client.view.html'\r\n\t\t});\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\tangular.module('users').controller('AuthenticationController', AuthenticationController);\r\n\tAuthenticationController.$inject = ['$scope', '$http', '$location', 'Authentication'];\r\n\r\n\tfunction AuthenticationController($scope, $http, $location, Authentication) {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tctrl.authentication = Authentication;\r\n\t\tctrl.signin = signin;\r\n\t\tctrl.signup = signup;\r\n\r\n\t\tfunction signup() {\r\n\t\t\t$http.post('/auth/signup', ctrl.credentials).success(function(response) {\r\n\t\t\t\t// If successful we assign the response to the global user model\r\n\t\t\t\tctrl.authentication.user = response;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/signin');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\tctrl.error = response.message;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction signin() {\r\n\t\t\tctrl.credentials.username = 'username';\r\n\t\t\t$http.post('/auth/signin', ctrl.credentials).success(function(response) {\r\n\t\t\t\t// If successful we assign the response to the global user model\r\n\t\t\t\tctrl.authentication.user = response;\r\n\t\t\t\tctrl.loginBody = true;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/tasks');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\tctrl.error = response.message;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n})();\r\n\r\n'use strict';\r\n\r\nangular.module('users').controller('PasswordController', ['$scope', '$stateParams', '$http', '$location', 'Authentication',\r\n\tfunction($scope, $stateParams, $http, $location, Authentication) {\r\n\t\t$scope.authentication = Authentication;\r\n\r\n\t\t//If user is signed in then redirect back home\r\n\t\tif ($scope.authentication.user) $location.path('/');\r\n\r\n\t\t// Submit forgotten password account id\r\n\t\t$scope.askForPasswordReset = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/auth/forgot', $scope.credentials).success(function(response) {\r\n\t\t\t\t// Show user success message and clear form\r\n\t\t\t\t$scope.credentials = null;\r\n\t\t\t\t$scope.success = response.message;\r\n\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t// Show user error message and clear form\r\n\t\t\t\t$scope.credentials = null;\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Change user password\r\n\t\t$scope.resetUserPassword = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/auth/reset/' + $stateParams.token, $scope.passwordDetails).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.passwordDetails = null;\r\n\r\n\t\t\t\t// Attach user profile\r\n\t\t\t\tAuthentication.user = response;\r\n\r\n\t\t\t\t// And redirect to the index page\r\n\t\t\t\t$location.path('/password/reset/success');\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n]);\r\n'use strict';\r\n\r\nangular.module('users').controller('SettingsController', ['$scope', '$http', '$location', 'Users', 'Authentication',\r\n\tfunction($scope, $http, $location, Users, Authentication) {\r\n\t\t$scope.user = Authentication.user;\r\n\r\n\t\t// If user is not signed in then redirect back home\r\n\t\tif (!$scope.user) $location.path('/');\r\n\r\n\t\t// Check if there are additional accounts \r\n\t\t$scope.hasConnectedAdditionalSocialAccounts = function(provider) {\r\n\t\t\tfor (var i in $scope.user.additionalProvidersData) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// Check if provider is already in use with current user\r\n\t\t$scope.isConnectedSocialAccount = function(provider) {\r\n\t\t\treturn $scope.user.provider === provider || ($scope.user.additionalProvidersData && $scope.user.additionalProvidersData[provider]);\r\n\t\t};\r\n\r\n\t\t// Remove a user social account\r\n\t\t$scope.removeUserSocialAccount = function(provider) {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.delete('/users/accounts', {\r\n\t\t\t\tparams: {\r\n\t\t\t\t\tprovider: provider\r\n\t\t\t\t}\r\n\t\t\t}).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.success = true;\r\n\t\t\t\t$scope.user = Authentication.user = response;\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Update a user profile\r\n\t\t$scope.updateUserProfile = function(isValid) {\r\n\t\t\tif (isValid) {\r\n\t\t\t\t$scope.success = $scope.error = null;\r\n\t\t\t\tvar user = new Users($scope.user);\r\n\r\n\t\t\t\tuser.$update(function(response) {\r\n\t\t\t\t\t$scope.success = true;\r\n\t\t\t\t\tAuthentication.user = response;\r\n\t\t\t\t}, function(response) {\r\n\t\t\t\t\t$scope.error = response.data.message;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t$scope.submitted = true;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Change user password\r\n\t\t$scope.changeUserPassword = function() {\r\n\t\t\t$scope.success = $scope.error = null;\r\n\r\n\t\t\t$http.post('/users/password', $scope.passwordDetails).success(function(response) {\r\n\t\t\t\t// If successful show success message and clear form\r\n\t\t\t\t$scope.success = true;\r\n\t\t\t\t$scope.passwordDetails = null;\r\n\t\t\t}).error(function(response) {\r\n\t\t\t\t$scope.error = response.message;\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n]);\r\n(function() {\r\n\t'use strict';\r\n\t// Authentication service for user variables\r\n\tangular.module('users').factory('Authentication', AuthenticationFactory);\r\n\r\n\tfunction AuthenticationFactory() {\r\n\t\tvar _this = this;\r\n\r\n\t\t_this._data = {\r\n\t\t\tuser: window.user\r\n\t\t};\r\n\r\n\t\treturn _this._data;\r\n\t}\r\n\r\n})();\r\n\r\n(function() {\r\n\t'use strict';\r\n\t// Users service used for communicating with the users REST endpoint\r\n\tangular.module('users').factory('Users', UsersFactory);\r\n\tUsersFactory.$inject = ['$resource'];\r\n\r\n\tfunction UsersFactory($resource) {\r\n\t\treturn $resource('users', {}, {\r\n\t\t\tupdate: {\r\n\t\t\t\tmethod: 'PUT'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})();\r\n"]}